"use strict";var iQ=Object.create;var iS=Object.defineProperty;var KU=Object.getOwnPropertyDescriptor;var oQ=Object.getOwnPropertyNames;var sQ=Object.getPrototypeOf,aQ=Object.prototype.hasOwnProperty;var cQ=(r,e)=>()=>(r&&(e=r(r=0)),e);var N=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),FU=(r,e)=>{for(var t in e)iS(r,t,{get:e[t],enumerable:!0})},LU=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of oQ(e))!aQ.call(r,i)&&i!==t&&iS(r,i,{get:()=>e[i],enumerable:!(n=KU(e,i))||n.enumerable});return r};var k=(r,e,t)=>(t=r!=null?iQ(sQ(r)):{},LU(e||!r||!r.__esModule?iS(t,"default",{value:r,enumerable:!0}):t,r)),UU=r=>LU(iS({},"__esModule",{value:!0}),r),g=(r,e,t,n)=>{for(var i=n>1?void 0:n?KU(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&iS(e,t,i),i},d=(r,e)=>(t,n)=>e(t,n,r);var WU=N(()=>{var jU;(function(r){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(r);typeof t.Reflect>"u"?t.Reflect=r:n=i(t.Reflect,n),e(n);function i(o,s){return function(a,c){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:c}),s&&s(a,c)}}})(function(e){var t=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,c=!s&&!a,l={create:s?function(){return rn(Object.create(null))}:a?function(){return rn({__proto__:null})}:function(){return rn({})},has:c?function($,ne){return t.call($,ne)}:function($,ne){return ne in $},get:c?function($,ne){return t.call($,ne)?$[ne]:void 0}:function($,ne){return $[ne]}},u=Object.getPrototypeOf(Function),p=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",m=!p&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:xr(),h=!p&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Wr(),v=!p&&typeof WeakMap=="function"?WeakMap:kr(),b=new v;function w($,ne,he,we){if(Ct(he)){if(!bl($))throw new TypeError;if(!W(ne))throw new TypeError;return Oe($,ne)}else{if(!bl($))throw new TypeError;if(!Vt(ne))throw new TypeError;if(!Vt(we)&&!Ct(we)&&!jr(we))throw new TypeError;return jr(we)&&(we=void 0),he=Xn(he),Je($,ne,he,we)}}e("decorate",w);function D($,ne){function he(we,He){if(!Vt(we))throw new TypeError;if(!Ct(He)&&!be(He))throw new TypeError;Y($,ne,we,He)}return he}e("metadata",D);function T($,ne,he,we){if(!Vt(he))throw new TypeError;return Ct(we)||(we=Xn(we)),Y($,ne,he,we)}e("defineMetadata",T);function F($,ne,he){if(!Vt(ne))throw new TypeError;return Ct(he)||(he=Xn(he)),mt($,ne,he)}e("hasMetadata",F);function ee($,ne,he){if(!Vt(ne))throw new TypeError;return Ct(he)||(he=Xn(he)),rt($,ne,he)}e("hasOwnMetadata",ee);function de($,ne,he){if(!Vt(ne))throw new TypeError;return Ct(he)||(he=Xn(he)),oe($,ne,he)}e("getMetadata",de);function Z($,ne,he){if(!Vt(ne))throw new TypeError;return Ct(he)||(he=Xn(he)),Pe($,ne,he)}e("getOwnMetadata",Z);function ye($,ne){if(!Vt($))throw new TypeError;return Ct(ne)||(ne=Xn(ne)),ve($,ne)}e("getMetadataKeys",ye);function ue($,ne){if(!Vt($))throw new TypeError;return Ct(ne)||(ne=Xn(ne)),Ve($,ne)}e("getOwnMetadataKeys",ue);function le($,ne,he){if(!Vt(ne))throw new TypeError;Ct(he)||(he=Xn(he));var we=vt(ne,he,!1);if(Ct(we)||!we.delete($))return!1;if(we.size>0)return!0;var He=b.get(ne);return He.delete(he),He.size>0||b.delete(ne),!0}e("deleteMetadata",le);function Oe($,ne){for(var he=$.length-1;he>=0;--he){var we=$[he],He=we(ne);if(!Ct(He)&&!jr(He)){if(!W(He))throw new TypeError;ne=He}}return ne}function Je($,ne,he,we){for(var He=$.length-1;He>=0;--He){var nn=$[He],wt=nn(ne,he,we);if(!Ct(wt)&&!jr(wt)){if(!Vt(wt))throw new TypeError;we=wt}}return we}function vt($,ne,he){var we=b.get($);if(Ct(we)){if(!he)return;we=new m,b.set($,we)}var He=we.get(ne);if(Ct(He)){if(!he)return;He=new m,we.set(ne,He)}return He}function mt($,ne,he){var we=rt($,ne,he);if(we)return!0;var He=Mt(ne);return jr(He)?!1:mt($,He,he)}function rt($,ne,he){var we=vt(ne,he,!1);return Ct(we)?!1:Nt(we.has($))}function oe($,ne,he){var we=rt($,ne,he);if(we)return Pe($,ne,he);var He=Mt(ne);if(!jr(He))return oe($,He,he)}function Pe($,ne,he){var we=vt(ne,he,!1);if(!Ct(we))return we.get($)}function Y($,ne,he,we){var He=vt(he,we,!0);He.set($,ne)}function ve($,ne){var he=Ve($,ne),we=Mt($);if(we===null)return he;var He=ve(we,ne);if(He.length<=0)return he;if(he.length<=0)return He;for(var nn=new h,wt=[],Dt=0,ot=he;Dt<ot.length;Dt++){var Lt=ot[Dt],ie=nn.has(Lt);ie||(nn.add(Lt),wt.push(Lt))}for(var me=0,B=He;me<B.length;me++){var Lt=B[me],ie=nn.has(Lt);ie||(nn.add(Lt),wt.push(Lt))}return wt}function Ve($,ne){var he=[],we=vt($,ne,!1);if(Ct(we))return he;for(var He=we.keys(),nn=nt(He),wt=0;;){var Dt=Ht(nn);if(!Dt)return he.length=wt,he;var ot=tn(Dt);try{he[wt]=ot}catch(Lt){try{jt(nn)}finally{throw Lt}}wt++}}function un($){if($===null)return 1;switch(typeof $){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return $===null?1:6;default:return 6}}function Ct($){return $===void 0}function jr($){return $===null}function cs($){return typeof $=="symbol"}function Vt($){return typeof $=="object"?$!==null:typeof $=="function"}function en($,ne){switch(un($)){case 0:return $;case 1:return $;case 2:return $;case 3:return $;case 4:return $;case 5:return $}var he=ne===3?"string":ne===5?"number":"default",we=Ne($,i);if(we!==void 0){var He=we.call($,he);if(Vt(He))throw new TypeError;return He}return Li($,he==="default"?"number":he)}function Li($,ne){if(ne==="string"){var he=$.toString;if(L(he)){var we=he.call($);if(!Vt(we))return we}var He=$.valueOf;if(L(He)){var we=He.call($);if(!Vt(we))return we}}else{var He=$.valueOf;if(L(He)){var we=He.call($);if(!Vt(we))return we}var nn=$.toString;if(L(nn)){var we=nn.call($);if(!Vt(we))return we}}throw new TypeError}function Nt($){return!!$}function or($){return""+$}function Xn($){var ne=en($,3);return cs(ne)?ne:or(ne)}function bl($){return Array.isArray?Array.isArray($):$ instanceof Object?$ instanceof Array:Object.prototype.toString.call($)==="[object Array]"}function L($){return typeof $=="function"}function W($){return typeof $=="function"}function be($){switch(un($)){case 3:return!0;case 4:return!0;default:return!1}}function Ne($,ne){var he=$[ne];if(he!=null){if(!L(he))throw new TypeError;return he}}function nt($){var ne=Ne($,o);if(!L(ne))throw new TypeError;var he=ne.call($);if(!Vt(he))throw new TypeError;return he}function tn($){return $.value}function Ht($){var ne=$.next();return ne.done?!1:ne}function jt($){var ne=$.return;ne&&ne.call($)}function Mt($){var ne=Object.getPrototypeOf($);if(typeof $!="function"||$===u||ne!==u)return ne;var he=$.prototype,we=he&&Object.getPrototypeOf(he);if(we==null||we===Object.prototype)return ne;var He=we.constructor;return typeof He!="function"||He===$?ne:He}function xr(){var $={},ne=[],he=function(){function wt(Dt,ot,Lt){this._index=0,this._keys=Dt,this._values=ot,this._selector=Lt}return wt.prototype["@@iterator"]=function(){return this},wt.prototype[o]=function(){return this},wt.prototype.next=function(){var Dt=this._index;if(Dt>=0&&Dt<this._keys.length){var ot=this._selector(this._keys[Dt],this._values[Dt]);return Dt+1>=this._keys.length?(this._index=-1,this._keys=ne,this._values=ne):this._index++,{value:ot,done:!1}}return{value:void 0,done:!0}},wt.prototype.throw=function(Dt){throw this._index>=0&&(this._index=-1,this._keys=ne,this._values=ne),Dt},wt.prototype.return=function(Dt){return this._index>=0&&(this._index=-1,this._keys=ne,this._values=ne),{value:Dt,done:!0}},wt}();return function(){function wt(){this._keys=[],this._values=[],this._cacheKey=$,this._cacheIndex=-2}return Object.defineProperty(wt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),wt.prototype.has=function(Dt){return this._find(Dt,!1)>=0},wt.prototype.get=function(Dt){var ot=this._find(Dt,!1);return ot>=0?this._values[ot]:void 0},wt.prototype.set=function(Dt,ot){var Lt=this._find(Dt,!0);return this._values[Lt]=ot,this},wt.prototype.delete=function(Dt){var ot=this._find(Dt,!1);if(ot>=0){for(var Lt=this._keys.length,ie=ot+1;ie<Lt;ie++)this._keys[ie-1]=this._keys[ie],this._values[ie-1]=this._values[ie];return this._keys.length--,this._values.length--,Dt===this._cacheKey&&(this._cacheKey=$,this._cacheIndex=-2),!0}return!1},wt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=$,this._cacheIndex=-2},wt.prototype.keys=function(){return new he(this._keys,this._values,we)},wt.prototype.values=function(){return new he(this._keys,this._values,He)},wt.prototype.entries=function(){return new he(this._keys,this._values,nn)},wt.prototype["@@iterator"]=function(){return this.entries()},wt.prototype[o]=function(){return this.entries()},wt.prototype._find=function(Dt,ot){return this._cacheKey!==Dt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Dt)),this._cacheIndex<0&&ot&&(this._cacheIndex=this._keys.length,this._keys.push(Dt),this._values.push(void 0)),this._cacheIndex},wt}();function we(wt,Dt){return wt}function He(wt,Dt){return Dt}function nn(wt,Dt){return[wt,Dt]}}function Wr(){return function(){function $(){this._map=new m}return Object.defineProperty($.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),$.prototype.has=function(ne){return this._map.has(ne)},$.prototype.add=function(ne){return this._map.set(ne,ne),this},$.prototype.delete=function(ne){return this._map.delete(ne)},$.prototype.clear=function(){this._map.clear()},$.prototype.keys=function(){return this._map.keys()},$.prototype.values=function(){return this._map.values()},$.prototype.entries=function(){return this._map.entries()},$.prototype["@@iterator"]=function(){return this.keys()},$.prototype[o]=function(){return this.keys()},$}()}function kr(){var $=16,ne=l.create(),he=we();return function(){function ot(){this._key=we()}return ot.prototype.has=function(Lt){var ie=He(Lt,!1);return ie!==void 0?l.has(ie,this._key):!1},ot.prototype.get=function(Lt){var ie=He(Lt,!1);return ie!==void 0?l.get(ie,this._key):void 0},ot.prototype.set=function(Lt,ie){var me=He(Lt,!0);return me[this._key]=ie,this},ot.prototype.delete=function(Lt){var ie=He(Lt,!1);return ie!==void 0?delete ie[this._key]:!1},ot.prototype.clear=function(){this._key=we()},ot}();function we(){var ot;do ot="@@WeakMap@@"+Dt();while(l.has(ne,ot));return ne[ot]=!0,ot}function He(ot,Lt){if(!t.call(ot,he)){if(!Lt)return;Object.defineProperty(ot,he,{value:l.create()})}return ot[he]}function nn(ot,Lt){for(var ie=0;ie<Lt;++ie)ot[ie]=Math.random()*255|0;return ot}function wt(ot){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(ot)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(ot)):nn(new Uint8Array(ot),ot):nn(new Array(ot),ot)}function Dt(){var ot=wt($);ot[6]=ot[6]&79|64,ot[8]=ot[8]&191|128;for(var Lt="",ie=0;ie<$;++ie){var me=ot[ie];(ie===4||ie===6||ie===8)&&(Lt+="-"),me<16&&(Lt+="0"),Lt+=me.toString(16).toLowerCase()}return Lt}}function rn($){return $.__=void 0,delete $.__,$}})})(jU||(jU={}))});var VU={};FU(VU,{isPreRelesVersionOfJupyterExtension:()=>lQ});var lQ,BU=cQ(()=>{"use strict";lQ=!1});var Cn=N(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.NON_CUSTOM_TAG_KEYS=Xt.PRE_DESTROY=Xt.POST_CONSTRUCT=Xt.DESIGN_PARAM_TYPES=Xt.PARAM_TYPES=Xt.TAGGED_PROP=Xt.TAGGED=Xt.MULTI_INJECT_TAG=Xt.INJECT_TAG=Xt.OPTIONAL_TAG=Xt.UNMANAGED_TAG=Xt.NAME_TAG=Xt.NAMED_TAG=void 0;Xt.NAMED_TAG="named";Xt.NAME_TAG="name";Xt.UNMANAGED_TAG="unmanaged";Xt.OPTIONAL_TAG="optional";Xt.INJECT_TAG="inject";Xt.MULTI_INJECT_TAG="multi_inject";Xt.TAGGED="inversify:tagged";Xt.TAGGED_PROP="inversify:tagged_props";Xt.PARAM_TYPES="inversify:paramtypes";Xt.DESIGN_PARAM_TYPES="design:paramtypes";Xt.POST_CONSTRUCT="post_construct";Xt.PRE_DESTROY="pre_destroy";function VQ(){return[Xt.INJECT_TAG,Xt.MULTI_INJECT_TAG,Xt.NAME_TAG,Xt.UNMANAGED_TAG,Xt.NAMED_TAG,Xt.OPTIONAL_TAG]}Xt.NON_CUSTOM_TAG_KEYS=VQ()});var oa=N(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0});Gu.TargetTypeEnum=Gu.BindingTypeEnum=Gu.BindingScopeEnum=void 0;var BQ={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Gu.BindingScopeEnum=BQ;var qQ={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Gu.BindingTypeEnum=qQ;var JQ={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Gu.TargetTypeEnum=JQ});var zu=N(Mw=>{"use strict";Object.defineProperty(Mw,"__esModule",{value:!0});Mw.id=void 0;var $Q=0;function HQ(){return $Q++}Mw.id=HQ});var Rj=N(Ow=>{"use strict";Object.defineProperty(Ow,"__esModule",{value:!0});Ow.Binding=void 0;var Tj=oa(),GQ=zu(),zQ=function(){function r(e,t){this.id=(0,GQ.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=Tj.BindingTypeEnum.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return r.prototype.clone=function(){var e=new r(this.serviceIdentifier,this.scope);return e.activated=e.scope===Tj.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},r}();Ow.Binding=zQ});var xi=N(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.STACK_OVERFLOW=Ue.CIRCULAR_DEPENDENCY_IN_FACTORY=Ue.ON_DEACTIVATION_ERROR=Ue.PRE_DESTROY_ERROR=Ue.POST_CONSTRUCT_ERROR=Ue.ASYNC_UNBIND_REQUIRED=Ue.MULTIPLE_POST_CONSTRUCT_METHODS=Ue.MULTIPLE_PRE_DESTROY_METHODS=Ue.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ue.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ue.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ue.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ue.ARGUMENTS_LENGTH_MISMATCH=Ue.INVALID_DECORATOR_OPERATION=Ue.INVALID_TO_SELF_VALUE=Ue.LAZY_IN_SYNC=Ue.INVALID_FUNCTION_BINDING=Ue.INVALID_MIDDLEWARE_RETURN=Ue.NO_MORE_SNAPSHOTS_AVAILABLE=Ue.INVALID_BINDING_TYPE=Ue.NOT_IMPLEMENTED=Ue.CIRCULAR_DEPENDENCY=Ue.UNDEFINED_INJECT_ANNOTATION=Ue.MISSING_INJECT_ANNOTATION=Ue.MISSING_INJECTABLE_ANNOTATION=Ue.NOT_REGISTERED=Ue.CANNOT_UNBIND=Ue.AMBIGUOUS_MATCH=Ue.KEY_NOT_FOUND=Ue.NULL_ARGUMENT=Ue.DUPLICATED_METADATA=Ue.DUPLICATED_INJECTABLE_DECORATOR=void 0;Ue.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Ue.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Ue.NULL_ARGUMENT="NULL argument";Ue.KEY_NOT_FOUND="Key Not Found";Ue.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Ue.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Ue.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Ue.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Ue.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var QQ=function(r){return"@inject called with undefined this could mean that the class "+r+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ue.UNDEFINED_INJECT_ANNOTATION=QQ;Ue.CIRCULAR_DEPENDENCY="Circular dependency found:";Ue.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Ue.INVALID_BINDING_TYPE="Invalid binding type:";Ue.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Ue.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Ue.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var YQ=function(r){return"You are attempting to construct '"+r+`' in a synchronous way
 but it has asynchronous dependencies.`};Ue.LAZY_IN_SYNC=YQ;Ue.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Ue.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var XQ=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return"The number of constructor arguments in the derived class "+(r[0]+" must be >= than the number of constructor arguments of its base class.")};Ue.ARGUMENTS_LENGTH_MISMATCH=XQ;Ue.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Ue.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Ue.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Ue.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Ue.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Ue.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Ue.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var ZQ=function(r,e){return"@postConstruct error in class "+r+": "+e};Ue.POST_CONSTRUCT_ERROR=ZQ;var eY=function(r,e){return"@preDestroy error in class "+r+": "+e};Ue.PRE_DESTROY_ERROR=eY;var tY=function(r,e){return"onDeactivation() error in class "+r+": "+e};Ue.ON_DEACTIVATION_ERROR=tY;var rY=function(r,e){return"It looks like there is a circular dependency in one of the '"+r+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Ue.CIRCULAR_DEPENDENCY_IN_FACTORY=rY;Ue.STACK_OVERFLOW="Maximum call stack size exceeded"});var VR=N(Ha=>{"use strict";var nY=Ha&&Ha.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),iY=Ha&&Ha.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),oY=Ha&&Ha.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&nY(e,r,t);return iY(e,r),e};Object.defineProperty(Ha,"__esModule",{value:!0});Ha.MetadataReader=void 0;var WR=oY(Cn()),sY=function(){function r(){}return r.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(WR.PARAM_TYPES,e),n=Reflect.getMetadata(WR.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:n||{}}},r.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(WR.TAGGED_PROP,e)||[];return t},r}();Ha.MetadataReader=sY});var Aj=N(Kw=>{"use strict";Object.defineProperty(Kw,"__esModule",{value:!0});Kw.BindingCount=void 0;var aY={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Kw.BindingCount=aY});var BR=N(fs=>{"use strict";var cY=fs&&fs.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),lY=fs&&fs.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),uY=fs&&fs.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&cY(e,r,t);return lY(e,r),e};Object.defineProperty(fs,"__esModule",{value:!0});fs.tryAndThrowErrorIfStackOverflow=fs.isStackOverflowExeption=void 0;var pY=uY(xi());function Nj(r){return r instanceof RangeError||r.message===pY.STACK_OVERFLOW}fs.isStackOverflowExeption=Nj;var dY=function(r,e){try{return r()}catch(t){throw Nj(t)&&(t=e()),t}};fs.tryAndThrowErrorIfStackOverflow=dY});var vh=N(wn=>{"use strict";var mY=wn&&wn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fY=wn&&wn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),hY=wn&&wn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&mY(e,r,t);return fY(e,r),e};Object.defineProperty(wn,"__esModule",{value:!0});wn.getSymbolDescription=wn.circularDependencyToException=wn.listMetadataForTarget=wn.listRegisteredBindingsForServiceIdentifier=wn.getServiceIdentifierAsString=wn.getFunctionName=void 0;var gY=hY(xi());function Mj(r){if(typeof r=="function"){var e=r;return e.name}else{if(typeof r=="symbol")return r.toString();var e=r;return e}}wn.getServiceIdentifierAsString=Mj;function vY(r,e,t){var n="",i=t(r,e);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=Fj(o.implementationType)),n=n+`
 `+s,o.constraint.metaData&&(n=n+" - "+o.constraint.metaData)})),n}wn.listRegisteredBindingsForServiceIdentifier=vY;function Oj(r,e){return r.parentRequest===null?!1:r.parentRequest.serviceIdentifier===e?!0:Oj(r.parentRequest,e)}function yY(r){function e(n,i){i===void 0&&(i=[]);var o=Mj(n.serviceIdentifier);return i.push(o),n.parentRequest!==null?e(n.parentRequest,i):i}var t=e(r);return t.reverse().join(" --> ")}function Kj(r){r.childRequests.forEach(function(e){if(Oj(e,e.serviceIdentifier)){var t=yY(e);throw new Error(gY.CIRCULAR_DEPENDENCY+" "+t)}else Kj(e)})}wn.circularDependencyToException=Kj;function bY(r,e){if(e.isTagged()||e.isNamed()){var t="",n=e.getNamedTag(),i=e.getCustomTags();return n!==null&&(t+=n.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+r+`
 `+r+" - "+t}else return" "+r}wn.listMetadataForTarget=bY;function Fj(r){if(r.name)return r.name;var e=r.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}wn.getFunctionName=Fj;function IY(r){return r.toString().slice(7,-1)}wn.getSymbolDescription=IY});var Lj=N(Fw=>{"use strict";Object.defineProperty(Fw,"__esModule",{value:!0});Fw.Context=void 0;var SY=zu(),xY=function(){function r(e){this.id=(0,SY.id)(),this.container=e}return r.prototype.addPlan=function(e){this.plan=e},r.prototype.setCurrentRequest=function(e){this.currentRequest=e},r}();Fw.Context=xY});var sa=N(Ga=>{"use strict";var CY=Ga&&Ga.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),wY=Ga&&Ga.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),EY=Ga&&Ga.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&CY(e,r,t);return wY(e,r),e};Object.defineProperty(Ga,"__esModule",{value:!0});Ga.Metadata=void 0;var PY=EY(Cn()),kY=function(){function r(e,t){this.key=e,this.value=t}return r.prototype.toString=function(){return this.key===PY.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},r}();Ga.Metadata=kY});var Uj=N(Lw=>{"use strict";Object.defineProperty(Lw,"__esModule",{value:!0});Lw.Plan=void 0;var DY=function(){function r(e,t){this.parentContext=e,this.rootRequest=t}return r}();Lw.Plan=DY});var qR=N(Uw=>{"use strict";Object.defineProperty(Uw,"__esModule",{value:!0});Uw.LazyServiceIdentifer=void 0;var _Y=function(){function r(e){this._cb=e}return r.prototype.unwrap=function(){return this._cb()},r}();Uw.LazyServiceIdentifer=_Y});var jj=N(jw=>{"use strict";Object.defineProperty(jw,"__esModule",{value:!0});jw.QueryableString=void 0;var TY=function(){function r(e){this.str=e}return r.prototype.startsWith=function(e){return this.str.indexOf(e)===0},r.prototype.endsWith=function(e){var t="",n=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},n)},r.prototype.contains=function(e){return this.str.indexOf(e)!==-1},r.prototype.equals=function(e){return this.str===e},r.prototype.value=function(){return this.str},r}();jw.QueryableString=TY});var JR=N(za=>{"use strict";var RY=za&&za.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),AY=za&&za.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),NY=za&&za.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&RY(e,r,t);return AY(e,r),e};Object.defineProperty(za,"__esModule",{value:!0});za.Target=void 0;var kl=NY(Cn()),MY=zu(),OY=vh(),Wj=sa(),KY=jj(),FY=function(){function r(e,t,n,i){this.id=(0,MY.id)(),this.type=e,this.serviceIdentifier=n;var o=typeof t=="symbol"?(0,OY.getSymbolDescription)(t):t;this.name=new KY.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new Wj.Metadata(kl.NAMED_TAG,i):i instanceof Wj.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return r.prototype.hasTag=function(e){for(var t=0,n=this.metadata;t<n.length;t++){var i=n[t];if(i.key===e)return!0}return!1},r.prototype.isArray=function(){return this.hasTag(kl.MULTI_INJECT_TAG)},r.prototype.matchesArray=function(e){return this.matchesTag(kl.MULTI_INJECT_TAG)(e)},r.prototype.isNamed=function(){return this.hasTag(kl.NAMED_TAG)},r.prototype.isTagged=function(){return this.metadata.some(function(e){return kl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},r.prototype.isOptional=function(){return this.matchesTag(kl.OPTIONAL_TAG)(!0)},r.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===kl.NAMED_TAG})[0]:null},r.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return kl.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},r.prototype.matchesNamedTag=function(e){return this.matchesTag(kl.NAMED_TAG)(e)},r.prototype.matchesTag=function(e){var t=this;return function(n){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===n)return!0}return!1}},r}();za.Target=FY});var zj=N(Ci=>{"use strict";var LY=Ci&&Ci.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),UY=Ci&&Ci.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Vj=Ci&&Ci.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&LY(e,r,t);return UY(e,r),e},Ww=Ci&&Ci.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.getFunctionName=Ci.getBaseClassDependencyCount=Ci.getDependencies=void 0;var jY=qR(),$R=Vj(xi()),Bj=oa(),xS=Vj(Cn()),HR=vh();Object.defineProperty(Ci,"getFunctionName",{enumerable:!0,get:function(){return HR.getFunctionName}});var qj=JR();function WY(r,e){var t=(0,HR.getFunctionName)(e);return Jj(r,t,e,!1)}Ci.getDependencies=WY;function Jj(r,e,t,n){var i=r.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=$R.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,c=Object.keys(a),l=t.length===0&&c.length>0,u=c.length>t.length,p=l||u?c.length:t.length,m=BY(n,e,o,a,p),h=$j(r,t,e),v=Ww(Ww([],m,!0),h,!0);return v}function VY(r,e,t,n,i){var o=i[r.toString()]||[],s=Gj(o),a=s.unmanaged!==!0,c=n[r],l=s.inject||s.multiInject;if(c=l||c,c instanceof jY.LazyServiceIdentifer&&(c=c.unwrap()),a){var u=c===Object,p=c===Function,m=c===void 0,h=u||p||m;if(!e&&h){var v=$R.MISSING_INJECT_ANNOTATION+" argument "+r+" in class "+t+".";throw new Error(v)}var b=new qj.Target(Bj.TargetTypeEnum.ConstructorArgument,s.targetName,c);return b.metadata=o,b}return null}function BY(r,e,t,n,i){for(var o=[],s=0;s<i;s++){var a=s,c=VY(a,r,e,t,n);c!==null&&o.push(c)}return o}function qY(r,e,t,n){var i=r||e;if(i===void 0){var o=$R.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+n+".";throw new Error(o)}return i}function $j(r,e,t){for(var n=r.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(n),s=Object.keys(n),a=s.concat(o),c=0,l=a;c<l.length;c++){var u=l[c],p=n[u],m=Gj(p),h=m.targetName||u,v=qY(m.inject,m.multiInject,u,t),b=new qj.Target(Bj.TargetTypeEnum.ClassProperty,h,v);b.metadata=p,i.push(b)}var w=Object.getPrototypeOf(e.prototype).constructor;if(w!==Object){var D=$j(r,w,t);i=Ww(Ww([],i,!0),D,!0)}return i}function Hj(r,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var n=(0,HR.getFunctionName)(t),i=Jj(r,n,t,!0),o=i.map(function(c){return c.metadata.filter(function(l){return l.key===xS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:Hj(r,t)}else return 0}Ci.getBaseClassDependencyCount=Hj;function Gj(r){var e={};return r.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[xS.INJECT_TAG],multiInject:e[xS.MULTI_INJECT_TAG],targetName:e[xS.NAME_TAG],unmanaged:e[xS.UNMANAGED_TAG]}}});var Qj=N(Vw=>{"use strict";Object.defineProperty(Vw,"__esModule",{value:!0});Vw.Request=void 0;var JY=zu(),$Y=function(){function r(e,t,n,i,o){this.id=(0,JY.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return r.prototype.addChildRequest=function(e,t,n){var i=new r(e,this.parentContext,this,t,n);return this.childRequests.push(i),i},r}();Vw.Request=$Y});var XR=N(io=>{"use strict";var HY=io&&io.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),GY=io&&io.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Zj=io&&io.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&HY(e,r,t);return GY(e,r),e};Object.defineProperty(io,"__esModule",{value:!0});io.getBindingDictionary=io.createMockRequest=io.plan=void 0;var Bw=Aj(),zR=Zj(xi()),eW=oa(),Yj=Zj(Cn()),zY=BR(),yh=vh(),tW=Lj(),QR=sa(),QY=Uj(),GR=zj(),YR=Qj(),rW=JR();function nW(r){return r._bindingDictionary}io.getBindingDictionary=nW;function YY(r,e,t,n,i,o){var s=r?Yj.MULTI_INJECT_TAG:Yj.INJECT_TAG,a=new QR.Metadata(s,t),c=new rW.Target(e,n,t,a);if(i!==void 0){var l=new QR.Metadata(i,o);c.metadata.push(l)}return c}function Xj(r,e,t,n,i){var o=CS(t.container,i.serviceIdentifier),s=[];return o.length===Bw.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&r.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=CS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var c=new YR.Request(a.serviceIdentifier,t,n,a,i);return a.constraint(c)}),XY(i.serviceIdentifier,s,i,t.container),s}function XY(r,e,t,n){switch(e.length){case Bw.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,yh.getServiceIdentifierAsString)(r),o=zR.NOT_REGISTERED;throw o+=(0,yh.listMetadataForTarget)(i,t),o+=(0,yh.listRegisteredBindingsForServiceIdentifier)(n,i,CS),new Error(o);case Bw.BindingCount.OnlyOneBindingAvailable:return e;case Bw.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,yh.getServiceIdentifierAsString)(r),o=zR.AMBIGUOUS_MATCH+" "+i;throw o+=(0,yh.listRegisteredBindingsForServiceIdentifier)(n,i,CS),new Error(o)}}function iW(r,e,t,n,i,o){var s,a;if(i===null){s=Xj(r,e,n,null,o),a=new YR.Request(t,n,null,s,o);var c=new QY.Plan(n,a);n.addPlan(c)}else s=Xj(r,e,n,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(l){var u=null;if(o.isArray())u=a.addChildRequest(l.serviceIdentifier,l,o);else{if(l.cache)return;u=a}if(l.type===eW.BindingTypeEnum.Instance&&l.implementationType!==null){var p=(0,GR.getDependencies)(r,l.implementationType);if(!n.container.options.skipBaseClassChecks){var m=(0,GR.getBaseClassDependencyCount)(r,l.implementationType);if(p.length<m){var h=zR.ARGUMENTS_LENGTH_MISMATCH((0,GR.getFunctionName)(l.implementationType));throw new Error(h)}}p.forEach(function(v){iW(r,!1,v.serviceIdentifier,n,u,v)})}})}function CS(r,e){var t=[],n=nW(r);return n.hasKey(e)?t=n.get(e):r.parent!==null&&(t=CS(r.parent,e)),t}function ZY(r,e,t,n,i,o,s,a){a===void 0&&(a=!1);var c=new tW.Context(e),l=YY(t,n,i,"",o,s);try{return iW(r,a,i,c,null,l),c}catch(u){throw(0,zY.isStackOverflowExeption)(u)&&(0,yh.circularDependencyToException)(c.plan.rootRequest),u}}io.plan=ZY;function eX(r,e,t,n){var i=new rW.Target(eW.TargetTypeEnum.Variable,"",e,new QR.Metadata(t,n)),o=new tW.Context(r),s=new YR.Request(e,o,null,[],i);return s}io.createMockRequest=eX});var wS=N(bh=>{"use strict";Object.defineProperty(bh,"__esModule",{value:!0});bh.isPromiseOrContainsPromise=bh.isPromise=void 0;function ZR(r){var e=typeof r=="object"&&r!==null||typeof r=="function";return e&&typeof r.then=="function"}bh.isPromise=ZR;function tX(r){return ZR(r)?!0:Array.isArray(r)&&r.some(ZR)}bh.isPromiseOrContainsPromise=tX});var oW=N(Qa=>{"use strict";var rX=Qa&&Qa.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},nX=Qa&&Qa.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(Qa,"__esModule",{value:!0});Qa.saveToScope=Qa.tryGetFromScope=void 0;var qw=M(),iX=wS(),oX=function(r,e){return e.scope===qw.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===qw.BindingScopeEnum.Request&&r.has(e.id)?r.get(e.id):null};Qa.tryGetFromScope=oX;var sX=function(r,e,t){e.scope===qw.BindingScopeEnum.Singleton&&cX(e,t),e.scope===qw.BindingScopeEnum.Request&&aX(r,e,t)};Qa.saveToScope=sX;var aX=function(r,e,t){r.has(e.id)||r.set(e.id,t)},cX=function(r,e){r.cache=e,r.activated=!0,(0,iX.isPromise)(e)&&lX(r,e)},lX=function(r,e){return rX(void 0,void 0,void 0,function(){var t,n;return nX(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),r.cache=t,[3,3];case 2:throw n=i.sent(),r.cache=null,r.activated=!1,n;case 3:return[2]}})})}});var sW=N(ES=>{"use strict";Object.defineProperty(ES,"__esModule",{value:!0});ES.FactoryType=void 0;var uX;(function(r){r.DynamicValue="toDynamicValue",r.Factory="toFactory",r.Provider="toProvider"})(uX=ES.FactoryType||(ES.FactoryType={}))});var tA=N(oo=>{"use strict";var pX=oo&&oo.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),dX=oo&&oo.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),mX=oo&&oo.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pX(e,r,t);return dX(e,r),e};Object.defineProperty(oo,"__esModule",{value:!0});oo.getFactoryDetails=oo.ensureFullyBound=oo.multiBindToService=void 0;var fX=M(),hX=mX(xi()),Ya=oa(),eA=sW(),gX=function(r){return function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return t.forEach(function(i){return r.bind(i).toService(e)})}}};oo.multiBindToService=gX;var vX=function(r){var e=null;switch(r.type){case Ya.BindingTypeEnum.ConstantValue:case Ya.BindingTypeEnum.Function:e=r.cache;break;case Ya.BindingTypeEnum.Constructor:case Ya.BindingTypeEnum.Instance:e=r.implementationType;break;case Ya.BindingTypeEnum.DynamicValue:e=r.dynamicValue;break;case Ya.BindingTypeEnum.Provider:e=r.provider;break;case Ya.BindingTypeEnum.Factory:e=r.factory;break}if(e===null){var t=(0,fX.getServiceIdentifierAsString)(r.serviceIdentifier);throw new Error(hX.INVALID_BINDING_TYPE+" "+t)}};oo.ensureFullyBound=vX;var yX=function(r){switch(r.type){case Ya.BindingTypeEnum.Factory:return{factory:r.factory,factoryType:eA.FactoryType.Factory};case Ya.BindingTypeEnum.Provider:return{factory:r.provider,factoryType:eA.FactoryType.Provider};case Ya.BindingTypeEnum.DynamicValue:return{factory:r.dynamicValue,factoryType:eA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+r.type)}};oo.getFactoryDetails=yX});var dW=N($n=>{"use strict";var Ih=$n&&$n.__assign||function(){return Ih=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},Ih.apply(this,arguments)},bX=$n&&$n.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),IX=$n&&$n.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),SX=$n&&$n.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&bX(e,r,t);return IX(e,r),e},lW=$n&&$n.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},uW=$n&&$n.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},xX=$n&&$n.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty($n,"__esModule",{value:!0});$n.resolveInstance=void 0;var rA=xi(),iA=oa(),nA=SX(Cn()),oA=wS();function CX(r,e){return r.reduce(function(t,n){var i=e(n),o=n.target.type;return o===iA.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(n),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,oA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function wX(r,e,t){var n;if(e.length>0){var i=CX(e,t),o=Ih(Ih({},i),{constr:r});i.isAsync?n=EX(o):n=pW(o)}else n=new r;return n}function pW(r){var e,t=new((e=r.constr).bind.apply(e,xX([void 0],r.constructorInjections,!1)));return r.propertyRequests.forEach(function(n,i){var o=n.target.identifier,s=r.propertyInjections[i];t[o]=s}),t}function EX(r){return lW(this,void 0,void 0,function(){var e,t;return uW(this,function(n){switch(n.label){case 0:return[4,aW(r.constructorInjections)];case 1:return e=n.sent(),[4,aW(r.propertyInjections)];case 2:return t=n.sent(),[2,pW(Ih(Ih({},r),{constructorInjections:e,propertyInjections:t}))]}})})}function aW(r){return lW(this,void 0,void 0,function(){var e,t,n,i;return uW(this,function(o){for(e=[],t=0,n=r;t<n.length;t++)i=n[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function cW(r,e){var t=PX(r,e);return(0,oA.isPromise)(t)?t.then(function(){return e}):e}function PX(r,e){var t,n;if(Reflect.hasMetadata(nA.POST_CONSTRUCT,r)){var i=Reflect.getMetadata(nA.POST_CONSTRUCT,r);try{return(n=(t=e)[i.value])===null||n===void 0?void 0:n.call(t)}catch(o){throw new Error((0,rA.POST_CONSTRUCT_ERROR)(r.name,o.message))}}}function kX(r,e){r.scope!==iA.BindingScopeEnum.Singleton&&DX(r,e)}function DX(r,e){var t="Class cannot be instantiated in "+(r.scope===iA.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof r.onDeactivation=="function")throw new Error((0,rA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(nA.PRE_DESTROY,e))throw new Error((0,rA.PRE_DESTROY_ERROR)(e.name,t))}function _X(r,e,t,n){kX(r,e);var i=wX(e,t,n);return(0,oA.isPromise)(i)?i.then(function(o){return cW(e,o)}):cW(e,i)}$n.resolveInstance=_X});var vW=N(so=>{"use strict";var TX=so&&so.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),RX=so&&so.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),AX=so&&so.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&TX(e,r,t);return RX(e,r),e},NX=so&&so.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},MX=so&&so.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}};Object.defineProperty(so,"__esModule",{value:!0});so.resolve=void 0;var OX=AX(xi()),Jw=oa(),KX=XR(),mW=oW(),sA=wS(),hW=tA(),FX=BR(),LX=dW(),aA=function(r){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,n=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return n.map(function(a){var c=aA(r);return c(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return VX(r,e,s)}},UX=function(r,e){var t=(0,hW.getFactoryDetails)(r);return(0,FX.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(r)(e)},function(){return new Error(OX.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},jX=function(r,e,t){var n,i=e.childRequests;switch((0,hW.ensureFullyBound)(t),t.type){case Jw.BindingTypeEnum.ConstantValue:case Jw.BindingTypeEnum.Function:n=t.cache;break;case Jw.BindingTypeEnum.Constructor:n=t.implementationType;break;case Jw.BindingTypeEnum.Instance:n=(0,LX.resolveInstance)(t,t.implementationType,i,aA(r));break;default:n=UX(t,e.parentContext)}return n},WX=function(r,e,t){var n=(0,mW.tryGetFromScope)(r,e);return n!==null||(n=t(),(0,mW.saveToScope)(r,e,n)),n},VX=function(r,e,t){return WX(r,t,function(){var n=jX(r,e,t);return(0,sA.isPromise)(n)?n=n.then(function(i){return fW(e,t,i)}):n=fW(e,t,n),n})};function fW(r,e,t){var n=BX(r.parentContext,e,t),i=$X(r.parentContext.container),o,s=i.next();do{o=s.value;var a=r.parentContext,c=r.serviceIdentifier,l=JX(o,c);(0,sA.isPromise)(n)?n=gW(l,a,n):n=qX(l,a,n),s=i.next()}while(s.done!==!0&&!(0,KX.getBindingDictionary)(o).hasKey(r.serviceIdentifier));return n}var BX=function(r,e,t){var n;return typeof e.onActivation=="function"?n=e.onActivation(r,t):n=t,n},qX=function(r,e,t){for(var n=r.next();!n.done;){if(t=n.value(e,t),(0,sA.isPromise)(t))return gW(r,e,t);n=r.next()}return t},gW=function(r,e,t){return NX(void 0,void 0,void 0,function(){var n,i;return MX(this,function(o){switch(o.label){case 0:return[4,t];case 1:n=o.sent(),i=r.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,n)];case 3:return n=o.sent(),i=r.next(),[3,2];case 4:return[2,n]}})})},JX=function(r,e){var t=r._activations;return t.hasKey(e)?t.get(e).values():[].values()},$X=function(r){for(var e=[r],t=r.parent;t!==null;)e.push(t),t=t.parent;var n=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:n};return i};function HX(r){var e=aA(r.plan.rootRequest.requestScope);return e(r.plan.rootRequest)}so.resolve=HX});var cA=N(wi=>{"use strict";var GX=wi&&wi.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),zX=wi&&wi.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),QX=wi&&wi.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&GX(e,r,t);return zX(e,r),e};Object.defineProperty(wi,"__esModule",{value:!0});wi.typeConstraint=wi.namedConstraint=wi.taggedConstraint=wi.traverseAncerstors=void 0;var YX=QX(Cn()),XX=sa(),yW=function(r,e){var t=r.parentRequest;return t!==null?e(t)?!0:yW(t,e):!1};wi.traverseAncerstors=yW;var bW=function(r){return function(e){var t=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(r)(e)};return t.metaData=new XX.Metadata(r,e),t}};wi.taggedConstraint=bW;var ZX=bW(YX.NAMED_TAG);wi.namedConstraint=ZX;var eZ=function(r){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof r=="string"){var n=t.serviceIdentifier;return n===r}else{var i=e.bindings[0].implementationType;return r===i}return!1}};wi.typeConstraint=eZ});var Hw=N($w=>{"use strict";Object.defineProperty($w,"__esModule",{value:!0});$w.BindingWhenSyntax=void 0;var Vi=Gw(),Nn=cA(),tZ=function(){function r(e){this._binding=e}return r.prototype.when=function(e){return this._binding.constraint=e,new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Nn.namedConstraint)(e),new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Nn.taggedConstraint)(e)(t),new Vi.BindingOnSyntax(this._binding)},r.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.typeConstraint)(e)(t.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.namedConstraint)(e)(t.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Nn.taggedConstraint)(e)(t)(n.parentRequest)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,(0,Nn.typeConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,(0,Nn.typeConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,(0,Nn.namedConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,(0,Nn.namedConstraint)(e))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&(0,Nn.traverseAncerstors)(n,(0,Nn.taggedConstraint)(e)(t))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(n){return n!==null&&!(0,Nn.traverseAncerstors)(n,(0,Nn.taggedConstraint)(e)(t))},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Nn.traverseAncerstors)(t,e)},new Vi.BindingOnSyntax(this._binding)},r.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Nn.traverseAncerstors)(t,e)},new Vi.BindingOnSyntax(this._binding)},r}();$w.BindingWhenSyntax=tZ});var Gw=N(zw=>{"use strict";Object.defineProperty(zw,"__esModule",{value:!0});zw.BindingOnSyntax=void 0;var IW=Hw(),rZ=function(){function r(e){this._binding=e}return r.prototype.onActivation=function(e){return this._binding.onActivation=e,new IW.BindingWhenSyntax(this._binding)},r.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new IW.BindingWhenSyntax(this._binding)},r}();zw.BindingOnSyntax=rZ});var lA=N(Qw=>{"use strict";Object.defineProperty(Qw,"__esModule",{value:!0});Qw.BindingWhenOnSyntax=void 0;var nZ=Gw(),iZ=Hw(),oZ=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new iZ.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new nZ.BindingOnSyntax(this._binding)}return r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();Qw.BindingWhenOnSyntax=oZ});var SW=N(Yw=>{"use strict";Object.defineProperty(Yw,"__esModule",{value:!0});Yw.BindingInSyntax=void 0;var uA=oa(),pA=lA(),sZ=function(){function r(e){this._binding=e}return r.prototype.inRequestScope=function(){return this._binding.scope=uA.BindingScopeEnum.Request,new pA.BindingWhenOnSyntax(this._binding)},r.prototype.inSingletonScope=function(){return this._binding.scope=uA.BindingScopeEnum.Singleton,new pA.BindingWhenOnSyntax(this._binding)},r.prototype.inTransientScope=function(){return this._binding.scope=uA.BindingScopeEnum.Transient,new pA.BindingWhenOnSyntax(this._binding)},r}();Yw.BindingInSyntax=sZ});var xW=N(Xw=>{"use strict";Object.defineProperty(Xw,"__esModule",{value:!0});Xw.BindingInWhenOnSyntax=void 0;var aZ=SW(),cZ=Gw(),lZ=Hw(),uZ=function(){function r(e){this._binding=e,this._bindingWhenSyntax=new lZ.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new cZ.BindingOnSyntax(this._binding),this._bindingInSyntax=new aZ.BindingInSyntax(e)}return r.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},r.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},r.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},r.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},r.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},r.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},r.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},r.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},r.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},r.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},r.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},r.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},r.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},r.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},r.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},r.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},r.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},r.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},r.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},r.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},r}();Xw.BindingInWhenOnSyntax=uZ});var EW=N(Xa=>{"use strict";var pZ=Xa&&Xa.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),dZ=Xa&&Xa.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),mZ=Xa&&Xa.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pZ(e,r,t);return dZ(e,r),e};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.BindingToSyntax=void 0;var CW=mZ(xi()),Bi=oa(),wW=xW(),Sh=lA(),fZ=function(){function r(e){this._binding=e}return r.prototype.to=function(e){return this._binding.type=Bi.BindingTypeEnum.Instance,this._binding.implementationType=e,new wW.BindingInWhenOnSyntax(this._binding)},r.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+CW.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},r.prototype.toConstantValue=function(e){return this._binding.type=Bi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Bi.BindingScopeEnum.Singleton,new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toDynamicValue=function(e){return this._binding.type=Bi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new wW.BindingInWhenOnSyntax(this._binding)},r.prototype.toConstructor=function(e){return this._binding.type=Bi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(CW.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Bi.BindingTypeEnum.Function,this._binding.scope=Bi.BindingScopeEnum.Singleton,t},r.prototype.toAutoFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){var n=function(){return t.container.get(e)};return n},this._binding.scope=Bi.BindingScopeEnum.Singleton,new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toAutoNamedFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(n){return t.container.getNamed(e,n)}},new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toProvider=function(e){return this._binding.type=Bi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new Sh.BindingWhenOnSyntax(this._binding)},r.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},r}();Xa.BindingToSyntax=fZ});var PW=N(Zw=>{"use strict";Object.defineProperty(Zw,"__esModule",{value:!0});Zw.ContainerSnapshot=void 0;var hZ=function(){function r(){}return r.of=function(e,t,n,i,o){var s=new r;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=n,s.moduleActivationStore=o,s},r}();Zw.ContainerSnapshot=hZ});var kW=N(eE=>{"use strict";Object.defineProperty(eE,"__esModule",{value:!0});eE.isClonable=void 0;function gZ(r){return typeof r=="object"&&r!==null&&"clone"in r&&typeof r.clone=="function"}eE.isClonable=gZ});var dA=N(Za=>{"use strict";var vZ=Za&&Za.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yZ=Za&&Za.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bZ=Za&&Za.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vZ(e,r,t);return yZ(e,r),e};Object.defineProperty(Za,"__esModule",{value:!0});Za.Lookup=void 0;var em=bZ(xi()),IZ=kW(),SZ=function(){function r(){this._map=new Map}return r.prototype.getMap=function(){return this._map},r.prototype.add=function(e,t){if(e==null)throw new Error(em.NULL_ARGUMENT);if(t==null)throw new Error(em.NULL_ARGUMENT);var n=this._map.get(e);n!==void 0?n.push(t):this._map.set(e,[t])},r.prototype.get=function(e){if(e==null)throw new Error(em.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(em.KEY_NOT_FOUND)},r.prototype.remove=function(e){if(e==null)throw new Error(em.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(em.KEY_NOT_FOUND)},r.prototype.removeIntersection=function(e){var t=this;this.traverse(function(n,i){var o=e.hasKey(n)?e.get(n):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(c){return a===c})});t._setValue(n,s)}})},r.prototype.removeByCondition=function(e){var t=this,n=[];return this._map.forEach(function(i,o){for(var s=[],a=0,c=i;a<c.length;a++){var l=c[a],u=e(l);u?n.push(l):s.push(l)}t._setValue(o,s)}),n},r.prototype.hasKey=function(e){if(e==null)throw new Error(em.NULL_ARGUMENT);return this._map.has(e)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){t.forEach(function(i){return e.add(n,(0,IZ.isClonable)(i)?i.clone():i)})}),e},r.prototype.traverse=function(e){this._map.forEach(function(t,n){e(n,t)})},r.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},r}();Za.Lookup=SZ});var _W=N(tE=>{"use strict";Object.defineProperty(tE,"__esModule",{value:!0});tE.ModuleActivationStore=void 0;var DW=dA(),xZ=function(){function r(){this._map=new Map}return r.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},r.prototype.addDeactivation=function(e,t,n){this._getModuleActivationHandlers(e).onDeactivations.add(t,n)},r.prototype.addActivation=function(e,t,n){this._getModuleActivationHandlers(e).onActivations.add(t,n)},r.prototype.clone=function(){var e=new r;return this._map.forEach(function(t,n){e._map.set(n,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},r.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},r.prototype._getEmptyHandlersStore=function(){var e={onActivations:new DW.Lookup,onDeactivations:new DW.Lookup};return e},r}();tE.ModuleActivationStore=xZ});var mA=N(Hn=>{"use strict";var nE=Hn&&Hn.__assign||function(){return nE=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=e[i])}return r},nE.apply(this,arguments)},CZ=Hn&&Hn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),wZ=Hn&&Hn.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),TW=Hn&&Hn.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&CZ(e,r,t);return wZ(e,r),e},hs=Hn&&Hn.__awaiter||function(r,e,t,n){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{l(n.next(u))}catch(p){s(p)}}function c(u){try{l(n.throw(u))}catch(p){s(p)}}function l(u){u.done?o(u.value):i(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})},gs=Hn&&Hn.__generator||function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},EZ=Hn&&Hn.__spreadArray||function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Hn,"__esModule",{value:!0});Hn.Container=void 0;var PZ=Rj(),aa=TW(xi()),xh=oa(),tm=TW(Cn()),kZ=VR(),rE=XR(),DZ=vW(),_Z=EW(),rm=wS(),TZ=zu(),RZ=vh(),AZ=PW(),PS=dA(),NZ=_W(),MZ=function(){function r(e){var t=e||{};if(typeof t!="object")throw new Error(""+aa.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=xh.BindingScopeEnum.Transient;else if(t.defaultScope!==xh.BindingScopeEnum.Singleton&&t.defaultScope!==xh.BindingScopeEnum.Transient&&t.defaultScope!==xh.BindingScopeEnum.Request)throw new Error(""+aa.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+aa.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+aa.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,TZ.id)(),this._bindingDictionary=new PS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new PS.Lookup,this._deactivations=new PS.Lookup,this.parent=null,this._metadataReader=new kZ.MetadataReader,this._moduleActivationStore=new NZ.ModuleActivationStore}return r.merge=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var o=new r,s=EZ([e,t],n,!0).map(function(l){return(0,rE.getBindingDictionary)(l)}),a=(0,rE.getBindingDictionary)(o);function c(l,u){l.traverse(function(p,m){m.forEach(function(h){u.add(h.serviceIdentifier,h.clone())})})}return s.forEach(function(l){c(l,a)}),o},r.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=n(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},r.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hs(this,void 0,void 0,function(){var n,i,o,s,a;return gs(this,function(c){switch(c.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,o=e,c.label=1;case 1:return i<o.length?(s=o[i],a=n(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:c.sent(),c.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},r.prototype.unload=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},r.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return hs(this,void 0,void 0,function(){var n,i,o,s;return gs(this,function(a){switch(a.label){case 0:n=0,i=e,a.label=1;case 1:return n<i.length?(o=i[n],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},r.prototype.bind=function(e){var t=this.options.defaultScope||xh.BindingScopeEnum.Transient,n=new PZ.Binding(e,t);return this._bindingDictionary.add(e,n),new _Z.BindingToSyntax(n)},r.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},r.prototype.rebindAsync=function(e){return hs(this,void 0,void 0,function(){return gs(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},r.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},r.prototype.unbindAsync=function(e){return hs(this,void 0,void 0,function(){var t;return gs(this,function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},r.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,n){e._deactivateSingletons(n)}),this._bindingDictionary=new PS.Lookup},r.prototype.unbindAllAsync=function(){return hs(this,void 0,void 0,function(){var e,t=this;return gs(this,function(n){switch(n.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return n.sent(),this._bindingDictionary=new PS.Lookup,[2]}})})},r.prototype.onActivation=function(e,t){this._activations.add(e,t)},r.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},r.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},r.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},r.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,tm.NAMED_TAG,t)},r.prototype.isBoundTagged=function(e,t,n){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,rE.createMockRequest)(this,e,t,n);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,n)),i},r.prototype.snapshot=function(){this._snapshots.push(AZ.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},r.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(aa.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},r.prototype.createChild=function(e){var t=new r(e||this.options);return t.parent=this,t},r.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},n)},r.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},r.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},r.prototype.getAsync=function(e){return hs(this,void 0,void 0,function(){var t;return gs(this,function(n){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},r.prototype.getTagged=function(e,t,n){var i=this._getNotAllArgs(e,!1,t,n);return this._getButThrowIfAsync(i)},r.prototype.getTaggedAsync=function(e,t,n){return hs(this,void 0,void 0,function(){var i;return gs(this,function(o){return i=this._getNotAllArgs(e,!1,t,n),[2,this._get(i)]})})},r.prototype.getNamed=function(e,t){return this.getTagged(e,tm.NAMED_TAG,t)},r.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,tm.NAMED_TAG,t)},r.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},r.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},r.prototype.getAllTagged=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getButThrowIfAsync(i)},r.prototype.getAllTaggedAsync=function(e,t,n){var i=this._getNotAllArgs(e,!0,t,n);return this._getAll(i)},r.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,tm.NAMED_TAG,t)},r.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,tm.NAMED_TAG,t)},r.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var n=this.get(e);return t||this.unbind(e),n},r.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(tm.PRE_DESTROY,e)){var n=Reflect.getMetadata(tm.PRE_DESTROY,e);return t[n.value]()}},r.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},r.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},r.prototype._deactivate=function(e,t){var n=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,rm.isPromise)(o))return this._handleDeactivationError(o.then(function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,rm.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(aa.ON_DEACTIVATION_ERROR(i.name,a.message))}},r.prototype._handleDeactivationError=function(e,t){return hs(this,void 0,void 0,function(){var n;return gs(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw n=i.sent(),new Error(aa.ON_DEACTIVATION_ERROR(t.name,n.message));case 3:return[2]}})})},r.prototype._deactivateContainer=function(e,t){for(var n=this,i=t.next();i.value;){var o=i.value(e);if((0,rm.isPromise)(o))return o.then(function(){return n._deactivateContainerAsync(e,t)});i=t.next()}},r.prototype._deactivateContainerAsync=function(e,t){return hs(this,void 0,void 0,function(){var n;return gs(this,function(i){switch(i.label){case 0:n=t.next(),i.label=1;case 1:return n.value?[4,n.value(e)]:[3,3];case 2:return i.sent(),n=t.next(),[3,1];case 3:return[2]}})})},r.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,p){u._binding.moduleId=p},n=function(u){return function(p){var m=e.bind(p);return t(m,u),m}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(p){var m=e.rebind(p);return t(m,u),m}},c=function(u){return function(p,m){e._moduleActivationStore.addActivation(u,p,m),e.onActivation(p,m)}},l=function(u){return function(p,m){e._moduleActivationStore.addDeactivation(u,p,m),e.onDeactivation(p,m)}};return function(u){return{bindFunction:n(u),isboundFunction:s(),onActivationFunction:c(u),onDeactivationFunction:l(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},r.prototype._getAll=function(e){return Promise.all(this._get(e))},r.prototype._get=function(e){var t=nE(nE({},e),{contextInterceptor:function(i){return i},targetType:xh.TargetTypeEnum.Variable});if(this._middleware){var n=this._middleware(t);if(n==null)throw new Error(aa.INVALID_MIDDLEWARE_RETURN);return n}return this._planAndResolve()(t)},r.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,rm.isPromiseOrContainsPromise)(t))throw new Error(aa.LAZY_IN_SYNC(e.serviceIdentifier));return t},r.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},r.prototype._getNotAllArgs=function(e,t,n,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:n,value:i};return o},r.prototype._planAndResolve=function(){var e=this;return function(t){var n=(0,rE.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);n=t.contextInterceptor(n);var i=(0,DZ.resolve)(n);return i}},r.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,rm.isPromise)(e.cache)?e.cache.then(function(n){return t._deactivate(e,n)}):this._deactivate(e,e.cache)},r.prototype._deactivateSingletons=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t],o=this._deactivateIfSingleton(i);if((0,rm.isPromise)(o))throw new Error(aa.ASYNC_UNBIND_REQUIRED)}},r.prototype._deactivateSingletonsAsync=function(e){return hs(this,void 0,void 0,function(){var t=this;return gs(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return n.sent(),[2]}})})},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,n){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,n)},r.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,n){return hs(this,void 0,void 0,function(){return gs(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,n)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},r.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(aa.CANNOT_UNBIND+" "+(0,RZ.getServiceIdentifierAsString)(e))}},r.prototype._bindingDeactivationAndPreDestroy=function(e,t,n){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,rm.isPromise)(o))return o.then(function(){return i._preDestroy(n,t)})}return this._preDestroy(n,t)},r.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,n){return hs(this,void 0,void 0,function(){return gs(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(n,t)];case 3:return i.sent(),[2]}})})},r}();Hn.Container=MZ});var AW=N(Ch=>{"use strict";Object.defineProperty(Ch,"__esModule",{value:!0});Ch.AsyncContainerModule=Ch.ContainerModule=void 0;var RW=zu(),OZ=function(){function r(e){this.id=(0,RW.id)(),this.registry=e}return r}();Ch.ContainerModule=OZ;var KZ=function(){function r(e){this.id=(0,RW.id)(),this.registry=e}return r}();Ch.AsyncContainerModule=KZ});var NW=N(iE=>{"use strict";Object.defineProperty(iE,"__esModule",{value:!0});iE.getFirstArrayDuplicate=void 0;function FZ(r){for(var e=new Set,t=0,n=r;t<n.length;t++){var i=n[t];if(e.has(i))return i;e.add(i)}}iE.getFirstArrayDuplicate=FZ});var Dl=N(Ei=>{"use strict";var LZ=Ei&&Ei.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),UZ=Ei&&Ei.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),OW=Ei&&Ei.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&LZ(e,r,t);return UZ(e,r),e};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.createTaggedDecorator=Ei.tagProperty=Ei.tagParameter=Ei.decorate=void 0;var oE=OW(xi()),KW=OW(Cn()),jZ=NW();function WZ(r){return r.prototype!==void 0}function VZ(r){if(r!==void 0)throw new Error(oE.INVALID_DECORATOR_OPERATION)}function FW(r,e,t,n){VZ(e),UW(KW.TAGGED,r,t.toString(),n)}Ei.tagParameter=FW;function LW(r,e,t){if(WZ(r))throw new Error(oE.INVALID_DECORATOR_OPERATION);UW(KW.TAGGED_PROP,r.constructor,e,t)}Ei.tagProperty=LW;function BZ(r){var e=[];if(Array.isArray(r)){e=r;var t=(0,jZ.getFirstArrayDuplicate)(e.map(function(n){return n.key}));if(t!==void 0)throw new Error(oE.DUPLICATED_METADATA+" "+t.toString())}else e=[r];return e}function UW(r,e,t,n){var i=BZ(n),o={};Reflect.hasOwnMetadata(r,e)&&(o=Reflect.getMetadata(r,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(p){if(i.some(function(m){return m.key===p.key}))throw new Error(oE.DUPLICATED_METADATA+" "+p.key.toString())},c=0,l=s;c<l.length;c++){var u=l[c];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(r,o,e)}function qZ(r){return function(e,t,n){typeof n=="number"?FW(e,t,n,r):LW(e,t,r)}}Ei.createTaggedDecorator=qZ;function MW(r,e){Reflect.decorate(r,e)}function JZ(r,e){return function(t,n){e(t,n,r)}}function $Z(r,e,t){typeof t=="number"?MW([JZ(t,r)],e):typeof t=="string"?Reflect.decorate([r],e,t):MW([r],e)}Ei.decorate=$Z});var WW=N(ec=>{"use strict";var HZ=ec&&ec.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),GZ=ec&&ec.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),jW=ec&&ec.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&HZ(e,r,t);return GZ(e,r),e};Object.defineProperty(ec,"__esModule",{value:!0});ec.injectable=void 0;var zZ=jW(xi()),fA=jW(Cn());function QZ(){return function(r){if(Reflect.hasOwnMetadata(fA.PARAM_TYPES,r))throw new Error(zZ.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(fA.DESIGN_PARAM_TYPES,r)||[];return Reflect.defineMetadata(fA.PARAM_TYPES,e,r),r}}ec.injectable=QZ});var VW=N(sE=>{"use strict";Object.defineProperty(sE,"__esModule",{value:!0});sE.tagged=void 0;var YZ=sa(),XZ=Dl();function ZZ(r,e){return(0,XZ.createTaggedDecorator)(new YZ.Metadata(r,e))}sE.tagged=ZZ});var BW=N(tc=>{"use strict";var eee=tc&&tc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),tee=tc&&tc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ree=tc&&tc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&eee(e,r,t);return tee(e,r),e};Object.defineProperty(tc,"__esModule",{value:!0});tc.named=void 0;var nee=ree(Cn()),iee=sa(),oee=Dl();function see(r){return(0,oee.createTaggedDecorator)(new iee.Metadata(nee.NAMED_TAG,r))}tc.named=see});var hA=N(aE=>{"use strict";Object.defineProperty(aE,"__esModule",{value:!0});aE.injectBase=void 0;var aee=xi(),cee=sa(),lee=Dl();function uee(r){return function(e){return function(t,n,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,aee.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,lee.createTaggedDecorator)(new cee.Metadata(r,e))(t,n,i)}}}aE.injectBase=uee});var qW=N(rc=>{"use strict";var pee=rc&&rc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),dee=rc&&rc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),mee=rc&&rc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&pee(e,r,t);return dee(e,r),e};Object.defineProperty(rc,"__esModule",{value:!0});rc.inject=void 0;var fee=mee(Cn()),hee=hA(),gee=(0,hee.injectBase)(fee.INJECT_TAG);rc.inject=gee});var JW=N(nc=>{"use strict";var vee=nc&&nc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),yee=nc&&nc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bee=nc&&nc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&vee(e,r,t);return yee(e,r),e};Object.defineProperty(nc,"__esModule",{value:!0});nc.optional=void 0;var Iee=bee(Cn()),See=sa(),xee=Dl();function Cee(){return(0,xee.createTaggedDecorator)(new See.Metadata(Iee.OPTIONAL_TAG,!0))}nc.optional=Cee});var $W=N(ic=>{"use strict";var wee=ic&&ic.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Eee=ic&&ic.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Pee=ic&&ic.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wee(e,r,t);return Eee(e,r),e};Object.defineProperty(ic,"__esModule",{value:!0});ic.unmanaged=void 0;var kee=Pee(Cn()),Dee=sa(),_ee=Dl();function Tee(){return function(r,e,t){var n=new Dee.Metadata(kee.UNMANAGED_TAG,!0);(0,_ee.tagParameter)(r,e,t,n)}}ic.unmanaged=Tee});var HW=N(oc=>{"use strict";var Ree=oc&&oc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Aee=oc&&oc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Nee=oc&&oc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Ree(e,r,t);return Aee(e,r),e};Object.defineProperty(oc,"__esModule",{value:!0});oc.multiInject=void 0;var Mee=Nee(Cn()),Oee=hA(),Kee=(0,Oee.injectBase)(Mee.MULTI_INJECT_TAG);oc.multiInject=Kee});var GW=N(sc=>{"use strict";var Fee=sc&&sc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Lee=sc&&sc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Uee=sc&&sc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Fee(e,r,t);return Lee(e,r),e};Object.defineProperty(sc,"__esModule",{value:!0});sc.targetName=void 0;var jee=Uee(Cn()),Wee=sa(),Vee=Dl();function Bee(r){return function(e,t,n){var i=new Wee.Metadata(jee.NAME_TAG,r);(0,Vee.tagParameter)(e,t,n,i)}}sc.targetName=Bee});var gA=N(cE=>{"use strict";Object.defineProperty(cE,"__esModule",{value:!0});cE.propertyEventDecorator=void 0;var qee=sa();function Jee(r,e){return function(){return function(t,n){var i=new qee.Metadata(r,n);if(Reflect.hasOwnMetadata(r,t.constructor))throw new Error(e);Reflect.defineMetadata(r,i,t.constructor)}}}cE.propertyEventDecorator=Jee});var QW=N(ac=>{"use strict";var $ee=ac&&ac.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Hee=ac&&ac.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),zW=ac&&ac.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&$ee(e,r,t);return Hee(e,r),e};Object.defineProperty(ac,"__esModule",{value:!0});ac.postConstruct=void 0;var Gee=zW(xi()),zee=zW(Cn()),Qee=gA(),Yee=(0,Qee.propertyEventDecorator)(zee.POST_CONSTRUCT,Gee.MULTIPLE_POST_CONSTRUCT_METHODS);ac.postConstruct=Yee});var XW=N(cc=>{"use strict";var Xee=cc&&cc.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Zee=cc&&cc.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),YW=cc&&cc.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Xee(e,r,t);return Zee(e,r),e};Object.defineProperty(cc,"__esModule",{value:!0});cc.preDestroy=void 0;var ete=YW(xi()),tte=YW(Cn()),rte=gA(),nte=(0,rte.propertyEventDecorator)(tte.PRE_DESTROY,ete.MULTIPLE_PRE_DESTROY_METHODS);cc.preDestroy=nte});var ZW=N(lE=>{"use strict";Object.defineProperty(lE,"__esModule",{value:!0});lE.interfaces=void 0;var vA;vA||(vA={});lE.interfaces=vA});var M=N(je=>{"use strict";var ite=je&&je.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t),Object.defineProperty(r,n,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ote=je&&je.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ste=je&&je.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&ite(e,r,t);return ote(e,r),e};Object.defineProperty(je,"__esModule",{value:!0});je.multiBindToService=je.getServiceIdentifierAsString=je.typeConstraint=je.namedConstraint=je.taggedConstraint=je.traverseAncerstors=je.decorate=je.interfaces=je.id=je.MetadataReader=je.preDestroy=je.postConstruct=je.targetName=je.multiInject=je.unmanaged=je.optional=je.LazyServiceIdentifer=je.inject=je.named=je.tagged=je.injectable=je.createTaggedDecorator=je.ContainerModule=je.AsyncContainerModule=je.TargetTypeEnum=je.BindingTypeEnum=je.BindingScopeEnum=je.Container=je.METADATA_KEY=void 0;var ate=ste(Cn());je.METADATA_KEY=ate;var cte=mA();Object.defineProperty(je,"Container",{enumerable:!0,get:function(){return cte.Container}});var yA=oa();Object.defineProperty(je,"BindingScopeEnum",{enumerable:!0,get:function(){return yA.BindingScopeEnum}});Object.defineProperty(je,"BindingTypeEnum",{enumerable:!0,get:function(){return yA.BindingTypeEnum}});Object.defineProperty(je,"TargetTypeEnum",{enumerable:!0,get:function(){return yA.TargetTypeEnum}});var e2=AW();Object.defineProperty(je,"AsyncContainerModule",{enumerable:!0,get:function(){return e2.AsyncContainerModule}});Object.defineProperty(je,"ContainerModule",{enumerable:!0,get:function(){return e2.ContainerModule}});var lte=Dl();Object.defineProperty(je,"createTaggedDecorator",{enumerable:!0,get:function(){return lte.createTaggedDecorator}});var ute=WW();Object.defineProperty(je,"injectable",{enumerable:!0,get:function(){return ute.injectable}});var pte=VW();Object.defineProperty(je,"tagged",{enumerable:!0,get:function(){return pte.tagged}});var dte=BW();Object.defineProperty(je,"named",{enumerable:!0,get:function(){return dte.named}});var mte=qW();Object.defineProperty(je,"inject",{enumerable:!0,get:function(){return mte.inject}});var fte=qR();Object.defineProperty(je,"LazyServiceIdentifer",{enumerable:!0,get:function(){return fte.LazyServiceIdentifer}});var hte=JW();Object.defineProperty(je,"optional",{enumerable:!0,get:function(){return hte.optional}});var gte=$W();Object.defineProperty(je,"unmanaged",{enumerable:!0,get:function(){return gte.unmanaged}});var vte=HW();Object.defineProperty(je,"multiInject",{enumerable:!0,get:function(){return vte.multiInject}});var yte=GW();Object.defineProperty(je,"targetName",{enumerable:!0,get:function(){return yte.targetName}});var bte=QW();Object.defineProperty(je,"postConstruct",{enumerable:!0,get:function(){return bte.postConstruct}});var Ite=XW();Object.defineProperty(je,"preDestroy",{enumerable:!0,get:function(){return Ite.preDestroy}});var Ste=VR();Object.defineProperty(je,"MetadataReader",{enumerable:!0,get:function(){return Ste.MetadataReader}});var xte=zu();Object.defineProperty(je,"id",{enumerable:!0,get:function(){return xte.id}});var Cte=ZW();Object.defineProperty(je,"interfaces",{enumerable:!0,get:function(){return Cte.interfaces}});var wte=Dl();Object.defineProperty(je,"decorate",{enumerable:!0,get:function(){return wte.decorate}});var uE=cA();Object.defineProperty(je,"traverseAncerstors",{enumerable:!0,get:function(){return uE.traverseAncerstors}});Object.defineProperty(je,"taggedConstraint",{enumerable:!0,get:function(){return uE.taggedConstraint}});Object.defineProperty(je,"namedConstraint",{enumerable:!0,get:function(){return uE.namedConstraint}});Object.defineProperty(je,"typeConstraint",{enumerable:!0,get:function(){return uE.typeConstraint}});var Ete=vh();Object.defineProperty(je,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return Ete.getServiceIdentifierAsString}});var Pte=tA();Object.defineProperty(je,"multiBindToService",{enumerable:!0,get:function(){return Pte.multiBindToService}})});var i2=N(AS=>{AS.get=function(r){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},n=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,r||AS.get);var i=t.stack;return Error.prepareStackTrace=n,Error.stackTraceLimit=e,i};AS.parse=function(r){if(!r.stack)return[];var e=this,t=r.stack.split(`
`).slice(1);return t.map(function(n){if(n.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:n,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=n.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,c=null,l=null,u=i[5]==="native";if(i[1]){a=i[1];var p=a.lastIndexOf(".");if(a[p-1]=="."&&p--,p>0){o=a.substr(0,p),s=a.substr(p+1);var m=o.indexOf(".Module");m>0&&(a=a.substr(m+1),o=o.substr(0,m))}c=null}s&&(c=o,l=s),s==="<anonymous>"&&(l=null,a=null);var h={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:c,methodName:l,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(h)}}).filter(function(n){return!!n})};function RS(r){for(var e in r)this[e]=r[e]}var Dte=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],_te=["topLevel","eval","native","constructor"];Dte.forEach(function(r){RS.prototype[r]=null,RS.prototype["get"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});_te.forEach(function(r){RS.prototype[r]=!1,RS.prototype["is"+r[0].toUpperCase()+r.substr(1)]=function(){return this[r]}});AS._createParsedCallSite=function(r){return new RS(r)}});var w2=N((nCe,C2)=>{"use strict";C2.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var k2=N(TA=>{"use strict";var Wie=Object.prototype.hasOwnProperty,Vie;function E2(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch{return null}}function P2(r){try{return encodeURIComponent(r)}catch{return null}}function Bie(r){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},n;n=e.exec(r);){var i=E2(n[1]),o=E2(n[2]);i===null||o===null||i in t||(t[i]=o)}return t}function qie(r,e){e=e||"";var t=[],n,i;typeof e!="string"&&(e="?");for(i in r)if(Wie.call(r,i)){if(n=r[i],!n&&(n===null||n===Vie||isNaN(n))&&(n=""),i=P2(i),n=P2(n),i===null||n===null)continue;t.push(i+"="+n)}return t.length?e+t.join("&"):""}TA.stringify=qie;TA.parse=Bie});var O2=N((oCe,M2)=>{"use strict";var _2=w2(),DE=k2(),Jie=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,T2=/[\n\r\t]/g,$ie=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,R2=/:\d+$/,Hie=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Gie=/^[a-zA-Z]:/;function AA(r){return(r||"").toString().replace(Jie,"")}var RA=[["#","hash"],["?","query"],function(e,t){return fc(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],D2={hash:1,query:1};function A2(r){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};r=r||t;var n={},i=typeof r,o;if(r.protocol==="blob:")n=new hc(unescape(r.pathname),{});else if(i==="string"){n=new hc(r,{});for(o in D2)delete n[o]}else if(i==="object"){for(o in r)o in D2||(n[o]=r[o]);n.slashes===void 0&&(n.slashes=$ie.test(r.href))}return n}function fc(r){return r==="file:"||r==="ftp:"||r==="http:"||r==="https:"||r==="ws:"||r==="wss:"}function N2(r,e){r=AA(r),r=r.replace(T2,""),e=e||{};var t=Hie.exec(r),n=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],n==="file:"?s>=2&&(a=a.slice(2)):fc(n)?a=t[4]:n?i&&(a=a.slice(2)):s>=2&&fc(e.protocol)&&(a=t[4]),{protocol:n,slashes:i||fc(n),slashesCount:s,rest:a}}function zie(r,e){if(r==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(r.split("/")),n=t.length,i=t[n-1],o=!1,s=0;n--;)t[n]==="."?t.splice(n,1):t[n]===".."?(t.splice(n,1),s++):s&&(n===0&&(o=!0),t.splice(n,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function hc(r,e,t){if(r=AA(r),r=r.replace(T2,""),!(this instanceof hc))return new hc(r,e,t);var n,i,o,s,a,c,l=RA.slice(),u=typeof e,p=this,m=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=DE.parse),e=A2(e),i=N2(r||"",e),n=!i.protocol&&!i.slashes,p.slashes=i.slashes||n&&e.slashes,p.protocol=i.protocol||e.protocol||"",r=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Gie.test(r))||!i.slashes&&(i.protocol||i.slashesCount<2||!fc(p.protocol)))&&(l[3]=[/(.*)/,"pathname"]);m<l.length;m++){if(s=l[m],typeof s=="function"){r=s(r,p);continue}o=s[0],c=s[1],o!==o?p[c]=r:typeof o=="string"?(a=o==="@"?r.lastIndexOf(o):r.indexOf(o),~a&&(typeof s[2]=="number"?(p[c]=r.slice(0,a),r=r.slice(a+s[2])):(p[c]=r.slice(a),r=r.slice(0,a)))):(a=o.exec(r))&&(p[c]=a[1],r=r.slice(0,a.index)),p[c]=p[c]||n&&s[3]&&e[c]||"",s[4]&&(p[c]=p[c].toLowerCase())}t&&(p.query=t(p.query)),n&&e.slashes&&p.pathname.charAt(0)!=="/"&&(p.pathname!==""||e.pathname!=="")&&(p.pathname=zie(p.pathname,e.pathname)),p.pathname.charAt(0)!=="/"&&fc(p.protocol)&&(p.pathname="/"+p.pathname),_2(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(a=p.auth.indexOf(":"),~a?(p.username=p.auth.slice(0,a),p.username=encodeURIComponent(decodeURIComponent(p.username)),p.password=p.auth.slice(a+1),p.password=encodeURIComponent(decodeURIComponent(p.password))):p.username=encodeURIComponent(decodeURIComponent(p.auth)),p.auth=p.password?p.username+":"+p.password:p.username),p.origin=p.protocol!=="file:"&&fc(p.protocol)&&p.host?p.protocol+"//"+p.host:"null",p.href=p.toString()}function Qie(r,e,t){var n=this;switch(r){case"query":typeof e=="string"&&e.length&&(e=(t||DE.parse)(e)),n[r]=e;break;case"port":n[r]=e,_2(e,n.protocol)?e&&(n.host=n.hostname+":"+e):(n.host=n.hostname,n[r]="");break;case"hostname":n[r]=e,n.port&&(e+=":"+n.port),n.host=e;break;case"host":n[r]=e,R2.test(e)?(e=e.split(":"),n.port=e.pop(),n.hostname=e.join(":")):(n.hostname=e,n.port="");break;case"protocol":n.protocol=e.toLowerCase(),n.slashes=!t;break;case"pathname":case"hash":if(e){var i=r==="pathname"?"/":"#";n[r]=e.charAt(0)!==i?i+e:e}else n[r]=e;break;case"username":case"password":n[r]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(n.username=e.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=e.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<RA.length;s++){var a=RA[s];a[4]&&(n[a[1]]=n[a[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin=n.protocol!=="file:"&&fc(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n}function Yie(r){(!r||typeof r!="function")&&(r=DE.stringify);var e,t=this,n=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||fc(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&fc(t.protocol)&&!n&&t.pathname!=="/"&&(o+="@"),(n[n.length-1]===":"||R2.test(t.hostname)&&!t.port)&&(n+=":"),o+=n+t.pathname,e=typeof t.query=="object"?r(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}hc.prototype={set:Qie,toString:Yie};hc.extractProtocol=N2;hc.location=A2;hc.trimLeft=AA;hc.qs=DE;M2.exports=hc});var Hh=N((kt,X2)=>{kt=X2.exports=Qt;var Ir;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Ir=function(){var r=Array.prototype.slice.call(arguments,0);r.unshift("SEMVER"),console.log.apply(console,r)}:Ir=function(){};kt.SEMVER_SPEC_VERSION="2.0.0";var KS=256,RE=Number.MAX_SAFE_INTEGER||9007199254740991,NA=16,Xie=KS-6,FS=kt.re=[],Mr=kt.safeRe=[],fe=kt.src=[],qt=0,LA="[a-zA-Z0-9-]",MA=[["\\s",1],["\\d",KS],[LA,Xie]];function FE(r){for(var e=0;e<MA.length;e++){var t=MA[e][0],n=MA[e][1];r=r.split(t+"*").join(t+"{0,"+n+"}").split(t+"+").join(t+"{1,"+n+"}")}return r}var jh=qt++;fe[jh]="0|[1-9]\\d*";var Wh=qt++;fe[Wh]="\\d+";var UA=qt++;fe[UA]="\\d*[a-zA-Z-]"+LA+"*";var L2=qt++;fe[L2]="("+fe[jh]+")\\.("+fe[jh]+")\\.("+fe[jh]+")";var U2=qt++;fe[U2]="("+fe[Wh]+")\\.("+fe[Wh]+")\\.("+fe[Wh]+")";var OA=qt++;fe[OA]="(?:"+fe[jh]+"|"+fe[UA]+")";var KA=qt++;fe[KA]="(?:"+fe[Wh]+"|"+fe[UA]+")";var jA=qt++;fe[jA]="(?:-("+fe[OA]+"(?:\\."+fe[OA]+")*))";var WA=qt++;fe[WA]="(?:-?("+fe[KA]+"(?:\\."+fe[KA]+")*))";var FA=qt++;fe[FA]=LA+"+";var US=qt++;fe[US]="(?:\\+("+fe[FA]+"(?:\\."+fe[FA]+")*))";var VA=qt++,j2="v?"+fe[L2]+fe[jA]+"?"+fe[US]+"?";fe[VA]="^"+j2+"$";var BA="[v=\\s]*"+fe[U2]+fe[WA]+"?"+fe[US]+"?",qA=qt++;fe[qA]="^"+BA+"$";var $h=qt++;fe[$h]="((?:<|>)?=?)";var AE=qt++;fe[AE]=fe[Wh]+"|x|X|\\*";var NE=qt++;fe[NE]=fe[jh]+"|x|X|\\*";var am=qt++;fe[am]="[v=\\s]*("+fe[NE]+")(?:\\.("+fe[NE]+")(?:\\.("+fe[NE]+")(?:"+fe[jA]+")?"+fe[US]+"?)?)?";var Bh=qt++;fe[Bh]="[v=\\s]*("+fe[AE]+")(?:\\.("+fe[AE]+")(?:\\.("+fe[AE]+")(?:"+fe[WA]+")?"+fe[US]+"?)?)?";var W2=qt++;fe[W2]="^"+fe[$h]+"\\s*"+fe[am]+"$";var V2=qt++;fe[V2]="^"+fe[$h]+"\\s*"+fe[Bh]+"$";var B2=qt++;fe[B2]="(?:^|[^\\d])(\\d{1,"+NA+"})(?:\\.(\\d{1,"+NA+"}))?(?:\\.(\\d{1,"+NA+"}))?(?:$|[^\\d])";var LE=qt++;fe[LE]="(?:~>?)";var qh=qt++;fe[qh]="(\\s*)"+fe[LE]+"\\s+";FS[qh]=new RegExp(fe[qh],"g");Mr[qh]=new RegExp(FE(fe[qh]),"g");var Zie="$1~",q2=qt++;fe[q2]="^"+fe[LE]+fe[am]+"$";var J2=qt++;fe[J2]="^"+fe[LE]+fe[Bh]+"$";var UE=qt++;fe[UE]="(?:\\^)";var Jh=qt++;fe[Jh]="(\\s*)"+fe[UE]+"\\s+";FS[Jh]=new RegExp(fe[Jh],"g");Mr[Jh]=new RegExp(FE(fe[Jh]),"g");var eoe="$1^",$2=qt++;fe[$2]="^"+fe[UE]+fe[am]+"$";var H2=qt++;fe[H2]="^"+fe[UE]+fe[Bh]+"$";var JA=qt++;fe[JA]="^"+fe[$h]+"\\s*("+BA+")$|^$";var $A=qt++;fe[$A]="^"+fe[$h]+"\\s*("+j2+")$|^$";var cm=qt++;fe[cm]="(\\s*)"+fe[$h]+"\\s*("+BA+"|"+fe[am]+")";FS[cm]=new RegExp(fe[cm],"g");Mr[cm]=new RegExp(FE(fe[cm]),"g");var toe="$1$2$3",G2=qt++;fe[G2]="^\\s*("+fe[am]+")\\s+-\\s+("+fe[am]+")\\s*$";var z2=qt++;fe[z2]="^\\s*("+fe[Bh]+")\\s+-\\s+("+fe[Bh]+")\\s*$";var Q2=qt++;fe[Q2]="(<|>)?=?\\s*\\*";for(yc=0;yc<qt;yc++)Ir(yc,fe[yc]),FS[yc]||(FS[yc]=new RegExp(fe[yc]),Mr[yc]=new RegExp(FE(fe[yc])));var yc;kt.parse=lm;function lm(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Qt)return r;if(typeof r!="string"||r.length>KS)return null;var t=e.loose?Mr[qA]:Mr[VA];if(!t.test(r))return null;try{return new Qt(r,e)}catch{return null}}kt.valid=roe;function roe(r,e){var t=lm(r,e);return t?t.version:null}kt.clean=noe;function noe(r,e){var t=lm(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null}kt.SemVer=Qt;function Qt(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof Qt){if(r.loose===e.loose)return r;r=r.version}else if(typeof r!="string")throw new TypeError("Invalid Version: "+r);if(r.length>KS)throw new TypeError("version is longer than "+KS+" characters");if(!(this instanceof Qt))return new Qt(r,e);Ir("SemVer",r,e),this.options=e,this.loose=!!e.loose;var t=r.trim().match(e.loose?Mr[qA]:Mr[VA]);if(!t)throw new TypeError("Invalid Version: "+r);if(this.raw=r,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>RE||this.major<0)throw new TypeError("Invalid major version");if(this.minor>RE||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>RE||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(n){if(/^[0-9]+$/.test(n)){var i=+n;if(i>=0&&i<RE)return i}return n}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}Qt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Qt.prototype.toString=function(){return this.version};Qt.prototype.compare=function(r){return Ir("SemVer.compare",this.version,this.options,r),r instanceof Qt||(r=new Qt(r,this.options)),this.compareMain(r)||this.comparePre(r)};Qt.prototype.compareMain=function(r){return r instanceof Qt||(r=new Qt(r,this.options)),Vh(this.major,r.major)||Vh(this.minor,r.minor)||Vh(this.patch,r.patch)};Qt.prototype.comparePre=function(r){if(r instanceof Qt||(r=new Qt(r,this.options)),this.prerelease.length&&!r.prerelease.length)return-1;if(!this.prerelease.length&&r.prerelease.length)return 1;if(!this.prerelease.length&&!r.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],n=r.prerelease[e];if(Ir("prerelease compare",e,t,n),t===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(t===void 0)return-1;if(t===n)continue;return Vh(t,n)}while(++e)};Qt.prototype.inc=function(r,e){switch(r){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+r)}return this.format(),this.raw=this.version,this};kt.inc=ioe;function ioe(r,e,t,n){typeof t=="string"&&(n=t,t=void 0);try{return new Qt(r,t).inc(e,n).version}catch{return null}}kt.diff=ooe;function ooe(r,e){if(HA(r,e))return null;var t=lm(r),n=lm(e),i="";if(t.prerelease.length||n.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==n[s])return i+s;return o}kt.compareIdentifiers=Vh;var F2=/^[0-9]+$/;function Vh(r,e){var t=F2.test(r),n=F2.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1}kt.rcompareIdentifiers=soe;function soe(r,e){return Vh(e,r)}kt.major=aoe;function aoe(r,e){return new Qt(r,e).major}kt.minor=coe;function coe(r,e){return new Qt(r,e).minor}kt.patch=loe;function loe(r,e){return new Qt(r,e).patch}kt.compare=Tl;function Tl(r,e,t){return new Qt(r,t).compare(new Qt(e,t))}kt.compareLoose=uoe;function uoe(r,e){return Tl(r,e,!0)}kt.rcompare=poe;function poe(r,e,t){return Tl(e,r,t)}kt.sort=doe;function doe(r,e){return r.sort(function(t,n){return kt.compare(t,n,e)})}kt.rsort=moe;function moe(r,e){return r.sort(function(t,n){return kt.rcompare(t,n,e)})}kt.gt=LS;function LS(r,e,t){return Tl(r,e,t)>0}kt.lt=ME;function ME(r,e,t){return Tl(r,e,t)<0}kt.eq=HA;function HA(r,e,t){return Tl(r,e,t)===0}kt.neq=Y2;function Y2(r,e,t){return Tl(r,e,t)!==0}kt.gte=GA;function GA(r,e,t){return Tl(r,e,t)>=0}kt.lte=zA;function zA(r,e,t){return Tl(r,e,t)<=0}kt.cmp=OE;function OE(r,e,t,n){switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return HA(r,t,n);case"!=":return Y2(r,t,n);case">":return LS(r,t,n);case">=":return GA(r,t,n);case"<":return ME(r,t,n);case"<=":return zA(r,t,n);default:throw new TypeError("Invalid operator: "+e)}}kt.Comparator=ys;function ys(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof ys){if(r.loose===!!e.loose)return r;r=r.value}if(!(this instanceof ys))return new ys(r,e);r=r.trim().split(/\s+/).join(" "),Ir("comparator",r,e),this.options=e,this.loose=!!e.loose,this.parse(r),this.semver===jS?this.value="":this.value=this.operator+this.semver.version,Ir("comp",this)}var jS={};ys.prototype.parse=function(r){var e=this.options.loose?Mr[JA]:Mr[$A],t=r.match(e);if(!t)throw new TypeError("Invalid comparator: "+r);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new Qt(t[2],this.options.loose):this.semver=jS};ys.prototype.toString=function(){return this.value};ys.prototype.test=function(r){return Ir("Comparator.test",r,this.options.loose),this.semver===jS?!0:(typeof r=="string"&&(r=new Qt(r,this.options)),OE(r,this.operator,this.semver,this.options))};ys.prototype.intersects=function(r,e){if(!(r instanceof ys))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new an(r.value,e),KE(this.value,t,e);if(r.operator==="")return t=new an(this.value,e),KE(r.semver,t,e);var n=(this.operator===">="||this.operator===">")&&(r.operator===">="||r.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(r.operator==="<="||r.operator==="<"),o=this.semver.version===r.semver.version,s=(this.operator===">="||this.operator==="<=")&&(r.operator===">="||r.operator==="<="),a=OE(this.semver,"<",r.semver,e)&&(this.operator===">="||this.operator===">")&&(r.operator==="<="||r.operator==="<"),c=OE(this.semver,">",r.semver,e)&&(this.operator==="<="||this.operator==="<")&&(r.operator===">="||r.operator===">");return n||i||o&&s||a||c};kt.Range=an;function an(r,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),r instanceof an)return r.loose===!!e.loose&&r.includePrerelease===!!e.includePrerelease?r:new an(r.raw,e);if(r instanceof ys)return new an(r.value,e);if(!(this instanceof an))return new an(r,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=r.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}an.prototype.format=function(){return this.range=this.set.map(function(r){return r.join(" ").trim()}).join("||").trim(),this.range};an.prototype.toString=function(){return this.range};an.prototype.parseRange=function(r){var e=this.options.loose,t=e?Mr[z2]:Mr[G2];r=r.replace(t,Coe),Ir("hyphen replace",r),r=r.replace(Mr[cm],toe),Ir("comparator trim",r,Mr[cm]),r=r.replace(Mr[qh],Zie),r=r.replace(Mr[Jh],eoe);var n=e?Mr[JA]:Mr[$A],i=r.split(" ").map(function(o){return hoe(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(n)})),i=i.map(function(o){return new ys(o,this.options)},this),i};an.prototype.intersects=function(r,e){if(!(r instanceof an))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(n){return r.set.some(function(i){return i.every(function(o){return n.intersects(o,e)})})})})};kt.toComparators=foe;function foe(r,e){return new an(r,e).set.map(function(t){return t.map(function(n){return n.value}).join(" ").trim().split(" ")})}function hoe(r,e){return Ir("comp",r,e),r=yoe(r,e),Ir("caret",r),r=goe(r,e),Ir("tildes",r),r=Ioe(r,e),Ir("xrange",r),r=xoe(r,e),Ir("stars",r),r}function Ji(r){return!r||r.toLowerCase()==="x"||r==="*"}function goe(r,e){return r.trim().split(/\s+/).map(function(t){return voe(t,e)}).join(" ")}function voe(r,e){var t=e.loose?Mr[J2]:Mr[q2];return r.replace(t,function(n,i,o,s,a){Ir("tilde",r,n,i,o,s,a);var c;return Ji(i)?c="":Ji(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Ji(s)?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(Ir("replaceTilde pr",a),c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",Ir("tilde return",c),c})}function yoe(r,e){return r.trim().split(/\s+/).map(function(t){return boe(t,e)}).join(" ")}function boe(r,e){Ir("caret",r,e);var t=e.loose?Mr[H2]:Mr[$2];return r.replace(t,function(n,i,o,s,a){Ir("caret",r,n,i,o,s,a);var c;return Ji(i)?c="":Ji(o)?c=">="+i+".0.0 <"+(+i+1)+".0.0":Ji(s)?i==="0"?c=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(Ir("replaceCaret pr",a),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(Ir("no pr"),i==="0"?o==="0"?c=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):c=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":c=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),Ir("caret return",c),c})}function Ioe(r,e){return Ir("replaceXRanges",r,e),r.split(/\s+/).map(function(t){return Soe(t,e)}).join(" ")}function Soe(r,e){r=r.trim();var t=e.loose?Mr[V2]:Mr[W2];return r.replace(t,function(n,i,o,s,a,c){Ir("xRange",r,n,i,o,s,a,c);var l=Ji(o),u=l||Ji(s),p=u||Ji(a),m=p;return i==="="&&m&&(i=""),l?i===">"||i==="<"?n="<0.0.0":n="*":i&&m?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),n=i+o+"."+s+"."+a):u?n=">="+o+".0.0 <"+(+o+1)+".0.0":p&&(n=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),Ir("xRange return",n),n})}function xoe(r,e){return Ir("replaceStars",r,e),r.trim().replace(Mr[Q2],"")}function Coe(r,e,t,n,i,o,s,a,c,l,u,p,m){return Ji(t)?e="":Ji(n)?e=">="+t+".0.0":Ji(i)?e=">="+t+"."+n+".0":e=">="+e,Ji(c)?a="":Ji(l)?a="<"+(+c+1)+".0.0":Ji(u)?a="<"+c+"."+(+l+1)+".0":p?a="<="+c+"."+l+"."+u+"-"+p:a="<="+a,(e+" "+a).trim()}an.prototype.test=function(r){if(!r)return!1;typeof r=="string"&&(r=new Qt(r,this.options));for(var e=0;e<this.set.length;e++)if(woe(this.set[e],r,this.options))return!0;return!1};function woe(r,e,t){for(var n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(n=0;n<r.length;n++)if(Ir(r[n].semver),r[n].semver!==jS&&r[n].semver.prerelease.length>0){var i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}kt.satisfies=KE;function KE(r,e,t){try{e=new an(e,t)}catch{return!1}return e.test(r)}kt.maxSatisfying=Eoe;function Eoe(r,e,t){var n=null,i=null;try{var o=new an(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===-1)&&(n=s,i=new Qt(n,t))}),n}kt.minSatisfying=Poe;function Poe(r,e,t){var n=null,i=null;try{var o=new an(e,t)}catch{return null}return r.forEach(function(s){o.test(s)&&(!n||i.compare(s)===1)&&(n=s,i=new Qt(n,t))}),n}kt.minVersion=koe;function koe(r,e){r=new an(r,e);var t=new Qt("0.0.0");if(r.test(t)||(t=new Qt("0.0.0-0"),r.test(t)))return t;t=null;for(var n=0;n<r.set.length;++n){var i=r.set[n];i.forEach(function(o){var s=new Qt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||LS(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&r.test(t)?t:null}kt.validRange=Doe;function Doe(r,e){try{return new an(r,e).range||"*"}catch{return null}}kt.ltr=_oe;function _oe(r,e,t){return QA(r,e,"<",t)}kt.gtr=Toe;function Toe(r,e,t){return QA(r,e,">",t)}kt.outside=QA;function QA(r,e,t,n){r=new Qt(r,n),e=new an(e,n);var i,o,s,a,c;switch(t){case">":i=LS,o=zA,s=ME,a=">",c=">=";break;case"<":i=ME,o=GA,s=LS,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(KE(r,e,n))return!1;for(var l=0;l<e.set.length;++l){var u=e.set[l],p=null,m=null;if(u.forEach(function(h){h.semver===jS&&(h=new ys(">=0.0.0")),p=p||h,m=m||h,i(h.semver,p.semver,n)?p=h:s(h.semver,m.semver,n)&&(m=h)}),p.operator===a||p.operator===c||(!m.operator||m.operator===a)&&o(r,m.semver))return!1;if(m.operator===c&&s(r,m.semver))return!1}return!0}kt.prerelease=Roe;function Roe(r,e){var t=lm(r,e);return t&&t.prerelease.length?t.prerelease:null}kt.intersects=Aoe;function Aoe(r,e,t){return r=new an(r,t),e=new an(e,t),r.intersects(e)}kt.coerce=Noe;function Noe(r){if(r instanceof Qt)return r;if(typeof r!="string")return null;var e=r.match(Mr[B2]);return e==null?null:lm(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var YA=N((QCe,rV)=>{"use strict";var eV=Array.isArray,tV=Object.keys,Koe=Object.prototype.hasOwnProperty;rV.exports=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=eV(e),i=eV(t),o,s,a;if(n&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!r(e[o],t[o]))return!1;return!0}if(n!=i)return!1;var c=e instanceof Date,l=t instanceof Date;if(c!=l)return!1;if(c&&l)return e.getTime()==t.getTime();var u=e instanceof RegExp,p=t instanceof RegExp;if(u!=p)return!1;if(u&&p)return e.toString()==t.toString();var m=tV(e);if(s=m.length,s!==tV(t).length)return!1;for(o=s;o--!==0;)if(!Koe.call(t,m[o]))return!1;for(o=s;o--!==0;)if(a=m[o],!r(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var xV=N(Sc=>{"use strict";Object.defineProperty(Sc,"__esModule",{value:!0});Sc.EventEmitter=Sc.once=Sc.toPromise=void 0;function sse(r,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let n=(0,Sc.once)(r,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{n.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Sc.once)(r,t))}Sc.toPromise=sse;var ase=(r,e)=>{let t=r(n=>{e(n),t.dispose()});return t};Sc.once=ase;var iN=class{constructor(){this.event=(e,t,n)=>{let i=this.add(t?e.bind(t):e);return n?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Sc.EventEmitter=iN});var yN=N(hp=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.TargetPopulation=hp.Filters=hp.VSCodeFilterProvider=void 0;var xP=require("vscode"),vN=class r{constructor(e,t,n){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=n}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Tc.ApplicationVersion:return r.trimVersionSuffix(xP.version);case Tc.Build:return xP.env.appName;case Tc.ClientId:return xP.env.machineId;case Tc.ExtensionName:return this.extensionName;case Tc.ExtensionVersion:return r.trimVersionSuffix(this.extensionVersion);case Tc.Language:return xP.env.language;case Tc.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Tc);for(let n of t)e.set(n,this.getFilterValue(n));return e}};hp.VSCodeFilterProvider=vN;var Tc;(function(r){r.Market="X-MSEdge-Market",r.CorpNet="X-FD-Corpnet",r.ApplicationVersion="X-VSCode-AppVersion",r.Build="X-VSCode-Build",r.ClientId="X-MSEdge-ClientId",r.ExtensionName="X-VSCode-ExtensionName",r.ExtensionVersion="X-VSCode-ExtensionVersion",r.Language="X-VSCode-Language",r.TargetPopulation="X-VSCode-TargetPopulation"})(Tc||(hp.Filters=Tc={}));var e9;(function(r){r.Team="team",r.Internal="internal",r.Insiders="insider",r.Public="public"})(e9||(hp.TargetPopulation=e9={}))});var t9=N(CP=>{"use strict";Object.defineProperty(CP,"__esModule",{value:!0});CP.BaseFeatureProvider=void 0;var bN=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};CP.BaseFeatureProvider=bN});var r9=N(wP=>{"use strict";Object.defineProperty(wP,"__esModule",{value:!0});wP.FilteredFeatureProvider=void 0;var vse=t9(),IN=class extends vse.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let n=t.getFilters();for(let i of n.keys()){let o=n.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};wP.FilteredFeatureProvider=IN});var n9=N(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});gp.TasApiFeatureProvider=gp.TASAPI_FETCHERROR_EVENTNAME=void 0;var yse=r9();gp.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var SN="ErrorType",xN=class extends yse.FilteredFeatureProvider{constructor(e,t,n){super(t,n),this.httpClient=e,this.telemetry=t,this.filterProviders=n}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let c=e.get(a);t[a]=c}let n;try{n=await this.httpClient.get({headers:t})}catch(a){let c=a,l=new Map;c.response?l.set(SN,"ServerError"):c.request?l.set(SN,"NoResponse"):l.set(SN,"GenericError"),this.telemetry.postEvent(gp.TASAPI_FETCHERROR_EVENTNAME,l)}if(!n)throw Error(gp.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=n.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let c of Object.keys(a.Parameters)){let l=c+(a.Parameters[c]?"":"cf");s.includes(l)||s.push(l)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};gp.TasApiFeatureProvider=xN});var s9=N((y_e,o9)=>{var i9=require("stream").Stream,bse=require("util");o9.exports=fa;function fa(){this.source=null,this.dataSize=0,this.maxDataSize=1024*1024,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}bse.inherits(fa,i9);fa.create=function(r,e){var t=new this;e=e||{};for(var n in e)t[n]=e[n];t.source=r;var i=r.emit;return r.emit=function(){return t._handleEmit(arguments),i.apply(r,arguments)},r.on("error",function(){}),t.pauseStream&&r.pause(),t};Object.defineProperty(fa.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}});fa.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)};fa.prototype.resume=function(){this._released||this.release(),this.source.resume()};fa.prototype.pause=function(){this.source.pause()};fa.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(r){this.emit.apply(this,r)}.bind(this)),this._bufferedEvents=[]};fa.prototype.pipe=function(){var r=i9.prototype.pipe.apply(this,arguments);return this.resume(),r};fa.prototype._handleEmit=function(r){if(this._released){this.emit.apply(this,r);return}r[0]==="data"&&(this.dataSize+=r[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(r)};fa.prototype._checkIfMaxDataSizeExceeded=function(){if(!this._maxDataSizeExceeded&&!(this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(r))}}});var u9=N((b_e,l9)=>{var Ise=require("util"),c9=require("stream").Stream,a9=s9();l9.exports=vn;function vn(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2*1024*1024,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}Ise.inherits(vn,c9);vn.create=function(r){var e=new this;r=r||{};for(var t in r)e[t]=r[t];return e};vn.isStreamLike=function(r){return typeof r!="function"&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"&&!Buffer.isBuffer(r)};vn.prototype.append=function(r){var e=vn.isStreamLike(r);if(e){if(!(r instanceof a9)){var t=a9.create(r,{maxDataSize:1/0,pauseStream:this.pauseStreams});r.on("data",this._checkDataSize.bind(this)),r=t}this._handleErrors(r),this.pauseStreams&&r.pause()}return this._streams.push(r),this};vn.prototype.pipe=function(r,e){return c9.prototype.pipe.call(this,r,e),this.resume(),r};vn.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop){this._pendingNext=!0;return}this._insideLoop=!0;try{do this._pendingNext=!1,this._realGetNext();while(this._pendingNext)}finally{this._insideLoop=!1}};vn.prototype._realGetNext=function(){var r=this._streams.shift();if(typeof r>"u"){this.end();return}if(typeof r!="function"){this._pipeNext(r);return}var e=r;e(function(t){var n=vn.isStreamLike(t);n&&(t.on("data",this._checkDataSize.bind(this)),this._handleErrors(t)),this._pipeNext(t)}.bind(this))};vn.prototype._pipeNext=function(r){this._currentStream=r;var e=vn.isStreamLike(r);if(e){r.on("end",this._getNext.bind(this)),r.pipe(this,{end:!1});return}var t=r;this.write(t),this._getNext()};vn.prototype._handleErrors=function(r){var e=this;r.on("error",function(t){e._emitError(t)})};vn.prototype.write=function(r){this.emit("data",r)};vn.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&typeof this._currentStream.pause=="function"&&this._currentStream.pause(),this.emit("pause"))};vn.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&typeof this._currentStream.resume=="function"&&this._currentStream.resume(),this.emit("resume")};vn.prototype.end=function(){this._reset(),this.emit("end")};vn.prototype.destroy=function(){this._reset(),this.emit("close")};vn.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null};vn.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var r="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(r))}};vn.prototype._updateDataSize=function(){this.dataSize=0;var r=this;this._streams.forEach(function(e){e.dataSize&&(r.dataSize+=e.dataSize)}),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)};vn.prototype._emitError=function(r){this._reset(),this.emit("error",r)}});var p9=N((I_e,Sse)=>{Sse.exports={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}}});var m9=N((S_e,d9)=>{d9.exports=p9()});var g9=N(uo=>{"use strict";var EP=m9(),xse=require("path").extname,f9=/^\s*([^;\s]*)(?:;|\s|$)/,Cse=/^text\//i;uo.charset=h9;uo.charsets={lookup:h9};uo.contentType=wse;uo.extension=Ese;uo.extensions=Object.create(null);uo.lookup=Pse;uo.types=Object.create(null);kse(uo.extensions,uo.types);function h9(r){if(!r||typeof r!="string")return!1;var e=f9.exec(r),t=e&&EP[e[1].toLowerCase()];return t&&t.charset?t.charset:e&&Cse.test(e[1])?"UTF-8":!1}function wse(r){if(!r||typeof r!="string")return!1;var e=r.indexOf("/")===-1?uo.lookup(r):r;if(!e)return!1;if(e.indexOf("charset")===-1){var t=uo.charset(e);t&&(e+="; charset="+t.toLowerCase())}return e}function Ese(r){if(!r||typeof r!="string")return!1;var e=f9.exec(r),t=e&&uo.extensions[e[1].toLowerCase()];return!t||!t.length?!1:t[0]}function Pse(r){if(!r||typeof r!="string")return!1;var e=xse("x."+r).toLowerCase().substr(1);return e&&uo.types[e]||!1}function kse(r,e){var t=["nginx","apache",void 0,"iana"];Object.keys(EP).forEach(function(i){var o=EP[i],s=o.extensions;if(!(!s||!s.length)){r[i]=s;for(var a=0;a<s.length;a++){var c=s[a];if(e[c]){var l=t.indexOf(EP[e[c]].source),u=t.indexOf(o.source);if(e[c]!=="application/octet-stream"&&(l>u||l===u&&e[c].substr(0,12)==="application/"))continue}e[c]=i}}})}});var y9=N((C_e,v9)=>{v9.exports=Dse;function Dse(r){var e=typeof setImmediate=="function"?setImmediate:typeof process=="object"&&typeof process.nextTick=="function"?process.nextTick:null;e?e(r):setTimeout(r,0)}});var CN=N((w_e,I9)=>{var b9=y9();I9.exports=_se;function _se(r){var e=!1;return b9(function(){e=!0}),function(n,i){e?r(n,i):b9(function(){r(n,i)})}}});var wN=N((E_e,S9)=>{S9.exports=Tse;function Tse(r){Object.keys(r.jobs).forEach(Rse.bind(r)),r.jobs={}}function Rse(r){typeof this.jobs[r]=="function"&&this.jobs[r]()}});var EN=N((P_e,C9)=>{var x9=CN(),Ase=wN();C9.exports=Nse;function Nse(r,e,t,n){var i=t.keyedList?t.keyedList[t.index]:t.index;t.jobs[i]=Mse(e,i,r[i],function(o,s){i in t.jobs&&(delete t.jobs[i],o?Ase(t):t.results[i]=s,n(o,t.results))})}function Mse(r,e,t,n){var i;return r.length==2?i=r(t,x9(n)):i=r(t,e,x9(n)),i}});var PN=N((k_e,w9)=>{w9.exports=Ose;function Ose(r,e){var t=!Array.isArray(r),n={index:0,keyedList:t||e?Object.keys(r):null,jobs:{},results:t?{}:[],size:t?Object.keys(r).length:r.length};return e&&n.keyedList.sort(t?e:function(i,o){return e(r[i],r[o])}),n}});var kN=N((D_e,E9)=>{var Kse=wN(),Fse=CN();E9.exports=Lse;function Lse(r){Object.keys(this.jobs).length&&(this.index=this.size,Kse(this),Fse(r)(null,this.results))}});var k9=N((__e,P9)=>{var Use=EN(),jse=PN(),Wse=kN();P9.exports=Vse;function Vse(r,e,t){for(var n=jse(r);n.index<(n.keyedList||r).length;)Use(r,e,n,function(i,o){if(i){t(i,o);return}if(Object.keys(n.jobs).length===0){t(null,n.results);return}}),n.index++;return Wse.bind(n,t)}});var DN=N((T_e,PP)=>{var D9=EN(),Bse=PN(),qse=kN();PP.exports=Jse;PP.exports.ascending=_9;PP.exports.descending=$se;function Jse(r,e,t,n){var i=Bse(r,t);return D9(r,e,i,function o(s,a){if(s){n(s,a);return}if(i.index++,i.index<(i.keyedList||r).length){D9(r,e,i,o);return}n(null,i.results)}),qse.bind(i,n)}function _9(r,e){return r<e?-1:r>e?1:0}function $se(r,e){return-1*_9(r,e)}});var R9=N((R_e,T9)=>{var Hse=DN();T9.exports=Gse;function Gse(r,e,t){return Hse(r,e,null,t)}});var N9=N((A_e,A9)=>{A9.exports={parallel:k9(),serial:R9(),serialOrdered:DN()}});var O9=N((N_e,M9)=>{M9.exports=function(r,e){return Object.keys(e).forEach(function(t){r[t]=r[t]||e[t]}),r}});var L9=N((M_e,F9)=>{var AN=u9(),K9=require("util"),_N=require("path"),zse=require("http"),Qse=require("https"),Yse=require("url").parse,Xse=require("fs"),Zse=require("stream").Stream,TN=g9(),eae=N9(),RN=O9();F9.exports=rr;K9.inherits(rr,AN);function rr(r){if(!(this instanceof rr))return new rr(r);this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],AN.call(this),r=r||{};for(var e in r)this[e]=r[e]}rr.LINE_BREAK=`\r
`;rr.DEFAULT_CONTENT_TYPE="application/octet-stream";rr.prototype.append=function(r,e,t){t=t||{},typeof t=="string"&&(t={filename:t});var n=AN.prototype.append.bind(this);if(typeof e=="number"&&(e=""+e),K9.isArray(e)){this._error(new Error("Arrays are not supported."));return}var i=this._multiPartHeader(r,e,t),o=this._multiPartFooter();n(i),n(e),n(o),this._trackLength(i,e,t)};rr.prototype._trackLength=function(r,e,t){var n=0;t.knownLength!=null?n+=+t.knownLength:Buffer.isBuffer(e)?n=e.length:typeof e=="string"&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(r)+rr.LINE_BREAK.length,!(!e||!e.path&&!(e.readable&&e.hasOwnProperty("httpVersion"))&&!(e instanceof Zse))&&(t.knownLength||this._valuesToMeasure.push(e))};rr.prototype._lengthRetriever=function(r,e){r.hasOwnProperty("fd")?r.end!=null&&r.end!=1/0&&r.start!=null?e(null,r.end+1-(r.start?r.start:0)):Xse.stat(r.path,function(t,n){var i;if(t){e(t);return}i=n.size-(r.start?r.start:0),e(null,i)}):r.hasOwnProperty("httpVersion")?e(null,+r.headers["content-length"]):r.hasOwnProperty("httpModule")?(r.on("response",function(t){r.pause(),e(null,+t.headers["content-length"])}),r.resume()):e("Unknown stream")};rr.prototype._multiPartHeader=function(r,e,t){if(typeof t.header=="string")return t.header;var n=this._getContentDisposition(e,t),i=this._getContentType(e,t),o="",s={"Content-Disposition":["form-data",'name="'+r+'"'].concat(n||[]),"Content-Type":[].concat(i||[])};typeof t.header=="object"&&RN(s,t.header);var a;for(var c in s)s.hasOwnProperty(c)&&(a=s[c],a!=null&&(Array.isArray(a)||(a=[a]),a.length&&(o+=c+": "+a.join("; ")+rr.LINE_BREAK)));return"--"+this.getBoundary()+rr.LINE_BREAK+o+rr.LINE_BREAK};rr.prototype._getContentDisposition=function(r,e){var t,n;return typeof e.filepath=="string"?t=_N.normalize(e.filepath).replace(/\\/g,"/"):e.filename||r.name||r.path?t=_N.basename(e.filename||r.name||r.path):r.readable&&r.hasOwnProperty("httpVersion")&&(t=_N.basename(r.client._httpMessage.path||"")),t&&(n='filename="'+t+'"'),n};rr.prototype._getContentType=function(r,e){var t=e.contentType;return!t&&r.name&&(t=TN.lookup(r.name)),!t&&r.path&&(t=TN.lookup(r.path)),!t&&r.readable&&r.hasOwnProperty("httpVersion")&&(t=r.headers["content-type"]),!t&&(e.filepath||e.filename)&&(t=TN.lookup(e.filepath||e.filename)),!t&&typeof r=="object"&&(t=rr.DEFAULT_CONTENT_TYPE),t};rr.prototype._multiPartFooter=function(){return function(r){var e=rr.LINE_BREAK,t=this._streams.length===0;t&&(e+=this._lastBoundary()),r(e)}.bind(this)};rr.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+rr.LINE_BREAK};rr.prototype.getHeaders=function(r){var e,t={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in r)r.hasOwnProperty(e)&&(t[e.toLowerCase()]=r[e]);return t};rr.prototype.setBoundary=function(r){this._boundary=r};rr.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary};rr.prototype.getBuffer=function(){for(var r=new Buffer.alloc(0),e=this.getBoundary(),t=0,n=this._streams.length;t<n;t++)typeof this._streams[t]!="function"&&(Buffer.isBuffer(this._streams[t])?r=Buffer.concat([r,this._streams[t]]):r=Buffer.concat([r,Buffer.from(this._streams[t])]),(typeof this._streams[t]!="string"||this._streams[t].substring(2,e.length+2)!==e)&&(r=Buffer.concat([r,Buffer.from(rr.LINE_BREAK)])));return Buffer.concat([r,Buffer.from(this._lastBoundary())])};rr.prototype._generateBoundary=function(){for(var r="--------------------------",e=0;e<24;e++)r+=Math.floor(Math.random()*10).toString(16);this._boundary=r};rr.prototype.getLengthSync=function(){var r=this._overheadLength+this._valueLength;return this._streams.length&&(r+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),r};rr.prototype.hasKnownLength=function(){var r=!0;return this._valuesToMeasure.length&&(r=!1),r};rr.prototype.getLength=function(r){var e=this._overheadLength+this._valueLength;if(this._streams.length&&(e+=this._lastBoundary().length),!this._valuesToMeasure.length){process.nextTick(r.bind(this,null,e));return}eae.parallel(this._valuesToMeasure,this._lengthRetriever,function(t,n){if(t){r(t);return}n.forEach(function(i){e+=i}),r(null,e)})};rr.prototype.submit=function(r,e){var t,n,i={method:"post"};return typeof r=="string"?(r=Yse(r),n=RN({port:r.port,path:r.pathname,host:r.hostname,protocol:r.protocol},i)):(n=RN(r,i),n.port||(n.port=n.protocol=="https:"?443:80)),n.headers=this.getHeaders(r.headers),n.protocol=="https:"?t=Qse.request(n):t=zse.request(n),this.getLength(function(o,s){if(o&&o!=="Unknown stream"){this._error(o);return}if(s&&t.setHeader("Content-Length",s),this.pipe(t),e){var a,c=function(l,u){return t.removeListener("error",c),t.removeListener("response",a),e.call(this,l,u)};a=c.bind(this,null),t.on("error",c),t.on("response",a)}}.bind(this)),t};rr.prototype._error=function(r){this.error||(this.error=r,this.pause(),this.emit("error",r))};rr.prototype.toString=function(){return"[object FormData]"}});var j9=N(U9=>{"use strict";var tae=require("url").parse,rae={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},nae=String.prototype.endsWith||function(r){return r.length<=this.length&&this.indexOf(r,this.length-r.length)!==-1};function iae(r){var e=typeof r=="string"?tae(r):r||{},t=e.protocol,n=e.host,i=e.port;if(typeof n!="string"||!n||typeof t!="string"||(t=t.split(":",1)[0],n=n.replace(/:\d*$/,""),i=parseInt(i)||rae[t]||0,!oae(n,i)))return"";var o=fg("npm_config_"+t+"_proxy")||fg(t+"_proxy")||fg("npm_config_proxy")||fg("all_proxy");return o&&o.indexOf("://")===-1&&(o=t+"://"+o),o}function oae(r,e){var t=(fg("npm_config_no_proxy")||fg("no_proxy")).toLowerCase();return t?t==="*"?!1:t.split(/[,\s]/).every(function(n){if(!n)return!0;var i=n.match(/^(.+):(\d+)$/),o=i?i[1]:n,s=i?parseInt(i[2]):0;return s&&s!==e?!0:/^[.*]/.test(o)?(o.charAt(0)==="*"&&(o=o.slice(1)),!nae.call(r,o)):r!==o}):!0}function fg(r){return process.env[r.toLowerCase()]||process.env[r.toUpperCase()]||""}U9.getProxyForUrl=iae});var DP=N((K_e,W9)=>{var hg=1e3,gg=hg*60,vg=gg*60,vm=vg*24,sae=vm*7,aae=vm*365.25;W9.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return cae(r);if(t==="number"&&isFinite(r))return e.long?uae(r):lae(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function cae(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*aae;case"weeks":case"week":case"w":return t*sae;case"days":case"day":case"d":return t*vm;case"hours":case"hour":case"hrs":case"hr":case"h":return t*vg;case"minutes":case"minute":case"mins":case"min":case"m":return t*gg;case"seconds":case"second":case"secs":case"sec":case"s":return t*hg;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function lae(r){var e=Math.abs(r);return e>=vm?Math.round(r/vm)+"d":e>=vg?Math.round(r/vg)+"h":e>=gg?Math.round(r/gg)+"m":e>=hg?Math.round(r/hg)+"s":r+"ms"}function uae(r){var e=Math.abs(r);return e>=vm?kP(r,e,vm,"day"):e>=vg?kP(r,e,vg,"hour"):e>=gg?kP(r,e,gg,"minute"):e>=hg?kP(r,e,hg,"second"):r+" ms"}function kP(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var NN=N((F_e,V9)=>{function pae(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=DP(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null,h,v;function b(...w){if(!b.enabled)return;let D=b,T=Number(new Date),F=T-(p||T);D.diff=F,D.prev=p,D.curr=T,p=T,w[0]=t.coerce(w[0]),typeof w[0]!="string"&&w.unshift("%O");let ee=0;w[0]=w[0].replace(/%([a-zA-Z%])/g,(Z,ye)=>{if(Z==="%%")return"%";ee++;let ue=t.formatters[ye];if(typeof ue=="function"){let le=w[ee];Z=ue.call(D,le),w.splice(ee,1),ee--}return Z}),t.formatArgs.call(D,w),(D.log||t.log).apply(D,w)}return b.namespace=u,b.useColors=t.useColors(),b.color=t.selectColor(u),b.extend=n,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==t.namespaces&&(h=t.namespaces,v=t.enabled(u)),v),set:w=>{m=w}}),typeof t.init=="function"&&t.init(b),b}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.slice(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}V9.exports=pae});var B9=N((Lo,_P)=>{Lo.formatArgs=mae;Lo.save=fae;Lo.load=hae;Lo.useColors=dae;Lo.storage=gae();Lo.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Lo.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dae(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mae(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+_P.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}Lo.log=console.debug||console.log||(()=>{});function fae(r){try{r?Lo.storage.setItem("debug",r):Lo.storage.removeItem("debug")}catch{}}function hae(){let r;try{r=Lo.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function gae(){try{return localStorage}catch{}}_P.exports=NN()(Lo);var{formatters:vae}=_P.exports;vae.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var J9=N((L_e,q9)=>{"use strict";q9.exports=(r,e)=>{e=e||process.argv;let t=r.startsWith("-")?"":r.length===1?"-":"--",n=e.indexOf(t+r),i=e.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var TP=N((U_e,$9)=>{"use strict";var yae=require("os"),ha=J9(),Ri=process.env,yg;ha("no-color")||ha("no-colors")||ha("color=false")?yg=!1:(ha("color")||ha("colors")||ha("color=true")||ha("color=always"))&&(yg=!0);"FORCE_COLOR"in Ri&&(yg=Ri.FORCE_COLOR.length===0||parseInt(Ri.FORCE_COLOR,10)!==0);function bae(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function Iae(r){if(yg===!1)return 0;if(ha("color=16m")||ha("color=full")||ha("color=truecolor"))return 3;if(ha("color=256"))return 2;if(r&&!r.isTTY&&yg!==!0)return 0;let e=yg?1:0;if(process.platform==="win32"){let t=yae.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Ri)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Ri)||Ri.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Ri)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Ri.TEAMCITY_VERSION)?1:0;if(Ri.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Ri){let t=parseInt((Ri.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Ri.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Ri.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Ri.TERM)||"COLORTERM"in Ri?1:(Ri.TERM==="dumb",e)}function MN(r){let e=Iae(r);return bae(e)}$9.exports={supportsColor:MN,stdout:MN(process.stdout),stderr:MN(process.stderr)}});var G9=N((oi,AP)=>{var Sae=require("tty"),RP=require("util");oi.init=Dae;oi.log=Eae;oi.formatArgs=Cae;oi.save=Pae;oi.load=kae;oi.useColors=xae;oi.destroy=RP.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");oi.colors=[6,2,3,4,5,1];try{let r=TP();r&&(r.stderr||r).level>=2&&(oi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}oi.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function xae(){return"colors"in oi.inspectOpts?!!oi.inspectOpts.colors:Sae.isatty(process.stderr.fd)}function Cae(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+AP.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=wae()+e+" "+r[0]}function wae(){return oi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Eae(...r){return process.stderr.write(RP.format(...r)+`
`)}function Pae(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function kae(){return process.env.DEBUG}function Dae(r){r.inspectOpts={};let e=Object.keys(oi.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=oi.inspectOpts[e[t]]}AP.exports=NN()(oi);var{formatters:H9}=AP.exports;H9.o=function(r){return this.inspectOpts.colors=this.useColors,RP.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};H9.O=function(r){return this.inspectOpts.colors=this.useColors,RP.inspect(r,this.inspectOpts)}});var z9=N((j_e,ON)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ON.exports=B9():ON.exports=G9()});var Y9=N((W_e,Q9)=>{var XS;Q9.exports=function(){if(!XS){try{XS=z9()("follow-redirects")}catch{}typeof XS!="function"&&(XS=function(){})}XS.apply(null,arguments)}});var r3=N((V_e,HN)=>{var tx=require("url"),ZS=tx.URL,_ae=require("http"),Tae=require("https"),jN=require("stream").Writable,WN=require("assert"),X9=Y9(),VN=!1;try{WN(new ZS)}catch(r){VN=r.code==="ERR_INVALID_URL"}var Rae=["auth","host","hostname","href","path","pathname","port","protocol","query","search"],BN=["abort","aborted","connect","error","socket","timeout"],qN=Object.create(null);BN.forEach(function(r){qN[r]=function(e,t,n){this._redirectable.emit(r,e,t,n)}});var FN=rx("ERR_INVALID_URL","Invalid URL",TypeError),LN=rx("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),Aae=rx("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded",LN),Nae=rx("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),Mae=rx("ERR_STREAM_WRITE_AFTER_END","write after end"),Oae=jN.prototype.destroy||e3;function po(r,e){jN.call(this),this._sanitizeOptions(r),this._options=r,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],e&&this.on("response",e);var t=this;this._onNativeResponse=function(n){try{t._processResponse(n)}catch(i){t.emit("error",i instanceof LN?i:new LN({cause:i}))}},this._performRequest()}po.prototype=Object.create(jN.prototype);po.prototype.abort=function(){$N(this._currentRequest),this._currentRequest.abort(),this.emit("abort")};po.prototype.destroy=function(r){return $N(this._currentRequest,r),Oae.call(this,r),this};po.prototype.write=function(r,e,t){if(this._ending)throw new Mae;if(!ym(r)&&!Lae(r))throw new TypeError("data should be a string, Buffer or Uint8Array");if(ex(e)&&(t=e,e=null),r.length===0){t&&t();return}this._requestBodyLength+r.length<=this._options.maxBodyLength?(this._requestBodyLength+=r.length,this._requestBodyBuffers.push({data:r,encoding:e}),this._currentRequest.write(r,e,t)):(this.emit("error",new Nae),this.abort())};po.prototype.end=function(r,e,t){if(ex(r)?(t=r,r=e=null):ex(e)&&(t=e,e=null),!r)this._ended=this._ending=!0,this._currentRequest.end(null,null,t);else{var n=this,i=this._currentRequest;this.write(r,e,function(){n._ended=!0,i.end(null,null,t)}),this._ending=!0}};po.prototype.setHeader=function(r,e){this._options.headers[r]=e,this._currentRequest.setHeader(r,e)};po.prototype.removeHeader=function(r){delete this._options.headers[r],this._currentRequest.removeHeader(r)};po.prototype.setTimeout=function(r,e){var t=this;function n(s){s.setTimeout(r),s.removeListener("timeout",s.destroy),s.addListener("timeout",s.destroy)}function i(s){t._timeout&&clearTimeout(t._timeout),t._timeout=setTimeout(function(){t.emit("timeout"),o()},r),n(s)}function o(){t._timeout&&(clearTimeout(t._timeout),t._timeout=null),t.removeListener("abort",o),t.removeListener("error",o),t.removeListener("response",o),t.removeListener("close",o),e&&t.removeListener("timeout",e),t.socket||t._currentRequest.removeListener("socket",i)}return e&&this.on("timeout",e),this.socket?i(this.socket):this._currentRequest.once("socket",i),this.on("socket",n),this.on("abort",o),this.on("error",o),this.on("response",o),this.on("close",o),this};["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach(function(r){po.prototype[r]=function(e,t){return this._currentRequest[r](e,t)}});["aborted","connection","socket"].forEach(function(r){Object.defineProperty(po.prototype,r,{get:function(){return this._currentRequest[r]}})});po.prototype._sanitizeOptions=function(r){if(r.headers||(r.headers={}),r.host&&(r.hostname||(r.hostname=r.host),delete r.host),!r.pathname&&r.path){var e=r.path.indexOf("?");e<0?r.pathname=r.path:(r.pathname=r.path.substring(0,e),r.search=r.path.substring(e))}};po.prototype._performRequest=function(){var r=this._options.protocol,e=this._options.nativeProtocols[r];if(!e)throw new TypeError("Unsupported protocol "+r);if(this._options.agents){var t=r.slice(0,-1);this._options.agent=this._options.agents[t]}var n=this._currentRequest=e.request(this._options,this._onNativeResponse);n._redirectable=this;for(var i of BN)n.on(i,qN[i]);if(this._currentUrl=/^\//.test(this._options.path)?tx.format(this._options):this._options.path,this._isRedirect){var o=0,s=this,a=this._requestBodyBuffers;(function c(l){if(n===s._currentRequest)if(l)s.emit("error",l);else if(o<a.length){var u=a[o++];n.finished||n.write(u.data,u.encoding,c)}else s._ended&&n.end()})()}};po.prototype._processResponse=function(r){var e=r.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:r.headers,statusCode:e});var t=r.headers.location;if(!t||this._options.followRedirects===!1||e<300||e>=400){r.responseUrl=this._currentUrl,r.redirects=this._redirects,this.emit("response",r),this._requestBodyBuffers=[];return}if($N(this._currentRequest),r.destroy(),++this._redirectCount>this._options.maxRedirects)throw new Aae;var n,i=this._options.beforeRedirect;i&&(n=Object.assign({Host:r.req.getHeader("host")},this._options.headers));var o=this._options.method;((e===301||e===302)&&this._options.method==="POST"||e===303&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],KN(/^content-/i,this._options.headers));var s=KN(/^host$/i,this._options.headers),a=JN(this._currentUrl),c=s||a.host,l=/^\w+:/.test(t)?this._currentUrl:tx.format(Object.assign(a,{host:c})),u=Kae(t,l);if(X9("redirecting to",u.href),this._isRedirect=!0,UN(u,this._options),(u.protocol!==a.protocol&&u.protocol!=="https:"||u.host!==c&&!Fae(u.host,c))&&KN(/^(?:authorization|cookie)$/i,this._options.headers),ex(i)){var p={headers:r.headers,statusCode:e},m={url:l,method:o,headers:n};i(this._options,p,m),this._sanitizeOptions(this._options)}this._performRequest()};function Z9(r){var e={maxRedirects:21,maxBodyLength:10485760},t={};return Object.keys(r).forEach(function(n){var i=n+":",o=t[i]=r[n],s=e[n]=Object.create(o);function a(l,u,p){return Uae(l)?l=UN(l):ym(l)?l=UN(JN(l)):(p=u,u=t3(l),l={protocol:i}),ex(u)&&(p=u,u=null),u=Object.assign({maxRedirects:e.maxRedirects,maxBodyLength:e.maxBodyLength},l,u),u.nativeProtocols=t,!ym(u.host)&&!ym(u.hostname)&&(u.hostname="::1"),WN.equal(u.protocol,i,"protocol mismatch"),X9("options",u),new po(u,p)}function c(l,u,p){var m=s.request(l,u,p);return m.end(),m}Object.defineProperties(s,{request:{value:a,configurable:!0,enumerable:!0,writable:!0},get:{value:c,configurable:!0,enumerable:!0,writable:!0}})}),e}function e3(){}function JN(r){var e;if(VN)e=new ZS(r);else if(e=t3(tx.parse(r)),!ym(e.protocol))throw new FN({input:r});return e}function Kae(r,e){return VN?new ZS(r,e):JN(tx.resolve(e,r))}function t3(r){if(/^\[/.test(r.hostname)&&!/^\[[:0-9a-f]+\]$/i.test(r.hostname))throw new FN({input:r.href||r});if(/^\[/.test(r.host)&&!/^\[[:0-9a-f]+\](:\d+)?$/i.test(r.host))throw new FN({input:r.href||r});return r}function UN(r,e){var t=e||{};for(var n of Rae)t[n]=r[n];return t.hostname.startsWith("[")&&(t.hostname=t.hostname.slice(1,-1)),t.port!==""&&(t.port=Number(t.port)),t.path=t.search?t.pathname+t.search:t.pathname,t}function KN(r,e){var t;for(var n in e)r.test(n)&&(t=e[n],delete e[n]);return t===null||typeof t>"u"?void 0:String(t).trim()}function rx(r,e,t){function n(i){Error.captureStackTrace(this,this.constructor),Object.assign(this,i||{}),this.code=r,this.message=this.cause?e+": "+this.cause.message:e}return n.prototype=new(t||Error),Object.defineProperties(n.prototype,{constructor:{value:n,enumerable:!1},name:{value:"Error ["+r+"]",enumerable:!1}}),n}function $N(r,e){for(var t of BN)r.removeListener(t,qN[t]);r.on("error",e3),r.destroy(e)}function Fae(r,e){WN(ym(r)&&ym(e));var t=r.length-e.length-1;return t>0&&r[t]==="."&&r.endsWith(e)}function ym(r){return typeof r=="string"||r instanceof String}function ex(r){return typeof r=="function"}function Lae(r){return typeof r=="object"&&"length"in r}function Uae(r){return ZS&&r instanceof ZS}HN.exports=Z9({http:_ae,https:Tae});HN.exports.wrap=Z9});var $3=N((B_e,J3)=>{"use strict";var jae=L9(),Wae=require("url"),Vae=j9(),Bae=require("http"),qae=require("https"),I3=require("util"),Jae=r3(),$ae=require("zlib"),S3=require("stream"),Hae=require("events");function Ol(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var x3=Ol(jae),Gae=Ol(Wae),zae=Ol(Bae),Qae=Ol(qae),Yae=Ol(I3),Xae=Ol(Jae),Ip=Ol($ae),yp=Ol(S3),Zae=Ol(Hae);function C3(r,e){return function(){return r.apply(e,arguments)}}var{toString:ece}=Object.prototype,{getPrototypeOf:cM}=Object,LP=(r=>e=>{let t=ece.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Rc=r=>(r=r.toLowerCase(),e=>LP(e)===r),UP=r=>e=>typeof e===r,{isArray:xg}=Array,ox=UP("undefined");function tce(r){return r!==null&&!ox(r)&&r.constructor!==null&&!ox(r.constructor)&&_s(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}var w3=Rc("ArrayBuffer");function rce(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&w3(r.buffer),e}var nce=UP("string"),_s=UP("function"),E3=UP("number"),jP=r=>r!==null&&typeof r=="object",ice=r=>r===!0||r===!1,MP=r=>{if(LP(r)!=="object")return!1;let e=cM(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},oce=Rc("Date"),sce=Rc("File"),ace=Rc("Blob"),cce=Rc("FileList"),lce=r=>jP(r)&&_s(r.pipe),uce=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||_s(r.append)&&((e=LP(r))==="formdata"||e==="object"&&_s(r.toString)&&r.toString()==="[object FormData]"))},pce=Rc("URLSearchParams"),dce=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ax(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let n,i;if(typeof r!="object"&&(r=[r]),xg(r))for(n=0,i=r.length;n<i;n++)e.call(null,r[n],n,r);else{let o=t?Object.getOwnPropertyNames(r):Object.keys(r),s=o.length,a;for(n=0;n<s;n++)a=o[n],e.call(null,r[a],a,r)}}function P3(r,e){e=e.toLowerCase();let t=Object.keys(r),n=t.length,i;for(;n-- >0;)if(i=t[n],e===i.toLowerCase())return i;return null}var k3=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),D3=r=>!ox(r)&&r!==k3;function XN(){let{caseless:r}=D3(this)&&this||{},e={},t=(n,i)=>{let o=r&&P3(e,i)||i;MP(e[o])&&MP(n)?e[o]=XN(e[o],n):MP(n)?e[o]=XN({},n):xg(n)?e[o]=n.slice():e[o]=n};for(let n=0,i=arguments.length;n<i;n++)arguments[n]&&ax(arguments[n],t);return e}var mce=(r,e,t,{allOwnKeys:n}={})=>(ax(e,(i,o)=>{t&&_s(i)?r[o]=C3(i,t):r[o]=i},{allOwnKeys:n}),r),fce=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),hce=(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},gce=(r,e,t,n)=>{let i,o,s,a={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),o=i.length;o-- >0;)s=i[o],(!n||n(s,r,e))&&!a[s]&&(e[s]=r[s],a[s]=!0);r=t!==!1&&cM(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},vce=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},yce=r=>{if(!r)return null;if(xg(r))return r;let e=r.length;if(!E3(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},bce=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&cM(Uint8Array)),Ice=(r,e)=>{let n=(r&&r[Symbol.iterator]).call(r),i;for(;(i=n.next())&&!i.done;){let o=i.value;e.call(r,o[0],o[1])}},Sce=(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},xce=Rc("HTMLFormElement"),Cce=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,i){return n.toUpperCase()+i}),n3=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),wce=Rc("RegExp"),_3=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};ax(t,(i,o)=>{let s;(s=e(i,o,r))!==!1&&(n[o]=s||i)}),Object.defineProperties(r,n)},Ece=r=>{_3(r,(e,t)=>{if(_s(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];if(_s(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Pce=(r,e)=>{let t={},n=i=>{i.forEach(o=>{t[o]=!0})};return xg(r)?n(r):n(String(r).split(e)),t},kce=()=>{},Dce=(r,e)=>(r=+r,Number.isFinite(r)?r:e),GN="abcdefghijklmnopqrstuvwxyz",i3="0123456789",T3={DIGIT:i3,ALPHA:GN,ALPHA_DIGIT:GN+GN.toUpperCase()+i3},_ce=(r=16,e=T3.ALPHA_DIGIT)=>{let t="",{length:n}=e;for(;r--;)t+=e[Math.random()*n|0];return t};function Tce(r){return!!(r&&_s(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}var Rce=r=>{let e=new Array(10),t=(n,i)=>{if(jP(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let o=xg(n)?[]:{};return ax(n,(s,a)=>{let c=t(s,i+1);!ox(c)&&(o[a]=c)}),e[i]=void 0,o}}return n};return t(r,0)},Ace=Rc("AsyncFunction"),Nce=r=>r&&(jP(r)||_s(r))&&_s(r.then)&&_s(r.catch),X={isArray:xg,isArrayBuffer:w3,isBuffer:tce,isFormData:uce,isArrayBufferView:rce,isString:nce,isNumber:E3,isBoolean:ice,isObject:jP,isPlainObject:MP,isUndefined:ox,isDate:oce,isFile:sce,isBlob:ace,isRegExp:wce,isFunction:_s,isStream:lce,isURLSearchParams:pce,isTypedArray:bce,isFileList:cce,forEach:ax,merge:XN,extend:mce,trim:dce,stripBOM:fce,inherits:hce,toFlatObject:gce,kindOf:LP,kindOfTest:Rc,endsWith:vce,toArray:yce,forEachEntry:Ice,matchAll:Sce,isHTMLForm:xce,hasOwnProperty:n3,hasOwnProp:n3,reduceDescriptors:_3,freezeMethods:Ece,toObjectSet:Pce,toCamelCase:Cce,noop:kce,toFiniteNumber:Dce,findKey:P3,global:k3,isContextDefined:D3,ALPHABET:T3,generateString:_ce,isSpecCompliantForm:Tce,toJSONObject:Rce,isAsyncFn:Ace,isThenable:Nce};function Ye(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i)}X.inherits(Ye,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:X.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var R3=Ye.prototype,A3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{A3[r]={value:r}});Object.defineProperties(Ye,A3);Object.defineProperty(R3,"isAxiosError",{value:!0});Ye.from=(r,e,t,n,i,o)=>{let s=Object.create(R3);return X.toFlatObject(r,s,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Ye.call(s,r.message,e,t,n,i),s.cause=r,s.name=r.name,o&&Object.assign(s,o),s};function ZN(r){return X.isPlainObject(r)||X.isArray(r)}function N3(r){return X.endsWith(r,"[]")?r.slice(0,-2):r}function o3(r,e,t){return r?r.concat(e).map(function(i,o){return i=N3(i),!t&&o?"["+i+"]":i}).join(t?".":""):e}function Mce(r){return X.isArray(r)&&!r.some(ZN)}var Oce=X.toFlatObject(X,{},null,function(e){return/^is[A-Z]/.test(e)});function WP(r,e,t){if(!X.isObject(r))throw new TypeError("target must be an object");e=e||new(x3.default||FormData),t=X.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,w){return!X.isUndefined(w[b])});let n=t.metaTokens,i=t.visitor||u,o=t.dots,s=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&X.isSpecCompliantForm(e);if(!X.isFunction(i))throw new TypeError("visitor must be a function");function l(v){if(v===null)return"";if(X.isDate(v))return v.toISOString();if(!c&&X.isBlob(v))throw new Ye("Blob is not supported. Use a Buffer instead.");return X.isArrayBuffer(v)||X.isTypedArray(v)?c&&typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function u(v,b,w){let D=v;if(v&&!w&&typeof v=="object"){if(X.endsWith(b,"{}"))b=n?b:b.slice(0,-2),v=JSON.stringify(v);else if(X.isArray(v)&&Mce(v)||(X.isFileList(v)||X.endsWith(b,"[]"))&&(D=X.toArray(v)))return b=N3(b),D.forEach(function(F,ee){!(X.isUndefined(F)||F===null)&&e.append(s===!0?o3([b],ee,o):s===null?b:b+"[]",l(F))}),!1}return ZN(v)?!0:(e.append(o3(w,b,o),l(v)),!1)}let p=[],m=Object.assign(Oce,{defaultVisitor:u,convertValue:l,isVisitable:ZN});function h(v,b){if(!X.isUndefined(v)){if(p.indexOf(v)!==-1)throw Error("Circular reference detected in "+b.join("."));p.push(v),X.forEach(v,function(D,T){(!(X.isUndefined(D)||D===null)&&i.call(e,D,X.isString(T)?T.trim():T,b,m))===!0&&h(D,b?b.concat(T):[T])}),p.pop()}}if(!X.isObject(r))throw new TypeError("data must be an object");return h(r),e}function s3(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function M3(r,e){this._pairs=[],r&&WP(r,this,e)}var O3=M3.prototype;O3.append=function(e,t){this._pairs.push([e,t])};O3.toString=function(e){let t=e?function(n){return e.call(this,n,s3)}:s3;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function Kce(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lM(r,e,t){if(!e)return r;let n=t&&t.encode||Kce,i=t&&t.serialize,o;if(i?o=i(e,t):o=X.isURLSearchParams(e)?e.toString():new M3(e,t).toString(n),o){let s=r.indexOf("#");s!==-1&&(r=r.slice(0,s)),r+=(r.indexOf("?")===-1?"?":"&")+o}return r}var eM=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){X.forEach(this.handlers,function(n){n!==null&&e(n)})}},a3=eM,uM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Fce=Gae.default.URLSearchParams,Lce={isNode:!0,classes:{URLSearchParams:Fce,FormData:x3.default,Blob:typeof Blob<"u"&&Blob||null},protocols:["http","https","file","data"]},K3=typeof window<"u"&&typeof document<"u",Uce=(r=>K3&&["ReactNative","NativeScript","NS"].indexOf(r)<0)(typeof navigator<"u"&&navigator.product),jce=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Wce=Object.freeze({__proto__:null,hasBrowserEnv:K3,hasStandardBrowserWebWorkerEnv:jce,hasStandardBrowserEnv:Uce}),Ds={...Wce,...Lce};function Vce(r,e){return WP(r,new Ds.classes.URLSearchParams,Object.assign({visitor:function(t,n,i,o){return Ds.isNode&&X.isBuffer(t)?(this.append(n,t.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Bce(r){return X.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function qce(r){let e={},t=Object.keys(r),n,i=t.length,o;for(n=0;n<i;n++)o=t[n],e[o]=r[o];return e}function F3(r){function e(t,n,i,o){let s=t[o++],a=Number.isFinite(+s),c=o>=t.length;return s=!s&&X.isArray(i)?i.length:s,c?(X.hasOwnProp(i,s)?i[s]=[i[s],n]:i[s]=n,!a):((!i[s]||!X.isObject(i[s]))&&(i[s]=[]),e(t,n,i[s],o)&&X.isArray(i[s])&&(i[s]=qce(i[s])),!a)}if(X.isFormData(r)&&X.isFunction(r.entries)){let t={};return X.forEachEntry(r,(n,i)=>{e(Bce(n),i,t,0)}),t}return null}function Jce(r,e,t){if(X.isString(r))try{return(e||JSON.parse)(r),X.trim(r)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(r)}var pM={transitional:uM,adapter:["xhr","http"],transformRequest:[function(e,t){let n=t.getContentType()||"",i=n.indexOf("application/json")>-1,o=X.isObject(e);if(o&&X.isHTMLForm(e)&&(e=new FormData(e)),X.isFormData(e))return i&&i?JSON.stringify(F3(e)):e;if(X.isArrayBuffer(e)||X.isBuffer(e)||X.isStream(e)||X.isFile(e)||X.isBlob(e))return e;if(X.isArrayBufferView(e))return e.buffer;if(X.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Vce(e,this.formSerializer).toString();if((a=X.isFileList(e))||n.indexOf("multipart/form-data")>-1){let c=this.env&&this.env.FormData;return WP(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||i?(t.setContentType("application/json",!1),Jce(e)):e}],transformResponse:[function(e){let t=this.transitional||pM.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(e&&X.isString(e)&&(n&&!this.responseType||i)){let s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Ye.from(a,Ye.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ds.classes.FormData,Blob:Ds.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};X.forEach(["delete","get","head","post","put","patch"],r=>{pM.headers[r]={}});var dM=pM,$ce=X.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Hce=r=>{let e={},t,n,i;return r&&r.split(`
`).forEach(function(s){i=s.indexOf(":"),t=s.substring(0,i).trim().toLowerCase(),n=s.substring(i+1).trim(),!(!t||e[t]&&$ce[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},c3=Symbol("internals");function nx(r){return r&&String(r).trim().toLowerCase()}function OP(r){return r===!1||r==null?r:X.isArray(r)?r.map(OP):String(r)}function Gce(r){let e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,n;for(;n=t.exec(r);)e[n[1]]=n[2];return e}var zce=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function zN(r,e,t,n,i){if(X.isFunction(n))return n.call(this,e,t);if(i&&(e=t),!!X.isString(e)){if(X.isString(n))return e.indexOf(n)!==-1;if(X.isRegExp(n))return n.test(e)}}function Qce(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function Yce(r,e){let t=X.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(r,n+t,{value:function(i,o,s){return this[n].call(this,e,i,o,s)},configurable:!0})})}var bg=class{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function o(a,c,l){let u=nx(c);if(!u)throw new Error("header name must be a non-empty string");let p=X.findKey(i,u);(!p||i[p]===void 0||l===!0||l===void 0&&i[p]!==!1)&&(i[p||c]=OP(a))}let s=(a,c)=>X.forEach(a,(l,u)=>o(l,u,c));return X.isPlainObject(e)||e instanceof this.constructor?s(e,t):X.isString(e)&&(e=e.trim())&&!zce(e)?s(Hce(e),t):e!=null&&o(t,e,n),this}get(e,t){if(e=nx(e),e){let n=X.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return Gce(i);if(X.isFunction(t))return t.call(this,i,n);if(X.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=nx(e),e){let n=X.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||zN(this,this[n],n,t)))}return!1}delete(e,t){let n=this,i=!1;function o(s){if(s=nx(s),s){let a=X.findKey(n,s);a&&(!t||zN(n,n[a],a,t))&&(delete n[a],i=!0)}}return X.isArray(e)?e.forEach(o):o(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let o=t[n];(!e||zN(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){let t=this,n={};return X.forEach(this,(i,o)=>{let s=X.findKey(n,o);if(s){t[s]=OP(i),delete t[o];return}let a=e?Qce(o):String(o).trim();a!==o&&delete t[o],t[a]=OP(i),n[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){let t=Object.create(null);return X.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&X.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){let n=new this(e);return t.forEach(i=>n.set(i)),n}static accessor(e){let n=(this[c3]=this[c3]={accessors:{}}).accessors,i=this.prototype;function o(s){let a=nx(s);n[a]||(Yce(i,s),n[a]=!0)}return X.isArray(e)?e.forEach(o):o(e),this}};bg.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);X.reduceDescriptors(bg.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(n){this[t]=n}}});X.freezeMethods(bg);var Ts=bg;function QN(r,e){let t=this||dM,n=e||t,i=Ts.from(n.headers),o=n.data;return X.forEach(r,function(a){o=a.call(t,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function L3(r){return!!(r&&r.__CANCEL__)}function bm(r,e,t){Ye.call(this,r??"canceled",Ye.ERR_CANCELED,e,t),this.name="CanceledError"}X.inherits(bm,Ye,{__CANCEL__:!0});function ix(r,e,t){let n=t.config.validateStatus;!t.status||!n||n(t.status)?r(t):e(new Ye("Request failed with status code "+t.status,[Ye.ERR_BAD_REQUEST,Ye.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Xce(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zce(r,e){return e?r.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):r}function mM(r,e){return r&&!Xce(e)?Zce(r,e):e}var FP="1.6.1";function U3(r){let e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}var ele=/^(?:([^;]+);)?(?:[^;]+;)?(base64|),([\s\S]*)$/;function tle(r,e,t){let n=t&&t.Blob||Ds.classes.Blob,i=U3(r);if(e===void 0&&n&&(e=!0),i==="data"){r=i.length?r.slice(i.length+1):r;let o=ele.exec(r);if(!o)throw new Ye("Invalid URL",Ye.ERR_INVALID_URL);let s=o[1],a=o[2],c=o[3],l=Buffer.from(decodeURIComponent(c),a?"base64":"utf8");if(e){if(!n)throw new Ye("Blob is not supported",Ye.ERR_NOT_SUPPORT);return new n([l],{type:s})}return l}throw new Ye("Unsupported protocol "+i,Ye.ERR_NOT_SUPPORT)}function rle(r,e){let t=0,n=1e3/e,i=null;return function(s,a){let c=Date.now();if(s||c-t>n)return i&&(clearTimeout(i),i=null),t=c,r.apply(null,a);i||(i=setTimeout(()=>(i=null,t=Date.now(),r.apply(null,a)),n-(c-t)))}}function j3(r,e){r=r||10;let t=new Array(r),n=new Array(r),i=0,o=0,s;return e=e!==void 0?e:1e3,function(c){let l=Date.now(),u=n[o];s||(s=l),t[i]=c,n[i]=l;let p=o,m=0;for(;p!==i;)m+=t[p++],p=p%r;if(i=(i+1)%r,i===o&&(o=(o+1)%r),l-s<e)return;let h=u&&l-u;return h?Math.round(m*1e3/h):void 0}}var NP=Symbol("internals"),tM=class extends yp.default.Transform{constructor(e){e=X.toFlatObject(e,{maxRate:0,chunkSize:64*1024,minChunkSize:100,timeWindow:500,ticksRate:2,samplesCount:15},null,(a,c)=>!X.isUndefined(c[a])),super({readableHighWaterMark:e.chunkSize});let t=this,n=this[NP]={length:e.length,timeWindow:e.timeWindow,ticksRate:e.ticksRate,chunkSize:e.chunkSize,maxRate:e.maxRate,minChunkSize:e.minChunkSize,bytesSeen:0,isCaptured:!1,notifiedBytesLoaded:0,ts:Date.now(),bytes:0,onReadCallback:null},i=j3(n.ticksRate*e.samplesCount,n.timeWindow);this.on("newListener",a=>{a==="progress"&&(n.isCaptured||(n.isCaptured=!0))});let o=0;n.updateProgress=rle(function(){let c=n.length,l=n.bytesSeen,u=l-o;if(!u||t.destroyed)return;let p=i(u);o=l,process.nextTick(()=>{t.emit("progress",{loaded:l,total:c,progress:c?l/c:void 0,bytes:u,rate:p||void 0,estimated:p&&c&&l<=c?(c-l)/p:void 0})})},n.ticksRate);let s=()=>{n.updateProgress(!0)};this.once("end",s),this.once("error",s)}_read(e){let t=this[NP];return t.onReadCallback&&t.onReadCallback(),super._read(e)}_transform(e,t,n){let i=this,o=this[NP],s=o.maxRate,a=this.readableHighWaterMark,c=o.timeWindow,l=1e3/c,u=s/l,p=o.minChunkSize!==!1?Math.max(o.minChunkSize,u*.01):0;function m(v,b){let w=Buffer.byteLength(v);o.bytesSeen+=w,o.bytes+=w,o.isCaptured&&o.updateProgress(),i.push(v)?process.nextTick(b):o.onReadCallback=()=>{o.onReadCallback=null,process.nextTick(b)}}let h=(v,b)=>{let w=Buffer.byteLength(v),D=null,T=a,F,ee=0;if(s){let de=Date.now();(!o.ts||(ee=de-o.ts)>=c)&&(o.ts=de,F=u-o.bytes,o.bytes=F<0?-F:0,ee=0),F=u-o.bytes}if(s){if(F<=0)return setTimeout(()=>{b(null,v)},c-ee);F<T&&(T=F)}T&&w>T&&w-T>p&&(D=v.subarray(T),v=v.subarray(0,T)),m(v,D?()=>{process.nextTick(b,null,D)}:b)};h(e,function v(b,w){if(b)return n(b);w?h(w,v):n(null)})}setLength(e){return this[NP].length=+e,this}},l3=tM,{asyncIterator:u3}=Symbol,nle=async function*(r){r.stream?yield*r.stream():r.arrayBuffer?yield await r.arrayBuffer():r[u3]?yield*r[u3]():yield r},W3=nle,ile=X.ALPHABET.ALPHA_DIGIT+"-_",sx=new I3.TextEncoder,bp=`\r
`,ole=sx.encode(bp),sle=2,rM=class{constructor(e,t){let{escapeName:n}=this.constructor,i=X.isString(t),o=`Content-Disposition: form-data; name="${n(e)}"${!i&&t.name?`; filename="${n(t.name)}"`:""}${bp}`;i?t=sx.encode(String(t).replace(/\r?\n|\r\n?/g,bp)):o+=`Content-Type: ${t.type||"application/octet-stream"}${bp}`,this.headers=sx.encode(o+bp),this.contentLength=i?t.byteLength:t.size,this.size=this.headers.byteLength+this.contentLength+sle,this.name=e,this.value=t}async*encode(){yield this.headers;let{value:e}=this;X.isTypedArray(e)?yield e:yield*W3(e),yield ole}static escapeName(e){return String(e).replace(/[\r\n"]/g,t=>({"\r":"%0D","\n":"%0A",'"':"%22"})[t])}},ale=(r,e,t)=>{let{tag:n="form-data-boundary",size:i=25,boundary:o=n+"-"+X.generateString(i,ile)}=t||{};if(!X.isFormData(r))throw TypeError("FormData instance required");if(o.length<1||o.length>70)throw Error("boundary must be 10-70 characters long");let s=sx.encode("--"+o+bp),a=sx.encode("--"+o+"--"+bp+bp),c=a.byteLength,l=Array.from(r.entries()).map(([p,m])=>{let h=new rM(p,m);return c+=h.size,h});c+=s.byteLength*l.length,c=X.toFiniteNumber(c);let u={"Content-Type":`multipart/form-data; boundary=${o}`};return Number.isFinite(c)&&(u["Content-Length"]=c),e&&e(u),S3.Readable.from(async function*(){for(let p of l)yield s,yield*p.encode();yield a}())},cle=ale,nM=class extends yp.default.Transform{__transform(e,t,n){this.push(e),n()}_transform(e,t,n){if(e.length!==0&&(this._transform=this.__transform,e[0]!==120)){let i=Buffer.alloc(2);i[0]=120,i[1]=156,this.push(i,t)}this.__transform(e,t,n)}},lle=nM,ule=(r,e)=>X.isAsyncFn(r)?function(...t){let n=t.pop();r.apply(this,t).then(i=>{try{e?n(null,...e(i)):n(null,i)}catch(o){n(o)}},n)}:r,ple=ule,p3={flush:Ip.default.constants.Z_SYNC_FLUSH,finishFlush:Ip.default.constants.Z_SYNC_FLUSH},dle={flush:Ip.default.constants.BROTLI_OPERATION_FLUSH,finishFlush:Ip.default.constants.BROTLI_OPERATION_FLUSH},d3=X.isFunction(Ip.default.createBrotliDecompress),{http:mle,https:fle}=Xae.default,hle=/https:?/,m3=Ds.protocols.map(r=>r+":");function gle(r){r.beforeRedirects.proxy&&r.beforeRedirects.proxy(r),r.beforeRedirects.config&&r.beforeRedirects.config(r)}function V3(r,e,t){let n=e;if(!n&&n!==!1){let i=Vae.getProxyForUrl(t);i&&(n=new URL(i))}if(n){if(n.username&&(n.auth=(n.username||"")+":"+(n.password||"")),n.auth){(n.auth.username||n.auth.password)&&(n.auth=(n.auth.username||"")+":"+(n.auth.password||""));let o=Buffer.from(n.auth,"utf8").toString("base64");r.headers["Proxy-Authorization"]="Basic "+o}r.headers.host=r.hostname+(r.port?":"+r.port:"");let i=n.hostname||n.host;r.hostname=i,r.host=i,r.port=n.port,r.path=t,n.protocol&&(r.protocol=n.protocol.includes(":")?n.protocol:`${n.protocol}:`)}r.beforeRedirects.proxy=function(o){V3(o,e,o.href)}}var vle=typeof process<"u"&&X.kindOf(process)==="process",yle=r=>new Promise((e,t)=>{let n,i,o=(c,l)=>{i||(i=!0,n&&n(c,l))},s=c=>{o(c),e(c)},a=c=>{o(c,!0),t(c)};r(s,a,c=>n=c).catch(a)}),ble=({address:r,family:e})=>{if(!X.isString(r))throw TypeError("address must be a string");return{address:r,family:e||(r.indexOf(".")<0?6:4)}},f3=(r,e)=>ble(X.isObject(r)?r:{address:r,family:e}),Ile=vle&&function(e){return yle(async function(n,i,o){let{data:s,lookup:a,family:c}=e,{responseType:l,responseEncoding:u}=e,p=e.method.toUpperCase(),m,h=!1,v;if(a){let Y=ple(a,ve=>X.isArray(ve)?ve:[ve]);a=(ve,Ve,un)=>{Y(ve,Ve,(Ct,jr,cs)=>{let Vt=X.isArray(jr)?jr.map(en=>f3(en)):[f3(jr,cs)];Ve.all?un(Ct,Vt):un(Ct,Vt[0].address,Vt[0].family)})}}let b=new Zae.default,w=()=>{e.cancelToken&&e.cancelToken.unsubscribe(D),e.signal&&e.signal.removeEventListener("abort",D),b.removeAllListeners()};o((Y,ve)=>{m=!0,ve&&(h=!0,w())});function D(Y){b.emit("abort",!Y||Y.type?new bm(null,e,v):Y)}b.once("abort",i),(e.cancelToken||e.signal)&&(e.cancelToken&&e.cancelToken.subscribe(D),e.signal&&(e.signal.aborted?D():e.signal.addEventListener("abort",D)));let T=mM(e.baseURL,e.url),F=new URL(T,"http://localhost"),ee=F.protocol||m3[0];if(ee==="data:"){let Y;if(p!=="GET")return ix(n,i,{status:405,statusText:"method not allowed",headers:{},config:e});try{Y=tle(e.url,l==="blob",{Blob:e.env&&e.env.Blob})}catch(ve){throw Ye.from(ve,Ye.ERR_BAD_REQUEST,e)}return l==="text"?(Y=Y.toString(u),(!u||u==="utf8")&&(Y=X.stripBOM(Y))):l==="stream"&&(Y=yp.default.Readable.from(Y)),ix(n,i,{data:Y,status:200,statusText:"OK",headers:new Ts,config:e})}if(m3.indexOf(ee)===-1)return i(new Ye("Unsupported protocol "+ee,Ye.ERR_BAD_REQUEST,e));let de=Ts.from(e.headers).normalize();de.set("User-Agent","axios/"+FP,!1);let Z=e.onDownloadProgress,ye=e.onUploadProgress,ue=e.maxRate,le,Oe;if(X.isSpecCompliantForm(s)){let Y=de.getContentType(/boundary=([-_\w\d]{10,70})/i);s=cle(s,ve=>{de.set(ve)},{tag:`axios-${FP}-boundary`,boundary:Y&&Y[1]||void 0})}else if(X.isFormData(s)&&X.isFunction(s.getHeaders)){if(de.set(s.getHeaders()),!de.hasContentLength())try{let Y=await Yae.default.promisify(s.getLength).call(s);Number.isFinite(Y)&&Y>=0&&de.setContentLength(Y)}catch{}}else if(X.isBlob(s))s.size&&de.setContentType(s.type||"application/octet-stream"),de.setContentLength(s.size||0),s=yp.default.Readable.from(W3(s));else if(s&&!X.isStream(s)){if(!Buffer.isBuffer(s))if(X.isArrayBuffer(s))s=Buffer.from(new Uint8Array(s));else if(X.isString(s))s=Buffer.from(s,"utf-8");else return i(new Ye("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",Ye.ERR_BAD_REQUEST,e));if(de.setContentLength(s.length,!1),e.maxBodyLength>-1&&s.length>e.maxBodyLength)return i(new Ye("Request body larger than maxBodyLength limit",Ye.ERR_BAD_REQUEST,e))}let Je=X.toFiniteNumber(de.getContentLength());X.isArray(ue)?(le=ue[0],Oe=ue[1]):le=Oe=ue,s&&(ye||le)&&(X.isStream(s)||(s=yp.default.Readable.from(s,{objectMode:!1})),s=yp.default.pipeline([s,new l3({length:Je,maxRate:X.toFiniteNumber(le)})],X.noop),ye&&s.on("progress",Y=>{ye(Object.assign(Y,{upload:!0}))}));let vt;if(e.auth){let Y=e.auth.username||"",ve=e.auth.password||"";vt=Y+":"+ve}if(!vt&&F.username){let Y=F.username,ve=F.password;vt=Y+":"+ve}vt&&de.delete("authorization");let mt;try{mt=lM(F.pathname+F.search,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(Y){let ve=new Error(Y.message);return ve.config=e,ve.url=e.url,ve.exists=!0,i(ve)}de.set("Accept-Encoding","gzip, compress, deflate"+(d3?", br":""),!1);let rt={path:mt,method:p,headers:de.toJSON(),agents:{http:e.httpAgent,https:e.httpsAgent},auth:vt,protocol:ee,family:c,beforeRedirect:gle,beforeRedirects:{}};!X.isUndefined(a)&&(rt.lookup=a),e.socketPath?rt.socketPath=e.socketPath:(rt.hostname=F.hostname,rt.port=F.port,V3(rt,e.proxy,ee+"//"+F.hostname+(F.port?":"+F.port:"")+rt.path));let oe,Pe=hle.test(rt.protocol);if(rt.agent=Pe?e.httpsAgent:e.httpAgent,e.transport?oe=e.transport:e.maxRedirects===0?oe=Pe?Qae.default:zae.default:(e.maxRedirects&&(rt.maxRedirects=e.maxRedirects),e.beforeRedirect&&(rt.beforeRedirects.config=e.beforeRedirect),oe=Pe?fle:mle),e.maxBodyLength>-1?rt.maxBodyLength=e.maxBodyLength:rt.maxBodyLength=1/0,e.insecureHTTPParser&&(rt.insecureHTTPParser=e.insecureHTTPParser),v=oe.request(rt,function(ve){if(v.destroyed)return;let Ve=[ve],un=+ve.headers["content-length"];if(Z){let en=new l3({length:X.toFiniteNumber(un),maxRate:X.toFiniteNumber(Oe)});Z&&en.on("progress",Li=>{Z(Object.assign(Li,{download:!0}))}),Ve.push(en)}let Ct=ve,jr=ve.req||v;if(e.decompress!==!1&&ve.headers["content-encoding"])switch((p==="HEAD"||ve.statusCode===204)&&delete ve.headers["content-encoding"],(ve.headers["content-encoding"]||"").toLowerCase()){case"gzip":case"x-gzip":case"compress":case"x-compress":Ve.push(Ip.default.createUnzip(p3)),delete ve.headers["content-encoding"];break;case"deflate":Ve.push(new lle),Ve.push(Ip.default.createUnzip(p3)),delete ve.headers["content-encoding"];break;case"br":d3&&(Ve.push(Ip.default.createBrotliDecompress(dle)),delete ve.headers["content-encoding"])}Ct=Ve.length>1?yp.default.pipeline(Ve,X.noop):Ve[0];let cs=yp.default.finished(Ct,()=>{cs(),w()}),Vt={status:ve.statusCode,statusText:ve.statusMessage,headers:new Ts(ve.headers),config:e,request:jr};if(l==="stream")Vt.data=Ct,ix(n,i,Vt);else{let en=[],Li=0;Ct.on("data",function(or){en.push(or),Li+=or.length,e.maxContentLength>-1&&Li>e.maxContentLength&&(h=!0,Ct.destroy(),i(new Ye("maxContentLength size of "+e.maxContentLength+" exceeded",Ye.ERR_BAD_RESPONSE,e,jr)))}),Ct.on("aborted",function(){if(h)return;let or=new Ye("maxContentLength size of "+e.maxContentLength+" exceeded",Ye.ERR_BAD_RESPONSE,e,jr);Ct.destroy(or),i(or)}),Ct.on("error",function(or){v.destroyed||i(Ye.from(or,null,e,jr))}),Ct.on("end",function(){try{let or=en.length===1?en[0]:Buffer.concat(en);l!=="arraybuffer"&&(or=or.toString(u),(!u||u==="utf8")&&(or=X.stripBOM(or))),Vt.data=or}catch(or){return i(Ye.from(or,null,e,Vt.request,Vt))}ix(n,i,Vt)})}b.once("abort",en=>{Ct.destroyed||(Ct.emit("error",en),Ct.destroy())})}),b.once("abort",Y=>{i(Y),v.destroy(Y)}),v.on("error",function(ve){i(Ye.from(ve,null,e,v))}),v.on("socket",function(ve){ve.setKeepAlive(!0,1e3*60)}),e.timeout){let Y=parseInt(e.timeout,10);if(Number.isNaN(Y)){i(new Ye("error trying to parse `config.timeout` to int",Ye.ERR_BAD_OPTION_VALUE,e,v));return}v.setTimeout(Y,function(){if(m)return;let Ve=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",un=e.transitional||uM;e.timeoutErrorMessage&&(Ve=e.timeoutErrorMessage),i(new Ye(Ve,un.clarifyTimeoutError?Ye.ETIMEDOUT:Ye.ECONNABORTED,e,v)),D()})}if(X.isStream(s)){let Y=!1,ve=!1;s.on("end",()=>{Y=!0}),s.once("error",Ve=>{ve=!0,v.destroy(Ve)}),s.on("close",()=>{!Y&&!ve&&D(new bm("Request stream has been aborted",e,v))}),s.pipe(v)}else v.end(s)})},Sle=Ds.hasStandardBrowserEnv?function(){return{write:function(t,n,i,o,s,a){let c=[];c.push(t+"="+encodeURIComponent(n)),X.isNumber(i)&&c.push("expires="+new Date(i).toGMTString()),X.isString(o)&&c.push("path="+o),X.isString(s)&&c.push("domain="+s),a===!0&&c.push("secure"),document.cookie=c.join("; ")},read:function(t){let n=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),xle=Ds.hasStandardBrowserEnv?function(){let e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a"),n;function i(o){let s=o;return e&&(t.setAttribute("href",s),s=t.href),t.setAttribute("href",s),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}return n=i(window.location.href),function(s){let a=X.isString(s)?i(s):s;return a.protocol===n.protocol&&a.host===n.host}}():function(){return function(){return!0}}();function h3(r,e){let t=0,n=j3(50,250);return i=>{let o=i.loaded,s=i.lengthComputable?i.total:void 0,a=o-t,c=n(a),l=o<=s;t=o;let u={loaded:o,total:s,progress:s?o/s:void 0,bytes:a,rate:c||void 0,estimated:c&&s&&l?(s-o)/c:void 0,event:i};u[e?"download":"upload"]=!0,r(u)}}var Cle=typeof XMLHttpRequest<"u",wle=Cle&&function(r){return new Promise(function(t,n){let i=r.data,o=Ts.from(r.headers).normalize(),s=r.responseType,a;function c(){r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let l;if(X.isFormData(i)){if(Ds.hasStandardBrowserEnv||Ds.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((l=o.getContentType())!==!1){let[v,...b]=l?l.split(";").map(w=>w.trim()).filter(Boolean):[];o.setContentType([v||"multipart/form-data",...b].join("; "))}}let u=new XMLHttpRequest;if(r.auth){let v=r.auth.username||"",b=r.auth.password?unescape(encodeURIComponent(r.auth.password)):"";o.set("Authorization","Basic "+btoa(v+":"+b))}let p=mM(r.baseURL,r.url);u.open(r.method.toUpperCase(),lM(p,r.params,r.paramsSerializer),!0),u.timeout=r.timeout;function m(){if(!u)return;let v=Ts.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders()),w={data:!s||s==="text"||s==="json"?u.responseText:u.response,status:u.status,statusText:u.statusText,headers:v,config:r,request:u};ix(function(T){t(T),c()},function(T){n(T),c()},w),u=null}if("onloadend"in u?u.onloadend=m:u.onreadystatechange=function(){!u||u.readyState!==4||u.status===0&&!(u.responseURL&&u.responseURL.indexOf("file:")===0)||setTimeout(m)},u.onabort=function(){u&&(n(new Ye("Request aborted",Ye.ECONNABORTED,r,u)),u=null)},u.onerror=function(){n(new Ye("Network Error",Ye.ERR_NETWORK,r,u)),u=null},u.ontimeout=function(){let b=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded",w=r.transitional||uM;r.timeoutErrorMessage&&(b=r.timeoutErrorMessage),n(new Ye(b,w.clarifyTimeoutError?Ye.ETIMEDOUT:Ye.ECONNABORTED,r,u)),u=null},Ds.hasStandardBrowserEnv){let v=xle(p)&&r.xsrfCookieName&&Sle.read(r.xsrfCookieName);v&&o.set(r.xsrfHeaderName,v)}i===void 0&&o.setContentType(null),"setRequestHeader"in u&&X.forEach(o.toJSON(),function(b,w){u.setRequestHeader(w,b)}),X.isUndefined(r.withCredentials)||(u.withCredentials=!!r.withCredentials),s&&s!=="json"&&(u.responseType=r.responseType),typeof r.onDownloadProgress=="function"&&u.addEventListener("progress",h3(r.onDownloadProgress,!0)),typeof r.onUploadProgress=="function"&&u.upload&&u.upload.addEventListener("progress",h3(r.onUploadProgress)),(r.cancelToken||r.signal)&&(a=v=>{u&&(n(!v||v.type?new bm(null,r,u):v),u.abort(),u=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));let h=U3(p);if(h&&Ds.protocols.indexOf(h)===-1){n(new Ye("Unsupported protocol "+h+":",Ye.ERR_BAD_REQUEST,r));return}u.send(i||null)})},iM={http:Ile,xhr:wle};X.forEach(iM,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});var g3=r=>`- ${r}`,Ele=r=>X.isFunction(r)||r===null||r===!1,B3={getAdapter:r=>{r=X.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let o=0;o<e;o++){t=r[o];let s;if(n=t,!Ele(t)&&(n=iM[(s=String(t)).toLowerCase()],n===void 0))throw new Ye(`Unknown adapter '${s}'`);if(n)break;i[s||"#"+o]=n}if(!n){let o=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build")),s=e?o.length>1?`since :
`+o.map(g3).join(`
`):" "+g3(o[0]):"as no adapter specified";throw new Ye("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return n},adapters:iM};function YN(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new bm(null,r)}function v3(r){return YN(r),r.headers=Ts.from(r.headers),r.data=QN.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),B3.getAdapter(r.adapter||dM.adapter)(r).then(function(n){return YN(r),n.data=QN.call(r,r.transformResponse,n),n.headers=Ts.from(n.headers),n},function(n){return L3(n)||(YN(r),n&&n.response&&(n.response.data=QN.call(r,r.transformResponse,n.response),n.response.headers=Ts.from(n.response.headers))),Promise.reject(n)})}var y3=r=>r instanceof Ts?r.toJSON():r;function Ig(r,e){e=e||{};let t={};function n(l,u,p){return X.isPlainObject(l)&&X.isPlainObject(u)?X.merge.call({caseless:p},l,u):X.isPlainObject(u)?X.merge({},u):X.isArray(u)?u.slice():u}function i(l,u,p){if(X.isUndefined(u)){if(!X.isUndefined(l))return n(void 0,l,p)}else return n(l,u,p)}function o(l,u){if(!X.isUndefined(u))return n(void 0,u)}function s(l,u){if(X.isUndefined(u)){if(!X.isUndefined(l))return n(void 0,l)}else return n(void 0,u)}function a(l,u,p){if(p in e)return n(l,u);if(p in r)return n(void 0,l)}let c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(l,u)=>i(y3(l),y3(u),!0)};return X.forEach(Object.keys(Object.assign({},r,e)),function(u){let p=c[u]||i,m=p(r[u],e[u],u);X.isUndefined(m)&&p!==a||(t[u]=m)}),t}var fM={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{fM[r]=function(n){return typeof n===r||"a"+(e<1?"n ":" ")+r}});var b3={};fM.transitional=function(e,t,n){function i(o,s){return"[Axios v"+FP+"] Transitional option '"+o+"'"+s+(n?". "+n:"")}return(o,s,a)=>{if(e===!1)throw new Ye(i(s," has been removed"+(t?" in "+t:"")),Ye.ERR_DEPRECATED);return t&&!b3[s]&&(b3[s]=!0,console.warn(i(s," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(o,s,a):!0}};function Ple(r,e,t){if(typeof r!="object")throw new Ye("options must be an object",Ye.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let o=n[i],s=e[o];if(s){let a=r[o],c=a===void 0||s(a,o,r);if(c!==!0)throw new Ye("option "+o+" must be "+c,Ye.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ye("Unknown option "+o,Ye.ERR_BAD_OPTION)}}var oM={assertOptions:Ple,validators:fM},vp=oM.validators,Sg=class{constructor(e){this.defaults=e,this.interceptors={request:new a3,response:new a3}}request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ig(this.defaults,t);let{transitional:n,paramsSerializer:i,headers:o}=t;n!==void 0&&oM.assertOptions(n,{silentJSONParsing:vp.transitional(vp.boolean),forcedJSONParsing:vp.transitional(vp.boolean),clarifyTimeoutError:vp.transitional(vp.boolean)},!1),i!=null&&(X.isFunction(i)?t.paramsSerializer={serialize:i}:oM.assertOptions(i,{encode:vp.function,serialize:vp.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let s=o&&X.merge(o.common,o[t.method]);o&&X.forEach(["delete","get","head","post","put","patch","common"],v=>{delete o[v]}),t.headers=Ts.concat(s,o);let a=[],c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(c=c&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});let l=[];this.interceptors.response.forEach(function(b){l.push(b.fulfilled,b.rejected)});let u,p=0,m;if(!c){let v=[v3.bind(this),void 0];for(v.unshift.apply(v,a),v.push.apply(v,l),m=v.length,u=Promise.resolve(t);p<m;)u=u.then(v[p++],v[p++]);return u}m=a.length;let h=t;for(p=0;p<m;){let v=a[p++],b=a[p++];try{h=v(h)}catch(w){b.call(this,w);break}}try{u=v3.call(this,h)}catch(v){return Promise.reject(v)}for(p=0,m=l.length;p<m;)u=u.then(l[p++],l[p++]);return u}getUri(e){e=Ig(this.defaults,e);let t=mM(e.baseURL,e.url);return lM(t,e.params,e.paramsSerializer)}};X.forEach(["delete","get","head","options"],function(e){Sg.prototype[e]=function(t,n){return this.request(Ig(n||{},{method:e,url:t,data:(n||{}).data}))}});X.forEach(["post","put","patch"],function(e){function t(n){return function(o,s,a){return this.request(Ig(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Sg.prototype[e]=t(),Sg.prototype[e+"Form"]=t(!0)});var KP=Sg,sM=class r{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(o){t=o});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,s=new Promise(a=>{n.subscribe(a),o=a}).then(i);return s.cancel=function(){n.unsubscribe(o)},s},e(function(o,s,a){n.reason||(n.reason=new bm(o,s,a),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}static source(){let e;return{token:new r(function(i){e=i}),cancel:e}}},kle=sM;function Dle(r){return function(t){return r.apply(null,t)}}function _le(r){return X.isObject(r)&&r.isAxiosError===!0}var aM={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(aM).forEach(([r,e])=>{aM[e]=r});var Tle=aM;function q3(r){let e=new KP(r),t=C3(KP.prototype.request,e);return X.extend(t,KP.prototype,e,{allOwnKeys:!0}),X.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return q3(Ig(r,i))},t}var Dn=q3(dM);Dn.Axios=KP;Dn.CanceledError=bm;Dn.CancelToken=kle;Dn.isCancel=L3;Dn.VERSION=FP;Dn.toFormData=WP;Dn.AxiosError=Ye;Dn.Cancel=Dn.CanceledError;Dn.all=function(e){return Promise.all(e)};Dn.spread=Dle;Dn.isAxiosError=_le;Dn.mergeConfig=Ig;Dn.AxiosHeaders=Ts;Dn.formToJSON=r=>F3(X.isHTMLForm(r)?new FormData(r):r);Dn.getAdapter=B3.getAdapter;Dn.HttpStatusCode=Tle;Dn.default=Dn;J3.exports=Dn});var H3=N(VP=>{"use strict";Object.defineProperty(VP,"__esModule",{value:!0});VP.AxiosHttpClient=void 0;var Rle=$3(),hM=class{constructor(e){this.endpoint=e}get(e){return Rle.default.get(this.endpoint,Object.assign(Object.assign({},e),{proxy:!1}))}};VP.AxiosHttpClient=hM});var G3=N(BP=>{"use strict";Object.defineProperty(BP,"__esModule",{value:!0});BP.MemoryKeyValueStorage=void 0;var gM=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};BP.MemoryKeyValueStorage=gM});var z3=N(qP=>{"use strict";Object.defineProperty(qP,"__esModule",{value:!0});qP.ExperimentationServiceBase=void 0;var Ale=G3(),vM=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,n,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=n,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new Ale.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async n=>await n.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let n={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)n.features.includes(o)||n.features.push(o);for(let o of i.configs){let s=n.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):n.configs.push(o)}n.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=n),this.storage&&this.storage.setValue(this.storageKey,n)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let n=this.features.configs.find(i=>i.Id===e);return n?.Parameters[t]}async getTreatmentVariableAsync(e,t,n){if(n){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};qP.ExperimentationServiceBase=vM});var Q3=N(JP=>{"use strict";Object.defineProperty(JP,"__esModule",{value:!0});JP.PollingService=void 0;var yM=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};JP.PollingService=yM});var Y3=N($P=>{"use strict";Object.defineProperty($P,"__esModule",{value:!0});$P.ExperimentationServiceAutoPolling=void 0;var Nle=z3(),Mle=Q3(),bM=class extends Nle.ExperimentationServiceBase{constructor(e,t,n,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=n,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,n<1e3&&n!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");n>0&&(this.pollingService=new Mle.PollingService(n),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};$P.ExperimentationServiceAutoPolling=bM});var X3=N(GP=>{"use strict";Object.defineProperty(GP,"__esModule",{value:!0});GP.ExperimentationService=void 0;var Ole=n9(),Kle=H3(),Fle=Y3(),HP=class extends Fle.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Ole.TasApiFeatureProvider(new Kle.AxiosHttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};GP.ExperimentationService=HP;HP.REFRESH_RATE_IN_MINUTES=30});var Z3=N(zP=>{"use strict";Object.defineProperty(zP,"__esModule",{value:!0});zP.ExperimentationService=void 0;var Lle=X3();Object.defineProperty(zP,"ExperimentationService",{enumerable:!0,get:function(){return Lle.ExperimentationService}})});var eB=N(QP=>{"use strict";Object.defineProperty(QP,"__esModule",{value:!0});QP.MementoKeyValueStorage=void 0;var IM=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};QP.MementoKeyValueStorage=IM});var tB=N(xM=>{"use strict";Object.defineProperty(xM,"__esModule",{value:!0});var SM=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};xM.default=SM});var nB=N(Cg=>{"use strict";Object.defineProperty(Cg,"__esModule",{value:!0});Cg.getExperimentationServiceAsync=Cg.getExperimentationService=void 0;var Ule=yN(),jle=Z3(),CM=require("vscode"),Wle=eB(),Vle=tB(),Ble="https://default.exp-tas.com/vscode/ab",qle="query-expfeature",Jle="abexp.assignmentcontext",$le="VSCode.ABExp.FeatureData",Hle=1e3*60*30;function rB(r,e,t,n,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=CM.workspace.getConfiguration("telemetry");if(!(CM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):CM.env.isTelemetryEnabled))return new Vle.default;let l=[new Ule.VSCodeFilterProvider(r,e,t),...o],u=new Wle.MementoKeyValueStorage(i);return new jle.ExperimentationService({filterProviders:l,telemetry:n,storageKey:$le,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:Jle,telemetryEventName:qle,endpoint:Ble,refetchInterval:Hle})}Cg.getExperimentationService=rB;async function Gle(r,e,t,n,i,...o){let s=rB(r,e,t,n,i,...o);return await s.initializePromise,s}Cg.getExperimentationServiceAsync=Gle});var oB=N(Sp=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.TargetPopulation=Sp.getExperimentationServiceAsync=Sp.getExperimentationService=void 0;var iB=nB();Object.defineProperty(Sp,"getExperimentationService",{enumerable:!0,get:function(){return iB.getExperimentationService}});Object.defineProperty(Sp,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return iB.getExperimentationServiceAsync}});var zle=yN();Object.defineProperty(Sp,"TargetPopulation",{enumerable:!0,get:function(){return zle.TargetPopulation}})});var fB=N((r0e,mB)=>{"use strict";function Xle(){let r=[].slice.call(arguments).filter(t=>t),e=r.shift();return r.forEach(t=>{Object.keys(t).forEach(n=>{e[n]=t[n]})}),e}mB.exports=Xle});var fo=N(kM=>{"use strict";kM.fromCallback=function(r){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")r.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(n,i)=>{if(n)return t(n);e(i)},arguments.length++,r.apply(this,arguments)})},"name",{value:r.name})};kM.fromPromise=function(r){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return r.apply(this,arguments);r.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:r.name})}});var gB=N((i0e,hB)=>{var Ep=require("constants"),Zle=process.cwd,rk=null,eue=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return rk||(rk=Zle.call(process)),rk};try{process.cwd()}catch{}typeof process.chdir=="function"&&(DM=process.chdir,process.chdir=function(r){rk=null,DM.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,DM));var DM;hB.exports=tue;function tue(r){Ep.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=c(r.statSync),r.fstatSync=c(r.fstatSync),r.lstatSync=c(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,p,m){m&&process.nextTick(m)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,p,m,h){h&&process.nextTick(h)},r.lchownSync=function(){}),eue==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:function(u){function p(m,h,v){var b=Date.now(),w=0;u(m,h,function D(T){if(T&&(T.code==="EACCES"||T.code==="EPERM")&&Date.now()-b<6e4){setTimeout(function(){r.stat(h,function(F,ee){F&&F.code==="ENOENT"?u(m,h,D):v(T)})},w),w<100&&(w+=10);return}v&&v(T)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.rename)),r.read=typeof r.read!="function"?r.read:function(u){function p(m,h,v,b,w,D){var T;if(D&&typeof D=="function"){var F=0;T=function(ee,de,Z){if(ee&&ee.code==="EAGAIN"&&F<10)return F++,u.call(r,m,h,v,b,w,T);D.apply(this,arguments)}}return u.call(r,m,h,v,b,w,T)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p}(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:function(u){return function(p,m,h,v,b){for(var w=0;;)try{return u.call(r,p,m,h,v,b)}catch(D){if(D.code==="EAGAIN"&&w<10){w++;continue}throw D}}}(r.readSync);function e(u){u.lchmod=function(p,m,h){u.open(p,Ep.O_WRONLY|Ep.O_SYMLINK,m,function(v,b){if(v){h&&h(v);return}u.fchmod(b,m,function(w){u.close(b,function(D){h&&h(w||D)})})})},u.lchmodSync=function(p,m){var h=u.openSync(p,Ep.O_WRONLY|Ep.O_SYMLINK,m),v=!0,b;try{b=u.fchmodSync(h,m),v=!1}finally{if(v)try{u.closeSync(h)}catch{}else u.closeSync(h)}return b}}function t(u){Ep.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(p,m,h,v){u.open(p,Ep.O_SYMLINK,function(b,w){if(b){v&&v(b);return}u.futimes(w,m,h,function(D){u.close(w,function(T){v&&v(D||T)})})})},u.lutimesSync=function(p,m,h){var v=u.openSync(p,Ep.O_SYMLINK),b,w=!0;try{b=u.futimesSync(v,m,h),w=!1}finally{if(w)try{u.closeSync(v)}catch{}else u.closeSync(v)}return b}):u.futimes&&(u.lutimes=function(p,m,h,v){v&&process.nextTick(v)},u.lutimesSync=function(){})}function n(u){return u&&function(p,m,h){return u.call(r,p,m,function(v){l(v)&&(v=null),h&&h.apply(this,arguments)})}}function i(u){return u&&function(p,m){try{return u.call(r,p,m)}catch(h){if(!l(h))throw h}}}function o(u){return u&&function(p,m,h,v){return u.call(r,p,m,h,function(b){l(b)&&(b=null),v&&v.apply(this,arguments)})}}function s(u){return u&&function(p,m,h){try{return u.call(r,p,m,h)}catch(v){if(!l(v))throw v}}}function a(u){return u&&function(p,m,h){typeof m=="function"&&(h=m,m=null);function v(b,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),h&&h.apply(this,arguments)}return m?u.call(r,p,m,v):u.call(r,p,v)}}function c(u){return u&&function(p,m){var h=m?u.call(r,p,m):u.call(r,p);return h&&(h.uid<0&&(h.uid+=4294967296),h.gid<0&&(h.gid+=4294967296)),h}}function l(u){if(!u||u.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var bB=N((o0e,yB)=>{var vB=require("stream").Stream;yB.exports=rue;function rue(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);vB.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var l=s[a];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,p){if(u){o.emit("error",u),o.readable=!1;return}o.fd=p,o.emit("open",p),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);vB.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var c=o[s];this[c]=i[c]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var SB=N((s0e,IB)=>{"use strict";IB.exports=iue;var nue=Object.getPrototypeOf||function(r){return r.__proto__};function iue(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:nue(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var _n=N((a0e,RM)=>{var cn=require("fs"),oue=gB(),sue=bB(),aue=SB(),nk=require("util"),si,ok;typeof Symbol=="function"&&typeof Symbol.for=="function"?(si=Symbol.for("graceful-fs.queue"),ok=Symbol.for("graceful-fs.previous")):(si="___graceful-fs.queue",ok="___graceful-fs.previous");function cue(){}function wB(r,e){Object.defineProperty(r,si,{get:function(){return e}})}var Im=cue;nk.debuglog?Im=nk.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Im=function(){var r=nk.format.apply(nk,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});cn[si]||(xB=global[si]||[],wB(cn,xB),cn.close=function(r){function e(t,n){return r.call(cn,t,function(i){i||CB(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,ok,{value:r}),e}(cn.close),cn.closeSync=function(r){function e(t){r.apply(cn,arguments),CB()}return Object.defineProperty(e,ok,{value:r}),e}(cn.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Im(cn[si]),require("assert").equal(cn[si].length,0)}));var xB;global[si]||wB(global,cn[si]);RM.exports=_M(aue(cn));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!cn.__patched&&(RM.exports=_M(cn),cn.__patched=!0);function _M(r){oue(r),r.gracefulify=_M,r.createReadStream=de,r.createWriteStream=Z;var e=r.readFile;r.readFile=t;function t(le,Oe,Je){return typeof Oe=="function"&&(Je=Oe,Oe=null),vt(le,Oe,Je);function vt(mt,rt,oe,Pe){return e(mt,rt,function(Y){Y&&(Y.code==="EMFILE"||Y.code==="ENFILE")?Rg([vt,[mt,rt,oe],Y,Pe||Date.now(),Date.now()]):typeof oe=="function"&&oe.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(le,Oe,Je,vt){return typeof Je=="function"&&(vt=Je,Je=null),mt(le,Oe,Je,vt);function mt(rt,oe,Pe,Y,ve){return n(rt,oe,Pe,function(Ve){Ve&&(Ve.code==="EMFILE"||Ve.code==="ENFILE")?Rg([mt,[rt,oe,Pe,Y],Ve,ve||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(le,Oe,Je,vt){return typeof Je=="function"&&(vt=Je,Je=null),mt(le,Oe,Je,vt);function mt(rt,oe,Pe,Y,ve){return o(rt,oe,Pe,function(Ve){Ve&&(Ve.code==="EMFILE"||Ve.code==="ENFILE")?Rg([mt,[rt,oe,Pe,Y],Ve,ve||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=c);function c(le,Oe,Je,vt){return typeof Je=="function"&&(vt=Je,Je=0),mt(le,Oe,Je,vt);function mt(rt,oe,Pe,Y,ve){return a(rt,oe,Pe,function(Ve){Ve&&(Ve.code==="EMFILE"||Ve.code==="ENFILE")?Rg([mt,[rt,oe,Pe,Y],Ve,ve||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}var l=r.readdir;r.readdir=p;var u=/^v[0-5]\./;function p(le,Oe,Je){typeof Oe=="function"&&(Je=Oe,Oe=null);var vt=u.test(process.version)?function(oe,Pe,Y,ve){return l(oe,mt(oe,Pe,Y,ve))}:function(oe,Pe,Y,ve){return l(oe,Pe,mt(oe,Pe,Y,ve))};return vt(le,Oe,Je);function mt(rt,oe,Pe,Y){return function(ve,Ve){ve&&(ve.code==="EMFILE"||ve.code==="ENFILE")?Rg([vt,[rt,oe,Pe],ve,Y||Date.now(),Date.now()]):(Ve&&Ve.sort&&Ve.sort(),typeof Pe=="function"&&Pe.call(this,ve,Ve))}}}if(process.version.substr(0,4)==="v0.8"){var m=sue(r);D=m.ReadStream,F=m.WriteStream}var h=r.ReadStream;h&&(D.prototype=Object.create(h.prototype),D.prototype.open=T);var v=r.WriteStream;v&&(F.prototype=Object.create(v.prototype),F.prototype.open=ee),Object.defineProperty(r,"ReadStream",{get:function(){return D},set:function(le){D=le},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return F},set:function(le){F=le},enumerable:!0,configurable:!0});var b=D;Object.defineProperty(r,"FileReadStream",{get:function(){return b},set:function(le){b=le},enumerable:!0,configurable:!0});var w=F;Object.defineProperty(r,"FileWriteStream",{get:function(){return w},set:function(le){w=le},enumerable:!0,configurable:!0});function D(le,Oe){return this instanceof D?(h.apply(this,arguments),this):D.apply(Object.create(D.prototype),arguments)}function T(){var le=this;ue(le.path,le.flags,le.mode,function(Oe,Je){Oe?(le.autoClose&&le.destroy(),le.emit("error",Oe)):(le.fd=Je,le.emit("open",Je),le.read())})}function F(le,Oe){return this instanceof F?(v.apply(this,arguments),this):F.apply(Object.create(F.prototype),arguments)}function ee(){var le=this;ue(le.path,le.flags,le.mode,function(Oe,Je){Oe?(le.destroy(),le.emit("error",Oe)):(le.fd=Je,le.emit("open",Je))})}function de(le,Oe){return new r.ReadStream(le,Oe)}function Z(le,Oe){return new r.WriteStream(le,Oe)}var ye=r.open;r.open=ue;function ue(le,Oe,Je,vt){return typeof Je=="function"&&(vt=Je,Je=null),mt(le,Oe,Je,vt);function mt(rt,oe,Pe,Y,ve){return ye(rt,oe,Pe,function(Ve,un){Ve&&(Ve.code==="EMFILE"||Ve.code==="ENFILE")?Rg([mt,[rt,oe,Pe,Y],Ve,ve||Date.now(),Date.now()]):typeof Y=="function"&&Y.apply(this,arguments)})}}return r}function Rg(r){Im("ENQUEUE",r[0].name,r[1]),cn[si].push(r),TM()}var ik;function CB(){for(var r=Date.now(),e=0;e<cn[si].length;++e)cn[si][e].length>2&&(cn[si][e][3]=r,cn[si][e][4]=r);TM()}function TM(){if(clearTimeout(ik),ik=void 0,cn[si].length!==0){var r=cn[si].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Im("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Im("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,c=Math.max(o-i,1),l=Math.min(c*1.2,100);a>=l?(Im("RETRY",e.name,t),e.apply(null,t.concat([i]))):cn[si].push(r)}ik===void 0&&(ik=setTimeout(TM,0))}}});var AM=N(Ag=>{var lue=fo().fromCallback,ga=_n(),uue=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(r=>typeof ga[r]=="function");Object.keys(ga).forEach(r=>{Ag[r]=ga[r]});uue.forEach(r=>{Ag[r]=lue(ga[r])});Ag.exists=function(r,e){return typeof e=="function"?ga.exists(r,e):new Promise(t=>ga.exists(r,t))};Ag.read=function(r,e,t,n,i,o){return typeof o=="function"?ga.read(r,e,t,n,i,o):new Promise((s,a)=>{ga.read(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesRead:l,buffer:u})})})};Ag.write=function(r,e,t,n,i,o){return typeof arguments[arguments.length-1]=="function"?ga.write(r,e,t,n,i,o):typeof e=="string"?new Promise((s,a)=>{ga.write(r,e,t,n,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})}):new Promise((s,a)=>{ga.write(r,e,t,n,i,(c,l,u)=>{if(c)return a(c);s({bytesWritten:l,buffer:u})})})}});var kB=N((l0e,PB)=>{"use strict";var jo=_n(),EB=require("os"),sk=require("path");function pue(){let r=sk.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));r=sk.join(EB.tmpdir(),r);let e=new Date(1435410243862);jo.writeFileSync(r,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=jo.openSync(r,"r+");return jo.futimesSync(t,e,e),jo.closeSync(t),jo.statSync(r).mtime>1435410243e3}function due(r){let e=sk.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=sk.join(EB.tmpdir(),e);let t=new Date(1435410243862);jo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",n=>{if(n)return r(n);jo.open(e,"r+",(i,o)=>{if(i)return r(i);jo.futimes(o,t,t,s=>{if(s)return r(s);jo.close(o,a=>{if(a)return r(a);jo.stat(e,(c,l)=>{if(c)return r(c);r(null,l.mtime>1435410243e3)})})})})})}function mue(r){if(typeof r=="number")return Math.floor(r/1e3)*1e3;if(r instanceof Date)return new Date(Math.floor(r.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function fue(r,e,t,n){jo.open(r,"r+",(i,o)=>{if(i)return n(i);jo.futimes(o,e,t,s=>{jo.close(o,a=>{n&&n(s||a)})})})}PB.exports={hasMillisRes:due,hasMillisResSync:pue,timeRemoveMillis:mue,utimesMillis:fue}});var NM=N((u0e,DB)=>{var Wo=_n(),ux=require("path"),hue=kB();function gue(r,e,t,n){n||(n=t,t={});var i=process.cwd(),o=ux.resolve(i,r),s=ux.resolve(i,e),a=t.filter,c=t.transform,l=t.overwrite;l===void 0&&(l=t.clobber),l===void 0&&(l=!0);var u=t.errorOnExist,p=t.dereference,m=t.preserveTimestamps===!0,h=0,v=0,b=0,w=!1;D(o);function D(oe){if(h++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(oe))return rt(!0)}else if(typeof a=="function"&&!a(oe,e))return rt(!0)}return T(oe)}function T(oe){var Pe=p?Wo.stat:Wo.lstat;b++,Pe(oe,function(Y,ve){if(Y)return mt(Y);var Ve={name:oe,mode:ve.mode,mtime:ve.mtime,atime:ve.atime,stats:ve};if(ve.isDirectory())return Z(Ve);if(ve.isFile()||ve.isCharacterDevice()||ve.isBlockDevice())return F(Ve);if(ve.isSymbolicLink())return le(oe)})}function F(oe){var Pe=oe.name.replace(o,s.replace("$","$$$$"));vt(Pe,function(Y){Y?ee(oe,Pe):l?de(Pe,function(){ee(oe,Pe)}):u?mt(new Error(Pe+" already exists")):rt()})}function ee(oe,Pe){var Y=Wo.createReadStream(oe.name),ve=Wo.createWriteStream(Pe,{mode:oe.mode});Y.on("error",mt),ve.on("error",mt),c?c(Y,ve,oe):ve.on("open",function(){Y.pipe(ve)}),ve.once("close",function(){Wo.chmod(Pe,oe.mode,function(Ve){if(Ve)return mt(Ve);m?hue.utimesMillis(Pe,oe.atime,oe.mtime,function(un){return un?mt(un):rt()}):rt()})})}function de(oe,Pe){Wo.unlink(oe,function(Y){return Y?mt(Y):Pe()})}function Z(oe){var Pe=oe.name.replace(o,s.replace("$","$$$$"));vt(Pe,function(Y){if(Y)return ye(oe,Pe);ue(oe.name)})}function ye(oe,Pe){Wo.mkdir(Pe,oe.mode,function(Y){if(Y)return mt(Y);Wo.chmod(Pe,oe.mode,function(ve){if(ve)return mt(ve);ue(oe.name)})})}function ue(oe){Wo.readdir(oe,function(Pe,Y){return Pe?mt(Pe):(Y.forEach(function(ve){D(ux.join(oe,ve))}),rt())})}function le(oe){var Pe=oe.replace(o,s);Wo.readlink(oe,function(Y,ve){if(Y)return mt(Y);Oe(ve,Pe)})}function Oe(oe,Pe){p&&(oe=ux.resolve(i,oe)),vt(Pe,function(Y){if(Y)return Je(oe,Pe);Wo.readlink(Pe,function(ve,Ve){return ve?mt(ve):(p&&(Ve=ux.resolve(i,Ve)),Ve===oe?rt():de(Pe,function(){Je(oe,Pe)}))})})}function Je(oe,Pe){Wo.symlink(oe,Pe,function(Y){return Y?mt(Y):rt()})}function vt(oe,Pe){Wo.lstat(oe,function(Y){return Y&&Y.code==="ENOENT"?Pe(!0):Pe(!1)})}function mt(oe){if(!w&&n!==void 0)return w=!0,n(oe)}function rt(oe){if(oe||b--,v++,h===v&&b===0&&n!==void 0)return n(null)}}DB.exports=gue});var OM=N((p0e,TB)=>{"use strict";var MM=require("path");function _B(r){return r=MM.normalize(MM.resolve(r)).split(MM.sep),r.length>0?r[0]:null}var vue=/[<>:"|?*]/;function yue(r){let e=_B(r);return r=r.replace(e,""),vue.test(r)}TB.exports={getRootPath:_B,invalidWin32Path:yue}});var AB=N((d0e,RB)=>{"use strict";var bue=_n(),KM=require("path"),Iue=OM().invalidWin32Path,Sue=parseInt("0777",8);function FM(r,e,t,n){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&Iue(r)){let s=new Error(r+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||bue;i===void 0&&(i=Sue&~process.umask()),n||(n=null),t=t||function(){},r=KM.resolve(r),o.mkdir(r,i,s=>{if(!s)return n=n||r,t(null,n);switch(s.code){case"ENOENT":if(KM.dirname(r)===r)return t(s);FM(KM.dirname(r),e,(a,c)=>{a?t(a,c):FM(r,e,t,c)});break;default:o.stat(r,(a,c)=>{a||!c.isDirectory()?t(s,n):t(null,n)});break}})}RB.exports=FM});var MB=N((m0e,NB)=>{"use strict";var xue=_n(),LM=require("path"),Cue=OM().invalidWin32Path,wue=parseInt("0777",8);function UM(r,e,t){(!e||typeof e!="object")&&(e={mode:e});let n=e.mode,i=e.fs||xue;if(process.platform==="win32"&&Cue(r)){let o=new Error(r+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}n===void 0&&(n=wue&~process.umask()),t||(t=null),r=LM.resolve(r);try{i.mkdirSync(r,n),t=t||r}catch(o){switch(o.code){case"ENOENT":if(LM.dirname(r)===r)throw o;t=UM(LM.dirname(r),e,t),UM(r,e,t);break;default:let s;try{s=i.statSync(r)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}NB.exports=UM});var Vo=N((f0e,OB)=>{"use strict";var Eue=fo().fromCallback,jM=Eue(AB()),WM=MB();OB.exports={mkdirs:jM,mkdirsSync:WM,mkdirp:jM,mkdirpSync:WM,ensureDir:jM,ensureDirSync:WM}});var Kl=N((h0e,FB)=>{"use strict";var Pue=fo().fromPromise,KB=AM();function kue(r){return KB.access(r).then(()=>!0).catch(()=>!1)}FB.exports={pathExists:Pue(kue),pathExistsSync:KB.existsSync}});var jB=N((g0e,UB)=>{"use strict";var Due=_n(),px=require("path"),LB=NM(),_ue=Vo(),Tue=Kl().pathExists;function Rue(r,e,t,n){typeof t=="function"&&!n?(n=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),n=n||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=px.resolve(i,r),s=px.resolve(i,e);if(o===s)return n(new Error("Source and destination must not be the same."));Due.lstat(r,(a,c)=>{if(a)return n(a);let l=null;if(c.isDirectory()){let u=e.split(px.sep);u.pop(),l=u.join(px.sep)}else l=px.dirname(e);Tue(l,(u,p)=>{if(u)return n(u);if(p)return LB(r,e,t,n);_ue.mkdirs(l,m=>{if(m)return n(m);LB(r,e,t,n)})})})}UB.exports=Rue});var VB=N((v0e,WB)=>{var Aue=fo().fromCallback;WB.exports={copy:Aue(jB())}});var VM=N((y0e,BB)=>{BB.exports=function(r){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(r)}catch{return new Buffer(r)}return new Buffer(r)}});var HB=N((b0e,$B)=>{"use strict";var Nc=_n(),JB=64*1024,qB=VM()(JB);function Nue(r,e,t){let n=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Nc.existsSync(e))if(n)Nc.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Nc.openSync(r,"r"),a=Nc.fstatSync(s),c=Nc.openSync(e,"w",a.mode),l=1,u=0;for(;l>0;)l=Nc.readSync(s,qB,0,JB,u),Nc.writeSync(c,qB,0,l),u+=l;o&&Nc.futimesSync(c,a.atime,a.mtime),Nc.closeSync(s),Nc.closeSync(c)}$B.exports=Nue});var YB=N((I0e,QB)=>{"use strict";var Sm=_n(),BM=require("path"),Mue=HB(),GB=Vo();function zB(r,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let n=t.recursive&&!t.dereference?Sm.lstatSync(r):Sm.statSync(r),i=BM.dirname(e),o=Sm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(r)):typeof t.filter=="function"&&(s=t.filter(r,e)),n.isFile()&&s)o||GB.mkdirsSync(i),Mue(r,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(n.isDirectory()&&s)Sm.existsSync(e)||GB.mkdirsSync(e),Sm.readdirSync(r).forEach(c=>{let l=t;l.recursive=!0,zB(BM.join(r,c),BM.join(e,c),l)});else if(t.recursive&&n.isSymbolicLink()&&s){let a=Sm.readlinkSync(r);Sm.symlinkSync(a,e)}}QB.exports=zB});var qM=N((S0e,XB)=>{XB.exports={copySync:YB()}});var aq=N((x0e,sq)=>{"use strict";var ZB=_n(),nq=require("path"),cr=require("assert"),dx=process.platform==="win32";function iq(r){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{r[t]=r[t]||ZB[t],t=t+"Sync",r[t]=r[t]||ZB[t]}),r.maxBusyTries=r.maxBusyTries||3}function JM(r,e,t){let n=0;typeof e=="function"&&(t=e,e={}),cr(r,"rimraf: missing path"),cr.equal(typeof r,"string","rimraf: path should be a string"),cr.equal(typeof t,"function","rimraf: callback function required"),cr(e,"rimraf: invalid options argument provided"),cr.equal(typeof e,"object","rimraf: options should be object"),iq(e),eq(r,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&n<e.maxBusyTries){n++;let s=n*100;return setTimeout(()=>eq(r,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function eq(r,e,t){cr(r),cr(e),cr(typeof t=="function"),e.lstat(r,(n,i)=>{if(n&&n.code==="ENOENT")return t(null);if(n&&n.code==="EPERM"&&dx)return tq(r,e,n,t);if(i&&i.isDirectory())return ak(r,e,n,t);e.unlink(r,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return dx?tq(r,e,o,t):ak(r,e,o,t);if(o.code==="EISDIR")return ak(r,e,o,t)}return t(o)})})}function tq(r,e,t,n){cr(r),cr(e),cr(typeof n=="function"),t&&cr(t instanceof Error),e.chmod(r,438,i=>{i?n(i.code==="ENOENT"?null:t):e.stat(r,(o,s)=>{o?n(o.code==="ENOENT"?null:t):s.isDirectory()?ak(r,e,t,n):e.unlink(r,n)})})}function rq(r,e,t){let n;cr(r),cr(e),t&&cr(t instanceof Error);try{e.chmodSync(r,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{n=e.statSync(r)}catch(i){if(i.code==="ENOENT")return;throw t}n.isDirectory()?ck(r,e,t):e.unlinkSync(r)}function ak(r,e,t,n){cr(r),cr(e),t&&cr(t instanceof Error),cr(typeof n=="function"),e.rmdir(r,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Oue(r,e,n):i&&i.code==="ENOTDIR"?n(t):n(i)})}function Oue(r,e,t){cr(r),cr(e),cr(typeof t=="function"),e.readdir(r,(n,i)=>{if(n)return t(n);let o=i.length,s;if(o===0)return e.rmdir(r,t);i.forEach(a=>{JM(nq.join(r,a),e,c=>{if(!s){if(c)return t(s=c);--o===0&&e.rmdir(r,t)}})})})}function oq(r,e){let t;e=e||{},iq(e),cr(r,"rimraf: missing path"),cr.equal(typeof r,"string","rimraf: path should be a string"),cr(e,"rimraf: missing options"),cr.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(r)}catch(n){if(n.code==="ENOENT")return;n.code==="EPERM"&&dx&&rq(r,e,n)}try{t&&t.isDirectory()?ck(r,e,null):e.unlinkSync(r)}catch(n){if(n.code==="ENOENT")return;if(n.code==="EPERM")return dx?rq(r,e,n):ck(r,e,n);if(n.code!=="EISDIR")throw n;ck(r,e,n)}}function ck(r,e,t){cr(r),cr(e),t&&cr(t instanceof Error);try{e.rmdirSync(r)}catch(n){if(n.code==="ENOTDIR")throw t;if(n.code==="ENOTEMPTY"||n.code==="EEXIST"||n.code==="EPERM")Kue(r,e);else if(n.code!=="ENOENT")throw n}}function Kue(r,e){cr(r),cr(e),e.readdirSync(r).forEach(i=>oq(nq.join(r,i),e));let t=dx?100:1,n=0;do{let i=!0;try{let o=e.rmdirSync(r,e);return i=!1,o}finally{if(++n<t&&i)continue}}while(!0)}sq.exports=JM;JM.sync=oq});var mx=N((C0e,lq)=>{"use strict";var Fue=fo().fromCallback,cq=aq();lq.exports={remove:Fue(cq),removeSync:cq.sync}});var mq=N((w0e,dq)=>{var Ng;try{Ng=_n()}catch{Ng=require("fs")}function Lue(r,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var n=e.fs||Ng,i=!0;"throws"in e&&(i=e.throws),n.readFile(r,e,function(o,s){if(o)return t(o);s=pq(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(c){return i?(c.message=r+": "+c.message,t(c)):t(null,null)}t(null,a)})}function Uue(r,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||Ng,n=!0;"throws"in e&&(n=e.throws);try{var i=t.readFileSync(r,e);return i=pq(i),JSON.parse(i,e.reviver)}catch(o){if(n)throw o.message=r+": "+o.message,o;return null}}function uq(r,e){var t,n=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(n=e.EOL));var i=JSON.stringify(r,e?e.replacer:null,t);return i.replace(/\n/g,n)+n}function jue(r,e,t,n){n==null&&(n=t,t={}),t=t||{};var i=t.fs||Ng,o="";try{o=uq(e,t)}catch(s){n&&n(s,null);return}i.writeFile(r,o,t,n)}function Wue(r,e,t){t=t||{};var n=t.fs||Ng,i=uq(e,t);return n.writeFileSync(r,i,t)}function pq(r){return Buffer.isBuffer(r)&&(r=r.toString("utf8")),r=r.replace(/^\uFEFF/,""),r}var Vue={readFile:Lue,readFileSync:Uue,writeFile:jue,writeFileSync:Wue};dq.exports=Vue});var uk=N((E0e,hq)=>{"use strict";var fq=fo().fromCallback,lk=mq();hq.exports={readJson:fq(lk.readFile),readJsonSync:lk.readFileSync,writeJson:fq(lk.writeFile),writeJsonSync:lk.writeFileSync}});var yq=N((P0e,vq)=>{"use strict";var Bue=require("path"),que=Vo(),Jue=Kl().pathExists,gq=uk();function $ue(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=Bue.dirname(r);Jue(i,(o,s)=>{if(o)return n(o);if(s)return gq.writeJson(r,e,t,n);que.mkdirs(i,a=>{if(a)return n(a);gq.writeJson(r,e,t,n)})})}vq.exports=$ue});var Iq=N((k0e,bq)=>{"use strict";var Hue=_n(),Gue=require("path"),zue=Vo(),Que=uk();function Yue(r,e,t){let n=Gue.dirname(r);Hue.existsSync(n)||zue.mkdirsSync(n),Que.writeJsonSync(r,e,t)}bq.exports=Yue});var xq=N((D0e,Sq)=>{"use strict";var Xue=fo().fromCallback,zi=uk();zi.outputJson=Xue(yq());zi.outputJsonSync=Iq();zi.outputJSON=zi.outputJson;zi.outputJSONSync=zi.outputJsonSync;zi.writeJSON=zi.writeJson;zi.writeJSONSync=zi.writeJsonSync;zi.readJSON=zi.readJson;zi.readJSONSync=zi.readJsonSync;Sq.exports=zi});var Pq=N((_0e,Eq)=>{"use strict";var Zue=fo().fromCallback,Mc=_n(),epe=NM(),xm=require("path"),pk=mx().remove,tpe=Vo().mkdirs;function $M(r,e,t,n){typeof t=="function"&&(n=t,t={});let i=t.overwrite||t.clobber||!1;npe(r,e,(s,a)=>{if(s)return n(s);if(a)return n(new Error(`Cannot move '${r}' to a subdirectory of itself, '${e}'.`));tpe(xm.dirname(e),c=>{if(c)return n(c);o()})});function o(){xm.resolve(r)===xm.resolve(e)?Mc.access(r,n):i?Mc.rename(r,e,s=>{if(!s)return n();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){pk(e,a=>{if(a)return n(a);t.overwrite=!1,$M(r,e,t,n)});return}if(s.code==="EPERM"){setTimeout(()=>{pk(e,a=>{if(a)return n(a);t.overwrite=!1,$M(r,e,t,n)})},200);return}if(s.code!=="EXDEV")return n(s);Cq(r,e,i,n)}):Mc.link(r,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?Cq(r,e,i,n):n(s):Mc.unlink(r,n))}}function Cq(r,e,t,n){Mc.stat(r,(i,o)=>{if(i)return n(i);o.isDirectory()?wq(r,e,t,n):rpe(r,e,t,n)})}function rpe(r,e,t,n){let i=t?"w":"wx",o=Mc.createReadStream(r),s=Mc.createWriteStream(e,{flags:i});o.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),Mc.unlink(e,()=>{c.code==="EISDIR"||c.code==="EPERM"?wq(r,e,t,n):n(c)})}),s.on("error",c=>{o.destroy(),s.destroy(),s.removeListener("close",a),n(c)}),s.once("close",a),o.pipe(s);function a(){Mc.unlink(r,n)}}function wq(r,e,t,n){let i={overwrite:!1};t?pk(e,s=>{if(s)return n(s);o()}):o();function o(){epe(r,e,i,s=>{if(s)return n(s);pk(r,n)})}}function npe(r,e,t){Mc.stat(r,(n,i)=>{if(n)return t(n);if(i.isDirectory()){let o=e.split(xm.dirname(r)+xm.sep)[1];if(o){let s=o.split(xm.sep)[0];return s?t(null,r!==e&&e.indexOf(r)>-1&&s===xm.basename(r)):t(null,!1)}return t(null,!1)}return t(null,!1)})}Eq.exports={move:Zue($M)}});var Tq=N((T0e,_q)=>{"use strict";var ho=_n(),Cm=require("path"),ipe=qM().copySync,HM=mx().removeSync,ope=Vo().mkdirsSync,spe=VM();function Dq(r,e,t){t=t||{};let n=t.overwrite||t.clobber||!1;if(r=Cm.resolve(r),e=Cm.resolve(e),r===e)return ho.accessSync(r);if(lpe(r,e))throw new Error(`Cannot move '${r}' into itself '${e}'.`);ope(Cm.dirname(e)),i();function i(){if(n)try{return ho.renameSync(r,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return HM(e),t.overwrite=!1,Dq(r,e,t);if(o.code!=="EXDEV")throw o;return kq(r,e,n)}else try{return ho.linkSync(r,e),ho.unlinkSync(r)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return kq(r,e,n);throw o}}}function kq(r,e,t){return ho.statSync(r).isDirectory()?cpe(r,e,t):ape(r,e,t)}function ape(r,e,t){let i=spe(65536),o=t?"w":"wx",s=ho.openSync(r,"r"),a=ho.fstatSync(s),c=ho.openSync(e,o,a.mode),l=1,u=0;for(;l>0;)l=ho.readSync(s,i,0,65536,u),ho.writeSync(c,i,0,l),u+=l;return ho.closeSync(s),ho.closeSync(c),ho.unlinkSync(r)}function cpe(r,e,t){let n={overwrite:!1};t&&HM(e),i();function i(){return ipe(r,e,n),HM(r)}}function lpe(r,e){try{return ho.statSync(r).isDirectory()&&r!==e&&e.indexOf(r)>-1&&e.split(Cm.dirname(r)+Cm.sep)[1].split(Cm.sep)[0]===Cm.basename(r)}catch{return!1}}_q.exports={moveSync:Dq}});var Lq=N((R0e,Fq)=>{"use strict";var upe=fo().fromCallback,Nq=require("fs"),Mq=require("path"),Oq=Vo(),Kq=mx(),Rq=upe(function(e,t){t=t||function(){},Nq.readdir(e,(n,i)=>{if(n)return Oq.mkdirs(e,t);i=i.map(s=>Mq.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();Kq.remove(s,a=>{if(a)return t(a);o()})}})});function Aq(r){let e;try{e=Nq.readdirSync(r)}catch{return Oq.mkdirsSync(r)}e.forEach(t=>{t=Mq.join(r,t),Kq.removeSync(t)})}Fq.exports={emptyDirSync:Aq,emptydirSync:Aq,emptyDir:Rq,emptydir:Rq}});var Vq=N((A0e,Wq)=>{"use strict";var ppe=fo().fromCallback,Uq=require("path"),fx=_n(),jq=Vo(),dpe=Kl().pathExists;function mpe(r,e){function t(){fx.writeFile(r,"",n=>{if(n)return e(n);e()})}fx.stat(r,(n,i)=>{if(!n&&i.isFile())return e();let o=Uq.dirname(r);dpe(o,(s,a)=>{if(s)return e(s);if(a)return t();jq.mkdirs(o,c=>{if(c)return e(c);t()})})})}function fpe(r){let e;try{e=fx.statSync(r)}catch{}if(e&&e.isFile())return;let t=Uq.dirname(r);fx.existsSync(t)||jq.mkdirsSync(t),fx.writeFileSync(r,"")}Wq.exports={createFile:ppe(mpe),createFileSync:fpe}});var Hq=N((N0e,$q)=>{"use strict";var hpe=fo().fromCallback,qq=require("path"),wm=_n(),Jq=Vo(),Bq=Kl().pathExists;function gpe(r,e,t){function n(i,o){wm.link(i,o,s=>{if(s)return t(s);t(null)})}Bq(e,(i,o)=>{if(i)return t(i);if(o)return t(null);wm.lstat(r,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let c=qq.dirname(e);Bq(c,(l,u)=>{if(l)return t(l);if(u)return n(r,e);Jq.mkdirs(c,p=>{if(p)return t(p);n(r,e)})})})})}function vpe(r,e,t){if(wm.existsSync(e))return;try{wm.lstatSync(r)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=qq.dirname(e);return wm.existsSync(i)||Jq.mkdirsSync(i),wm.linkSync(r,e)}$q.exports={createLink:hpe(gpe),createLinkSync:vpe}});var zq=N((M0e,Gq)=>{"use strict";var Pp=require("path"),hx=_n(),ype=Kl().pathExists;function bpe(r,e,t){if(Pp.isAbsolute(r))return hx.lstat(r,(n,i)=>n?(n.message=n.message.replace("lstat","ensureSymlink"),t(n)):t(null,{toCwd:r,toDst:r}));{let n=Pp.dirname(e),i=Pp.join(n,r);return ype(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:r}):hx.lstat(r,(a,c)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:r,toDst:Pp.relative(n,r)})))}}function Ipe(r,e){let t;if(Pp.isAbsolute(r)){if(t=hx.existsSync(r),!t)throw new Error("absolute srcpath does not exist");return{toCwd:r,toDst:r}}else{let n=Pp.dirname(e),i=Pp.join(n,r);if(t=hx.existsSync(i),t)return{toCwd:i,toDst:r};if(t=hx.existsSync(r),!t)throw new Error("relative srcpath does not exist");return{toCwd:r,toDst:Pp.relative(n,r)}}}Gq.exports={symlinkPaths:bpe,symlinkPathsSync:Ipe}});var Xq=N((O0e,Yq)=>{"use strict";var Qq=_n();function Spe(r,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);Qq.lstat(r,(n,i)=>{if(n)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function xpe(r,e){let t;if(e)return e;try{t=Qq.lstatSync(r)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}Yq.exports={symlinkType:Spe,symlinkTypeSync:xpe}});var o6=N((K0e,i6)=>{"use strict";var Cpe=fo().fromCallback,e6=require("path"),Mg=_n(),t6=Vo(),wpe=t6.mkdirs,Epe=t6.mkdirsSync,r6=zq(),Ppe=r6.symlinkPaths,kpe=r6.symlinkPathsSync,n6=Xq(),Dpe=n6.symlinkType,_pe=n6.symlinkTypeSync,Zq=Kl().pathExists;function Tpe(r,e,t,n){n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,Zq(e,(i,o)=>{if(i)return n(i);if(o)return n(null);Ppe(r,e,(s,a)=>{if(s)return n(s);r=a.toDst,Dpe(a.toCwd,t,(c,l)=>{if(c)return n(c);let u=e6.dirname(e);Zq(u,(p,m)=>{if(p)return n(p);if(m)return Mg.symlink(r,e,l,n);wpe(u,h=>{if(h)return n(h);Mg.symlink(r,e,l,n)})})})})})}function Rpe(r,e,t,n){if(n=typeof t=="function"?t:n,t=typeof t=="function"?!1:t,Mg.existsSync(e))return;let o=kpe(r,e);r=o.toDst,t=_pe(o.toCwd,t);let s=e6.dirname(e);return Mg.existsSync(s)||Epe(s),Mg.symlinkSync(r,e,t)}i6.exports={createSymlink:Cpe(Tpe),createSymlinkSync:Rpe}});var a6=N((F0e,s6)=>{"use strict";var dk=Vq(),mk=Hq(),fk=o6();s6.exports={createFile:dk.createFile,createFileSync:dk.createFileSync,ensureFile:dk.createFile,ensureFileSync:dk.createFileSync,createLink:mk.createLink,createLinkSync:mk.createLinkSync,ensureLink:mk.createLink,ensureLinkSync:mk.createLinkSync,createSymlink:fk.createSymlink,createSymlinkSync:fk.createSymlinkSync,ensureSymlink:fk.createSymlink,ensureSymlinkSync:fk.createSymlinkSync}});var p6=N((L0e,u6)=>{"use strict";var Ape=fo().fromCallback,Em=_n(),c6=require("path"),l6=Vo(),Npe=Kl().pathExists;function Mpe(r,e,t,n){typeof t=="function"&&(n=t,t="utf8");let i=c6.dirname(r);Npe(i,(o,s)=>{if(o)return n(o);if(s)return Em.writeFile(r,e,t,n);l6.mkdirs(i,a=>{if(a)return n(a);Em.writeFile(r,e,t,n)})})}function Ope(r,e,t){let n=c6.dirname(r);if(Em.existsSync(n))return Em.writeFileSync.apply(Em,arguments);l6.mkdirsSync(n),Em.writeFileSync.apply(Em,arguments)}u6.exports={outputFile:Ape(Mpe),outputFileSync:Ope}});var Fl=N((U0e,d6)=>{"use strict";var Rs=fB(),Bo={};Rs(Bo,AM());Rs(Bo,VB());Rs(Bo,qM());Rs(Bo,Vo());Rs(Bo,mx());Rs(Bo,xq());Rs(Bo,Pq());Rs(Bo,Tq());Rs(Bo,Lq());Rs(Bo,a6());Rs(Bo,p6());Rs(Bo,Kl());d6.exports=Bo});var _k=N((HAe,aO)=>{"use strict";function Hpe(r){var e=void 0;typeof r=="string"?e=[r]:e=r.raw;for(var t="",n=0;n<e.length;n++)t+=e[n].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),n<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=n+1?void 0:arguments[n+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var c=a[1].length;o?o=Math.min(o,c):o=c}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof aO<"u"&&(aO.exports=Hpe)});var EJ=N((DFe,wJ)=>{wJ.exports=function(r,e){for(var t=[],n=0;n<r.length;n++){var i=e(r[n],n);tde(i)?t.push.apply(t,i):t.push(i)}return t};var tde=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"}});var TJ=N((_Fe,_J)=>{"use strict";_J.exports=kJ;function kJ(r,e,t){r instanceof RegExp&&(r=PJ(r,t)),e instanceof RegExp&&(e=PJ(e,t));var n=DJ(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function PJ(r,e){var t=e.match(r);return t?t[0]:null}kJ.range=DJ;function DJ(r,e,t){var n,i,o,s,a,c=t.indexOf(r),l=t.indexOf(e,c+1),u=c;if(c>=0&&l>0){if(r===e)return[c,l];for(n=[],o=t.length;u>=0&&!a;)u==c?(n.push(u),c=t.indexOf(r,u+1)):n.length==1?a=[n.pop(),l]:(i=n.pop(),i<o&&(o=i,s=l),l=t.indexOf(e,u+1)),u=c<l&&c>=0?c:l;n.length&&(a=[o,s])}return a}});var LJ=N((TFe,FJ)=>{var rde=EJ(),RJ=TJ();FJ.exports=ode;var AJ="\0SLASH"+Math.random()+"\0",NJ="\0OPEN"+Math.random()+"\0",IO="\0CLOSE"+Math.random()+"\0",MJ="\0COMMA"+Math.random()+"\0",OJ="\0PERIOD"+Math.random()+"\0";function bO(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function nde(r){return r.split("\\\\").join(AJ).split("\\{").join(NJ).split("\\}").join(IO).split("\\,").join(MJ).split("\\.").join(OJ)}function ide(r){return r.split(AJ).join("\\").split(NJ).join("{").split(IO).join("}").split(MJ).join(",").split(OJ).join(".")}function KJ(r){if(!r)return[""];var e=[],t=RJ("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,o=t.post,s=n.split(",");s[s.length-1]+="{"+i+"}";var a=KJ(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function ode(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),av(nde(r),!0).map(ide)):[]}function sde(r){return"{"+r+"}"}function ade(r){return/^-?0\d/.test(r)}function cde(r,e){return r<=e}function lde(r,e){return r>=e}function av(r,e){var t=[],n=RJ("{","}",r);if(!n||/\$$/.test(n.pre))return[r];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),s=i||o,a=n.body.indexOf(",")>=0;if(!s&&!a)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+IO+n.post,av(r)):[r];var c;if(s)c=n.body.split(/\.\./);else if(c=KJ(n.body),c.length===1&&(c=av(c[0],!1).map(sde),c.length===1)){var u=n.post.length?av(n.post,!1):[""];return u.map(function(Je){return n.pre+c[0]+Je})}var l=n.pre,u=n.post.length?av(n.post,!1):[""],p;if(s){var m=bO(c[0]),h=bO(c[1]),v=Math.max(c[0].length,c[1].length),b=c.length==3?Math.abs(bO(c[2])):1,w=cde,D=h<m;D&&(b*=-1,w=lde);var T=c.some(ade);p=[];for(var F=m;w(F,h);F+=b){var ee;if(o)ee=String.fromCharCode(F),ee==="\\"&&(ee="");else if(ee=String(F),T){var de=v-ee.length;if(de>0){var Z=new Array(de+1).join("0");F<0?ee="-"+Z+ee.slice(1):ee=Z+ee}}p.push(ee)}}else p=rde(c,function(Oe){return av(Oe,!1)});for(var ye=0;ye<p.length;ye++)for(var ue=0;ue<u.length;ue++){var le=l+p[ye]+u[ue];(!e||s||le)&&t.push(le)}return t}});var Ex=N((RFe,BJ)=>{BJ.exports=Jo;Jo.Minimatch=ci;var wx=function(){try{return require("path")}catch{}}()||{sep:"/"};Jo.sep=wx.sep;var CO=Jo.GLOBSTAR=ci.GLOBSTAR={},ude=LJ(),UJ={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},SO="[^/]",xO=SO+"*?",pde="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",dde="(?:(?!(?:\\/|^)\\.).)*?",jJ=mde("().*{}+?[]^$\\!");function mde(r){return r.split("").reduce(function(e,t){return e[t]=!0,e},{})}var WJ=/\/+/;Jo.filter=fde;function fde(r,e){return e=e||{},function(t,n,i){return Jo(t,r,e)}}function Op(r,e){e=e||{};var t={};return Object.keys(r).forEach(function(n){t[n]=r[n]}),Object.keys(e).forEach(function(n){t[n]=e[n]}),t}Jo.defaults=function(r){if(!r||typeof r!="object"||!Object.keys(r).length)return Jo;var e=Jo,t=function(i,o,s){return e(i,o,Op(r,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Op(r,o))},t.Minimatch.defaults=function(i){return e.defaults(Op(r,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Op(r,o))},t.defaults=function(i){return e.defaults(Op(r,i))},t.makeRe=function(i,o){return e.makeRe(i,Op(r,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Op(r,o))},t.match=function(n,i,o){return e.match(n,i,Op(r,o))},t};ci.defaults=function(r){return Jo.defaults(r).Minimatch};function Jo(r,e,t){return Yk(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new ci(e,t).match(r)}function ci(r,e){if(!(this instanceof ci))return new ci(r,e);Yk(r),e||(e={}),r=r.trim(),!e.allowWindowsEscape&&wx.sep!=="/"&&(r=r.split(wx.sep).join("/")),this.options=e,this.set=[],this.pattern=r,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}ci.prototype.debug=function(){};ci.prototype.make=hde;function hde(){var r=this.pattern,e=this.options;if(!e.nocomment&&r.charAt(0)==="#"){this.comment=!0;return}if(!r){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(n){return n.split(WJ)}),this.debug(this.pattern,t),t=t.map(function(n,i,o){return n.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}ci.prototype.parseNegate=gde;function gde(){var r=this.pattern,e=!1,t=this.options,n=0;if(!t.nonegate){for(var i=0,o=r.length;i<o&&r.charAt(i)==="!";i++)e=!e,n++;n&&(this.pattern=r.substr(n)),this.negate=e}}Jo.braceExpand=function(r,e){return VJ(r,e)};ci.prototype.braceExpand=VJ;function VJ(r,e){return e||(this instanceof ci?e=this.options:e={}),r=typeof r>"u"?this.pattern:r,Yk(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:ude(r)}var vde=1024*64,Yk=function(r){if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>vde)throw new TypeError("pattern is too long")};ci.prototype.parse=yde;var Qk={};function yde(r,e){Yk(r);var t=this.options;if(r==="**")if(t.noglobstar)r="*";else return CO;if(r==="")return"";var n="",i=!!t.nocase,o=!1,s=[],a=[],c,l=!1,u=-1,p=-1,m=r.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",h=this;function v(){if(c){switch(c){case"*":n+=xO,i=!0;break;case"?":n+=SO,i=!0;break;default:n+="\\"+c;break}h.debug("clearStateChar %j %j",c,n),c=!1}}for(var b=0,w=r.length,D;b<w&&(D=r.charAt(b));b++){if(this.debug("%s	%s %s %j",r,b,n,D),o&&jJ[D]){n+="\\"+D,o=!1;continue}switch(D){case"/":return!1;case"\\":v(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",r,b,n,D),l){this.debug("  in class"),D==="!"&&b===p+1&&(D="^"),n+=D;continue}h.debug("call clearStateChar %j",c),v(),c=D,t.noext&&v();continue;case"(":if(l){n+="(";continue}if(!c){n+="\\(";continue}s.push({type:c,start:b-1,reStart:n.length,open:UJ[c].open,close:UJ[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(l||!s.length){n+="\\)";continue}v(),i=!0;var T=s.pop();n+=T.close,T.type==="!"&&a.push(T),T.reEnd=n.length;continue;case"|":if(l||!s.length||o){n+="\\|",o=!1;continue}v(),n+="|";continue;case"[":if(v(),l){n+="\\"+D;continue}l=!0,p=b,u=n.length,n+=D;continue;case"]":if(b===p+1||!l){n+="\\"+D,o=!1;continue}var F=r.substring(p+1,b);try{RegExp("["+F+"]")}catch{var ee=this.parse(F,Qk);n=n.substr(0,u)+"\\["+ee[0]+"\\]",i=i||ee[1],l=!1;continue}i=!0,l=!1,n+=D;continue;default:v(),o?o=!1:jJ[D]&&!(D==="^"&&l)&&(n+="\\"),n+=D}}for(l&&(F=r.substr(p+1),ee=this.parse(F,Qk),n=n.substr(0,u)+"\\["+ee[0],i=i||ee[1]),T=s.pop();T;T=s.pop()){var de=n.slice(T.reStart+T.open.length);this.debug("setting tail",n,T),de=de.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(un,Ct,jr){return jr||(jr="\\"),Ct+Ct+jr+"|"}),this.debug(`tail=%j
   %s`,de,de,T,n);var Z=T.type==="*"?xO:T.type==="?"?SO:"\\"+T.type;i=!0,n=n.slice(0,T.reStart)+Z+"\\("+de}v(),o&&(n+="\\\\");var ye=!1;switch(n.charAt(0)){case"[":case".":case"(":ye=!0}for(var ue=a.length-1;ue>-1;ue--){var le=a[ue],Oe=n.slice(0,le.reStart),Je=n.slice(le.reStart,le.reEnd-8),vt=n.slice(le.reEnd-8,le.reEnd),mt=n.slice(le.reEnd);vt+=mt;var rt=Oe.split("(").length-1,oe=mt;for(b=0;b<rt;b++)oe=oe.replace(/\)[+*?]?/,"");mt=oe;var Pe="";mt===""&&e!==Qk&&(Pe="$");var Y=Oe+Je+mt+Pe+vt;n=Y}if(n!==""&&i&&(n="(?=.)"+n),ye&&(n=m+n),e===Qk)return[n,i];if(!i)return Ide(r);var ve=t.nocase?"i":"";try{var Ve=new RegExp("^"+n+"$",ve)}catch{return new RegExp("$.")}return Ve._glob=r,Ve._src=n,Ve}Jo.makeRe=function(r,e){return new ci(r,e||{}).makeRe()};ci.prototype.makeRe=bde;function bde(){if(this.regexp||this.regexp===!1)return this.regexp;var r=this.set;if(!r.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?xO:e.dot?pde:dde,n=e.nocase?"i":"",i=r.map(function(o){return o.map(function(s){return s===CO?t:typeof s=="string"?Sde(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,n)}catch{this.regexp=!1}return this.regexp}Jo.match=function(r,e,t){t=t||{};var n=new ci(e,t);return r=r.filter(function(i){return n.match(i)}),n.options.nonull&&!r.length&&r.push(e),r};ci.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var n=this.options;wx.sep!=="/"&&(e=e.split(wx.sep).join("/")),e=e.split(WJ),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],c=e;n.matchBase&&a.length===1&&(c=[o]);var l=this.matchOne(c,a,t);if(l)return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate};ci.prototype.matchOne=function(r,e,t){var n=this.options;this.debug("matchOne",{this:this,file:r,pattern:e}),this.debug("matchOne",r.length,e.length);for(var i=0,o=0,s=r.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var c=e[o],l=r[i];if(this.debug(e,c,l),c===!1)return!1;if(c===CO){this.debug("GLOBSTAR",[e,c,l]);var u=i,p=o+1;if(p===a){for(this.debug("** at the end");i<s;i++)if(r[i]==="."||r[i]===".."||!n.dot&&r[i].charAt(0)===".")return!1;return!0}for(;u<s;){var m=r[u];if(this.debug(`
globstar while`,r,u,e,p,m),this.matchOne(r.slice(u),e.slice(p),t))return this.debug("globstar found match!",u,s,m),!0;if(m==="."||m===".."||!n.dot&&m.charAt(0)==="."){this.debug("dot detected!",r,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,r,u,e,p),u===s))}var h;if(typeof c=="string"?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&r[i]==="";throw new Error("wtf?")};function Ide(r){return r.replace(/\\(.)/g,"$1")}function Sde(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var YJ=N(EO=>{var Am=require("path"),Fp=process.platform==="win32",Kp=require("fs"),Ede=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function Pde(){var r;if(Ede){var e=new Error;r=t}else r=n;return r;function t(i){i&&(e.message=i.message,i=e,n(i))}function n(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function kde(r){return typeof r=="function"?r:Pde()}var bUe=Am.normalize;Fp?$l=/(.*?)(?:[\/\\]+|$)/g:$l=/(.*?)(?:[\/]+|$)/g;var $l;Fp?Tx=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:Tx=/^[\/]*/;var Tx;EO.realpathSync=function(e,t){if(e=Am.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var n=e,i={},o={},s,a,c,l;u();function u(){var w=Tx.exec(e);s=w[0].length,a=w[0],c=w[0],l="",Fp&&!o[c]&&(Kp.lstatSync(c),o[c]=!0)}for(;s<e.length;){$l.lastIndex=s;var p=$l.exec(e);if(l=a,a+=p[0],c=l+p[1],s=$l.lastIndex,!(o[c]||t&&t[c]===c)){var m;if(t&&Object.prototype.hasOwnProperty.call(t,c))m=t[c];else{var h=Kp.lstatSync(c);if(!h.isSymbolicLink()){o[c]=!0,t&&(t[c]=c);continue}var v=null;if(!Fp){var b=h.dev.toString(32)+":"+h.ino.toString(32);i.hasOwnProperty(b)&&(v=i[b])}v===null&&(Kp.statSync(c),v=Kp.readlinkSync(c)),m=Am.resolve(l,v),t&&(t[c]=m),Fp||(i[b]=v)}e=Am.resolve(m,e.slice(s)),u()}}return t&&(t[n]=e),e};EO.realpath=function(e,t,n){if(typeof n!="function"&&(n=kde(t),t=null),e=Am.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(n.bind(null,null,t[e]));var i=e,o={},s={},a,c,l,u;p();function p(){var w=Tx.exec(e);a=w[0].length,c=w[0],l=w[0],u="",Fp&&!s[l]?Kp.lstat(l,function(D){if(D)return n(D);s[l]=!0,m()}):process.nextTick(m)}function m(){if(a>=e.length)return t&&(t[i]=e),n(null,e);$l.lastIndex=a;var w=$l.exec(e);return u=c,c+=w[0],l=u+w[1],a=$l.lastIndex,s[l]||t&&t[l]===l?process.nextTick(m):t&&Object.prototype.hasOwnProperty.call(t,l)?b(t[l]):Kp.lstat(l,h)}function h(w,D){if(w)return n(w);if(!D.isSymbolicLink())return s[l]=!0,t&&(t[l]=l),process.nextTick(m);if(!Fp){var T=D.dev.toString(32)+":"+D.ino.toString(32);if(o.hasOwnProperty(T))return v(null,o[T],l)}Kp.stat(l,function(F){if(F)return n(F);Kp.readlink(l,function(ee,de){Fp||(o[T]=de),v(ee,de)})})}function v(w,D,T){if(w)return n(w);var F=Am.resolve(u,D);t&&(t[T]=F),b(F)}function b(w){e=Am.resolve(w,e.slice(a)),p()}}});var _O=N((SUe,t8)=>{t8.exports=Lp;Lp.realpath=Lp;Lp.sync=DO;Lp.realpathSync=DO;Lp.monkeypatch=_de;Lp.unmonkeypatch=Tde;var yv=require("fs"),PO=yv.realpath,kO=yv.realpathSync,Dde=process.version,XJ=/^v[0-5]\./.test(Dde),ZJ=YJ();function e8(r){return r&&r.syscall==="realpath"&&(r.code==="ELOOP"||r.code==="ENOMEM"||r.code==="ENAMETOOLONG")}function Lp(r,e,t){if(XJ)return PO(r,e,t);typeof e=="function"&&(t=e,e=null),PO(r,e,function(n,i){e8(n)?ZJ.realpath(r,e,t):t(n,i)})}function DO(r,e){if(XJ)return kO(r,e);try{return kO(r,e)}catch(t){if(e8(t))return ZJ.realpathSync(r,e);throw t}}function _de(){yv.realpath=Lp,yv.realpathSync=DO}function Tde(){yv.realpath=PO,yv.realpathSync=kO}});var r8=N((xUe,TO)=>{typeof Object.create=="function"?TO.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:TO.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}});var n8=N((CUe,AO)=>{try{if(RO=require("util"),typeof RO.inherits!="function")throw"";AO.exports=RO.inherits}catch{AO.exports=r8()}var RO});var tD=N((wUe,eD)=>{"use strict";function i8(r){return r.charAt(0)==="/"}function o8(r){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(r),n=t[1]||"",i=!!(n&&n.charAt(1)!==":");return!!(t[2]||i)}eD.exports=process.platform==="win32"?o8:i8;eD.exports.posix=i8;eD.exports.win32=o8});var MO=N(Up=>{Up.setopts=Kde;Up.ownProp=s8;Up.makeAbs=Rx;Up.finish=Fde;Up.mark=Lde;Up.isIgnored=c8;Up.childrenIgnored=Ude;function s8(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var Rde=require("fs"),bv=require("path"),Ade=Ex(),a8=tD(),NO=Ade.Minimatch;function Nde(r,e){return r.localeCompare(e,"en")}function Mde(r,e){r.ignore=e.ignore||[],Array.isArray(r.ignore)||(r.ignore=[r.ignore]),r.ignore.length&&(r.ignore=r.ignore.map(Ode))}function Ode(r){var e=null;if(r.slice(-3)==="/**"){var t=r.replace(/(\/\*\*)+$/,"");e=new NO(t,{dot:!0})}return{matcher:new NO(r,{dot:!0}),gmatcher:e}}function Kde(r,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}r.silent=!!t.silent,r.pattern=e,r.strict=t.strict!==!1,r.realpath=!!t.realpath,r.realpathCache=t.realpathCache||Object.create(null),r.follow=!!t.follow,r.dot=!!t.dot,r.mark=!!t.mark,r.nodir=!!t.nodir,r.nodir&&(r.mark=!0),r.sync=!!t.sync,r.nounique=!!t.nounique,r.nonull=!!t.nonull,r.nosort=!!t.nosort,r.nocase=!!t.nocase,r.stat=!!t.stat,r.noprocess=!!t.noprocess,r.absolute=!!t.absolute,r.fs=t.fs||Rde,r.maxLength=t.maxLength||1/0,r.cache=t.cache||Object.create(null),r.statCache=t.statCache||Object.create(null),r.symlinks=t.symlinks||Object.create(null),Mde(r,t),r.changedCwd=!1;var n=process.cwd();s8(t,"cwd")?(r.cwd=bv.resolve(t.cwd),r.changedCwd=r.cwd!==n):r.cwd=n,r.root=t.root||bv.resolve(r.cwd,"/"),r.root=bv.resolve(r.root),process.platform==="win32"&&(r.root=r.root.replace(/\\/g,"/")),r.cwdAbs=a8(r.cwd)?r.cwd:Rx(r,r.cwd),process.platform==="win32"&&(r.cwdAbs=r.cwdAbs.replace(/\\/g,"/")),r.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,r.minimatch=new NO(e,t),r.options=r.minimatch.options}function Fde(r){for(var e=r.nounique,t=e?[]:Object.create(null),n=0,i=r.matches.length;n<i;n++){var o=r.matches[n];if(!o||Object.keys(o).length===0){if(r.nonull){var s=r.minimatch.globSet[n];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(c){t[c]=!0})}}if(e||(t=Object.keys(t)),r.nosort||(t=t.sort(Nde)),r.mark){for(var n=0;n<t.length;n++)t[n]=r._mark(t[n]);r.nodir&&(t=t.filter(function(c){var l=!/\/$/.test(c),u=r.cache[c]||r.cache[Rx(r,c)];return l&&u&&(l=u!=="DIR"&&!Array.isArray(u)),l}))}r.ignore.length&&(t=t.filter(function(c){return!c8(r,c)})),r.found=t}function Lde(r,e){var t=Rx(r,e),n=r.cache[t],i=e;if(n){var o=n==="DIR"||Array.isArray(n),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=Rx(r,i);r.statCache[a]=r.statCache[t],r.cache[a]=r.cache[t]}}return i}function Rx(r,e){var t=e;return e.charAt(0)==="/"?t=bv.join(r.root,e):a8(e)||e===""?t=e:r.changedCwd?t=bv.resolve(r.cwd,e):t=bv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function c8(r,e){return r.ignore.length?r.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function Ude(r,e){return r.ignore.length?r.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var m8=N((_Ue,d8)=>{d8.exports=p8;p8.GlobSync=Kn;var jde=_O(),l8=Ex(),PUe=l8.Minimatch,kUe=FO().Glob,DUe=require("util"),OO=require("path"),u8=require("assert"),rD=tD(),Nm=MO(),Wde=Nm.setopts,KO=Nm.ownProp,Vde=Nm.childrenIgnored,Bde=Nm.isIgnored;function p8(r,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new Kn(r,e).found}function Kn(r,e){if(!r)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof Kn))return new Kn(r,e);if(Wde(this,r,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var n=0;n<t;n++)this._process(this.minimatch.set[n],n,!1);this._finish()}Kn.prototype._finish=function(){if(u8(this instanceof Kn),this.realpath){var r=this;this.matches.forEach(function(e,t){var n=r.matches[t]=Object.create(null);for(var i in e)try{i=r._makeAbs(i);var o=jde.realpathSync(i,r.realpathCache);n[o]=!0}catch(s){if(s.syscall==="stat")n[r._makeAbs(i)]=!0;else throw s}})}Nm.finish(this)};Kn.prototype._process=function(r,e,t){u8(this instanceof Kn);for(var n=0;typeof r[n]=="string";)n++;var i;switch(n){case r.length:this._processSimple(r.join("/"),e);return;case 0:i=null;break;default:i=r.slice(0,n).join("/");break}var o=r.slice(n),s;i===null?s=".":((rD(i)||rD(r.join("/")))&&(!i||!rD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!Vde(this,s)){var c=o[0]===l8.GLOBSTAR;c?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};Kn.prototype._processReaddir=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){for(var a=n[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||l.charAt(0)===".",p=[],m=0;m<s.length;m++){var h=s[m];if(h.charAt(0)!=="."||u){var v;c&&!r?v=!h.match(a):v=h.match(a),v&&p.push(h)}}var b=p.length;if(b!==0){if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var m=0;m<b;m++){var h=p[m];r&&(r.slice(-1)!=="/"?h=r+"/"+h:h=r+h),h.charAt(0)==="/"&&!this.nomount&&(h=OO.join(this.root,h)),this._emitMatch(i,h)}return}n.shift();for(var m=0;m<b;m++){var h=p[m],w;r?w=[r,h]:w=[h],this._process(w.concat(n),i,o)}}}};Kn.prototype._emitMatch=function(r,e){if(!Bde(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0,this.stat&&this._stat(e)}}};Kn.prototype._readdirInGlobStar=function(r){if(this.follow)return this._readdir(r,!1);var e,t,n;try{t=this.fs.lstatSync(r)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[r]=i,!i&&t&&!t.isDirectory()?this.cache[r]="FILE":e=this._readdir(r,!1),e};Kn.prototype._readdir=function(r,e){var t;if(e&&!KO(this.symlinks,r))return this._readdirInGlobStar(r);if(KO(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return null;if(Array.isArray(n))return n}try{return this._readdirEntries(r,this.fs.readdirSync(r))}catch(i){return this._readdirError(r,i),null}};Kn.prototype._readdirEntries=function(r,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var n=e[t];r==="/"?n=r+n:n=r+"/"+n,this.cache[n]=!0}return this.cache[r]=e,e};Kn.prototype._readdirError=function(r,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(r);if(this.cache[t]="FILE",t===this.cwdAbs){var n=new Error(e.code+" invalid cwd "+this.cwd);throw n.path=this.cwd,n.code=e.code,n}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:if(this.cache[this._makeAbs(r)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};Kn.prototype._processGlobStar=function(r,e,t,n,i,o){var s=this._readdir(t,o);if(s){var a=n.slice(1),c=r?[r]:[],l=c.concat(a);this._process(l,i,!1);var u=s.length,p=this.symlinks[t];if(!(p&&o))for(var m=0;m<u;m++){var h=s[m];if(!(h.charAt(0)==="."&&!this.dot)){var v=c.concat(s[m],a);this._process(v,i,!0);var b=c.concat(s[m],n);this._process(b,i,!0)}}}};Kn.prototype._processSimple=function(r,e){var t=this._stat(r);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(r&&rD(r)&&!this.nomount){var n=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=OO.join(this.root,r):(r=OO.resolve(this.root,r),n&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r)}};Kn.prototype._stat=function(r){var e=this._makeAbs(r),t=r.slice(-1)==="/";if(r.length>this.maxLength)return!1;if(!this.stat&&KO(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var n,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};Kn.prototype._mark=function(r){return Nm.mark(this,r)};Kn.prototype._makeAbs=function(r){return Nm.makeAbs(this,r)}});var LO=N((TUe,h8)=>{h8.exports=f8;function f8(r,e){if(r&&e)return f8(r)(e);if(typeof r!="function")throw new TypeError("need wrapper function");return Object.keys(r).forEach(function(n){t[n]=r[n]}),t;function t(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];var o=r.apply(this,n),s=n[n.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var jO=N((RUe,UO)=>{var g8=LO();UO.exports=g8(nD);UO.exports.strict=g8(v8);nD.proto=nD(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return nD(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return v8(this)},configurable:!0})});function nD(r){var e=function(){return e.called?e.value:(e.called=!0,e.value=r.apply(this,arguments))};return e.called=!1,e}function v8(r){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=r.apply(this,arguments)},t=r.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var b8=N((AUe,y8)=>{var qde=LO(),Ax=Object.create(null),Jde=jO();y8.exports=qde($de);function $de(r,e){return Ax[r]?(Ax[r].push(e),null):(Ax[r]=[e],Hde(r))}function Hde(r){return Jde(function e(){var t=Ax[r],n=t.length,i=Gde(arguments);try{for(var o=0;o<n;o++)t[o].apply(null,i)}finally{t.length>n?(t.splice(0,n),process.nextTick(function(){e.apply(null,i)})):delete Ax[r]}})}function Gde(r){for(var e=r.length,t=[],n=0;n<e;n++)t[n]=r[n];return t}});var FO=N((OUe,S8)=>{S8.exports=Mm;var zde=_O(),I8=Ex(),NUe=I8.Minimatch,Qde=n8(),Yde=require("events").EventEmitter,WO=require("path"),VO=require("assert"),Nx=tD(),qO=m8(),Om=MO(),Xde=Om.setopts,BO=Om.ownProp,JO=b8(),MUe=require("util"),Zde=Om.childrenIgnored,eme=Om.isIgnored,tme=jO();function Mm(r,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return qO(r,e)}return new gr(r,e,t)}Mm.sync=qO;var rme=Mm.GlobSync=qO.GlobSync;Mm.glob=Mm;function nme(r,e){if(e===null||typeof e!="object")return r;for(var t=Object.keys(e),n=t.length;n--;)r[t[n]]=e[t[n]];return r}Mm.hasMagic=function(r,e){var t=nme({},e);t.noprocess=!0;var n=new gr(r,t),i=n.minimatch.set;if(!r)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Mm.Glob=gr;Qde(gr,Yde);function gr(r,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new rme(r,e)}if(!(this instanceof gr))return new gr(r,e,t);Xde(this,r,e),this._didRealPath=!1;var n=this.minimatch.set.length;this.matches=new Array(n),typeof t=="function"&&(t=tme(t),this.on("error",t),this.on("end",function(c){t(null,c)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(n===0)return a();for(var o=!0,s=0;s<n;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}gr.prototype._finish=function(){if(VO(this instanceof gr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Om.finish(this),this.emit("end",this.found)}};gr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var r=this.matches.length;if(r===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,n);function n(){--r===0&&e._finish()}};gr.prototype._realpathSet=function(r,e){var t=this.matches[r];if(!t)return e();var n=Object.keys(t),i=this,o=n.length;if(o===0)return e();var s=this.matches[r]=Object.create(null);n.forEach(function(a,c){a=i._makeAbs(a),zde.realpath(a,i.realpathCache,function(l,u){l?l.syscall==="stat"?s[a]=!0:i.emit("error",l):s[u]=!0,--o===0&&(i.matches[r]=s,e())})})};gr.prototype._mark=function(r){return Om.mark(this,r)};gr.prototype._makeAbs=function(r){return Om.makeAbs(this,r)};gr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};gr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};gr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var r=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<r.length;e++){var t=r[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var n=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<n.length;e++){var i=n[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};gr.prototype._process=function(r,e,t,n){if(VO(this instanceof gr),VO(typeof n=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([r,e,t,n]);return}for(var i=0;typeof r[i]=="string";)i++;var o;switch(i){case r.length:this._processSimple(r.join("/"),e,n);return;case 0:o=null;break;default:o=r.slice(0,i).join("/");break}var s=r.slice(i),a;o===null?a=".":((Nx(o)||Nx(r.join("/")))&&(!o||!Nx(o))&&(o="/"+o),a=o);var c=this._makeAbs(a);if(Zde(this,a))return n();var l=s[0]===I8.GLOBSTAR;l?this._processGlobStar(o,a,c,s,e,t,n):this._processReaddir(o,a,c,s,e,t,n)}};gr.prototype._processReaddir=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){return a._processReaddir2(r,e,t,n,i,o,l,s)})};gr.prototype._processReaddir2=function(r,e,t,n,i,o,s,a){if(!s)return a();for(var c=n[0],l=!!this.minimatch.negate,u=c._glob,p=this.dot||u.charAt(0)===".",m=[],h=0;h<s.length;h++){var v=s[h];if(v.charAt(0)!=="."||p){var b;l&&!r?b=!v.match(c):b=v.match(c),b&&m.push(v)}}var w=m.length;if(w===0)return a();if(n.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var h=0;h<w;h++){var v=m[h];r&&(r!=="/"?v=r+"/"+v:v=r+v),v.charAt(0)==="/"&&!this.nomount&&(v=WO.join(this.root,v)),this._emitMatch(i,v)}return a()}n.shift();for(var h=0;h<w;h++){var v=m[h],D;r&&(r!=="/"?v=r+"/"+v:v=r+v),this._process([v].concat(n),i,o,a)}a()};gr.prototype._emitMatch=function(r,e){if(!this.aborted&&!eme(this,e)){if(this.paused){this._emitQueue.push([r,e]);return}var t=Nx(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[r][e]){if(this.nodir){var n=this.cache[t];if(n==="DIR"||Array.isArray(n))return}this.matches[r][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};gr.prototype._readdirInGlobStar=function(r,e){if(this.aborted)return;if(this.follow)return this._readdir(r,!1,e);var t="lstat\0"+r,n=this,i=JO(t,o);i&&n.fs.lstat(r,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var c=a&&a.isSymbolicLink();n.symlinks[r]=c,!c&&a&&!a.isDirectory()?(n.cache[r]="FILE",e()):n._readdir(r,!1,e)}};gr.prototype._readdir=function(r,e,t){if(!this.aborted&&(t=JO("readdir\0"+r+"\0"+e,t),!!t)){if(e&&!BO(this.symlinks,r))return this._readdirInGlobStar(r,t);if(BO(this.cache,r)){var n=this.cache[r];if(!n||n==="FILE")return t();if(Array.isArray(n))return t(null,n)}var i=this;i.fs.readdir(r,ime(this,r,t))}};function ime(r,e,t){return function(n,i){n?r._readdirError(e,n,t):r._readdirEntries(e,i,t)}}gr.prototype._readdirEntries=function(r,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var i=e[n];r==="/"?i=r+i:i=r+"/"+i,this.cache[i]=!0}return this.cache[r]=e,t(null,e)}};gr.prototype._readdirError=function(r,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(r);if(this.cache[n]="FILE",n===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(r)]=!1;break;default:this.cache[this._makeAbs(r)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};gr.prototype._processGlobStar=function(r,e,t,n,i,o,s){var a=this;this._readdir(t,o,function(c,l){a._processGlobStar2(r,e,t,n,i,o,l,s)})};gr.prototype._processGlobStar2=function(r,e,t,n,i,o,s,a){if(!s)return a();var c=n.slice(1),l=r?[r]:[],u=l.concat(c);this._process(u,i,!1,a);var p=this.symlinks[t],m=s.length;if(p&&o)return a();for(var h=0;h<m;h++){var v=s[h];if(!(v.charAt(0)==="."&&!this.dot)){var b=l.concat(s[h],c);this._process(b,i,!0,a);var w=l.concat(s[h],n);this._process(w,i,!0,a)}}a()};gr.prototype._processSimple=function(r,e,t){var n=this;this._stat(r,function(i,o){n._processSimple2(r,e,i,o,t)})};gr.prototype._processSimple2=function(r,e,t,n,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!n)return i();if(r&&Nx(r)&&!this.nomount){var o=/[\/\\]$/.test(r);r.charAt(0)==="/"?r=WO.join(this.root,r):(r=WO.resolve(this.root,r),o&&(r+="/"))}process.platform==="win32"&&(r=r.replace(/\\/g,"/")),this._emitMatch(e,r),i()};gr.prototype._stat=function(r,e){var t=this._makeAbs(r),n=r.slice(-1)==="/";if(r.length>this.maxLength)return e();if(!this.stat&&BO(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!n||i==="DIR")return e(null,i);if(n&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return n&&a==="FILE"?e():e(null,a,s)}var c=this,l=JO("stat\0"+t,u);l&&c.fs.lstat(t,l);function u(p,m){if(m&&m.isSymbolicLink())return c.fs.stat(t,function(h,v){h?c._stat2(r,t,null,m,e):c._stat2(r,t,h,v,e)});c._stat2(r,t,p,m,e)}};gr.prototype._stat2=function(r,e,t,n,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=r.slice(-1)==="/";if(this.statCache[e]=n,e.slice(-1)==="/"&&n&&!n.isDirectory())return i(null,!1,n);var s=!0;return n&&(s=n.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,n)}});var w8=N((KUe,C8)=>{"use strict";var x8=process.platform==="win32",ome=x8?/[^:]\\$/:/.\/$/;C8.exports=function(){var r;return x8?r=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":r=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",ome.test(r)&&(r=r.slice(0,-1)),r}});var L8=N((FUe,Hl)=>{var yo=require("fs"),$O=require("path"),E8=require("crypto"),sme=w8(),Mx=require("constants"),HO=sme(),P8="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",GO=/XXXXXX/,D8=3,_8=Mx.O_CREAT|Mx.O_EXCL|Mx.O_RDWR,T8=448,R8=384,Iv=[],A8=!1,zO=!1;function k8(r){var e=[],t=null;try{t=E8.randomBytes(r)}catch{t=E8.pseudoRandomBytes(r)}for(var n=0;n<r;n++)e.push(P8[t[n]%P8.length]);return e.join("")}function ame(r){return typeof r>"u"}function Sv(r,e){if(typeof r=="function"){var t=r;r=e||{},e=t}else typeof r>"u"&&(r={});return[r,e]}function N8(r){if(r.name)return $O.join(r.dir||HO,r.name);if(r.template)return r.template.replace(GO,k8(6));var e=[r.prefix||"tmp-",process.pid,k8(12),r.postfix||""].join("");return $O.join(r.dir||HO,e)}function QO(r,e){var t=Sv(r,e),n=t[0],i=t[1],o=n.tries||D8;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(n.template&&!n.template.match(GO))return i(new Error("Invalid template provided"));(function s(){var a=N8(n);yo.stat(a,function(c){if(!c)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function YO(r){var e=Sv(r),t=e[0],n=t.tries||D8;if(isNaN(n)||n<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(GO))throw new Error("Invalid template provided");do{var i=N8(t);try{yo.statSync(i)}catch{return i}}while(n-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function cme(r,e){var t=Sv(r,e),n=t[0],i=t[1];n.postfix=ame(n.postfix)?".tmp":n.postfix,QO(n,function(s,a){if(s)return i(s);yo.open(a,_8,n.mode||R8,function(l,u){if(l)return i(l);i(null,a,u,M8(a,u,n))})})}function lme(r){var e=Sv(r),t=e[0];t.postfix=t.postfix||".tmp";var n=YO(t),i=yo.openSync(n,_8,t.mode||R8);return{name:n,fd:i,removeCallback:M8(n,i,t)}}function ume(r){var e=[r];do{for(var t=e.pop(),n=!1,i=yo.readdirSync(t),o=0,s=i.length;o<s;o++){var a=$O.join(t,i[o]),c=yo.lstatSync(a);c.isDirectory()?(n||(n=!0,e.push(t)),e.push(a)):yo.unlinkSync(a)}n||yo.rmdirSync(t)}while(e.length!==0)}function pme(r,e){var t=Sv(r,e),n=t[0],i=t[1];QO(n,function(s,a){if(s)return i(s);yo.mkdir(a,n.mode||T8,function(l){if(l)return i(l);i(null,a,O8(a,n))})})}function dme(r){var e=Sv(r),t=e[0],n=YO(t);return yo.mkdirSync(n,t.mode||T8),{name:n,removeCallback:O8(n,t)}}function M8(r,e,t){var n=K8(function(o){try{yo.closeSync(o[0])}catch(s){if(s.errno!=-Mx.EBADF&&s.errno!=-Mx.ENOENT)throw s}yo.unlinkSync(o[1])},[e,r]);return t.keep||Iv.unshift(n),n}function O8(r,e){var t=e.unsafeCleanup?ume:yo.rmdirSync.bind(yo),n=K8(t,r);return e.keep||Iv.unshift(n),n}function K8(r,e){var t=!1;return function n(){if(!t){var i=Iv.indexOf(n);i>=0&&Iv.splice(i,1),t=!0,r(e)}}}function F8(){if(!(zO&&!A8))for(var r=0,e=Iv.length;r<e;r++)try{Iv[r].call(null)}catch{}}function mme(){A8=!0}var iD=process.versions.node.split(".").map(function(r){return parseInt(r,10)});iD[0]===0&&(iD[1]<9||iD[1]===9&&iD[2]<5)&&process.addListener("uncaughtException",function(e){throw zO=!0,F8(),e});process.addListener("exit",function(e){e&&(zO=!0),F8()});Hl.exports.tmpdir=HO;Hl.exports.dir=pme;Hl.exports.dirSync=dme;Hl.exports.file=cme;Hl.exports.fileSync=lme;Hl.exports.tmpName=QO;Hl.exports.tmpNameSync=YO;Hl.exports.setGracefulCleanup=mme});var j8=N((Km,U8)=>{var Ox=require("node-fetch"),fme=Ox.default||Ox,oD=function(r,e){return/^\/\//.test(r)&&(r="https:"+r),fme.call(this,r,e)};oD.ponyfill=!0;U8.exports=Km=oD;Km.fetch=oD;Km.Headers=Ox.Headers;Km.Request=Ox.Request;Km.Response=Ox.Response;Km.default=oD});var E7=N((Oqe,w7)=>{var kme=require("crypto");w7.exports=function(){return kme.randomBytes(16)}});var D7=N((Kqe,k7)=>{var P7=[];for(Jx=0;Jx<256;++Jx)P7[Jx]=(Jx+256).toString(16).substr(1);var Jx;function Dme(r,e){var t=e||0,n=P7;return[n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],"-",n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]],n[r[t++]]].join("")}k7.exports=Dme});var Io=N((Fqe,_7)=>{var _me=E7(),Tme=D7();function Rme(r,e,t){var n=e&&t||0;typeof r=="string"&&(e=r==="binary"?new Array(16):null,r=null),r=r||{};var i=r.random||(r.rng||_me)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[n+o]=i[o];return e||Tme(i)}_7.exports=Rme});var O7=N((MJe,M7)=>{"use strict";function Qm(r){if(!(this instanceof Qm))return new Qm(r);r=r||{},this.concurrency=r.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Mme.bind(this)}var Nme=["push","unshift","splice"];Nme.forEach(function(r){Qm.prototype[r]=function(){var e=Array.prototype[r].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(Qm.prototype,"length",{get:function(){return this.pending+this.jobs.length}});Qm.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var r=this.jobs.shift();this.pending++,r(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};Qm.prototype.onDone=function(r){typeof r=="function"&&(this.cbs.push(r),this._run())};function Mme(){this.pending--,this._run()}M7.exports=Qm});var Ym=N((OJe,K7)=>{"use strict";K7.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var X7=N((KJe,Y7)=>{var j7=require("fs"),eu=require("path"),W7=require("os"),V7=typeof __webpack_require__=="function"?__non_webpack_require__:require,Ome=process.config&&process.config.variables||{},Kme=!!process.env.PREBUILDS_ONLY,F7=process.versions.modules,fK=Ume()?"electron":Lme()?"node-webkit":"node",hK=process.env.npm_config_arch||W7.arch(),gK=process.env.npm_config_platform||W7.platform(),B7=process.env.LIBC||(jme(gK)?"musl":"glibc"),vK=process.env.ARM_VERSION||(hK==="arm64"?"8":Ome.arm_version)||"",q7=(process.versions.uv||"").split(".")[0];Y7.exports=Jc;function Jc(r){return V7(Jc.resolve(r))}Jc.resolve=Jc.path=function(r){r=eu.resolve(r||".");try{var e=V7(eu.join(r,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(r=process.env[e+"_PREBUILD"])}catch{}if(!Kme){var t=L7(eu.join(r,"build/Release"),U7);if(t)return t;var n=L7(eu.join(r,"build/Debug"),U7);if(n)return n}var i=a(r);if(i)return i;var o=a(eu.dirname(process.execPath));if(o)return o;var s=["platform="+gK,"arch="+hK,"runtime="+fK,"abi="+F7,"uv="+q7,vK?"armv="+vK:"","libc="+B7,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+r+`
`);function a(c){var l=yK(eu.join(c,"prebuilds")).map(J7),u=l.filter($7(gK,hK)).sort(H7)[0];if(u){var p=eu.join(c,"prebuilds",u.name),m=yK(p).map(G7),h=m.filter(z7(fK,F7)),v=h.sort(Q7(fK))[0];if(v)return eu.join(p,v.file)}}};function yK(r){try{return j7.readdirSync(r)}catch{return[]}}function L7(r,e){var t=yK(r).filter(e);return t[0]&&eu.join(r,t[0])}function U7(r){return/\.node$/.test(r)}function J7(r){var e=r.split("-");if(e.length===2){var t=e[0],n=e[1].split("+");if(t&&n.length&&n.every(Boolean))return{name:r,platform:t,architectures:n}}}function $7(r,e){return function(t){return t==null||t.platform!==r?!1:t.architectures.includes(e)}}function H7(r,e){return r.architectures.length-e.architectures.length}function G7(r){var e=r.split("."),t=e.pop(),n={file:r,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")n.runtime=o;else if(o==="napi")n.napi=!0;else if(o.slice(0,3)==="abi")n.abi=o.slice(3);else if(o.slice(0,2)==="uv")n.uv=o.slice(2);else if(o.slice(0,4)==="armv")n.armv=o.slice(4);else if(o==="glibc"||o==="musl")n.libc=o;else continue;n.specificity++}return n}}function z7(r,e){return function(t){return!(t==null||t.runtime!==r&&!Fme(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==q7||t.armv&&t.armv!==vK||t.libc&&t.libc!==B7)}}function Fme(r){return r.runtime==="node"&&r.napi}function Q7(r){return function(e,t){return e.runtime!==t.runtime?e.runtime===r?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function Lme(){return!!(process.versions&&process.versions.nw)}function Ume(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function jme(r){return r==="linux"&&j7.existsSync("/etc/alpine-release")}Jc.parseTags=G7;Jc.matchTags=z7;Jc.compareTags=Q7;Jc.parseTuple=J7;Jc.matchTuple=$7;Jc.compareTuples=H7});var IK=N((FJe,bK)=>{typeof process.addon=="function"?bK.exports=process.addon.bind(process):bK.exports=X7()});var e$=N((LJe,Z7)=>{"use strict";var Wme=(r,e,t,n,i)=>{for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]},Vme=(r,e)=>{let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]};Z7.exports={mask:Wme,unmask:Vme}});var t$=N((UJe,SK)=>{"use strict";try{SK.exports=IK()(__dirname)}catch{SK.exports=e$()}});var AD=N((jJe,xK)=>{"use strict";var{EMPTY_BUFFER:Bme}=Ym();function r$(r,e){if(r.length===0)return Bme;if(r.length===1)return r[0];let t=Buffer.allocUnsafe(e);for(var n=0,i=0;i<r.length;i++){let o=r[i];o.copy(t,n),n+=o.length}return t}function n$(r,e,t,n,i){for(var o=0;o<i;o++)t[n+o]=r[o]^e[o&3]}function i$(r,e){let t=r.length;for(var n=0;n<t;n++)r[n]^=e[n&3]}function o$(r){return r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}function RD(r){if(RD.readOnly=!0,Buffer.isBuffer(r))return r;var e;return r instanceof ArrayBuffer?e=Buffer.from(r):ArrayBuffer.isView(r)?e=qme(r):(e=Buffer.from(r),RD.readOnly=!1),e}function qme(r){let e=Buffer.from(r.buffer);return r.byteLength!==r.buffer.byteLength?e.slice(r.byteOffset,r.byteOffset+r.byteLength):e}try{let r=t$(),e=r.BufferUtil||r;xK.exports={concat:r$,mask(t,n,i,o,s){s<48?n$(t,n,i,o,s):e.mask(t,n,i,o,s)},toArrayBuffer:o$,toBuffer:RD,unmask(t,n){t.length<32?i$(t,n):e.unmask(t,n)}}}catch{xK.exports={concat:r$,mask:n$,toArrayBuffer:o$,toBuffer:RD,unmask:i$}}});var zx=N((WJe,u$)=>{"use strict";var Jme=O7(),Gx=require("zlib"),s$=AD(),{kStatusCode:a$,NOOP:$me}=Ym(),Hme=Buffer.from([0,0,255,255]),Gme=Buffer.from([0]),MD=Symbol("permessage-deflate"),tu=Symbol("total-length"),c$=Symbol("callback"),Qp=Symbol("buffers"),CK=Symbol("error"),ND,wK=class{constructor(e,t,n){if(this._maxPayload=n|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!ND){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;ND=new Jme({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,n=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(n.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?n.client_max_window_bits=t.clientMaxWindowBits:(n.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(n=>{var i=t[n];if(i.length>1)throw new Error(`Parameter "${n}" must have only a single value`);if(i=i[0],n==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else if(n==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${n}": ${i}`);i=o}else if(n==="client_no_context_takeover"||n==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${n}": ${i}`)}else throw new Error(`Unknown parameter "${n}"`);t[n]=i})}),e}decompress(e,t,n){ND.push(i=>{this._decompress(e,t,(o,s)=>{i(),n(o,s)})})}compress(e,t,n){ND.push(i=>{this._compress(e,t,(o,s)=>{i(),n(o,s)})})}_decompress(e,t,n){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Gx.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=Gx.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[MD]=this,this._inflate[tu]=0,this._inflate[Qp]=[],this._inflate.on("error",Qme),this._inflate.on("data",l$)}this._inflate[c$]=n,this._inflate.write(e),t&&this._inflate.write(Hme),this._inflate.flush(()=>{let o=this._inflate[CK];if(o){this._inflate.close(),this._inflate=null,n(o);return}let s=s$.concat(this._inflate[Qp],this._inflate[tu]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[tu]=0,this._inflate[Qp]=[]),n(null,s)})}_compress(e,t,n){if(!e||e.length===0){process.nextTick(n,null,Gme);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?Gx.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=Gx.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[tu]=0,this._deflate[Qp]=[],this._deflate.on("error",$me),this._deflate.on("data",zme)}this._deflate.write(e),this._deflate.flush(Gx.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=s$.concat(this._deflate[Qp],this._deflate[tu]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[tu]=0,this._deflate[Qp]=[]),n(null,o)}})}};u$.exports=wK;function zme(r){this[Qp].push(r),this[tu]+=r.length}function l$(r){if(this[tu]+=r.length,this[MD]._maxPayload<1||this[tu]<=this[MD]._maxPayload){this[Qp].push(r);return}this[CK]=new RangeError("Max payload size exceeded"),this[CK][a$]=1009,this.removeListener("data",l$),this.reset()}function Qme(r){this[MD]._inflate=null,r[a$]=1007,this[c$](r)}});var d$=N((VJe,p$)=>{"use strict";var ey=class{constructor(e,t){this.target=t,this.type=e}},EK=class extends ey{constructor(e,t){super("message",t),this.data=e}},PK=class extends ey{constructor(e,t,n){super("close",n),this.wasClean=n._closeFrameReceived&&n._closeFrameSent,this.reason=t,this.code=e}},kK=class extends ey{constructor(e){super("open",e)}},DK=class extends ey{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},Yme={addEventListener(r,e){if(typeof e!="function")return;function t(s){e.call(this,new EK(s,this))}function n(s,a){e.call(this,new PK(s,a,this))}function i(s){e.call(this,new DK(s,this))}function o(){e.call(this,new kK(this))}r==="message"?(t._listener=e,this.on(r,t)):r==="close"?(n._listener=e,this.on(r,n)):r==="error"?(i._listener=e,this.on(r,i)):r==="open"?(o._listener=e,this.on(r,o)):this.on(r,e)},removeEventListener(r,e){let t=this.listeners(r);for(var n=0;n<t.length;n++)(t[n]===e||t[n]._listener===e)&&this.removeListener(r,t[n])}};p$.exports=Yme});var _K=N((BJe,m$)=>{"use strict";var Qx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function $c(r,e,t){Object.prototype.hasOwnProperty.call(r,e)?r[e].push(t):r[e]=[t]}function Xme(r){let e={};if(r===void 0||r==="")return e;for(var t={},n=!1,i=!1,o=!1,s,a,c=-1,l=-1,u=0;u<r.length;u++){let h=r.charCodeAt(u);if(s===void 0)if(l===-1&&Qx[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);let v=r.slice(c,l);h===44?($c(e,v,t),t={}):s=v,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(l===-1&&Qx[h]===1)c===-1&&(c=u);else if(h===32||h===9)l===-1&&c!==-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u),$c(t,r.slice(c,l),!0),h===44&&($c(e,s,t),t={},s=void 0),c=l=-1}else if(h===61&&c!==-1&&l===-1)a=r.slice(c,u),c=l=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(Qx[h]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1?c=u:n||(n=!0),i=!1}else if(o)if(Qx[h]===1)c===-1&&(c=u);else if(h===34&&c!==-1)o=!1,l=u;else if(h===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(h===34&&r.charCodeAt(u-1)===61)o=!0;else if(l===-1&&Qx[h]===1)c===-1&&(c=u);else if(c!==-1&&(h===32||h===9))l===-1&&(l=u);else if(h===59||h===44){if(c===-1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1&&(l=u);var p=r.slice(c,l);n&&(p=p.replace(/\\/g,""),n=!1),$c(t,a,p),h===44&&($c(e,s,t),t={},s=void 0),a=void 0,c=l=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(c===-1||o)throw new SyntaxError("Unexpected end of input");l===-1&&(l=u);let m=r.slice(c,l);return s===void 0?$c(e,m,{}):(a===void 0?$c(t,m,!0):n?$c(t,a,m.replace(/\\/g,"")):$c(t,a,m),$c(e,s,t)),e}function Zme(r){return Object.keys(r).map(e=>{var t=r[e];return Array.isArray(t)||(t=[t]),t.map(n=>[e].concat(Object.keys(n).map(i=>{var o=n[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}m$.exports={format:Zme,parse:Xme}});var h$=N((qJe,f$)=>{"use strict";function efe(r){let e=r.length,t=0;for(;t<e;)if(!(r[t]&128))t++;else if((r[t]&224)===192){if(t+1===e||(r[t+1]&192)!==128||(r[t]&254)===192)return!1;t+=2}else if((r[t]&240)===224){if(t+2>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||r[t]===224&&(r[t+1]&224)===128||r[t]===237&&(r[t+1]&224)===160)return!1;t+=3}else if((r[t]&248)===240){if(t+3>=e||(r[t+1]&192)!==128||(r[t+2]&192)!==128||(r[t+3]&192)!==128||r[t]===240&&(r[t+1]&240)===128||r[t]===244&&r[t+1]>143||r[t]>244)return!1;t+=4}else return!1;return!0}f$.exports=efe});var g$=N((JJe,TK)=>{"use strict";try{TK.exports=IK()(__dirname)}catch{TK.exports=h$()}});var RK=N(OD=>{"use strict";try{let r=g$();OD.isValidUTF8=typeof r=="object"?r.Validation.isValidUTF8:r}catch{OD.isValidUTF8=()=>!0}OD.isValidStatusCode=r=>r>=1e3&&r<=1013&&r!==1004&&r!==1005&&r!==1006||r>=3e3&&r<=4999});var OK=N((HJe,x$)=>{"use strict";var{Writable:tfe}=require("stream"),v$=zx(),{BINARY_TYPES:rfe,EMPTY_BUFFER:nfe,kStatusCode:ife,kWebSocket:ofe}=Ym(),{concat:AK,toArrayBuffer:sfe,unmask:afe}=AD(),{isValidStatusCode:cfe,isValidUTF8:y$}=RK(),Yx=0,b$=1,I$=2,S$=3,NK=4,lfe=5,MK=class extends tfe{constructor(e,t,n){super(),this._binaryType=e||rfe[0],this[ofe]=void 0,this._extensions=t||{},this._maxPayload=n|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=Yx,this._loop=!1}_write(e,t,n){if(this._opcode===8&&this._state==Yx)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let n=this._buffers[0];return this._buffers[0]=n.slice(e),n.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0];e>=n.length?this._buffers.shift().copy(t,t.length-e):(n.copy(t,t.length-e,0,e),this._buffers[0]=n.slice(e)),e-=n.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case Yx:t=this.getInfo();break;case b$:t=this.getPayloadLength16();break;case I$:t=this.getPayloadLength64();break;case S$:this.getMask();break;case NK:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if(e[0]&48)return this._loop=!1,pi(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[v$.extensionName])return this._loop=!1,pi(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,pi(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,pi(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,pi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,pi(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,pi(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,pi(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,pi(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=b$;else if(this._payloadLength===127)this._state=I$;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,53-32)-1?(this._loop=!1,pi(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,pi(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=S$:this._state=NK}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=NK}getData(e){var t=nfe;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&afe(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=lfe,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[v$.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(pi(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=AK(n,t):this._binaryType==="arraybuffer"?e=sfe(AK(n,t)):e=n,this.emit("message",e)}else{let i=AK(n,t);if(!y$(i))return this._loop=!1,pi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=Yx}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return pi(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!cfe(t))return pi(RangeError,`invalid status code ${t}`,!0,1002);let n=e.slice(2);if(!y$(n))return pi(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,n.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=Yx}};x$.exports=MK;function pi(r,e,t,n){let i=new r(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,pi),i[ife]=n,i}});var FK=N((GJe,E$)=>{"use strict";var{randomBytes:ufe}=require("crypto"),C$=zx(),{EMPTY_BUFFER:pfe}=Ym(),{isValidStatusCode:dfe}=RK(),{mask:w$,toBuffer:ru}=AD(),KK=class r{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let n=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(n?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=ufe(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],n?(w$(e,a,s,i,e.length),[s]):(w$(e,a,e,0,e.length),[s,e])}close(e,t,n,i){var o;if(e===void 0)o=pfe;else{if(typeof e!="number"||!dfe(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,n,i]):this.doClose(o,n,i)}doClose(e,t,n){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),n)}ping(e,t,n){let i=ru(e);this._deflating?this.enqueue([this.doPing,i,t,ru.readOnly,n]):this.doPing(i,t,ru.readOnly,n)}doPing(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:n}),i)}pong(e,t,n){let i=ru(e);this._deflating?this.enqueue([this.doPong,i,t,ru.readOnly,n]):this.doPong(i,t,ru.readOnly,n)}doPong(e,t,n,i){this.sendFrame(r.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:n}),i)}send(e,t,n){let i=ru(e),o=this._extensions[C$.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let c={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:ru.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,c,n]):this.dispatch(i,this._compress,c,n)}else this.sendFrame(r.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:ru.readOnly}),n)}dispatch(e,t,n,i){if(!t){this.sendFrame(r.frame(e,n),i);return}let o=this._extensions[C$.extensionName];this._deflating=!0,o.compress(e,n.fin,(s,a)=>{this._deflating=!1,n.readOnly=!1,this.sendFrame(r.frame(a,n),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};E$.exports=KK});var jK=N((zJe,K$)=>{"use strict";var mfe=require("events"),P$=require("crypto"),ffe=require("https"),hfe=require("http"),gfe=require("net"),vfe=require("tls"),ty=require("url"),Yp=zx(),T$=d$(),k$=_K(),yfe=OK(),bfe=FK(),{BINARY_TYPES:D$,EMPTY_BUFFER:LK,GUID:Ife,kStatusCode:Sfe,kWebSocket:xo,NOOP:R$}=Ym(),KD=["CONNECTING","OPEN","CLOSING","CLOSED"],UK=[8,13],xfe=30*1e3,Co=class r extends mfe{constructor(e,t,n){super(),this.readyState=r.CONNECTING,this.protocol="",this._binaryType=D$[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(n=t,t=void 0),A$(this,e,t,n)):this._isServer=!0}get CONNECTING(){return r.CONNECTING}get CLOSING(){return r.CLOSING}get CLOSED(){return r.CLOSED}get OPEN(){return r.OPEN}get binaryType(){return this._binaryType}set binaryType(e){D$.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,n){let i=new yfe(this._binaryType,this._extensions,n);this._sender=new bfe(e,this._extensions),this._receiver=i,this._socket=e,i[xo]=this,e[xo]=this,i.on("conclude",Efe),i.on("drain",Pfe),i.on("error",kfe),i.on("message",Dfe),i.on("ping",_fe),i.on("pong",Tfe),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",N$),e.on("data",FD),e.on("end",M$),e.on("error",O$),this.readyState=r.OPEN,this.emit("open")}emitClose(){if(this.readyState=r.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[Yp.extensionName]&&this._extensions[Yp.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let n="WebSocket was closed before the connection was established";return nu(this,this._req,n)}if(this.readyState===r.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=r.CLOSING,this._sender.close(e,t,!this._isServer,n=>{n||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),xfe)}}ping(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${KD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||LK,t,n)}pong(e,t,n){if(typeof e=="function"?(n=e,e=t=void 0):typeof t=="function"&&(n=t,t=void 0),this.readyState!==r.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${KD[this.readyState]})`);if(n)return n(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||LK,t,n)}send(e,t,n){if(typeof t=="function"&&(n=t,t={}),this.readyState!==r.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${KD[this.readyState]})`);if(n)return n(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[Yp.extensionName]||(i.compress=!1),this._sender.send(e||LK,i,n)}terminate(){if(this.readyState!==r.CLOSED){if(this.readyState===r.CONNECTING){let e="WebSocket was closed before the connection was established";return nu(this,this._req,e)}this._socket&&(this.readyState=r.CLOSING,this._socket.destroy())}}};KD.forEach((r,e)=>{Co[r]=e});["open","error","close","message"].forEach(r=>{Object.defineProperty(Co.prototype,`on${r}`,{get(){let e=this.listeners(r);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(r);for(var n=0;n<t.length;n++)t[n]._listener&&this.removeListener(r,t[n]);this.addEventListener(r,e)}})});Co.prototype.addEventListener=T$.addEventListener;Co.prototype.removeEventListener=T$.removeEventListener;K$.exports=Co;function A$(r,e,t,n){let i=Object.assign({protocolVersion:UK[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},n,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!UK.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${UK.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,r.url=e.href):(o=ty.URL?new ty.URL(e):ty.parse(e),r.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${r.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",c=a?443:80,l=P$.randomBytes(16).toString("base64"),u=a?ffe.get:hfe.get,p=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var m;if(i.createConnection=a?wfe:Cfe,i.defaultPort=i.defaultPort||c,i.port=o.port||c,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":l,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=p,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(m=new Yp(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=k$.format({[Yp.extensionName]:m.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let v=p.split(":");i.socketPath=v[0],i.path=v[1]}var h=r._req=u(i);i.timeout&&h.on("timeout",()=>{nu(r,h,"Opening handshake has timed out")}),h.on("error",v=>{r._req.aborted||(h=r._req=null,r.readyState=Co.CLOSING,r.emit("error",v),r.emitClose())}),h.on("response",v=>{let b=v.headers.location,w=v.statusCode;if(b&&i.followRedirects&&w>=300&&w<400){if(++r._redirects>i.maxRedirects){nu(r,h,"Maximum redirects exceeded");return}h.abort();let D=ty.URL?new ty.URL(b,e):ty.resolve(e,b);A$(r,D,t,n)}else r.emit("unexpected-response",h,v)||nu(r,h,`Unexpected server response: ${v.statusCode}`)}),h.on("upgrade",(v,b,w)=>{if(r.emit("upgrade",v),r.readyState!==Co.CONNECTING)return;h=r._req=null;let D=P$.createHash("sha1").update(l+Ife).digest("base64");if(v.headers["sec-websocket-accept"]!==D){nu(r,b,"Invalid Sec-WebSocket-Accept header");return}let T=v.headers["sec-websocket-protocol"],F=(t||"").split(/, */);var ee;if(!t&&T?ee="Server sent a subprotocol but none was requested":t&&!T?ee="Server sent no subprotocol":T&&!F.includes(T)&&(ee="Server sent an invalid subprotocol"),ee){nu(r,b,ee);return}if(T&&(r.protocol=T),m)try{let de=k$.parse(v.headers["sec-websocket-extensions"]);de[Yp.extensionName]&&(m.accept(de[Yp.extensionName]),r._extensions[Yp.extensionName]=m)}catch{nu(r,b,"Invalid Sec-WebSocket-Extensions header");return}r.setSocket(b,w,i.maxPayload)})}function Cfe(r){return r.protocolVersion&&(r.path=r.socketPath),gfe.connect(r)}function wfe(r){return r.path=void 0,r.servername=r.servername||r.host,vfe.connect(r)}function nu(r,e,t){r.readyState=Co.CLOSING;let n=new Error(t);Error.captureStackTrace(n,nu),e.setHeader?(e.abort(),e.once("abort",r.emitClose.bind(r)),r.emit("error",n)):(e.destroy(n),e.once("error",r.emit.bind(r,"error")),e.once("close",r.emitClose.bind(r)))}function Efe(r,e){let t=this[xo];t._socket.removeListener("data",FD),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=r,r===1005?t.close():t.close(r,e)}function Pfe(){this[xo]._socket.resume()}function kfe(r){let e=this[xo];e._socket.removeListener("data",FD),e.readyState=Co.CLOSING,e._closeCode=r[Sfe],e.emit("error",r),e._socket.destroy()}function _$(){this[xo].emitClose()}function Dfe(r){this[xo].emit("message",r)}function _fe(r){let e=this[xo];e.pong(r,!e._isServer,R$),e.emit("ping",r)}function Tfe(r){this[xo].emit("pong",r)}function N$(){let r=this[xo];this.removeListener("close",N$),this.removeListener("end",M$),r.readyState=Co.CLOSING,r._socket.read(),r._receiver.end(),this.removeListener("data",FD),this[xo]=void 0,clearTimeout(r._closeTimer),r._receiver._writableState.finished||r._receiver._writableState.errorEmitted?r.emitClose():(r._receiver.on("error",_$),r._receiver.on("finish",_$))}function FD(r){this[xo]._receiver.write(r)||this.pause()}function M$(){let r=this[xo];r.readyState=Co.CLOSING,r._receiver.end(),this.end()}function O$(){let r=this[xo];this.removeListener("error",O$),this.on("error",R$),r.readyState=Co.CLOSING,this.destroy()}});var U$=N((QJe,L$)=>{"use strict";var Rfe=require("events"),Afe=require("crypto"),UD=require("http"),Xm=zx(),F$=_K(),Nfe=jK(),{GUID:Mfe}=Ym(),Ofe=/^[+/0-9A-Za-z]{22}==$/,WK=class extends Rfe{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=UD.createServer((n,i)=>{let o=UD.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=Kfe(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,o)=>{this.handleUpgrade(n,i,o,s=>{this.emit("connection",s,n)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let n of this.clients)n.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(Ffe,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",VK);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=+e.headers["sec-websocket-version"],a={};if(e.method!=="GET"||e.headers.upgrade.toLowerCase()!=="websocket"||!o||!Ofe.test(o)||s!==8&&s!==13||!this.shouldHandle(e))return LD(t,400);if(this.options.perMessageDeflate){let c=new Xm(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let l=F$.parse(e.headers["sec-websocket-extensions"]);l[Xm.extensionName]&&(c.accept(l[Xm.extensionName]),a[Xm.extensionName]=c)}catch{return LD(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${s===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(l,u,p,m)=>{if(!l)return LD(t,u||401,p,m);this.completeUpgrade(o,a,e,t,n,i)});return}if(!this.options.verifyClient(c))return LD(t,401)}this.completeUpgrade(o,a,e,t,n,i)}completeUpgrade(e,t,n,i,o,s){if(!i.readable||!i.writable)return i.destroy();let c=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Afe.createHash("sha1").update(e+Mfe).digest("base64")}`],l=new Nfe(null);var u=n.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(Lfe),this.options.handleProtocols?u=this.options.handleProtocols(u,n):u=u[0],u&&(c.push(`Sec-WebSocket-Protocol: ${u}`),l.protocol=u)),t[Xm.extensionName]){let p=t[Xm.extensionName].params,m=F$.format({[Xm.extensionName]:[p]});c.push(`Sec-WebSocket-Extensions: ${m}`),l._extensions=t}this.emit("headers",c,n),i.write(c.concat(`\r
`).join(`\r
`)),i.removeListener("error",VK),l.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(l),l.on("close",()=>this.clients.delete(l))),s(l)}};L$.exports=WK;function Kfe(r,e){for(let t of Object.keys(e))r.on(t,e[t]);return function(){for(let n of Object.keys(e))r.removeListener(n,e[n])}}function Ffe(r){r.emit("close")}function VK(){this.destroy()}function LD(r,e,t,n){r.writable&&(t=t||UD.STATUS_CODES[e],n=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},n),r.write(`HTTP/1.1 ${e} ${UD.STATUS_CODES[e]}\r
`+Object.keys(n).map(i=>`${i}: ${n[i]}`).join(`\r
`)+`\r
\r
`+t)),r.removeListener("error",VK),r.destroy()}function Lfe(r){return r.trim()}});var W$=N((YJe,j$)=>{"use strict";var jD=jK();jD.Server=U$();jD.Receiver=OK();jD.Sender=FK();j$.exports=jD});var B$=N((XJe,V$)=>{"use strict";V$.exports=W$()});var Q$=N((JD,z$)=>{(function(r,e){typeof JD=="object"&&typeof z$<"u"?e(JD):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_algorithm={}))})(JD,function(r){"use strict";r.ArrayExt=void 0,function(L){function W(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(te===0)return-1;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);var ke;q<B?ke=q+1+(te-B):ke=q-B+1;for(var Le=0;Le<ke;++Le){var ur=(B+Le)%te;if(ie[ur]===me)return ur}return-1}L.firstIndexOf=W;function be(ie,me,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var te=ie.length;if(te===0)return-1;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);var ke;B<q?ke=B+1+(te-q):ke=B-q+1;for(var Le=0;Le<ke;++Le){var ur=(B-Le+te)%te;if(ie[ur]===me)return ur}return-1}L.lastIndexOf=be;function Ne(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(te===0)return-1;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);var ke;q<B?ke=q+1+(te-B):ke=q-B+1;for(var Le=0;Le<ke;++Le){var ur=(B+Le)%te;if(me(ie[ur],ur))return ur}return-1}L.findFirstIndex=Ne;function nt(ie,me,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var te=ie.length;if(te===0)return-1;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);var ke;B<q?ke=B+1+(te-q):ke=B-q+1;for(var Le=0;Le<ke;++Le){var ur=(B-Le+te)%te;if(me(ie[ur],ur))return ur}return-1}L.findLastIndex=nt;function tn(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=Ne(ie,me,B,q);return te!==-1?ie[te]:void 0}L.findFirstValue=tn;function Ht(ie,me,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var te=nt(ie,me,B,q);return te!==-1?ie[te]:void 0}L.findLastValue=Ht;function jt(ie,me,B,q,te){q===void 0&&(q=0),te===void 0&&(te=-1);var ke=ie.length;if(ke===0)return 0;q<0?q=Math.max(0,q+ke):q=Math.min(q,ke-1),te<0?te=Math.max(0,te+ke):te=Math.min(te,ke-1);for(var Le=q,ur=te-q+1;ur>0;){var yi=ur>>1,Il=Le+yi;B(ie[Il],me)<0?(Le=Il+1,ur-=yi+1):ur=yi}return Le}L.lowerBound=jt;function Mt(ie,me,B,q,te){q===void 0&&(q=0),te===void 0&&(te=-1);var ke=ie.length;if(ke===0)return 0;q<0?q=Math.max(0,q+ke):q=Math.min(q,ke-1),te<0?te=Math.max(0,te+ke):te=Math.min(te,ke-1);for(var Le=q,ur=te-q+1;ur>0;){var yi=ur>>1,Il=Le+yi;B(ie[Il],me)>0?ur=yi:(Le=Il+1,ur-=yi+1)}return Le}L.upperBound=Mt;function xr(ie,me,B){if(ie===me)return!0;if(ie.length!==me.length)return!1;for(var q=0,te=ie.length;q<te;++q)if(B?!B(ie[q],me[q]):ie[q]!==me[q])return!1;return!0}L.shallowEqual=xr;function Wr(ie,me){me===void 0&&(me={});var B=me.start,q=me.stop,te=me.step;if(te===void 0&&(te=1),te===0)throw new Error("Slice `step` cannot be zero.");var ke=ie.length;B===void 0?B=te<0?ke-1:0:B<0?B=Math.max(B+ke,te<0?-1:0):B>=ke&&(B=te<0?ke-1:ke),q===void 0?q=te<0?-1:ke:q<0?q=Math.max(q+ke,te<0?-1:0):q>=ke&&(q=te<0?ke-1:ke);var Le;te<0&&q>=B||te>0&&B>=q?Le=0:te<0?Le=Math.floor((q-B+1)/te+1):Le=Math.floor((q-B-1)/te+1);for(var ur=[],yi=0;yi<Le;++yi)ur[yi]=ie[B+yi*te];return ur}L.slice=Wr;function kr(ie,me,B){var q=ie.length;if(!(q<=1)&&(me<0?me=Math.max(0,me+q):me=Math.min(me,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1),me!==B)){for(var te=ie[me],ke=me<B?1:-1,Le=me;Le!==B;Le+=ke)ie[Le]=ie[Le+ke];ie[B]=te}}L.move=kr;function rn(ie,me,B){me===void 0&&(me=0),B===void 0&&(B=-1);var q=ie.length;if(!(q<=1))for(me<0?me=Math.max(0,me+q):me=Math.min(me,q-1),B<0?B=Math.max(0,B+q):B=Math.min(B,q-1);me<B;){var te=ie[me],ke=ie[B];ie[me++]=ke,ie[B--]=te}}L.reverse=rn;function $(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(!(te<=1)&&(B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1),!(B>=q))){var ke=q-B+1;if(me>0?me=me%ke:me<0&&(me=(me%ke+ke)%ke),me!==0){var Le=B+me;rn(ie,B,Le-1),rn(ie,Le,q),rn(ie,B,q)}}}L.rotate=$;function ne(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(te!==0){B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);var ke;q<B?ke=q+1+(te-B):ke=q-B+1;for(var Le=0;Le<ke;++Le)ie[(B+Le)%te]=me}}L.fill=ne;function he(ie,me,B){var q=ie.length;me<0?me=Math.max(0,me+q):me=Math.min(me,q);for(var te=q;te>me;--te)ie[te]=ie[te-1];ie[me]=B}L.insert=he;function we(ie,me){var B=ie.length;if(me<0&&(me+=B),!(me<0||me>=B)){for(var q=ie[me],te=me+1;te<B;++te)ie[te-1]=ie[te];return ie.length=B-1,q}}L.removeAt=we;function He(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=W(ie,me,B,q);return te!==-1&&we(ie,te),te}L.removeFirstOf=He;function nn(ie,me,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var te=be(ie,me,B,q);return te!==-1&&we(ie,te),te}L.removeLastOf=nn;function wt(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(te===0)return 0;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);for(var ke=0,Le=0;Le<te;++Le)B<=q&&Le>=B&&Le<=q&&ie[Le]===me||q<B&&(Le<=q||Le>=B)&&ie[Le]===me?ke++:ke>0&&(ie[Le-ke]=ie[Le]);return ke>0&&(ie.length=te-ke),ke}L.removeAllOf=wt;function Dt(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te,ke=Ne(ie,me,B,q);return ke!==-1&&(te=we(ie,ke)),{index:ke,value:te}}L.removeFirstWhere=Dt;function ot(ie,me,B,q){B===void 0&&(B=-1),q===void 0&&(q=0);var te,ke=nt(ie,me,B,q);return ke!==-1&&(te=we(ie,ke)),{index:ke,value:te}}L.removeLastWhere=ot;function Lt(ie,me,B,q){B===void 0&&(B=0),q===void 0&&(q=-1);var te=ie.length;if(te===0)return 0;B<0?B=Math.max(0,B+te):B=Math.min(B,te-1),q<0?q=Math.max(0,q+te):q=Math.min(q,te-1);for(var ke=0,Le=0;Le<te;++Le)B<=q&&Le>=B&&Le<=q&&me(ie[Le],Le)||q<B&&(Le<=q||Le>=B)&&me(ie[Le],Le)?ke++:ke>0&&(ie[Le-ke]=ie[Le]);return ke>0&&(ie.length=te-ke),ke}L.removeAllWhere=Lt}(r.ArrayExt||(r.ArrayExt={}));function e(L){var W;return typeof L.iter=="function"?W=L.iter():W=new p(L),W}function t(L){return new m(L)}function n(L){return new h(L)}function i(L){return new v(L)}function o(L){return new b(L)}function s(L,W){for(var be=0,Ne=e(L),nt;(nt=Ne.next())!==void 0;)if(W(nt,be++)===!1)return}function a(L,W){for(var be=0,Ne=e(L),nt;(nt=Ne.next())!==void 0;)if(!W(nt,be++))return!1;return!0}function c(L,W){for(var be=0,Ne=e(L),nt;(nt=Ne.next())!==void 0;)if(W(nt,be++))return!0;return!1}function l(L){for(var W=0,be=[],Ne=e(L),nt;(nt=Ne.next())!==void 0;)be[W++]=nt;return be}function u(L){for(var W=e(L),be,Ne={};(be=W.next())!==void 0;)Ne[be[0]]=be[1];return Ne}var p=function(){function L(W){this._index=0,this._source=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},L}(),m=function(){function L(W,be){be===void 0&&(be=Object.keys(W)),this._index=0,this._source=W,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?W:this.next()}},L}(),h=function(){function L(W,be){be===void 0&&(be=Object.keys(W)),this._index=0,this._source=W,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?this._source[W]:this.next()}},L}(),v=function(){function L(W,be){be===void 0&&(be=Object.keys(W)),this._index=0,this._source=W,this._keys=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source,this._keys);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?[W,this._source[W]]:this.next()}},L}(),b=function(){function L(W){this._fn=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},L.prototype.next=function(){return this._fn.call(void 0)},L}();function w(){for(var L=[],W=0;W<arguments.length;W++)L[W]=arguments[W];return new D(e(L.map(e)))}var D=function(){function L(W){this._cloned=!1,this._source=W,this._active=void 0}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone());return W._active=this._active&&this._active.clone(),W._cloned=!0,this._cloned=!0,W},L.prototype.next=function(){if(this._active===void 0){var W=this._source.next();if(W===void 0)return;this._active=this._cloned?W.clone():W}var be=this._active.next();return be!==void 0?be:(this._active=void 0,this.next())},L}();function T(){return new F}var F=function(){function L(){}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L},L.prototype.next=function(){},L}();function ee(L,W){return W===void 0&&(W=0),new de(e(L),W)}var de=function(){function L(W,be){this._source=W,this._index=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._index)},L.prototype.next=function(){var W=this._source.next();if(W!==void 0)return[this._index++,W]},L}();function Z(L,W){return new ye(e(L),W)}var ye=function(){function L(W,be){this._index=0,this._source=W,this._fn=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone(),this._fn);return W._index=this._index,W},L.prototype.next=function(){for(var W=this._fn,be=this._source,Ne;(Ne=be.next())!==void 0;)if(W(Ne,this._index++))return Ne},L}();function ue(L,W){for(var be=0,Ne=e(L),nt;(nt=Ne.next())!==void 0;)if(W(nt,be++))return nt}function le(L,W){for(var be=0,Ne=e(L),nt;(nt=Ne.next())!==void 0;)if(W(nt,be++))return be-1;return-1}function Oe(L,W){var be=e(L),Ne=be.next();if(Ne!==void 0){for(var nt=Ne;(Ne=be.next())!==void 0;)W(Ne,nt)<0&&(nt=Ne);return nt}}function Je(L,W){var be=e(L),Ne=be.next();if(Ne!==void 0){for(var nt=Ne;(Ne=be.next())!==void 0;)W(Ne,nt)>0&&(nt=Ne);return nt}}function vt(L,W){var be=e(L),Ne=be.next();if(Ne!==void 0){for(var nt=Ne,tn=Ne;(Ne=be.next())!==void 0;)W(Ne,nt)<0?nt=Ne:W(Ne,tn)>0&&(tn=Ne);return[nt,tn]}}function mt(L,W){return new rt(e(L),W)}var rt=function(){function L(W,be){this._index=0,this._source=W,this._fn=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source.clone(),this._fn);return W._index=this._index,W},L.prototype.next=function(){var W=this._source.next();if(W!==void 0)return this._fn.call(void 0,W,this._index++)},L}();function oe(L,W,be){return W===void 0?new Pe(0,L,1):be===void 0?new Pe(L,W,1):new Pe(L,W,be)}var Pe=function(){function L(W,be,Ne){this._index=0,this._start=W,this._stop=be,this._step=Ne,this._length=Y.rangeLength(W,be,Ne)}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._start,this._stop,this._step);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},L}(),Y;(function(L){function W(be,Ne,nt){return nt===0?1/0:be>Ne&&nt>0||be<Ne&&nt<0?0:Math.ceil((Ne-be)/nt)}L.rangeLength=W})(Y||(Y={}));function ve(L,W,be){var Ne=0,nt=e(L),tn=nt.next();if(tn===void 0&&be===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(tn===void 0)return be;var Ht=nt.next();if(Ht===void 0&&be===void 0)return tn;if(Ht===void 0)return W(be,tn,Ne++);var jt;be===void 0?jt=W(tn,Ht,Ne++):jt=W(W(be,tn,Ne++),Ht,Ne++);for(var Mt;(Mt=nt.next())!==void 0;)jt=W(jt,Mt,Ne++);return jt}function Ve(L,W){return new Ct(L,W)}function un(L){return new Ct(L,1)}var Ct=function(){function L(W,be){this._value=W,this._count=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._value,this._count)},L.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},L}();function jr(L){var W;return typeof L.retro=="function"?W=L.retro():W=new cs(L),W}var cs=function(){function L(W){this._source=W,this._index=W.length-1}return L.prototype.iter=function(){return this},L.prototype.clone=function(){var W=new L(this._source);return W._index=this._index,W},L.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},L}();function Vt(L){var W=[],be=new Set,Ne=new Map;return s(L,nt),Ne.forEach(function(Ht,jt){tn(jt)}),W;function nt(Ht){var jt=Ht[0],Mt=Ht[1],xr=Ne.get(Mt);xr?xr.push(jt):Ne.set(Mt,[jt])}function tn(Ht){if(!be.has(Ht)){be.add(Ht);var jt=Ne.get(Ht);jt&&jt.forEach(tn),W.push(Ht)}}}function en(L,W){return new Li(e(L),W)}var Li=function(){function L(W,be){this._source=W,this._step=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._step)},L.prototype.next=function(){for(var W=this._source.next(),be=this._step-1;be>0;--be)this._source.next();return W},L}();r.StringExt=void 0,function(L){function W(Ht,jt,Mt){Mt===void 0&&(Mt=0);for(var xr=new Array(jt.length),Wr=0,kr=Mt,rn=jt.length;Wr<rn;++Wr,++kr){if(kr=Ht.indexOf(jt[Wr],kr),kr===-1)return null;xr[Wr]=kr}return xr}L.findIndices=W;function be(Ht,jt,Mt){Mt===void 0&&(Mt=0);var xr=W(Ht,jt,Mt);if(!xr)return null;for(var Wr=0,kr=0,rn=xr.length;kr<rn;++kr){var $=xr[kr]-Mt;Wr+=$*$}return{score:Wr,indices:xr}}L.matchSumOfSquares=be;function Ne(Ht,jt,Mt){Mt===void 0&&(Mt=0);var xr=W(Ht,jt,Mt);if(!xr)return null;for(var Wr=0,kr=Mt-1,rn=0,$=xr.length;rn<$;++rn){var ne=xr[rn];Wr+=ne-kr-1,kr=ne}return{score:Wr,indices:xr}}L.matchSumOfDeltas=Ne;function nt(Ht,jt,Mt){for(var xr=[],Wr=0,kr=0,rn=jt.length;Wr<rn;){for(var $=jt[Wr],ne=jt[Wr];++Wr<rn&&jt[Wr]===ne+1;)ne++;kr<$&&xr.push(Ht.slice(kr,$)),$<ne+1&&xr.push(Mt(Ht.slice($,ne+1))),kr=ne+1}return kr<Ht.length&&xr.push(Ht.slice(kr)),xr}L.highlight=nt;function tn(Ht,jt){return Ht<jt?-1:Ht>jt?1:0}L.cmp=tn}(r.StringExt||(r.StringExt={}));function Nt(L,W){return new or(e(L),W)}var or=function(){function L(W,be){this._source=W,this._count=be}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.clone(),this._count)},L.prototype.next=function(){if(!(this._count<=0)){var W=this._source.next();if(W!==void 0)return this._count--,W}},L}();function Xn(){for(var L=[],W=0;W<arguments.length;W++)L[W]=arguments[W];return new bl(L.map(e))}var bl=function(){function L(W){this._source=W}return L.prototype.iter=function(){return this},L.prototype.clone=function(){return new L(this._source.map(function(W){return W.clone()}))},L.prototype.next=function(){for(var W=new Array(this._source.length),be=0,Ne=this._source.length;be<Ne;++be){var nt=this._source[be].next();if(nt===void 0)return;W[be]=nt}return W},L}();r.ArrayIterator=p,r.ChainIterator=D,r.EmptyIterator=F,r.EnumerateIterator=de,r.FilterIterator=ye,r.FnIterator=b,r.ItemIterator=v,r.KeyIterator=m,r.MapIterator=rt,r.RangeIterator=Pe,r.RepeatIterator=Ct,r.RetroArrayIterator=cs,r.StrideIterator=Li,r.TakeIterator=or,r.ValueIterator=h,r.ZipIterator=bl,r.chain=w,r.each=s,r.empty=T,r.enumerate=ee,r.every=a,r.filter=Z,r.find=ue,r.findIndex=le,r.iter=e,r.iterFn=o,r.iterItems=i,r.iterKeys=t,r.iterValues=n,r.map=mt,r.max=Je,r.min=Oe,r.minmax=vt,r.once=un,r.range=oe,r.reduce=ve,r.repeat=Ve,r.retro=jr,r.some=c,r.stride=en,r.take=Nt,r.toArray=l,r.toObject=u,r.topologicSort=Vt,r.zip=Xn,Object.defineProperty(r,"__esModule",{value:!0})})});var X$=N(($D,Y$)=>{(function(r,e){typeof $D=="object"&&typeof Y$<"u"?e($D):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_properties={}))})($D,function(r){"use strict";r.AttachedProperty=function(){function t(n){this._pid=e.nextPID(),this.name=n.name,this._create=n.create,this._coerce=n.coerce||null,this._compare=n.compare||null,this._changed=n.changed||null}return t.prototype.get=function(n){var i,o=e.ensureMap(n);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n),i},t.prototype.set=function(n,i){var o,s=e.ensureMap(n);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(n);var a=this._coerceValue(n,i);this._maybeNotify(n,o,s[this._pid]=a)},t.prototype.coerce=function(n){var i,o=e.ensureMap(n);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(n);var s=this._coerceValue(n,i);this._maybeNotify(n,i,o[this._pid]=s)},t.prototype._createValue=function(n){var i=this._create;return i(n)},t.prototype._coerceValue=function(n,i){var o=this._coerce;return o?o(n,i):i},t.prototype._compareValue=function(n,i){var o=this._compare;return o?o(n,i):n===i},t.prototype._maybeNotify=function(n,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(n,i,o)},t}(),function(t){function n(i){e.ownerData.delete(i)}t.clearData=n}(r.AttachedProperty||(r.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function n(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=n})(e||(e={})),Object.defineProperty(r,"__esModule",{value:!0})})});var GD=N((HD,Z$)=>{(function(r,e){typeof HD=="object"&&typeof Z$<"u"?e(HD,Q$(),X$()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.lumino_signaling={},r.lumino_algorithm,r.lumino_properties))})(HD,function(r,e,t){"use strict";r.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return n.connect(this,o,s)},i.prototype.disconnect=function(o,s){return n.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||n.emit(this,o)},i}(),function(i){function o(h,v){var b=n.blockedProperty;b.set(h,b.get(h)+1);try{v()}finally{b.set(h,b.get(h)-1)}}i.blockAll=o;function s(h,v){n.disconnectBetween(h,v)}i.disconnectBetween=s;function a(h){n.disconnectSender(h)}i.disconnectSender=a;function c(h){n.disconnectReceiver(h)}i.disconnectReceiver=c;function l(h){n.disconnectAll(h)}i.disconnectAll=l;function u(h){n.disconnectAll(h)}i.clearData=u;function p(){return n.exceptionHandler}i.getExceptionHandler=p;function m(h){var v=n.exceptionHandler;return n.exceptionHandler=h,v}i.setExceptionHandler=m}(r.Signal||(r.Signal={}));var n;(function(i){i.exceptionHandler=function(Z){console.error(Z)};function o(Z,ye,ue){ue=ue||void 0;var le=m.get(Z.sender);if(le||(le=[],m.set(Z.sender,le)),w(le,Z,ye,ue))return!1;var Oe=ue||ye,Je=h.get(Oe);Je||(Je=[],h.set(Oe,Je));var vt={signal:Z,slot:ye,thisArg:ue};return le.push(vt),Je.push(vt),!0}i.connect=o;function s(Z,ye,ue){ue=ue||void 0;var le=m.get(Z.sender);if(!le||le.length===0)return!1;var Oe=w(le,Z,ye,ue);if(!Oe)return!1;var Je=ue||ye,vt=h.get(Je);return Oe.signal=null,T(le),T(vt),!0}i.disconnect=s;function a(Z,ye){var ue=m.get(Z);if(!(!ue||ue.length===0)){var le=h.get(ye);!le||le.length===0||(e.each(le,function(Oe){Oe.signal&&Oe.signal.sender===Z&&(Oe.signal=null)}),T(ue),T(le))}}i.disconnectBetween=a;function c(Z){var ye=m.get(Z);!ye||ye.length===0||(e.each(ye,function(ue){if(ue.signal){var le=ue.thisArg||ue.slot;ue.signal=null,T(h.get(le))}}),T(ye))}i.disconnectSender=c;function l(Z){var ye=h.get(Z);!ye||ye.length===0||(e.each(ye,function(ue){if(ue.signal){var le=ue.signal.sender;ue.signal=null,T(m.get(le))}}),T(ye))}i.disconnectReceiver=l;function u(Z){c(Z),l(Z)}i.disconnectAll=u;function p(Z,ye){if(!(i.blockedProperty.get(Z.sender)>0)){var ue=m.get(Z.sender);if(!(!ue||ue.length===0))for(var le=0,Oe=ue.length;le<Oe;++le){var Je=ue[le];Je.signal===Z&&D(Je,ye)}}}i.emit=p;var m=new WeakMap,h=new WeakMap,v=new Set,b=function(){var Z=typeof requestAnimationFrame=="function";return Z?requestAnimationFrame:setImmediate}();function w(Z,ye,ue,le){return e.find(Z,function(Oe){return Oe.signal===ye&&Oe.slot===ue&&Oe.thisArg===le})}function D(Z,ye){var ue=Z.signal,le=Z.slot,Oe=Z.thisArg;try{le.call(Oe,ue.sender,ye)}catch(Je){i.exceptionHandler(Je)}}function T(Z){v.size===0&&b(F),v.add(Z)}function F(){v.forEach(ee),v.clear()}function ee(Z){e.ArrayExt.removeAllWhere(Z,de)}function de(Z){return Z.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(n||(n={})),Object.defineProperty(r,"__esModule",{value:!0})})});var c5=N((QGe,a5)=>{"use strict";a5.exports=({onlyFirst:r=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,r?void 0:"g")}});var rF=N((zXe,C5)=>{"use strict";var phe=require("child_process").spawn;function dhe(r){if(r){r=r.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return r=r.replace(e,""),r.trim()}}function mhe(r,e,t,n){typeof t=="function"&&(n=t,t=void 0);var i=!1,o=phe(r,e,t),s="",a="";o.stdout.on("data",function(c){s+=c.toString()}),o.stderr.on("data",function(c){a+=c.toString()}),o.on("error",function(c){i||(i=!0,n(new Error(c)))}),o.on("close",function(c){if(!i){if(i=!0,a=dhe(a),a)return n(new Error(a));n(null,s,c)}})}C5.exports=mhe});var E5=N((QXe,w5)=>{"use strict";var fhe=require("os"),hhe=rF();function ghe(r){var e=["-A","-o","ppid,pid"];hhe("ps",e,function(t,n,i){if(t)return r(t);if(i!==0)return r(new Error("pidtree ps command exited with code "+i));try{n=n.split(fhe.EOL);for(var o=[],s=1;s<n.length;s++)n[s]=n[s].trim(),n[s]&&(n[s]=n[s].split(/\s+/),n[s][0]=parseInt(n[s][0],10),n[s][1]=parseInt(n[s][1],10),o.push(n[s]));r(null,o)}catch(a){r(a)}})}w5.exports=ghe});var k5=N((YXe,P5)=>{"use strict";var vhe=require("os"),yhe=rF();function bhe(r){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};yhe("wmic",e,t,function(n,i,o){if(n){r(n);return}if(o!==0){r(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(vhe.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));r(null,s)}catch(c){r(c)}})}P5.exports=bhe});var R5=N((XXe,T5)=>{"use strict";var _5=require("os"),Ihe={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},She={ps:()=>E5(),wmic:()=>k5()},nF=_5.platform();nF.startsWith("win")&&(nF="win");var D5=Ihe[nF];function xhe(r){D5===void 0&&r(new Error(_5.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=She[D5]();e(r)}T5.exports=xhe});var N5=N((ZXe,A5)=>{"use strict";var Che=R5();function whe(r,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),r=parseInt(r,10),isNaN(r)||r<-1){t(new TypeError("The pid provided is invalid"));return}Che(function(n,i){if(n){t(n);return}if(r===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===r){s=e.advanced?{ppid:i[a][0],pid:r}:r;break}i[a][0]===r&&(s=e.advanced?{pid:r}:r)}if(!s){t(new Error("No matching pid found"));return}for(var c={};i.length>0;){var l=i.pop();c[l[0]]?c[l[0]].push(l[1]):c[l[0]]=[l[1]]}for(var u=0,p=[s];u<p.length;){var m=e.advanced?p[u++].pid:p[u++];if(c[m]){for(var h=c[m].length,v=0;v<h;v++)p.push(e.advanced?{ppid:m,pid:c[m][v]}:c[m][v]);delete c[m]}}e.root||p.shift(),t(null,p)})}A5.exports=whe});var K5=N((eZe,O5)=>{"use strict";function Ehe(r,e,t){return new Promise(function(n,i){r(e,t,function(o,s){if(o)return i(o);n(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(r){return this.substring(0,r.length)===r});var M5=N5();function Phe(r,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){M5(r,e,t);return}return Ehe(M5,r,e)}O5.exports=Phe});var q5=N((tZe,B5)=>{var F5=Array.prototype.slice,L5=typeof Object.keys=="function"?Object.keys:function(r){var e=[];for(var t in r)e.push(t);return e},U5=B5.exports=function(r,e){return r===0&&e===0?khe(r,e):r===e?!0:r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():V5(r)?V5(e):typeof r!="object"&&typeof e!="object"?r==e:Dhe(r,e)};function j5(r){return r==null}function W5(r){return Object.prototype.toString.call(r)=="[object Arguments]"}function V5(r){return typeof r=="number"&&r!==r}function khe(r,e){return 1/r===1/e}function Dhe(r,e){if(j5(r)||j5(e)||r.prototype!==e.prototype)return!1;if(W5(r))return W5(e)?(r=F5.call(r),e=F5.call(e),U5(r,e)):!1;try{var t=L5(r),n=L5(e),i,o}catch{return!1}if(t.length!=n.length)return!1;for(t.sort(),n.sort(),o=t.length-1;o>=0;o--)if(t[o]!=n[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!U5(r[i],e[i]))return!1;return!0}});var H5=N((rZe,$5)=>{"use strict";var J5="[a-fA-F\\d:]",id=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${J5})|(?<=${J5})(?=\\s|$))`:"",ka="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",Tn="[a-fA-F\\d]{1,4}",C_=`
(?:
(?:${Tn}:){7}(?:${Tn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${Tn}:){6}(?:${ka}|:${Tn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${Tn}:){5}(?::${ka}|(?::${Tn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${Tn}:){4}(?:(?::${Tn}){0,1}:${ka}|(?::${Tn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${Tn}:){3}(?:(?::${Tn}){0,2}:${ka}|(?::${Tn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${Tn}:){2}(?:(?::${Tn}){0,3}:${ka}|(?::${Tn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${Tn}:){1}(?:(?::${Tn}){0,4}:${ka}|(?::${Tn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${Tn}){0,5}:${ka}|(?::${Tn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),_he=new RegExp(`(?:^${ka}$)|(?:^${C_}$)`),The=new RegExp(`^${ka}$`),Rhe=new RegExp(`^${C_}$`),iF=r=>r&&r.exact?_he:new RegExp(`(?:${id(r)}${ka}${id(r)})|(?:${id(r)}${C_}${id(r)})`,"g");iF.v4=r=>r&&r.exact?The:new RegExp(`${id(r)}${ka}${id(r)}`,"g");iF.v6=r=>r&&r.exact?Rhe:new RegExp(`${id(r)}${C_}${id(r)}`,"g");$5.exports=iF});var G5=N((nZe,Ahe)=>{Ahe.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var Q5=N((iZe,z5)=>{z5.exports=Khe;var Nhe=/^(?:\w+:)?\/\/(\S+)$/,Mhe=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Ohe=/^[^\s\.]+\.\S{2,}$/;function Khe(r){if(typeof r!="string")return!1;var e=r.match(Nhe);if(!e)return!1;var t=e[1];return t?!!(Mhe.test(t)||Ohe.test(t)):!1}});var Z5=N(X5=>{"use strict";var Y5={}.hasOwnProperty,vr={}.toString,S=X5,Fhe=q5(),Lhe=H5();S.version=G5().version;S.browser=function(){return!S.node()&&typeof window<"u"&&vr.call(window)==="[object global]"};S.defined=function(r){return typeof r<"u"};S.def=S.defined;S.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};S.node=S.nodejs;S.undefined=function(r){return r===void 0};S.udef=S.undef=S.undefined;S.array=function(r){return vr.call(r)==="[object Array]"};S.arr=S.ary=S.arry=S.array;S.arrayLike=function(r){return S.nullOrUndef(r)?!1:r!==void 0&&Y5.call(r,"length")&&isFinite(r.length)};S.arrLike=S.arryLike=S.aryLike=S.arraylike=S.arrayLike;S.arguments=function(r){return vr.call(r)==="[object Arguments]"};S.args=S.arguments;S.boolean=function(r){return vr.call(r)==="[object Boolean]"};S.bool=S.boolean;S.buffer=function(r){return S.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(r)};S.buff=S.buf=S.buffer;S.date=function(r){return vr.call(r)==="[object Date]"};S.error=function(r){return vr.call(r)==="[object Error]"};S.err=S.error;S.false=function(r){return r===!1};S.function=function(r){return S.syncFunction(r)||S.asyncFunction(r)};S.fun=S.func=S.function;S.asyncFunction=function(r){return vr.call(r)==="[object AsyncFunction]"};S.asyncFun=S.asyncFunc=S.asyncFunction;S.syncFunction=function(r){return vr.call(r)==="[object Function]"};S.syncFun=S.syncFunc=S.syncFunction;S.null=function(r){return r===null};S.nullOrUndefined=function(r){return r===null||typeof r>"u"};S.nullOrUndef=S.nullOrUndefined;S.number=function(r){return vr.call(r)==="[object Number]"};S.num=S.number;S.object=function(r){return vr.call(r)==="[object Object]"};S.obj=S.object;S.regExp=function(r){return vr.call(r)==="[object RegExp]"};S.re=S.regexp=S.regExp;S.string=function(r){return vr.call(r)==="[object String]"};S.str=S.string;S.true=function(r){return r===!0};var Uhe=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");S.uuid=function(r){return Uhe.test(r)};S.equal=function(r,e){var t=vr.call(r);return typeof r!=typeof e||t!==vr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?Fhe(r,e):t==="[object Function]"?r.prototype===e.prototype:t==="[object Date]"?r.getTime()===e.getTime():r===e};S.objEquals=S.eq=S.equal;var jhe={boolean:1,number:1,string:1,undefined:1};S.hosted=function(r,e){if(S.nullOrUndef(r))return!1;var t=typeof e[r];return t==="object"?!!e[r]:!jhe[t]};S.instanceOf=function(r,e){return S.nullOrUndef(r)||S.nullOrUndef(e)?!1:r instanceof e};S.instOf=S.instanceof=S.instanceOf;S.objectInstanceOf=function(r,e){try{return vr.call(r)==="[object Object]"&&r instanceof e}catch{return!1}};S.instOf=S.instanceOf=S.objInstOf=S.objectInstanceOf;S.type=function(r,e){return typeof r===e};S.a=S.type;S.empty=function(r){var e=vr.call(r);if(e==="[object Array]"||e==="[object Arguments]")return r.length===0;if(e==="[object Object]"){for(var t in r)if(Y5.call(r,t))return!1;return!0}return e==="[object String]"?r==="":!1};S.emptyArguments=function(r){return vr.call(r)==="[object Arguments]"&&r.length===0};S.noArgs=S.emptyArgs=S.emptyArguments;S.emptyArray=function(r){return vr.call(r)==="[object Array]"&&r.length===0};S.emptyArry=S.emptyAry=S.emptyArray;S.emptyArrayLike=function(r){return r.length===0};S.emptyArrLike=S.emptyArrayLike;S.emptyString=function(r){return S.string(r)&&r.length===0};S.emptyStr=S.emptyString;S.nonEmptyArray=function(r){return vr.call(r)==="[object Array]"&&r.length>0};S.nonEmptyArr=S.nonEmptyArry=S.nonEmptyAry=S.nonEmptyArray;S.nonEmptyObject=function(r){return vr.call(r)==="[object Object]"&&Object.keys(r).length>0};S.nonEmptyObj=S.nonEmptyObject;S.emptyObject=function(r){return vr.call(r)==="[object Object]"&&Object.keys(r).length===0};S.emptyObj=S.emptyObject;S.nonEmptyString=function(r){return S.string(r)&&r.length>0};S.nonEmptyStr=S.nonEmptyString;S.even=function(r){return vr.call(r)==="[object Number]"&&r%2===0};S.decimal=function(r){return vr.call(r)==="[object Number]"&&r%1!==0};S.dec=S.decNum=S.decimal;S.integer=function(r){return vr.call(r)==="[object Number]"&&r%1===0};S.int=S.integer;S.notANumber=function(r){return!S.num(r)||r!==r};S.nan=S.notANum=S.notANumber;S.odd=function(r){return!S.decimal(r)&&vr.call(r)==="[object Number]"&&r%2!==0};S.oddNumber=S.oddNum=S.odd;S.positiveNumber=function(r){return vr.call(r)==="[object Number]"&&r>0};S.pos=S.positive=S.posNum=S.positiveNum=S.positiveNumber;S.negativeNumber=function(r){return vr.call(r)==="[object Number]"&&r<0};S.neg=S.negNum=S.negativeNum=S.negativeNumber;S.negativeInteger=function(r){return vr.call(r)==="[object Number]"&&r%1===0&&r<0};S.negativeInt=S.negInt=S.negativeInteger;S.positiveInteger=function(r){return vr.call(r)==="[object Number]"&&r%1===0&&r>0};S.posInt=S.positiveInt=S.positiveInteger;S.divisibleBy=function(r,e){return r===0?!1:vr.call(r)==="[object Number]"&&e!==0&&r%e===0};S.divBy=S.divisBy=S.divisibleBy;S.greaterOrEqualTo=function(r,e){return r>=e};S.greaterOrEqual=S.ge=S.greaterOrEqualTo;S.greaterThan=function(r,e){return r>e};S.gt=S.greaterThan;S.lessThanOrEqualTo=function(r,e){return r<=e};S.lessThanOrEq=S.lessThanOrEqual=S.le=S.lessThanOrEqualTo;S.lessThan=function(r,e){return r<e};S.lt=S.lessThan;S.maximum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r<e[t])return!1;return!0};S.max=S.maximum;S.minimum=function(r,e){if(!S.arrayLike(e)||!S.number(r))return!1;for(var t=e.length;--t>-1;)if(r>e[t])return!1;return!0};S.min=S.minimum;S.within=function(r,e,t){return r>=e&&r<=t};S.withIn=S.within;S.prettyClose=function(r,e,t){return!S.number(r)||!S.number(e)||S.defined(t)&&!S.posInt(t)?!1:(S.undefined(t)&&(t=2),r.toFixed(t)===e.toFixed(t))};S.closish=S.near=S.prettyClose;S.dnsAddress=function(r){return!(!S.nonEmptyStr(r)||r.length>255||Vhe.test(r)||!Whe.test(r))};S.dnsAddr=S.dns=S.dnsAddress;var Whe=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Vhe=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;S.emailAddress=function(r){return S.nonEmptyStr(r)?Bhe.test(r):!1};S.email=S.emailAddr=S.emailAddress;var Bhe=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;S.ipv4Address=function(r){if(!S.nonEmptyStr(r)||r.length>15)return!1;var e=r.split(".");if(!S.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var n=parseInt(e[t],10);if(isNaN(n)||n<0||n>255)return!1}return!0};S.ipv4=S.ipv4Addr=S.ipv4Address;S.ipv6Address=function(r){return S.nonEmptyStr(r)?Lhe.v6({extract:!0}).test(r):!1};S.ipv6=S.ipv6Addr=S.ipv6Address;S.ipAddress=function(r){return S.nonEmptyStr(r)?S.ipv4Address(r)||S.ipv6Address(r):!1};S.ip=S.ipAddr=S.ipAddress;S.hostAddress=function(r){return S.nonEmptyStr(r)?S.dns(r)||S.ipv4(r)||S.ipv6(r):!1};S.host=S.hostIp=S.hostAddr=S.hostAddress;S.port=function(r){return!(!S.num(r)||S.negativeInt(r)||r>65535)};S.systemPort=function(r){return!!(S.port(r)&&r<1024)};S.sysPort=S.systemPort;S.userPort=function(r){return!!(S.port(r)&&r>1023)};S.creditCardNumber=function(r){if(!S.str(r))return!1;var e=r.split(""),t,n;for(t=e.length-1,n=1;t>-1;t--,n++)n%2===0&&(e[t]*=2);r=e.join("");var i=0;for(t=0;t<r.length;t++)i+=Math.floor(r[t]);return i%10===0};S.creditCard=S.creditCardNum=S.creditCardNumber;S.americanExpressCardNumber=function(r){if(!S.str(r)||r.length!==15)return!1;var e=Math.floor(r.slice(0,2));return!(e!==34&&e!==37||!S.creditCardNumber(r))};S.amexCard=S.amexCardNum=S.americanExpressCardNumber;S.chinaUnionPayCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,2));return!(e!==62&&e!==88)};S.chinaUnion=S.chinaUnionPayCard=S.chinaUnionPayCardNumber;S.dinersClubCarteBlancheCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3));return!(e<300||e>305||!S.creditCardNumber(r))};S.dinersClubCB=S.dinersClubCarteBlancheCard=S.dinersClubCarteBlancheCardNumber;S.dinersClubInternationalCardNumber=function(r){if(!S.str(r)||r.length!==14)return!1;var e=Math.floor(r.slice(0,3)),t=Math.floor(r.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!S.creditCardNumber(r))};S.dinersClubInt=S.dinersClubInternationalCard=S.dinersClubInternationalCardNumber;S.dinersClubUSACanadaCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e!==54&&e!==55||!S.creditCardNumber(r))};S.dinersClub=S.dinersClubUSACanCard=S.dinersClubUSACanadaCardNumber;S.discoverCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,6)),t=Math.floor(r.slice(0,3));return!(r.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&r.slice(0,2)!=="65"||!S.creditCardNumber(r))};S.discover=S.discoverCard=S.discoverCardNumber;S.instaPaymentCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,3));return!(e<637||e>639||!S.creditCardNumber(r))};S.instaPayment=S.instaPaymentCardNumber;S.jcbCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4));return!(e<3528||e>3589||!S.creditCardNumber(r))};S.jcb=S.jcbCard=S.jcbCardNumber;S.laserCardNumber=function(r){if(!S.str(r)||r.length<16&&r.length>19)return!1;var e=Math.floor(r.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.laser=S.laserCard=S.laserCardNumber;S.maestroCardNumber=function(r){if(!S.str(r)||r.length<12||r.length>19)return!1;var e=r.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!S.creditCardNumber(r))};S.maestro=S.maestroCard=S.maestroCardNumber;S.dankortCardNumber=function(r){return!(!S.str(r)||r.length!==16||r.slice(0,4)!=="5019"||!S.creditCardNumber(r))};S.dankort=S.dankortCard=S.dankortCardNumber;S.masterCardCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,2));return!(e<50||e>55||!S.creditCardNumber(r))};S.masterCard=S.masterCardCard=S.masterCardCardNumber;S.visaCardNumber=function(r){return!(!S.str(r)||r.length!==13&&r.length!==16||r.slice(0,1)!=="4"||!S.creditCardNumber(r))};S.visa=S.visaCard=S.visaCardNumber;S.visaElectronCardNumber=function(r){if(!S.str(r)||r.length!==16)return!1;var e=Math.floor(r.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return r.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!S.creditCardNumber(r),!1};S.visaElectron=S.visaElectronCard=S.visaElectronCardNumber;var qhe=/^[0-9a-fA-F]{24}$/;S.mongoId=S.objectId=S.objId=function(r){return!!r&&!Array.isArray(r)&&qhe.test(String(r))};S.matching=S.match=S.inArgs=function(r){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var n=S.equal(r,arguments[t]);e=e||n}return e};S.streetAddress=function(r){if(!S.str(r))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(r)};S.street=S.address=S.streetAddress;S.zipCode=function(r){if(S.undefined(r)||!(S.string(r)||S.number(r)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(r)};S.zip=S.zipCode;S.phoneNumber=function(r){if(!S.string(r))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(r)};S.phone=S.phoneNumber;var Jhe=Q5();S.url=function(r){return Jhe(r)};S.uri=S.url;S.enumerator=function(r,e){var t=!1;if(!S.defined(r)||!S.defined(e)||!S.arrayLike(e))return t;for(var n=0,i=e.length;n<i;n++)if(S.equal(r,e[n])){t=!0;break}return t};S.enum=S.inArray=S.enumerator});var oF=N((sZe,eH)=>{function $he(r){t.debug=t,t.default=t,t.coerce=c,t.disable=o,t.enable=i,t.enabled=s,t.humanize=DP(),t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let p=0;for(let m=0;m<u.length;m++)p=(p<<5)-p+u.charCodeAt(m),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(u){let p,m=null;function h(...v){if(!h.enabled)return;let b=h,w=Number(new Date),D=w-(p||w);b.diff=D,b.prev=p,b.curr=w,p=w,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let T=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(ee,de)=>{if(ee==="%%")return"%";T++;let Z=t.formatters[de];if(typeof Z=="function"){let ye=v[T];ee=Z.call(b,ye),v.splice(T,1),T--}return ee}),t.formatArgs.call(b,v),(b.log||t.log).apply(b,v)}return h.namespace=u,h.useColors=t.useColors(),h.color=t.selectColor(u),h.extend=n,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>m===null?t.enabled(u):m,set:v=>{m=v}}),typeof t.init=="function"&&t.init(h),h}function n(u,p){let m=t(this.namespace+(typeof p>"u"?":":p)+u);return m.log=this.log,m}function i(u){t.save(u),t.names=[],t.skips=[];let p,m=(typeof u=="string"?u:"").split(/[\s,]+/),h=m.length;for(p=0;p<h;p++)m[p]&&(u=m[p].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let p,m;for(p=0,m=t.skips.length;p<m;p++)if(t.skips[p].test(u))return!1;for(p=0,m=t.names.length;p<m;p++)if(t.names[p].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}eH.exports=$he});var tH=N((ts,w_)=>{ts.formatArgs=Ghe;ts.save=zhe;ts.load=Qhe;ts.useColors=Hhe;ts.storage=Yhe();ts.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();ts.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Hhe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ghe(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+w_.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}ts.log=console.debug||console.log||(()=>{});function zhe(r){try{r?ts.storage.setItem("debug",r):ts.storage.removeItem("debug")}catch{}}function Qhe(){let r;try{r=ts.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function Yhe(){try{return localStorage}catch{}}w_.exports=oF()(ts);var{formatters:Xhe}=w_.exports;Xhe.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var nH=N((mi,P_)=>{var Zhe=require("tty"),E_=require("util");mi.init=sge;mi.log=nge;mi.formatArgs=tge;mi.save=ige;mi.load=oge;mi.useColors=ege;mi.destroy=E_.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");mi.colors=[6,2,3,4,5,1];try{let r=TP();r&&(r.stderr||r).level>=2&&(mi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}mi.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function ege(){return"colors"in mi.inspectOpts?!!mi.inspectOpts.colors:Zhe.isatty(process.stderr.fd)}function tge(r){let{namespace:e,useColors:t}=this;if(t){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${e} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+P_.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=rge()+e+" "+r[0]}function rge(){return mi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function nge(...r){return process.stderr.write(E_.format(...r)+`
`)}function ige(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function oge(){return process.env.DEBUG}function sge(r){r.inspectOpts={};let e=Object.keys(mi.inspectOpts);for(let t=0;t<e.length;t++)r.inspectOpts[e[t]]=mi.inspectOpts[e[t]]}P_.exports=oF()(mi);var{formatters:rH}=P_.exports;rH.o=function(r){return this.inspectOpts.colors=this.useColors,E_.inspect(r,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};rH.O=function(r){return this.inspectOpts.colors=this.useColors,E_.inspect(r,this.inspectOpts)}});var iH=N((aZe,sF)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?sF.exports=tH():sF.exports=nH()});var pH=N(cf=>{"use strict";cf.check=lH;cf.waitUntilFreeOnHost=cge;cf.waitUntilFree=lge;cf.waitUntilUsedOnHost=uH;cf.waitUntilUsed=uge;cf.waitForStatus=D_;var Da=Z5(),age=require("net"),oH=require("util"),k_=iH()("tcp-port-used"),sH=2e3,aH=250;function cH(){var r,e,t=new Promise(function(n,i){r=n,e=i});return{resolve:r,reject:e,promise:t}}function Cy(r,e,t,n,i){var o={};return o.port=r,o.host=e,o.inUse=t,o.retryTimeMs=n,o.timeOutMs=i,o}function lH(r,e){var t=cH(),n=!0,i,o;if(Da.obj(r)?o=r:o=Cy(r,e),!Da.port(o.port))return k_("Error invalid port: "+oH.inspect(o.port)),t.reject(new Error("invalid port: "+oH.inspect(o.port))),t.promise;Da.nullOrUndefined(o.host)&&(k_("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(n),s()}function c(l){l.code!=="ECONNREFUSED"?t.reject(l):(n=!1,t.resolve(n)),s()}return i=new age.Socket,i.once("connect",a),i.once("error",c),i.connect({port:o.port,host:o.host},function(){}),t.promise}function D_(r,e,t,n,i){var o=cH(),s,a=!1,c,l;if(Da.obj(r)?l=r:l=Cy(r,e,t,n,i),!Da.bool(l.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;Da.positiveInt(l.retryTimeMs)||(l.retryTimeMs=aH,k_("set retryTime to default "+aH+"ms")),Da.positiveInt(l.timeOutMs)||(l.timeOutMs=sH,k_("set timeOutMs to default "+sH+"ms"));function u(){s&&clearTimeout(s),c&&clearTimeout(c)}function p(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(p,l.timeOutMs);function m(){lH(l.port,l.host).then(function(h){if(!a)if(h===l.inUse){o.resolve(),u();return}else{c=setTimeout(function(){m()},l.retryTimeMs);return}},function(h){a||(o.reject(h),u())})}return m(),o.promise}function cge(r,e,t,n){var i;return Da.obj(r)?(i=r,i.inUse=!1):i=Cy(r,e,!1,t,n),D_(i)}function lge(r,e,t){var n;return Da.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!1):n=Cy(r,"127.0.0.1",!1,e,t),D_(n)}function uH(r,e,t,n){var i;return Da.obj(r)?(i=r,i.inUse=!0):i=Cy(r,e,!0,t,n),D_(i)}function uge(r,e,t){var n;return Da.obj(r)?(n=r,n.host="127.0.0.1",n.inUse=!0):n=Cy(r,"127.0.0.1",!0,e,t),uH(n)}});var yH=N((__,Zc)=>{(function(r,e){typeof __=="object"&&typeof Zc<"u"?e(__):typeof define=="function"&&define.amd?define(["exports"],e):e(r.async=r.async||{})})(__,function(r){"use strict";function e(I,P){P=P|0;for(var R=Math.max(I.length-P,0),O=Array(R),z=0;z<R;z++)O[z]=I[P+z];return O}var t=function(I){var P=e(arguments,1);return function(){var R=e(arguments);return I.apply(null,P.concat(R))}},n=function(I){return function(){var P=e(arguments),R=P.pop();I.call(this,P,R)}};function i(I){var P=typeof I;return I!=null&&(P=="object"||P=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(I){setTimeout(I,0)}function c(I){return function(P){var R=e(arguments,1);I(function(){P.apply(null,R)})}}var l;o?l=setImmediate:s?l=process.nextTick:l=a;var u=c(l);function p(I){return n(function(P,R){var O;try{O=I.apply(this,P)}catch(z){return R(z)}i(O)&&typeof O.then=="function"?O.then(function(z){m(R,null,z)},function(z){m(R,z.message?z:new Error(z))}):R(null,O)})}function m(I,P,R){try{I(P,R)}catch(O){u(h,O)}}function h(I){throw I}var v=typeof Symbol=="function";function b(I){return v&&I[Symbol.toStringTag]==="AsyncFunction"}function w(I){return b(I)?p(I):I}function D(I){return function(P){var R=e(arguments,1),O=n(function(z,G){var se=this;return I(P,function(pe,Te){w(pe).apply(se,z.concat(Te))},G)});return R.length?O.apply(this,R):O}}var T=typeof global=="object"&&global&&global.Object===Object&&global,F=typeof self=="object"&&self&&self.Object===Object&&self,ee=T||F||Function("return this")(),de=ee.Symbol,Z=Object.prototype,ye=Z.hasOwnProperty,ue=Z.toString,le=de?de.toStringTag:void 0;function Oe(I){var P=ye.call(I,le),R=I[le];try{I[le]=void 0;var O=!0}catch{}var z=ue.call(I);return O&&(P?I[le]=R:delete I[le]),z}var Je=Object.prototype,vt=Je.toString;function mt(I){return vt.call(I)}var rt="[object Null]",oe="[object Undefined]",Pe=de?de.toStringTag:void 0;function Y(I){return I==null?I===void 0?oe:rt:Pe&&Pe in Object(I)?Oe(I):mt(I)}var ve="[object AsyncFunction]",Ve="[object Function]",un="[object GeneratorFunction]",Ct="[object Proxy]";function jr(I){if(!i(I))return!1;var P=Y(I);return P==Ve||P==un||P==ve||P==Ct}var cs=9007199254740991;function Vt(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=cs}function en(I){return I!=null&&Vt(I.length)&&!jr(I)}var Li={};function Nt(){}function or(I){return function(){if(I!==null){var P=I;I=null,P.apply(this,arguments)}}}var Xn=typeof Symbol=="function"&&Symbol.iterator,bl=function(I){return Xn&&I[Xn]&&I[Xn]()};function L(I,P){for(var R=-1,O=Array(I);++R<I;)O[R]=P(R);return O}function W(I){return I!=null&&typeof I=="object"}var be="[object Arguments]";function Ne(I){return W(I)&&Y(I)==be}var nt=Object.prototype,tn=nt.hasOwnProperty,Ht=nt.propertyIsEnumerable,jt=Ne(function(){return arguments}())?Ne:function(I){return W(I)&&tn.call(I,"callee")&&!Ht.call(I,"callee")},Mt=Array.isArray;function xr(){return!1}var Wr=typeof r=="object"&&r&&!r.nodeType&&r,kr=Wr&&typeof Zc=="object"&&Zc&&!Zc.nodeType&&Zc,rn=kr&&kr.exports===Wr,$=rn?ee.Buffer:void 0,ne=$?$.isBuffer:void 0,he=ne||xr,we=9007199254740991,He=/^(?:0|[1-9]\d*)$/;function nn(I,P){var R=typeof I;return P=P??we,!!P&&(R=="number"||R!="symbol"&&He.test(I))&&I>-1&&I%1==0&&I<P}var wt="[object Arguments]",Dt="[object Array]",ot="[object Boolean]",Lt="[object Date]",ie="[object Error]",me="[object Function]",B="[object Map]",q="[object Number]",te="[object Object]",ke="[object RegExp]",Le="[object Set]",ur="[object String]",yi="[object WeakMap]",Il="[object ArrayBuffer]",g1="[object DataView]",v1="[object Float32Array]",y1="[object Float64Array]",Ce="[object Int8Array]",pL="[object Int16Array]",dL="[object Int32Array]",mL="[object Uint8Array]",fL="[object Uint8ClampedArray]",hL="[object Uint16Array]",gL="[object Uint32Array]",Ar={};Ar[v1]=Ar[y1]=Ar[Ce]=Ar[pL]=Ar[dL]=Ar[mL]=Ar[fL]=Ar[hL]=Ar[gL]=!0,Ar[wt]=Ar[Dt]=Ar[Il]=Ar[ot]=Ar[g1]=Ar[Lt]=Ar[ie]=Ar[me]=Ar[B]=Ar[q]=Ar[te]=Ar[ke]=Ar[Le]=Ar[ur]=Ar[yi]=!1;function vL(I){return W(I)&&Vt(I.length)&&!!Ar[Y(I)]}function yL(I){return function(P){return I(P)}}var b1=typeof r=="object"&&r&&!r.nodeType&&r,zf=b1&&typeof Zc=="object"&&Zc&&!Zc.nodeType&&Zc,bL=zf&&zf.exports===b1,ew=bL&&T.process,I1=function(){try{var I=zf&&zf.require&&zf.require("util").types;return I||ew&&ew.binding&&ew.binding("util")}catch{}}(),S1=I1&&I1.isTypedArray,IL=S1?yL(S1):vL,SL=Object.prototype,xL=SL.hasOwnProperty;function CL(I,P){var R=Mt(I),O=!R&&jt(I),z=!R&&!O&&he(I),G=!R&&!O&&!z&&IL(I),se=R||O||z||G,pe=se?L(I.length,String):[],Te=pe.length;for(var tt in I)(P||xL.call(I,tt))&&!(se&&(tt=="length"||z&&(tt=="offset"||tt=="parent")||G&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||nn(tt,Te)))&&pe.push(tt);return pe}var wL=Object.prototype;function EL(I){var P=I&&I.constructor,R=typeof P=="function"&&P.prototype||wL;return I===R}function PL(I,P){return function(R){return I(P(R))}}var kL=PL(Object.keys,Object),DL=Object.prototype,_L=DL.hasOwnProperty;function TL(I){if(!EL(I))return kL(I);var P=[];for(var R in Object(I))_L.call(I,R)&&R!="constructor"&&P.push(R);return P}function tw(I){return en(I)?CL(I):TL(I)}function RL(I){var P=-1,R=I.length;return function(){return++P<R?{value:I[P],key:P}:null}}function AL(I){var P=-1;return function(){var O=I.next();return O.done?null:(P++,{value:O.value,key:P})}}function NL(I){var P=tw(I),R=-1,O=P.length;return function z(){var G=P[++R];return G==="__proto__"?z():R<O?{value:I[G],key:G}:null}}function ML(I){if(en(I))return RL(I);var P=bl(I);return P?AL(P):NL(I)}function ra(I){return function(){if(I===null)throw new Error("Callback was already called.");var P=I;I=null,P.apply(this,arguments)}}function FI(I){return function(P,R,O){if(O=or(O||Nt),I<=0||!P)return O(null);var z=ML(P),G=!1,se=0,pe=!1;function Te(Re,bt){if(se-=1,Re)G=!0,O(Re);else{if(bt===Li||G&&se<=0)return G=!0,O(null);pe||tt()}}function tt(){for(pe=!0;se<I&&!G;){var Re=z();if(Re===null){G=!0,se<=0&&O(null);return}se+=1,R(Re.value,Re.key,ra(Te))}pe=!1}tt()}}function Mu(I,P,R,O){FI(P)(I,w(R),O)}function jn(I,P){return function(R,O,z){return I(R,P,O,z)}}function OL(I,P,R){R=or(R||Nt);var O=0,z=0,G=I.length;G===0&&R(null);function se(pe,Te){pe?R(pe):(++z===G||Te===Li)&&R(null)}for(;O<G;O++)P(I[O],O,ra(se))}var KL=jn(Mu,1/0),Sl=function(I,P,R){var O=en(I)?OL:KL;O(I,w(P),R)};function jd(I){return function(P,R,O){return I(Sl,P,w(R),O)}}function x1(I,P,R,O){O=O||Nt,P=P||[];var z=[],G=0,se=w(R);I(P,function(pe,Te,tt){var Re=G++;se(pe,function(bt,Vr){z[Re]=Vr,tt(bt)})},function(pe){O(pe,z)})}var LI=jd(x1),C1=D(LI);function Wd(I){return function(P,R,O,z){return I(FI(R),P,w(O),z)}}var Vd=Wd(x1),rw=jn(Vd,1),w1=D(rw);function UI(I,P){for(var R=-1,O=I==null?0:I.length;++R<O&&P(I[R],R,I)!==!1;);return I}function FL(I){return function(P,R,O){for(var z=-1,G=Object(P),se=O(P),pe=se.length;pe--;){var Te=se[I?pe:++z];if(R(G[Te],Te,G)===!1)break}return P}}var LL=FL();function Qf(I,P){return I&&LL(I,P,tw)}function UL(I,P,R,O){for(var z=I.length,G=R+(O?1:-1);O?G--:++G<z;)if(P(I[G],G,I))return G;return-1}function jL(I){return I!==I}function WL(I,P,R){for(var O=R-1,z=I.length;++O<z;)if(I[O]===P)return O;return-1}function jI(I,P,R){return P===P?WL(I,P,R):UL(I,jL,R)}var nw=function(I,P,R){typeof P=="function"&&(R=P,P=null),R=or(R||Nt);var O=tw(I),z=O.length;if(!z)return R(null);P||(P=z);var G={},se=0,pe=!1,Te=Object.create(null),tt=[],Re=[],bt={};Qf(I,function(Gr,on){if(!Mt(Gr)){Vr(on,[Gr]),Re.push(on);return}var Wn=Gr.slice(0,Gr.length-1),Cl=Wn.length;if(Cl===0){Vr(on,Gr),Re.push(on);return}bt[on]=Cl,UI(Wn,function(oh){if(!I[oh])throw new Error("async.auto task `"+on+"` has a non-existent dependency `"+oh+"` in "+Wn.join(", "));ja(oh,function(){Cl--,Cl===0&&Vr(on,Gr)})})}),eQ(),bi();function Vr(Gr,on){tt.push(function(){Wa(Gr,on)})}function bi(){if(tt.length===0&&se===0)return R(null,G);for(;tt.length&&se<P;){var Gr=tt.shift();Gr()}}function ja(Gr,on){var Wn=Te[Gr];Wn||(Wn=Te[Gr]=[]),Wn.push(on)}function us(Gr){var on=Te[Gr]||[];UI(on,function(Wn){Wn()}),bi()}function Wa(Gr,on){if(!pe){var Wn=ra(function(oh,bR){if(se--,arguments.length>2&&(bR=e(arguments,1)),oh){var IR={};Qf(G,function(rQ,nQ){IR[nQ]=rQ}),IR[Gr]=bR,pe=!0,Te=Object.create(null),R(oh,IR)}else G[Gr]=bR,us(Gr)});se++;var Cl=w(on[on.length-1]);on.length>1?Cl(G,Wn):Cl(Wn)}}function eQ(){for(var Gr,on=0;Re.length;)Gr=Re.pop(),on++,UI(tQ(Gr),function(Wn){--bt[Wn]===0&&Re.push(Wn)});if(on!==z)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function tQ(Gr){var on=[];return Qf(I,function(Wn,Cl){Mt(Wn)&&jI(Wn,Gr,0)>=0&&on.push(Cl)}),on}};function Bd(I,P){for(var R=-1,O=I==null?0:I.length,z=Array(O);++R<O;)z[R]=P(I[R],R,I);return z}var VL="[object Symbol]";function BL(I){return typeof I=="symbol"||W(I)&&Y(I)==VL}var qL=1/0,E1=de?de.prototype:void 0,P1=E1?E1.toString:void 0;function iw(I){if(typeof I=="string")return I;if(Mt(I))return Bd(I,iw)+"";if(BL(I))return P1?P1.call(I):"";var P=I+"";return P=="0"&&1/I==-qL?"-0":P}function JL(I,P,R){var O=-1,z=I.length;P<0&&(P=-P>z?0:z+P),R=R>z?z:R,R<0&&(R+=z),z=P>R?0:R-P>>>0,P>>>=0;for(var G=Array(z);++O<z;)G[O]=I[O+P];return G}function $L(I,P,R){var O=I.length;return R=R===void 0?O:R,!P&&R>=O?I:JL(I,P,R)}function HL(I,P){for(var R=I.length;R--&&jI(P,I[R],0)>-1;);return R}function GL(I,P){for(var R=-1,O=I.length;++R<O&&jI(P,I[R],0)>-1;);return R}function zL(I){return I.split("")}var QL="\\ud800-\\udfff",YL="\\u0300-\\u036f",XL="\\ufe20-\\ufe2f",ZL="\\u20d0-\\u20ff",eU=YL+XL+ZL,tU="\\ufe0e\\ufe0f",rU="\\u200d",nU=RegExp("["+rU+QL+eU+tU+"]");function iU(I){return nU.test(I)}var k1="\\ud800-\\udfff",oU="\\u0300-\\u036f",sU="\\ufe20-\\ufe2f",aU="\\u20d0-\\u20ff",cU=oU+sU+aU,lU="\\ufe0e\\ufe0f",uU="["+k1+"]",ow="["+cU+"]",sw="\\ud83c[\\udffb-\\udfff]",pU="(?:"+ow+"|"+sw+")",D1="[^"+k1+"]",_1="(?:\\ud83c[\\udde6-\\uddff]){2}",T1="[\\ud800-\\udbff][\\udc00-\\udfff]",dU="\\u200d",R1=pU+"?",A1="["+lU+"]?",mU="(?:"+dU+"(?:"+[D1,_1,T1].join("|")+")"+A1+R1+")*",fU=A1+R1+mU,hU="(?:"+[D1+ow+"?",ow,_1,T1,uU].join("|")+")",gU=RegExp(sw+"(?="+sw+")|"+hU+fU,"g");function vU(I){return I.match(gU)||[]}function N1(I){return iU(I)?vU(I):zL(I)}function yU(I){return I==null?"":iw(I)}var bU=/^\s+|\s+$/g;function IU(I,P,R){if(I=yU(I),I&&(R||P===void 0))return I.replace(bU,"");if(!I||!(P=iw(P)))return I;var O=N1(I),z=N1(P),G=GL(O,z),se=HL(O,z)+1;return $L(O,G,se).join("")}var SU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,xU=/,/,CU=/(=.+)?(\s*)$/,wU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function EU(I){return I=I.toString().replace(wU,""),I=I.match(SU)[2].replace(" ",""),I=I?I.split(xU):[],I=I.map(function(P){return IU(P.replace(CU,""))}),I}function M1(I,P){var R={};Qf(I,function(O,z){var G,se=b(O),pe=!se&&O.length===1||se&&O.length===0;if(Mt(O))G=O.slice(0,-1),O=O[O.length-1],R[z]=G.concat(G.length>0?Te:O);else if(pe)R[z]=O;else{if(G=EU(O),O.length===0&&!se&&G.length===0)throw new Error("autoInject task functions require explicit parameters.");se||G.pop(),R[z]=G.concat(Te)}function Te(tt,Re){var bt=Bd(G,function(Vr){return tt[Vr]});bt.push(Re),w(O).apply(null,bt)}}),nw(R,P)}function ls(){this.head=this.tail=null,this.length=0}function O1(I,P){I.length=1,I.head=I.tail=P}ls.prototype.removeLink=function(I){return I.prev?I.prev.next=I.next:this.head=I.next,I.next?I.next.prev=I.prev:this.tail=I.prev,I.prev=I.next=null,this.length-=1,I},ls.prototype.empty=function(){for(;this.head;)this.shift();return this},ls.prototype.insertAfter=function(I,P){P.prev=I,P.next=I.next,I.next?I.next.prev=P:this.tail=P,I.next=P,this.length+=1},ls.prototype.insertBefore=function(I,P){P.prev=I.prev,P.next=I,I.prev?I.prev.next=P:this.head=P,I.prev=P,this.length+=1},ls.prototype.unshift=function(I){this.head?this.insertBefore(this.head,I):O1(this,I)},ls.prototype.push=function(I){this.tail?this.insertAfter(this.tail,I):O1(this,I)},ls.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ls.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ls.prototype.toArray=function(){for(var I=Array(this.length),P=this.head,R=0;R<this.length;R++)I[R]=P.data,P=P.next;return I},ls.prototype.remove=function(I){for(var P=this.head;P;){var R=P.next;I(P)&&this.removeLink(P),P=R}return this};function K1(I,P,R){if(P==null)P=1;else if(P===0)throw new Error("Concurrency must not be zero");var O=w(I),z=0,G=[],se=!1;function pe(bt,Vr,bi){if(bi!=null&&typeof bi!="function")throw new Error("task callback must be a function");if(Re.started=!0,Mt(bt)||(bt=[bt]),bt.length===0&&Re.idle())return u(function(){Re.drain()});for(var ja=0,us=bt.length;ja<us;ja++){var Wa={data:bt[ja],callback:bi||Nt};Vr?Re._tasks.unshift(Wa):Re._tasks.push(Wa)}se||(se=!0,u(function(){se=!1,Re.process()}))}function Te(bt){return function(Vr){z-=1;for(var bi=0,ja=bt.length;bi<ja;bi++){var us=bt[bi],Wa=jI(G,us,0);Wa===0?G.shift():Wa>0&&G.splice(Wa,1),us.callback.apply(us,arguments),Vr!=null&&Re.error(Vr,us.data)}z<=Re.concurrency-Re.buffer&&Re.unsaturated(),Re.idle()&&Re.drain(),Re.process()}}var tt=!1,Re={_tasks:new ls,concurrency:P,payload:R,saturated:Nt,unsaturated:Nt,buffer:P/4,empty:Nt,drain:Nt,error:Nt,started:!1,paused:!1,push:function(bt,Vr){pe(bt,!1,Vr)},kill:function(){Re.drain=Nt,Re._tasks.empty()},unshift:function(bt,Vr){pe(bt,!0,Vr)},remove:function(bt){Re._tasks.remove(bt)},process:function(){if(!tt){for(tt=!0;!Re.paused&&z<Re.concurrency&&Re._tasks.length;){var bt=[],Vr=[],bi=Re._tasks.length;Re.payload&&(bi=Math.min(bi,Re.payload));for(var ja=0;ja<bi;ja++){var us=Re._tasks.shift();bt.push(us),G.push(us),Vr.push(us.data)}z+=1,Re._tasks.length===0&&Re.empty(),z===Re.concurrency&&Re.saturated();var Wa=ra(Te(bt));O(Vr,Wa)}tt=!1}},length:function(){return Re._tasks.length},running:function(){return z},workersList:function(){return G},idle:function(){return Re._tasks.length+z===0},pause:function(){Re.paused=!0},resume:function(){Re.paused!==!1&&(Re.paused=!1,u(Re.process))}};return Re}function F1(I,P){return K1(I,1,P)}var qd=jn(Mu,1);function xl(I,P,R,O){O=or(O||Nt);var z=w(R);qd(I,function(G,se,pe){z(P,G,function(Te,tt){P=tt,pe(Te)})},function(G){O(G,P)})}function aw(){var I=Bd(arguments,w);return function(){var P=e(arguments),R=this,O=P[P.length-1];typeof O=="function"?P.pop():O=Nt,xl(I,P,function(z,G,se){G.apply(R,z.concat(function(pe){var Te=e(arguments,1);se(pe,Te)}))},function(z,G){O.apply(R,[z].concat(G))})}}var L1=function(){return aw.apply(null,e(arguments).reverse())},PU=Array.prototype.concat,WI=function(I,P,R,O){O=O||Nt;var z=w(R);Vd(I,P,function(G,se){z(G,function(pe){return pe?se(pe):se(null,e(arguments,1))})},function(G,se){for(var pe=[],Te=0;Te<se.length;Te++)se[Te]&&(pe=PU.apply(pe,se[Te]));return O(G,pe)})},U1=jn(WI,1/0),j1=jn(WI,1),W1=function(){var I=e(arguments),P=[null].concat(I);return function(){var R=arguments[arguments.length-1];return R.apply(this,P)}};function Yf(I){return I}function Jd(I,P){return function(R,O,z,G){G=G||Nt;var se=!1,pe;R(O,function(Te,tt,Re){z(Te,function(bt,Vr){bt?Re(bt):I(Vr)&&!pe?(se=!0,pe=P(!0,Te),Re(null,Li)):Re()})},function(Te){Te?G(Te):G(null,se?pe:P(!1))})}}function V1(I,P){return P}var VI=jd(Jd(Yf,V1)),Xf=Wd(Jd(Yf,V1)),BI=jn(Xf,1);function B1(I){return function(P){var R=e(arguments,1);R.push(function(O){var z=e(arguments,1);typeof console=="object"&&(O?console.error&&console.error(O):console[I]&&UI(z,function(G){console[I](G)}))}),w(P).apply(null,R)}}var q1=B1("dir");function J1(I,P,R){R=ra(R||Nt);var O=w(I),z=w(P);function G(pe){if(pe)return R(pe);var Te=e(arguments,1);Te.push(se),z.apply(this,Te)}function se(pe,Te){if(pe)return R(pe);if(!Te)return R(null);O(G)}se(null,!0)}function cw(I,P,R){R=ra(R||Nt);var O=w(I),z=function(G){if(G)return R(G);var se=e(arguments,1);if(P.apply(this,se))return O(z);R.apply(null,[null].concat(se))};O(z)}function $1(I,P,R){cw(I,function(){return!P.apply(this,arguments)},R)}function H1(I,P,R){R=ra(R||Nt);var O=w(P),z=w(I);function G(pe){if(pe)return R(pe);z(se)}function se(pe,Te){if(pe)return R(pe);if(!Te)return R(null);O(G)}z(se)}function G1(I){return function(P,R,O){return I(P,O)}}function qI(I,P,R){Sl(I,G1(w(P)),R)}function Zf(I,P,R,O){FI(P)(I,G1(w(R)),O)}var eh=jn(Zf,1);function lw(I){return b(I)?I:n(function(P,R){var O=!0;P.push(function(){var z=arguments;O?u(function(){R.apply(null,z)}):R.apply(null,z)}),I.apply(this,P),O=!1})}function JI(I){return!I}var $I=jd(Jd(JI,JI)),th=Wd(Jd(JI,JI)),HI=jn(th,1);function z1(I){return function(P){return P?.[I]}}function kU(I,P,R,O){var z=new Array(P.length);I(P,function(G,se,pe){R(G,function(Te,tt){z[se]=!!tt,pe(Te)})},function(G){if(G)return O(G);for(var se=[],pe=0;pe<P.length;pe++)z[pe]&&se.push(P[pe]);O(null,se)})}function DU(I,P,R,O){var z=[];I(P,function(G,se,pe){R(G,function(Te,tt){Te?pe(Te):(tt&&z.push({index:se,value:G}),pe())})},function(G){G?O(G):O(null,Bd(z.sort(function(se,pe){return se.index-pe.index}),z1("value")))})}function uw(I,P,R,O){var z=en(P)?kU:DU;z(I,P,w(R),O||Nt)}var GI=jd(uw),rh=Wd(uw),zI=jn(rh,1);function Q1(I,P){var R=ra(P||Nt),O=w(lw(I));function z(G){if(G)return R(G);O(z)}z()}var QI=function(I,P,R,O){O=O||Nt;var z=w(R);Vd(I,P,function(G,se){z(G,function(pe,Te){return pe?se(pe):se(null,{key:Te,val:G})})},function(G,se){for(var pe={},Te=Object.prototype.hasOwnProperty,tt=0;tt<se.length;tt++)if(se[tt]){var Re=se[tt].key,bt=se[tt].val;Te.call(pe,Re)?pe[Re].push(bt):pe[Re]=[bt]}return O(G,pe)})},Y1=jn(QI,1/0),X1=jn(QI,1),Z1=B1("log");function YI(I,P,R,O){O=or(O||Nt);var z={},G=w(R);Mu(I,P,function(se,pe,Te){G(se,pe,function(tt,Re){if(tt)return Te(tt);z[pe]=Re,Te()})},function(se){O(se,z)})}var eR=jn(YI,1/0),tR=jn(YI,1);function rR(I,P){return P in I}function nR(I,P){var R=Object.create(null),O=Object.create(null);P=P||Yf;var z=w(I),G=n(function(pe,Te){var tt=P.apply(null,pe);rR(R,tt)?u(function(){Te.apply(null,R[tt])}):rR(O,tt)?O[tt].push(Te):(O[tt]=[Te],z.apply(null,pe.concat(function(){var Re=e(arguments);R[tt]=Re;var bt=O[tt];delete O[tt];for(var Vr=0,bi=bt.length;Vr<bi;Vr++)bt[Vr].apply(null,Re)})))});return G.memo=R,G.unmemoized=I,G}var XI;s?XI=process.nextTick:o?XI=setImmediate:XI=a;var iR=c(XI);function pw(I,P,R){R=R||Nt;var O=en(P)?[]:{};I(P,function(z,G,se){w(z)(function(pe,Te){arguments.length>2&&(Te=e(arguments,1)),O[G]=Te,se(pe)})},function(z){R(z,O)})}function oR(I,P){pw(Sl,I,P)}function sR(I,P,R){pw(FI(P),I,R)}var dw=function(I,P){var R=w(I);return K1(function(O,z){R(O[0],z)},P,1)},aR=function(I,P){var R=dw(I,P);return R.push=function(O,z,G){if(G==null&&(G=Nt),typeof G!="function")throw new Error("task callback must be a function");if(R.started=!0,Mt(O)||(O=[O]),O.length===0)return u(function(){R.drain()});z=z||0;for(var se=R._tasks.head;se&&z>=se.priority;)se=se.next;for(var pe=0,Te=O.length;pe<Te;pe++){var tt={data:O[pe],priority:z,callback:G};se?R._tasks.insertBefore(se,tt):R._tasks.push(tt)}u(R.process)},delete R.unshift,R};function cR(I,P){if(P=or(P||Nt),!Mt(I))return P(new TypeError("First argument to race must be an array of functions"));if(!I.length)return P();for(var R=0,O=I.length;R<O;R++)w(I[R])(P)}function ZI(I,P,R,O){var z=e(I).reverse();xl(z,P,R,O)}function eS(I){var P=w(I);return n(function(O,z){return O.push(function(se,pe){if(se)z(null,{error:se});else{var Te;arguments.length<=2?Te=pe:Te=e(arguments,1),z(null,{value:Te})}}),P.apply(this,O)})}function lR(I){var P;return Mt(I)?P=Bd(I,eS):(P={},Qf(I,function(R,O){P[O]=eS.call(this,R)})),P}function uR(I,P,R,O){uw(I,P,function(z,G){R(z,function(se,pe){G(se,!pe)})},O)}var pR=jd(uR),mw=Wd(uR),dR=jn(mw,1);function mR(I){return function(){return I}}function tS(I,P,R){var O=5,z=0,G={times:O,intervalFunc:mR(z)};function se(Re,bt){if(typeof bt=="object")Re.times=+bt.times||O,Re.intervalFunc=typeof bt.interval=="function"?bt.interval:mR(+bt.interval||z),Re.errorFilter=bt.errorFilter;else if(typeof bt=="number"||typeof bt=="string")Re.times=+bt||O;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof I=="function"?(R=P||Nt,P=I):(se(G,I),R=R||Nt),typeof P!="function")throw new Error("Invalid arguments for async.retry");var pe=w(P),Te=1;function tt(){pe(function(Re){Re&&Te++<G.times&&(typeof G.errorFilter!="function"||G.errorFilter(Re))?setTimeout(tt,G.intervalFunc(Te)):R.apply(null,arguments)})}tt()}var fR=function(I,P){P||(P=I,I=null);var R=w(P);return n(function(O,z){function G(se){R.apply(null,O.concat(se))}I?tS(I,G,z):tS(G,z)})};function hR(I,P){pw(qd,I,P)}var rS=jd(Jd(Boolean,Yf)),nh=Wd(Jd(Boolean,Yf)),nS=jn(nh,1);function gR(I,P,R){var O=w(P);LI(I,function(G,se){O(G,function(pe,Te){if(pe)return se(pe);se(null,{value:G,criteria:Te})})},function(G,se){if(G)return R(G);R(null,Bd(se.sort(z),z1("value")))});function z(G,se){var pe=G.criteria,Te=se.criteria;return pe<Te?-1:pe>Te?1:0}}function vR(I,P,R){var O=w(I);return n(function(z,G){var se=!1,pe;function Te(){var tt=I.name||"anonymous",Re=new Error('Callback function "'+tt+'" timed out.');Re.code="ETIMEDOUT",R&&(Re.info=R),se=!0,G(Re)}z.push(function(){se||(G.apply(null,arguments),clearTimeout(pe))}),pe=setTimeout(Te,P),O.apply(null,z)})}var _=Math.ceil,U=Math.max;function et(I,P,R,O){for(var z=-1,G=U(_((P-I)/(R||1)),0),se=Array(G);G--;)se[O?G:++z]=I,I+=R;return se}function ih(I,P,R,O){var z=w(R);Vd(et(0,I,1),P,z,O)}var _U=jn(ih,1/0),TU=jn(ih,1);function RU(I,P,R,O){arguments.length<=3&&(O=R,R=P,P=Mt(I)?[]:{}),O=or(O||Nt);var z=w(R);Sl(I,function(G,se,pe){z(P,G,se,pe)},function(G){O(G,P)})}function AU(I,P){var R=null,O;P=P||Nt,eh(I,function(z,G){w(z)(function(se,pe){arguments.length>2?O=e(arguments,1):O=pe,R=se,G(!se)})},function(){P(R,O)})}function NU(I){return function(){return(I.unmemoized||I).apply(null,arguments)}}function yR(I,P,R){R=ra(R||Nt);var O=w(P);if(!I())return R(null);var z=function(G){if(G)return R(G);if(I())return O(z);var se=e(arguments,1);R.apply(null,[null].concat(se))};O(z)}function MU(I,P,R){yR(function(){return!I.apply(this,arguments)},P,R)}var OU=function(I,P){if(P=or(P||Nt),!Mt(I))return P(new Error("First argument to waterfall must be an array of functions"));if(!I.length)return P();var R=0;function O(G){var se=w(I[R++]);G.push(ra(z)),se.apply(null,G)}function z(G){if(G||R===I.length)return P.apply(null,arguments);O(e(arguments,1))}O([])},Zz={apply:t,applyEach:C1,applyEachSeries:w1,asyncify:p,auto:nw,autoInject:M1,cargo:F1,compose:L1,concat:U1,concatLimit:WI,concatSeries:j1,constant:W1,detect:VI,detectLimit:Xf,detectSeries:BI,dir:q1,doDuring:J1,doUntil:$1,doWhilst:cw,during:H1,each:qI,eachLimit:Zf,eachOf:Sl,eachOfLimit:Mu,eachOfSeries:qd,eachSeries:eh,ensureAsync:lw,every:$I,everyLimit:th,everySeries:HI,filter:GI,filterLimit:rh,filterSeries:zI,forever:Q1,groupBy:Y1,groupByLimit:QI,groupBySeries:X1,log:Z1,map:LI,mapLimit:Vd,mapSeries:rw,mapValues:eR,mapValuesLimit:YI,mapValuesSeries:tR,memoize:nR,nextTick:iR,parallel:oR,parallelLimit:sR,priorityQueue:aR,queue:dw,race:cR,reduce:xl,reduceRight:ZI,reflect:eS,reflectAll:lR,reject:pR,rejectLimit:mw,rejectSeries:dR,retry:tS,retryable:fR,seq:aw,series:hR,setImmediate:u,some:rS,someLimit:nh,someSeries:nS,sortBy:gR,timeout:vR,times:_U,timesLimit:ih,timesSeries:TU,transform:RU,tryEach:AU,unmemoize:NU,until:MU,waterfall:OU,whilst:yR,all:$I,allLimit:th,allSeries:HI,any:rS,anyLimit:nh,anySeries:nS,find:VI,findLimit:Xf,findSeries:BI,forEach:qI,forEachSeries:eh,forEachLimit:Zf,forEachOf:Sl,forEachOfSeries:qd,forEachOfLimit:Mu,inject:xl,foldl:xl,foldr:ZI,select:GI,selectLimit:rh,selectSeries:zI,wrapSync:p};r.default=Zz,r.apply=t,r.applyEach=C1,r.applyEachSeries=w1,r.asyncify=p,r.auto=nw,r.autoInject=M1,r.cargo=F1,r.compose=L1,r.concat=U1,r.concatLimit=WI,r.concatSeries=j1,r.constant=W1,r.detect=VI,r.detectLimit=Xf,r.detectSeries=BI,r.dir=q1,r.doDuring=J1,r.doUntil=$1,r.doWhilst=cw,r.during=H1,r.each=qI,r.eachLimit=Zf,r.eachOf=Sl,r.eachOfLimit=Mu,r.eachOfSeries=qd,r.eachSeries=eh,r.ensureAsync=lw,r.every=$I,r.everyLimit=th,r.everySeries=HI,r.filter=GI,r.filterLimit=rh,r.filterSeries=zI,r.forever=Q1,r.groupBy=Y1,r.groupByLimit=QI,r.groupBySeries=X1,r.log=Z1,r.map=LI,r.mapLimit=Vd,r.mapSeries=rw,r.mapValues=eR,r.mapValuesLimit=YI,r.mapValuesSeries=tR,r.memoize=nR,r.nextTick=iR,r.parallel=oR,r.parallelLimit=sR,r.priorityQueue=aR,r.queue=dw,r.race=cR,r.reduce=xl,r.reduceRight=ZI,r.reflect=eS,r.reflectAll=lR,r.reject=pR,r.rejectLimit=mw,r.rejectSeries=dR,r.retry=tS,r.retryable=fR,r.seq=aw,r.series=hR,r.setImmediate=u,r.some=rS,r.someLimit=nh,r.someSeries=nS,r.sortBy=gR,r.timeout=vR,r.times=_U,r.timesLimit=ih,r.timesSeries=TU,r.transform=RU,r.tryEach=AU,r.unmemoize=NU,r.until=MU,r.waterfall=OU,r.whilst=yR,r.all=$I,r.allLimit=th,r.allSeries=HI,r.any=rS,r.anyLimit=nh,r.anySeries=nS,r.find=VI,r.findLimit=Xf,r.findSeries=BI,r.forEach=qI,r.forEachSeries=eh,r.forEachLimit=Zf,r.forEachOf=Sl,r.forEachOfSeries=qd,r.forEachOfLimit=Mu,r.inject=xl,r.foldl=xl,r.foldr=ZI,r.select=GI,r.selectLimit=rh,r.selectSeries=zI,r.wrapSync=p,Object.defineProperty(r,"__esModule",{value:!0})})});var aF=N((OZe,bH)=>{"use strict";function pge(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=o,t.enabled=a,t.humanize=DP(),Object.keys(r).forEach(function(l){t[l]=r[l]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(l){for(var u=0,p=0;p<l.length;p++)u=(u<<5)-u+l.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(l){var u;function p(){if(p.enabled){for(var m=arguments.length,h=new Array(m),v=0;v<m;v++)h[v]=arguments[v];var b=p,w=Number(new Date),D=w-(u||w);b.diff=D,b.prev=u,b.curr=w,u=w,h[0]=t.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var T=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(ee,de){if(ee==="%%")return ee;T++;var Z=t.formatters[de];if(typeof Z=="function"){var ye=h[T];ee=Z.call(b,ye),h.splice(T,1),T--}return ee}),t.formatArgs.call(b,h);var F=b.log||t.log;F.apply(b,h)}}return p.namespace=l,p.enabled=t.enabled(l),p.useColors=t.useColors(),p.color=e(l),p.destroy=n,p.extend=i,typeof t.init=="function"&&t.init(p),t.instances.push(p),p}function n(){var l=t.instances.indexOf(this);return l!==-1?(t.instances.splice(l,1),!0):!1}function i(l,u){return t(this.namespace+(typeof u>"u"?":":u)+l)}function o(l){t.save(l),t.names=[],t.skips=[];var u,p=(typeof l=="string"?l:"").split(/[\s,]+/),m=p.length;for(u=0;u<m;u++)p[u]&&(l=p[u].replace(/\*/g,".*?"),l[0]==="-"?t.skips.push(new RegExp("^"+l.substr(1)+"$")):t.names.push(new RegExp("^"+l+"$")));for(u=0;u<t.instances.length;u++){var h=t.instances[u];h.enabled=t.enabled(h.namespace)}}function s(){t.enable("")}function a(l){if(l[l.length-1]==="*")return!0;var u,p;for(u=0,p=t.skips.length;u<p;u++)if(t.skips[u].test(l))return!1;for(u=0,p=t.names.length;u<p;u++)if(t.names[u].test(l))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}return t.enable(t.load()),t}bH.exports=pge});var IH=N((Ws,R_)=>{"use strict";function T_(r){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?T_=function(t){return typeof t}:T_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T_(r)}Ws.log=fge;Ws.formatArgs=mge;Ws.save=hge;Ws.load=gge;Ws.useColors=dge;Ws.storage=vge();Ws.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dge(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mge(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+R_.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;r.splice(1,0,e,"color: inherit");var t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}}function fge(){var r;return(typeof console>"u"?"undefined":T_(console))==="object"&&console.log&&(r=console).log.apply(r,arguments)}function hge(r){try{r?Ws.storage.setItem("debug",r):Ws.storage.removeItem("debug")}catch{}}function gge(){var r;try{r=Ws.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function vge(){try{return localStorage}catch{}}R_.exports=aF()(Ws);var yge=R_.exports.formatters;yge.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var xH=N((Oi,M_)=>{"use strict";var bge=require("tty"),N_=require("util");Oi.init=Pge;Oi.log=Cge;Oi.formatArgs=Sge;Oi.save=wge;Oi.load=Ege;Oi.useColors=Ige;Oi.colors=[6,2,3,4,5,1];try{A_=TP(),A_&&(A_.stderr||A_).level>=2&&(Oi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var A_;Oi.inspectOpts=Object.keys(process.env).filter(function(r){return/^debug_/i.test(r)}).reduce(function(r,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),n=process.env[e];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[t]=n,r},{});function Ige(){return"colors"in Oi.inspectOpts?!!Oi.inspectOpts.colors:bge.isatty(process.stderr.fd)}function Sge(r){var e=this.namespace,t=this.useColors;if(t){var n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o="  ".concat(i,";1m").concat(e," \x1B[0m");r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+M_.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=xge()+e+" "+r[0]}function xge(){return Oi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Cge(){return process.stderr.write(N_.format.apply(N_,arguments)+`
`)}function wge(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function Ege(){return process.env.DEBUG}function Pge(r){r.inspectOpts={};for(var e=Object.keys(Oi.inspectOpts),t=0;t<e.length;t++)r.inspectOpts[e[t]]=Oi.inspectOpts[e[t]]}M_.exports=aF()(Oi);var SH=M_.exports.formatters;SH.o=function(r){return this.inspectOpts.colors=this.useColors,N_.inspect(r,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};SH.O=function(r){return this.inspectOpts.colors=this.useColors,N_.inspect(r,this.inspectOpts)}});var CH=N((KZe,cF)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?cF.exports=IH():cF.exports=xH()});var kH=N((FZe,PH)=>{var lC=require("path"),wH=require("fs"),EH=parseInt("0777",8);PH.exports=ky.mkdirp=ky.mkdirP=ky;function ky(r,e,t,n){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||wH;i===void 0&&(i=EH),n||(n=null);var s=t||function(){};r=lC.resolve(r),o.mkdir(r,i,function(a){if(!a)return n=n||r,s(null,n);switch(a.code){case"ENOENT":if(lC.dirname(r)===r)return s(a);ky(lC.dirname(r),e,function(c,l){c?s(c,l):ky(r,e,s,l)});break;default:o.stat(r,function(c,l){c||!l.isDirectory()?s(a,n):s(null,n)});break}})}ky.sync=function r(e,t,n){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||wH;i===void 0&&(i=EH),n||(n=null),e=lC.resolve(e);try{o.mkdirSync(e,i),n=n||e}catch(a){switch(a.code){case"ENOENT":n=r(lC.dirname(e),t,n),r(e,t,n);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return n}});var TH=N(Sr=>{"use strict";var DH=require("fs"),kge=require("os"),Dge=require("net"),O_=require("path"),_H=yH(),pF=CH(),_ge=kH().mkdirp,lF=pF("portfinder:testPort"),uC=pF("portfinder:getPort"),Tge=pF("portfinder:defaultHosts"),uF={};uF.testPort=function(r,e){e||(e=r,r={}),r.server=r.server||Dge.createServer(function(){}),lF("entered testPort(): trying",r.host,"port",r.port);function t(){lF("done w/ testPort(): OK",r.host,"port",r.port),r.server.removeListener("error",n),r.server.close(),e(null,r.port)}function n(i){if(lF("done w/ testPort(): failed",r.host,"w/ port",r.port,"with error",i.code),r.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Sr.nextPort(r.port);if(o>Sr.highestPort)return e(new Error("No open ports available"));uF.testPort({port:o,host:r.host,server:r.server},e)}r.server.once("error",n),r.server.once("listening",t),r.host?r.server.listen(r.port,r.host):r.server.listen(r.port)};Sr.basePort=8e3;Sr.highestPort=65535;Sr.basePath="/tmp/portfinder";Sr.getPort=function(r,e){if(e||(e=r,r={}),r.port=Number(r.port)||Number(Sr.basePort),r.host=r.host||null,r.stopPort=Number(r.stopPort)||Number(Sr.highestPort),!r.startPort){if(r.startPort=Number(r.port),r.startPort<0)throw Error("Provided options.startPort("+r.startPort+") is less than 0, which are cannot be bound.");if(r.stopPort<r.startPort)throw Error("Provided options.stopPort("+r.stopPort+"is less than options.startPort ("+r.startPort+")")}if(r.host){for(var t,n=0;n<Sr._defaultHosts.length;n++)if(Sr._defaultHosts[n]===r.host){t=!0;break}t||Sr._defaultHosts.push(r.host)}var i=[],o;return _H.eachSeries(Sr._defaultHosts,function(s,a){return uC("in eachSeries() iteration callback: host is",s),uF.testPort({host:s,port:r.port},function(c,l){return c?(uC("in eachSeries() iteration callback testPort() callback","with an err:",c.code),o=s,a(c)):(uC("in eachSeries() iteration callback testPort() callback","with a success for port",l),i.push(l),a())})},function(s){if(s)if(uC("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(r.host===o){var a="Provided host "+r.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var c=Sr._defaultHosts.indexOf(o);return Sr._defaultHosts.splice(c,1),Sr.getPort(r,e)}else return e(s);if(i.sort(function(l,u){return l-u}),uC("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=r.stopPort)return e(null,i[0]);var a="No open ports found in between "+r.startPort+" and "+r.stopPort;return e(Error(a))}else return Sr.getPort({port:i.pop(),host:r.host,startPort:r.startPort,stopPort:r.stopPort},e)})};Sr.getPortPromise=function(r){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return r||(r={}),new Promise(function(e,t){Sr.getPort(r,function(n,i){if(n)return t(n);e(i)})})};Sr.getPorts=function(r,e,t){t||(t=e,e={});var n=null;_H.timesSeries(r,function(i,o){n&&(e.port=Sr.nextPort(n)),Sr.getPort(e,function(s,a){s?o(s):(n=a,o(null,a))})},t)};Sr.getSocket=function(r,e){e||(e=r,r={}),r.mod=r.mod||parseInt(755,8),r.path=r.path||Sr.basePath+".sock";function t(){DH.stat(r.path,function(o){o?o.code=="ENOENT"?e(null,r.path):e(o):(r.path=Sr.nextSocket(r.path),Sr.getSocket(r,e))})}function n(o){_ge(o,r.mod,function(s){if(s)return e(s);r.exists=!0,t()})}function i(){var o=O_.dirname(r.path);DH.stat(o,function(s,a){if(s||!a.isDirectory())return n(o);r.exists=!0,t()})}return r.exists?t():i()};Sr.nextPort=function(r){return r+1};Sr.nextSocket=function(r){var e=O_.dirname(r),t=O_.basename(r,".sock"),n=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(n[2]),o=n[1];return isNaN(i)&&(i=0),i+=1,O_.join(e,o+i+".sock")};Sr._defaultHosts=function(){var r={};try{r=kge.networkInterfaces()}catch(c){if(c.syscall!=="uv_interface_addresses")throw c}for(var e=Object.keys(r),t="0.0.0.0",n=[t],i=0;i<e.length;i++)for(var o=r[e[i]],s=0;s<o.length;s++){var a=o[s];n.push(a.address)}return n.push(null),Tge("exports._defaultHosts is: %o",n),n}()});var FH=N(Dy=>{"use strict";Object.defineProperty(Dy,"__esModule",{value:!0});Dy.encode=Dy.decode=void 0;var MH=require("crypto"),mF="<IDS|MSG>",Rge=5;function U_(r){return JSON.parse(r.toString())}function OH(r){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},r)}function KH(r){let e=r;switch(r){case"hmac-sha256":e="sha256";break}return e}function Age(r,e,t="sha256"){var n=0;let i=[];for(n=0;n<r.length;n++){var o=r[n];if(o.toString()===mF)break;i.push(o)}if(r.length-n<Rge)throw new Error("Message Decoding: Not enough message frames");if(r[n].toString()!==mF)throw new Error("Message Decoding: Missing delimiter");if(e){let u=KH(t);var s=r[n+1].toString(),a=MH.createHmac(u,e);a.update(r[n+2]),a.update(r[n+3]),a.update(r[n+4]),a.update(r[n+5]);var c=a.digest("hex");if(c!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${c}"`)}var l=OH({idents:i,header:U_(r[n+2]),parent_header:U_(r[n+3]),content:U_(r[n+5]),metadata:U_(r[n+4]),buffers:Array.prototype.slice.apply(r,[n+6])});return l}Dy.decode=Age;function Nge(r,e,t="sha256"){let n=OH(r),i=KH(t),o=n.idents,s=Buffer.from(JSON.stringify(n.header),"utf-8"),a=Buffer.from(JSON.stringify(n.parent_header),"utf-8"),c=Buffer.from(JSON.stringify(n.metadata),"utf-8"),l=Buffer.from(JSON.stringify(n.content),"utf-8"),u="";if(e){let m=MH.createHmac(i,e);m.update(s),m.update(a),m.update(c),m.update(l),u=m.digest("hex")}var p=o.concat([Buffer.from(mF),Buffer.from(u),s,a,c,l]).concat(n.buffers);return p}Dy.encode=Nge});var C4=N((put,x4)=>{"use strict";var rve=(r,e={})=>{let t=e.safe===!0||e.keepProtected===!0,n=!1,i=(o,s)=>{let a="",c,l;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&n===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){c=i(u,o),l=c.split(`
`),a+=`
`.repeat(l.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}n=!0;break;case"line":if(e.first&&n===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),n=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(r)};x4.exports=rve});var E4=N((dut,w4)=>{"use strict";var yT=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},CF=class extends yT{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};w4.exports={Node:yT,Block:CF}});var k4=N(P4=>{"use strict";P4.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var T4=N((fut,_4)=>{"use strict";var{Node:md,Block:D4}=E4(),nve=k4(),wF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},ive=(r,e={})=>{if(typeof r!="string")throw new TypeError("Expected input to be a string");let t=new D4({type:"root",nodes:[]}),n=[t],i=(e.language||"javascript").toLowerCase(),o=nve[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:c}=o,l=t,u=r,p,m,h=[a,c].filter(Boolean),v=!1;h.every(F=>F.source==='^"""')&&(v=!0);let b=(F=u[0]||"")=>(u=u.slice(F.length),F),w=(F,ee="text")=>{let de=F.exec(u);if(de)return b(de[0]),{type:ee,value:de[0],match:de}},D=F=>{if(m&&m.type==="text"&&F.type==="text"){m.value+=F.value;return}l.push(F),F.nodes&&(n.push(F),l=F),m=F},T=()=>{if(l.type==="root")throw new SyntaxError("Unclosed block comment");n.pop(),l=n[n.length-1]};for(;u!=="";){if(p=w(wF.ESCAPED_CHAR_REGEX,"text")){D(new md(p));continue}if(l.type!=="block"&&(!m||!/\w$/.test(m.value))&&!(v&&u.startsWith('"""'))&&(p=w(wF.QUOTED_STRING_REGEX,"text"))){D(new md(p));continue}if(p=w(wF.NEWLINE_REGEX,"newline")){D(new md(p));continue}if(a&&e.block&&!(v&&l.type==="block")&&(p=w(a,"open"))){D(new D4({type:"block"})),D(new md(p));continue}if(c&&l.type==="block"&&e.block&&(p=w(c,"close"))){p.newline=p.match[1]||"",D(new md(p)),T();continue}if(s&&l.type!=="block"&&e.line&&(p=w(s,"line"))){D(new md(p));continue}if(p=w(/^[a-zABD-Z0-9\t ]+/,"text")){D(new md(p));continue}D(new md({type:"text",value:b(u[0])}))}return t};_4.exports=ive});var A4=N((hut,R4)=>{"use strict";var bT=C4(),yC=T4(),IT=R4.exports=(r,e)=>{let t={...e,block:!0,line:!0};return bT(yC(r,t),t)};IT.block=(r,e)=>{let t={...e,block:!0};return bT(yC(r,t),t)};IT.line=(r,e)=>{let t={...e,line:!0};return bT(yC(r,t),t)};IT.first=(r,e)=>{let t={...e,block:!0,line:!0,first:!0};return bT(yC(r,t),t)};IT.parse=yC});var xG=N((Fkt,SG)=>{var Mve=typeof global=="object"&&global&&global.Object===Object&&global;SG.exports=Mve});var wG=N((Lkt,CG)=>{var Ove=xG(),Kve=typeof self=="object"&&self&&self.Object===Object&&self,Fve=Ove||Kve||Function("return this")();CG.exports=Fve});var m0=N((Ukt,EG)=>{var Lve=wG(),Uve=Lve.Symbol;EG.exports=Uve});var kG=N((jkt,PG)=>{function jve(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}PG.exports=jve});var _G=N((Wkt,DG)=>{var Wve=Array.isArray;DG.exports=Wve});var NG=N((Vkt,AG)=>{var TG=m0(),RG=Object.prototype,Vve=RG.hasOwnProperty,Bve=RG.toString,KC=TG?TG.toStringTag:void 0;function qve(r){var e=Vve.call(r,KC),t=r[KC];try{r[KC]=void 0;var n=!0}catch{}var i=Bve.call(r);return n&&(e?r[KC]=t:delete r[KC]),i}AG.exports=qve});var OG=N((Bkt,MG)=>{var Jve=Object.prototype,$ve=Jve.toString;function Hve(r){return $ve.call(r)}MG.exports=Hve});var UG=N((qkt,LG)=>{var KG=m0(),Gve=NG(),zve=OG(),Qve="[object Null]",Yve="[object Undefined]",FG=KG?KG.toStringTag:void 0;function Xve(r){return r==null?r===void 0?Yve:Qve:FG&&FG in Object(r)?Gve(r):zve(r)}LG.exports=Xve});var WG=N((Jkt,jG)=>{function Zve(r){return r!=null&&typeof r=="object"}jG.exports=Zve});var BG=N(($kt,VG)=>{var eye=UG(),tye=WG(),rye="[object Symbol]";function nye(r){return typeof r=="symbol"||tye(r)&&eye(r)==rye}VG.exports=nye});var zG=N((Hkt,GG)=>{var qG=m0(),iye=kG(),oye=_G(),sye=BG(),aye=1/0,JG=qG?qG.prototype:void 0,$G=JG?JG.toString:void 0;function HG(r){if(typeof r=="string")return r;if(oye(r))return iye(r,HG)+"";if(sye(r))return $G?$G.call(r):"";var e=r+"";return e=="0"&&1/r==-aye?"-0":e}GG.exports=HG});var YG=N((Gkt,QG)=>{var cye=zG();function lye(r){return r==null?"":cye(r)}QG.exports=lye});var ez=N((zkt,ZG)=>{var uye=YG(),XG=/[\\^$.*+?()[\]{}|]/g,pye=RegExp(XG.source);function dye(r){return r=uye(r),r&&pye.test(r)?r.replace(XG,"\\$&"):r}ZG.exports=dye});var oL=N((dWt,qz)=>{qz.exports=require("util").format});var cbe={};FU(cbe,{activate:()=>zye,deactivate:()=>Qye});module.exports=UU(cbe);Reflect.metadata===void 0&&WU();function Ou(){try{return(BU(),UU(VU)).isPreRelesVersionOfJupyterExtension===!0?"true":"false"}catch{return"true"}}var oS={isExiting:!1},fw="_builtin.JupyterServerSelectorForTesting",SR="_builtin.jupyterServerUrlProvider";var qU=!1;function JU(r){qU=r}function $d(){return qU}var $U=!1;function HU(r){$U=r}function Br(){return $U}var xe="python",sS="markdown",wl="vscode-notebook-cell",uQ={scheme:"untitled",language:xe},pQ={scheme:"file",language:xe},hw={language:xe},dQ={scheme:wl,language:xe},GU=[uQ,pQ,dQ],gw="vscode-interactive-input",It="jupyter-notebook",Et="interactive";var Va="GitHub.codespaces",Pt="ms-toolsai.jupyter",sh="ms-toolsai.jupyter-hub",zU="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",Ku="STANDARD_OUTPUT_CHANNEL",aS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(aS||={});var ps;(i=>(i.JupyterServerRemoteLaunchNameSeparator=`
`,i.JupyterServerRemoteLaunchService=Pt,i.JupyterServerUriListMax=10,i.IntellisenseTimeout=2e3))(ps||={});var Zn=!1;var mQ=!1;function Dr(){return mQ||cS()}var fQ=!1;function cS(){return fQ}var Ge;(b=>(b.GeneratedThemeName="ipython-theme",b.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",b.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",b.DefaultCodeCellMarker="# %%",b.DefaultCommTarget="jupyter.widget",b.ALL_VARIABLES="ALL_VARIABLES",b.KERNEL_VARIABLES="KERNEL_VARIABLES",b.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",b.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",b.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",b.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",b.REMOTE_URI="https://remote/",b.REMOTE_URI_ID_PARAM="id",b.REMOTE_URI_HANDLE_PARAM="uriHandle",b.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Ge||={});var Ba;(i=>(i.ImportIPython=`{0}
from IPython import get_ipython

{1}`,i.MatplotLibInit=`import matplotlib
%matplotlib inline
${Ge.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,i.UpdateCWDAndPath=`import os as _VSCODE_os
import sys as _VSCODE_sys
%cd "{0}"
if _VSCODE_os.getcwd() not in _VSCODE_sys.path:
    _VSCODE_sys.path.insert(0, _VSCODE_os.getcwd())

del _VSCODE_sys
del _VSCODE_os`,i.DisableJedi="%config Completer.use_jedi = False"))(Ba||={});var ah="JUPYTER_OUTPUT_CHANNEL",xR="Default Light+",ei="ms-python.python",ch="ms-toolsai.jupyter-renderers",Hd="ms-python.vscode-pylance",QU=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],YU=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),lS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var J;(Ce=>(Ce.RunAllCells="jupyter.runallcells",Ce.RunAllCellsAbove="jupyter.runallcellsabove",Ce.RunCellAndAllBelow="jupyter.runcellandallbelow",Ce.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",Ce.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",Ce.RunToLine="jupyter.runtoline",Ce.RunFromLine="jupyter.runfromline",Ce.RunCell="jupyter.runcell",Ce.RunCurrentCell="jupyter.runcurrentcell",Ce.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",Ce.CreateNewInteractive="jupyter.createnewinteractive",Ce.ImportNotebook="jupyter.importnotebook",Ce.ImportNotebookFile="jupyter.importnotebookfile",Ce.ExportFileAsNotebook="jupyter.exportfileasnotebook",Ce.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",Ce.InterruptKernel="jupyter.interruptkernel",Ce.RestartKernel="jupyter.restartkernel",Ce.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",Ce.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",Ce.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",Ce.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",Ce.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",Ce.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",Ce.ExpandAllCells="jupyter.expandallcells",Ce.CollapseAllCells="jupyter.collapseallcells",Ce.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",Ce.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",Ce.RunFileInInteractiveWindows="jupyter.runFileInteractive",Ce.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",Ce.AddCellBelow="jupyter.addcellbelow",Ce.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",Ce.DebugCell="jupyter.debugcell",Ce.DebugStepOver="jupyter.debugstepover",Ce.DebugContinue="jupyter.debugcontinue",Ce.DebugStop="jupyter.debugstop",Ce.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",Ce.InsertCellBelowPosition="jupyter.insertCellBelowPosition",Ce.InsertCellBelow="jupyter.insertCellBelow",Ce.InsertCellAbove="jupyter.insertCellAbove",Ce.DeleteCells="jupyter.deleteCells",Ce.SelectCell="jupyter.selectCell",Ce.SelectCellContents="jupyter.selectCellContents",Ce.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",Ce.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",Ce.MoveCellsUp="jupyter.moveCellsUp",Ce.MoveCellsDown="jupyter.moveCellsDown",Ce.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",Ce.ChangeCellToCode="jupyter.changeCellToCode",Ce.GotoNextCellInFile="jupyter.gotoNextCellInFile",Ce.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",Ce.ScrollToCell="jupyter.scrolltocell",Ce.CreateNewNotebook="jupyter.createnewnotebook",Ce.ViewJupyterOutput="jupyter.viewOutput",Ce.ExportAsPythonScript="jupyter.exportAsPythonScript",Ce.ExportToHTML="jupyter.exportToHTML",Ce.ExportToPDF="jupyter.exportToPDF",Ce.Export="jupyter.export",Ce.NativeNotebookExport="jupyter.notebookeditor.export",Ce.LatestExtension="jupyter.latestExtension",Ce.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",Ce.NotebookEditorExpandAllCells="jupyter.notebookeditor.expandallcells",Ce.NotebookEditorCollapseAllCells="jupyter.notebookeditor.collapseallcells",Ce.EnableDebugLogging="jupyter.enableDebugLogging",Ce.ResetLoggingLevel="jupyter.resetLoggingLevel",Ce.ShowDataViewer="jupyter.showDataViewer",Ce.RefreshDataViewer="jupyter.refreshDataViewer",Ce.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",Ce.OpenVariableView="jupyter.openVariableView",Ce.OpenOutlineView="jupyter.openOutlineView",Ce.InteractiveClearAll="jupyter.interactive.clearAllCells",Ce.InteractiveGoToCode="jupyter.interactive.goToCode",Ce.InteractiveCopyCell="jupyter.interactive.copyCell",Ce.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",Ce.InteractiveExportAs="jupyter.interactive.exportas",Ce.RunByLine="jupyter.runByLine",Ce.RunAndDebugCell="jupyter.runAndDebugCell",Ce.RunByLineNext="jupyter.runByLineNext",Ce.RunByLineStop="jupyter.runByLineStop",Ce.ReplayPylanceLog="jupyter.replayPylanceLog",Ce.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",Ce.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",Ce.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",Ce.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(J||={});var Fu;(n=>(n.DefaultDesignLenses=[J.RunCurrentCell,J.RunAllCellsAbove,J.DebugCell],n.DefaultDebuggingLenses=[J.DebugContinue,J.DebugStop,J.DebugStepOver],n.DebuggerCommands=[J.DebugContinue,J.DebugStop,J.DebugStepOver]))(Fu||={});var yr;(ue=>(ue.HasCodeCells="jupyter.hascodecells",ue.IsInteractiveActive="jupyter.isinteractiveactive",ue.OwnsSelection="jupyter.ownsSelection",ue.HaveNativeCells="jupyter.havenativecells",ue.HaveNative="jupyter.havenative",ue.IsNativeActive="jupyter.isnativeactive",ue.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",ue.IsPythonOrNativeActive="jupyter.ispythonornativeactive",ue.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",ue.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",ue.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",ue.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",ue.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",ue.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",ue.RunByLineCells="jupyter.notebookeditor.runByLineCells",ue.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",ue.DebugDocuments="jupyter.notebookeditor.debugDocuments",ue.IsPythonNotebook="jupyter.ispythonnotebook",ue.IsJupyterKernelSelected="jupyter.kernel.isjupyter",ue.IsDataViewerActive="jupyter.dataViewerActive",ue.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",ue.ZmqAvailable="jupyter.zmqavailable",ue.ReplayLogLoaded="jupyter.replayLogLoaded",ue.KernelSource="jupyter.kernelSource"))(yr||={});var Gd;(c=>(c.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,c.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,c.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",c.HttpPattern=/https?:\/\//,c.ShapeSplitterRegEx=/.*,\s*(\d+).*/,c.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,c.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,c.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(Gd||={});var XU=Symbol("DataScienceStartupTime"),CR={major:4,minor:2},Ui="application/vnd.jupyter.widget-view+json";var uS=7,pS="unknown";var mS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},dS=new Map;function ZU(){return dS}function ej(r,e){let t=e.map(n=>`${JSON.stringify(n)}`).join("-Arg-Separator-");return`KeyPrefix=${r}-Args=${t}`}var zd=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=dS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?dS.get(this.cacheKey)?.data:void 0}set data(e){let t=new mS(this.expiryDurationMs,e);dS.set(this.cacheKey,t)}clear(){dS.delete(this.cacheKey)}};async function ji(r){return new Promise(e=>{setTimeout(()=>e(r),r)})}async function yw(r,e,t){return new Promise(n=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{r().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),n(a)}})}function _r(r,e,...t){let n=vw(e)?void 0:e;vw(e)&&t.push(e);let i,o=setTimeout(()=>i?.(n),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function bw(r,e,...t){let n,i=setTimeout(()=>n?.(e),r);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>n=s)])}function Qd(r){return typeof r?.then=="function"&&typeof r?.catch=="function"}function vw(r){return typeof r?.then=="function"}var wR=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,n)=>{this._resolve=t,this._reject=n})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function ce(r=null){return new wR(r)}function ds(r){let e=ce();return r.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var lh=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=ce(),n=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await n,t.promise}chainFinally(e){let t=ce();return this.currentPromise=this.currentPromise.finally(()=>e().then(n=>t.resolve(n)).catch(n=>t.reject(n))),t.promise}};var Be=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};function f(){}function An(r){try{let e=r();Qd(e)&&e.catch(f)}catch{}}function ER(r,e,t){let n=new Be;try{t&&r(void 0);let i=e();return Qd(i)?i.then(o=>(r({elapsed:n.elapsedTime,returnValue:o}),o)).catch(o=>{r({elapsed:n.elapsedTime,err:o})}):r({elapsed:n.elapsedTime,returnValue:i}),i}catch(i){throw r({elapsed:n.elapsedTime,err:i}),i}}function Lu(r){if(!r)return!0;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function Vn(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function rj(r){let e=Vn(r)?r:r.uri;return e.scheme.includes(wl)||e.path.endsWith(".interactive")}function Uu(){return process.platform.toString()==="web"}function tj(r,e){return Vn(e)?e.toString():e}function Ro(r,e){return r===e?!0:r&&!e||!r&&e?!1:JSON.stringify(r,tj)===JSON.stringify(e,tj)}var nj=ZU();function PR(r){return function(e,t,n){let i=n.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;n.value=async function(...a){if(Dr())return i.apply(this,a);let c=ej(s,a),l=nj.get(c);if(l&&!l.expired)return E(`Cached data exists ${c}`),Promise.resolve(l.data);let u=i.apply(this,a);return u.then(p=>nj.set(c,new mS(r,p))).catch(f),u}}}function Nr(r){return function(e,t,n){let i=n.value,o=`Jupyter Extension (Error in ${r||t}, method:${t}):`;n.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(c=>{Dr()||x(o,c)})}catch(a){if(Dr())return;x(o,a)}}}}function ij(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:n,target:t},c=this;return ER(l=>r(a,l),()=>o.apply(c,s),e)},i}}function uh(){return function(r,e,t){let n=t.value;return t.value=function(...i){if(!Dr())throw new Error(`Function: ${e} can only be called from test code`);return n.apply(this,i)},t}}function kR(){return function(r,e,t){let n=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>n.apply(this,o)):s=n.apply(this,o),this[i]=s;let a=s.then(c=>c).catch(c=>{throw this[i]=void 0,c});return a.catch(f),a},t}}function DR(r,e){if(Array.isArray(r))return r.map(t=>DR(t,e)).join(", ");if(r===void 0)return"undefined";if(r===null)return"null";try{return r&&r.path?`<Uri:${r.path}>`:JSON.stringify(r)}catch{return`<${e} cannot be serialized for logging>`}}function _R(r){if(!r)return"";try{return r.map((t,n)=>{let i=DR(t,"argument");return`Arg ${n+1}: ${i}`}).join(", ")}catch{return""}}function oj(r){return`Return Value: ${DR(r,"Return value")}`}function Iw(){let r=new Date,e=String(r.getHours()).padStart(2,"0"),t=String(r.getMinutes()).padStart(2,"0"),n=String(r.getSeconds()).padStart(2,"0"),i=String(r.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${n}.${i}`}function Ke(r,e={removeEmptyEntries:!0,trim:!0}){r=r||"";let t=r.split(/\r?\n/g);return e&&e.trim&&(t=t.map(n=>n.trim())),e&&e.removeEmptyEntries&&(t=t.filter(n=>n.length>0)),t}function fS(r){return r&&(r.indexOf(" ")>=0&&!r.startsWith('"')&&!r.endsWith('"')?`"${r}"`:r.toString())}function hS(r){return r&&fS(r).replace(/\\/g,"/")}function Yd(r){return r&&r.replace(/(^['"])|(['"]$)/g,"")}function qa(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}function ph(r){return r?r.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():r||""}var FR=require("vscode");var xw="en",ww=!1,Ew=!1,gS=!1,hQ=!1,gQ=!1,RR=!1,vQ=!1,yQ=!1,bQ=!1,Sw,Cw=xw,IQ,Wu,ms=typeof self=="object"?self:typeof global=="object"?global:{},to;typeof ms.vscode<"u"&&typeof ms.vscode.process<"u"?to=ms.vscode.process:typeof process<"u"&&(to=process);var sj=typeof to?.versions?.electron=="string",aj=sj&&to?.type==="renderer",Rbe=aj&&to?.sandboxed;if(typeof navigator=="object"&&!aj)Wu=navigator.userAgent,ww=Wu.indexOf("Windows")>=0,Ew=Wu.indexOf("Macintosh")>=0,yQ=(Wu.indexOf("Macintosh")>=0||Wu.indexOf("iPad")>=0||Wu.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,gS=Wu.indexOf("Linux")>=0,RR=!0,Sw=navigator.language,Cw=Sw;else if(typeof to=="object"){ww=to.platform==="win32",Ew=to.platform==="darwin",gS=to.platform==="linux",hQ=gS&&!!to.env.SNAP&&!!to.env.SNAP_REVISION,vQ=sj,bQ=!!to.env.CI||!!to.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Sw=xw,Cw=xw;let r=to.env.VSCODE_NLS_CONFIG;if(r)try{let e=JSON.parse(r),t=e.availableLanguages["*"];Sw=e.locale,Cw=t||xw,IQ=e._translationsConfigFile}catch{}gQ=!0}else console.error("Unable to resolve platform.");var TR=0;Ew?TR=1:ww?TR=3:gS&&(TR=2);var vS=ww,cj=Ew,lj=gS;var Pw=RR,Abe=RR&&typeof ms.importScripts=="function";var Ja=Wu,ju=Cw,SQ;(n=>{function r(){return ju}n.value=r;function e(){return ju.length===2?ju==="en":ju.length>=3?ju[0]==="e"&&ju[1]==="n"&&ju[2]==="-":!1}n.isDefaultVariant=e;function t(){return ju==="en"}n.isDefault=t})(SQ||={});var Nbe=(()=>{if(typeof ms.postMessage=="function"&&!ms.importScripts){let r=[];ms.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===t.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let e=0;return t=>{let n=++e;r.push({id:n,callback:t}),ms.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var xQ=!!(Ja&&Ja.indexOf("Chrome")>=0),Mbe=!!(Ja&&Ja.indexOf("Firefox")>=0),Obe=!!(!xQ&&Ja&&Ja.indexOf("Safari")>=0),Kbe=!!(Ja&&Ja.indexOf("Edg/")>=0),Fbe=!!(Ja&&Ja.indexOf("Android")>=0);var Xd;if(typeof ms.vscode<"u"&&typeof ms.vscode.process<"u"){let r=ms.vscode.process;Xd={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"?Xd={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Xd={get platform(){return vS?"win32":cj?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var kw=Xd.cwd,uj=Xd.env,ro=Xd.platform,Wbe=Xd.arch;var wQ=65,EQ=97,PQ=90,kQ=122,qu=46,Bn=47,no=92,Vu=58,DQ=63,Dw=class extends Error{constructor(t,n,i){let o;typeof n=="string"&&n.indexOf("not ")===0?(o="must not be",n=n.replace(/^not /,"")):o="must be";let s=t.indexOf(".")!==-1?"property":"argument",a=`The "${t}" ${s} ${o} of type ${n}`;a+=`. Received type ${typeof i}`;super(a);this.code="ERR_INVALID_ARG_TYPE"}};function pn(r,e){if(typeof r!="string")throw new Dw(e,"string",r)}function Ot(r){return r===Bn||r===no}function AR(r){return r===Bn}function Bu(r){return r>=wQ&&r<=PQ||r>=EQ&&r<=kQ}function _w(r,e,t,n){let i="",o=0,s=-1,a=0,c=0;for(let l=0;l<=r.length;++l){if(l<r.length)c=r.charCodeAt(l);else{if(n(c))break;c=Bn}if(n(c)){if(!(s===l-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==qu||i.charCodeAt(i.length-2)!==qu){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=l,a=0;continue}else if(i.length!==0){i="",o=0,s=l,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${r.slice(s+1,l)}`:i=r.slice(s+1,l),o=l-s-1;s=l,a=0}else c===qu&&a!==-1?++a:a=-1}return i}function pj(r,e){if(e===null||typeof e!="object")throw new Dw("pathObject","Object",e);let t=e.dir||e.root,n=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${n}`:`${t}${r}${n}`:n}var xn={resolve(...r){let e="",t="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],pn(o,"path"),o.length===0)continue}else e.length===0?o=kw():(o=uj[`=${e}`]||kw(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===no)&&(o=`${e}\\`));let s=o.length,a=0,c="",l=!1,u=o.charCodeAt(0);if(s===1)Ot(u)&&(a=1,l=!0);else if(Ot(u))if(l=!0,Ot(o.charCodeAt(1))){let p=2,m=p;for(;p<s&&!Ot(o.charCodeAt(p));)p++;if(p<s&&p!==m){let h=o.slice(m,p);for(m=p;p<s&&Ot(o.charCodeAt(p));)p++;if(p<s&&p!==m){for(m=p;p<s&&!Ot(o.charCodeAt(p));)p++;(p===s||p!==m)&&(c=`\\\\${h}\\${o.slice(m,p)}`,a=p)}}}else a=1;else Bu(u)&&o.charCodeAt(1)===Vu&&(c=o.slice(0,2),a=2,s>2&&Ot(o.charCodeAt(2))&&(l=!0,a=3));if(c.length>0)if(e.length>0){if(c.toLowerCase()!==e.toLowerCase())continue}else e=c;if(n){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,n=l,l&&e.length>0)break}return t=_w(t,!n,"\\",Ot),n?`${e}\\${t}`:`${e}${t}`||"."},normalize(r){pn(r,"path");let e=r.length;if(e===0)return".";let t=0,n,i=!1,o=r.charCodeAt(0);if(e===1)return AR(o)?"\\":r;if(Ot(o))if(i=!0,Ot(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Ot(r.charCodeAt(a));)a++;if(a<e&&a!==c){let l=r.slice(c,a);for(c=a;a<e&&Ot(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Ot(r.charCodeAt(a));)a++;if(a===e)return`\\\\${l}\\${r.slice(c)}\\`;a!==c&&(n=`\\\\${l}\\${r.slice(c,a)}`,t=a)}}}else t=1;else Bu(o)&&r.charCodeAt(1)===Vu&&(n=r.slice(0,2),t=2,e>2&&Ot(r.charCodeAt(2))&&(i=!0,t=3));let s=t<e?_w(r.slice(t),!i,"\\",Ot):"";return s.length===0&&!i&&(s="."),s.length>0&&Ot(r.charCodeAt(e-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){pn(r,"path");let e=r.length;if(e===0)return!1;let t=r.charCodeAt(0);return Ot(t)||e>2&&Bu(t)&&r.charCodeAt(1)===Vu&&Ot(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let e,t;for(let o=0;o<r.length;++o){let s=r[o];pn(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let n=!0,i=0;if(typeof t=="string"&&Ot(t.charCodeAt(0))){++i;let o=t.length;o>1&&Ot(t.charCodeAt(1))&&(++i,o>2&&(Ot(t.charCodeAt(2))?++i:n=!1))}if(n){for(;i<e.length&&Ot(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return xn.normalize(e)},relative(r,e){if(pn(r,"from"),pn(e,"to"),r===e)return"";let t=xn.resolve(r),n=xn.resolve(e);if(t===n||(r=t.toLowerCase(),e=n.toLowerCase(),r===e))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===no;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===no;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===no;)a++;let c=e.length;for(;c-1>a&&e.charCodeAt(c-1)===no;)c--;let l=c-a,u=s<l?s:l,p=-1,m=0;for(;m<u;m++){let v=r.charCodeAt(i+m);if(v!==e.charCodeAt(a+m))break;v===no&&(p=m)}if(m!==u){if(p===-1)return n}else{if(l>u){if(e.charCodeAt(a+m)===no)return n.slice(a+m+1);if(m===2)return n.slice(a+m)}s>u&&(r.charCodeAt(i+m)===no?p=m:m===2&&(p=3)),p===-1&&(p=0)}let h="";for(m=i+p+1;m<=o;++m)(m===o||r.charCodeAt(m)===no)&&(h+=h.length===0?"..":"\\..");return a+=p,h.length>0?`${h}${n.slice(a,c)}`:(n.charCodeAt(a)===no&&++a,n.slice(a,c))},toNamespacedPath(r){if(typeof r!="string")return r;if(r.length===0)return"";let e=xn.resolve(r);if(e.length<=2)return r;if(e.charCodeAt(0)===no){if(e.charCodeAt(1)===no){let t=e.charCodeAt(2);if(t!==DQ&&t!==qu)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Bu(e.charCodeAt(0))&&e.charCodeAt(1)===Vu&&e.charCodeAt(2)===no)return`\\\\?\\${e}`;return r},dirname(r){pn(r,"path");let e=r.length;if(e===0)return".";let t=-1,n=0,i=r.charCodeAt(0);if(e===1)return Ot(i)?r:".";if(Ot(i)){if(t=n=1,Ot(r.charCodeAt(1))){let a=2,c=a;for(;a<e&&!Ot(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&Ot(r.charCodeAt(a));)a++;if(a<e&&a!==c){for(c=a;a<e&&!Ot(r.charCodeAt(a));)a++;if(a===e)return r;a!==c&&(t=n=a+1)}}}}else Bu(i)&&r.charCodeAt(1)===Vu&&(t=e>2&&Ot(r.charCodeAt(2))?3:2,n=t);let o=-1,s=!0;for(let a=e-1;a>=n;--a)if(Ot(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return r.slice(0,o)},basename(r,e){e!==void 0&&pn(e,"ext"),pn(r,"path");let t=0,n=-1,i=!0,o;if(r.length>=2&&Bu(r.charCodeAt(0))&&r.charCodeAt(1)===Vu&&(t=2),e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=t;--o){let c=r.charCodeAt(o);if(Ot(c)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=t;--o)if(Ot(r.charCodeAt(o))){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){pn(r,"path");let e=0,t=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===Vu&&Bu(r.charCodeAt(0))&&(e=n=2);for(let a=r.length-1;a>=e;--a){let c=r.charCodeAt(a);if(Ot(c)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),c===qu?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===n+1?"":r.slice(t,i)},format:pj.bind(null,"\\"),parse(r){pn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.length,n=0,i=r.charCodeAt(0);if(t===1)return Ot(i)?(e.root=e.dir=r,e):(e.base=e.name=r,e);if(Ot(i)){if(n=1,Ot(r.charCodeAt(1))){let p=2,m=p;for(;p<t&&!Ot(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&Ot(r.charCodeAt(p));)p++;if(p<t&&p!==m){for(m=p;p<t&&!Ot(r.charCodeAt(p));)p++;p===t?n=p:p!==m&&(n=p+1)}}}}else if(Bu(i)&&r.charCodeAt(1)===Vu){if(t<=2)return e.root=e.dir=r,e;if(n=2,Ot(r.charCodeAt(2))){if(t===3)return e.root=e.dir=r,e;n=3}}n>0&&(e.root=r.slice(0,n));let o=-1,s=n,a=-1,c=!0,l=r.length-1,u=0;for(;l>=n;--l){if(i=r.charCodeAt(l),Ot(i)){if(!c){s=l+1;break}continue}a===-1&&(c=!1,a=l+1),i===qu?o===-1?o=l:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=r.slice(s,a):(e.name=r.slice(s,o),e.base=r.slice(s,a),e.ext=r.slice(o,a))),s>0&&s!==n?e.dir=r.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},br={resolve(...r){let e="",t=!1;for(let n=r.length-1;n>=-1&&!t;n--){let i=n>=0?r[n]:kw();pn(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Bn)}return e=_w(e,!t,"/",AR),t?`/${e}`:e.length>0?e:"."},normalize(r){if(pn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Bn,t=r.charCodeAt(r.length-1)===Bn;return r=_w(r,!e,"/",AR),r.length===0?e?"/":t?"./":".":(t&&(r+="/"),e?`/${r}`:r)},isAbsolute(r){return pn(r,"path"),r.length>0&&r.charCodeAt(0)===Bn},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){let n=r[t];pn(n,"path"),n.length>0&&(e===void 0?e=n:e+=`/${n}`)}return e===void 0?".":br.normalize(e)},relative(r,e){if(pn(r,"from"),pn(e,"to"),r===e||(r=br.resolve(r),e=br.resolve(e),r===e))return"";let t=1,n=r.length,i=n-t,o=1,s=e.length-o,a=i<s?i:s,c=-1,l=0;for(;l<a;l++){let p=r.charCodeAt(t+l);if(p!==e.charCodeAt(o+l))break;p===Bn&&(c=l)}if(l===a)if(s>a){if(e.charCodeAt(o+l)===Bn)return e.slice(o+l+1);if(l===0)return e.slice(o+l)}else i>a&&(r.charCodeAt(t+l)===Bn?c=l:l===0&&(c=0));let u="";for(l=t+c+1;l<=n;++l)(l===n||r.charCodeAt(l)===Bn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+c)}`},toNamespacedPath(r){return r},dirname(r){if(pn(r,"path"),r.length===0)return".";let e=r.charCodeAt(0)===Bn,t=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===Bn){if(!n){t=i;break}}else n=!1;return t===-1?e?"/":".":e&&t===1?"//":r.slice(0,t)},basename(r,e){e!==void 0&&pn(e,"ext"),pn(r,"path");let t=0,n=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e===r)return"";let s=e.length-1,a=-1;for(o=r.length-1;o>=0;--o){let c=r.charCodeAt(o);if(c===Bn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(c===e.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return t===n?n=a:n===-1&&(n=r.length),r.slice(t,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===Bn){if(!i){t=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(t,n)},extname(r){pn(r,"path");let e=-1,t=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===Bn){if(!i){t=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===qu?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||n===-1||o===0||o===1&&e===n-1&&e===t+1?"":r.slice(e,n)},format:pj.bind(null,"/"),parse(r){pn(r,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;let t=r.charCodeAt(0)===Bn,n;t?(e.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,c=r.length-1,l=0;for(;c>=n;--c){let u=r.charCodeAt(c);if(u===Bn){if(!a){o=c+1;break}continue}s===-1&&(a=!1,s=c+1),u===qu?i===-1?i=c:l!==1&&(l=1):i!==-1&&(l=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||l===0||l===1&&i===s-1&&i===o+1?e.base=e.name=r.slice(u,s):(e.name=r.slice(u,i),e.base=r.slice(u,s),e.ext=r.slice(i,s))}return o>0?e.dir=r.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};br.win32=xn.win32=xn;br.posix=xn.posix=br;var bn=ro==="win32"?xn.normalize:br.normalize,dh=ro==="win32"?xn.isAbsolute:br.isAbsolute,We=ro==="win32"?xn.join:br.join,dj=ro==="win32"?xn.resolve:br.resolve,Tw=ro==="win32"?xn.relative:br.relative,ut=ro==="win32"?xn.dirname:br.dirname,De=ro==="win32"?xn.basename:br.basename,Wi=ro==="win32"?xn.extname:br.extname,Vbe=ro==="win32"?xn.format:br.format,mj=ro==="win32"?xn.parse:br.parse,Bbe=ro==="win32"?xn.toNamespacedPath:br.toNamespacedPath,qn=ro==="win32"?xn.sep:br.sep,Jn=ro==="win32"?xn.delimiter:br.delimiter;var bS=require("vscode");var _Q=require("vscode");var Rw=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var yS=class r{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new r(()=>e(this.getValue()))}};function yj(r,e){return r<e?-1:r>e?1:0}function TQ(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c<l)return-1;if(c>l)return 1}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function bj(r,e,t=0,n=r.length,i=0,o=e.length){for(;t<n&&i<o;t++,i++){let c=r.charCodeAt(t),l=e.charCodeAt(i);if(c===l)continue;if(c>=128||l>=128)return TQ(r.toLowerCase(),e.toLowerCase(),t,n,i,o);fj(c)&&(c-=32),fj(l)&&(l-=32);let u=c-l;if(u!==0)return u}let s=n-t,a=o-i;return s<a?-1:s>a?1:0}function fj(r){return r>=97&&r<=122}function Ij(r,e){return r.length===e.length&&bj(r,e)===0}function Sj(r,e){let t=e.length;return e.length>r.length?!1:bj(r,e,0,t)===0}var hj=class r{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new yS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new Rw(e=>{function t(u){let p=new Map;for(let m=0;m<u.length;m+=2)p.set(u[m],u[m+1]);return p}function n(u,p){let m=new Map(u);for(let[h,v]of p)m.set(h,v);return m}function i(u,p){if(!u)return p;let m=new Map;for(let[h,v]of u)p.has(h)&&m.set(h,v);return m}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let p=t(o[u]);a=i(a,p)}let c=t(o._common),l=n(c,a);return new r(l)})}static getInstance(e){return r.cache.get(Array.from(e))}static{this._locales=new yS(()=>Object.keys(r.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return r._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},gj=class r{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(r.getRawData())),this._data}static isInvisibleCharacter(e){return r.getData().has(e)}static get codePoints(){return r.getData()}};function Ju(r){return r===47||r===92}function NR(r){return r.replace(/[\\/]/g,br.sep)}function xj(r){return r.indexOf("/")===-1&&(r=NR(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function MR(r,e=br.sep){if(!r)return"";let t=r.length,n=r.charCodeAt(0);if(Ju(n)){if(Ju(r.charCodeAt(1))&&!Ju(r.charCodeAt(2))){let o=3,s=o;for(;o<t&&!Ju(r.charCodeAt(o));o++);if(s!==o&&!Ju(r.charCodeAt(o+1))){for(o+=1;o<t;o++)if(Ju(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(RQ(n)&&r.charCodeAt(1)===58)return Ju(r.charCodeAt(2))?r.slice(0,2)+e:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(Ju(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function OR(r,e,t,n=qn){if(r===e)return!0;if(!r||!e||e.length>r.length)return!1;if(t){if(!Sj(r,e))return!1;if(e.length===r.length)return!0;let o=e.length;return e.charAt(e.length-1)===n&&o--,r.charAt(o)===n}return e.charAt(e.length-1)!==n&&(e+=n),r.indexOf(e)===0}function RQ(r){return r>=65&&r<=90||r>=97&&r<=122}var $a;(oe=>(oe.inMemory="inmemory",oe.vscode="vscode",oe.internal="private",oe.walkThrough="walkThrough",oe.walkThroughSnippet="walkThroughSnippet",oe.http="http",oe.https="https",oe.file="file",oe.mailto="mailto",oe.untitled="untitled",oe.data="data",oe.command="command",oe.vscodeRemote="vscode-remote",oe.vscodeRemoteResource="vscode-remote-resource",oe.vscodeUserData="vscode-userdata",oe.vscodeCustomEditor="vscode-custom-editor",oe.vscodeNotebook="vscode-notebook",oe.vscodeNotebookCell="vscode-notebook-cell",oe.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",oe.vscodeNotebookCellOutput="vscode-notebook-cell-output",oe.vscodeInteractive="vscode-interactive",oe.vscodeInteractiveInput="vscode-interactive-input",oe.vscodeSettings="vscode-settings",oe.vscodeWorkspaceTrust="vscode-workspace-trust",oe.vscodeTerminal="vscode-terminal",oe.webviewPanel="webview-panel",oe.vscodeWebview="vscode-webview",oe.extension="extension",oe.vscodeFileResource="vscode-file",oe.tmp="tmp",oe.vsls="vsls"))($a||={});function na(r){return Pw?r?.path||"":r?.fsPath||""}var IS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,n=!1){return e===t?0:yj(this.getComparisonKey(e,n),this.getComparisonKey(t,n))}isEqual(e,t,n=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,n)===this.getComparisonKey(t,n)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,n=!1,i=vS?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===$a.file)return OR(na(e),na(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(n||e.fragment===t.fragment);if(Cj(e.authority,t.authority))return OR(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(n||e.fragment===t.fragment)}return!1}joinPath(e,...t){return bS.Uri.joinPath(e,...t)}basenameOrAuthority(e){return mn(e)||e.authority}basename(e,t){return br.basename(e.path,t)}extname(e){return br.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===$a.file?t=bS.Uri.file(ut(na(e))).path:(t=br.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===$a.file?t=bS.Uri.file(bn(na(e))).path:t=br.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!Cj(e.authority,t.authority))return;if(e.scheme===$a.file){let o=Tw(na(e),na(t));return vS?NR(o):o}let n=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return br.relative(n,i)}resolvePath(e,t){if(e.scheme===$a.file){let n=bS.Uri.file(dj(na(e),t));return e.with({authority:n.authority,path:n.path})}return t=xj(t),e.with({path:br.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&Ij(e,t)}hasTrailingPathSeparator(e,t=qn){if(e.scheme===$a.file){let n=na(e);return n.length>MR(n).length&&n[n.length-1]===t}else{let n=e.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=qn){return wj(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=qn){let n=!1;if(e.scheme===$a.file){let i=na(e);n=i!==void 0&&i.length===MR(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!wj(e,t)?e.with({path:e.path+"/"}):e}},nr=new IS(()=>!1),aIe=new IS(r=>r.scheme===$a.file?!lj:!0),cIe=new IS(r=>!0),Ii=nr.isEqual.bind(nr),SS=nr.isEqualOrParent.bind(nr),dn=nr.getComparisonKey.bind(nr),lIe=nr.basenameOrAuthority.bind(nr),mn=nr.basename.bind(nr),$u=nr.extname.bind(nr),Si=nr.dirname.bind(nr),sr=nr.joinPath.bind(nr),uIe=nr.normalizePath.bind(nr),KR=nr.relativePath.bind(nr),pIe=nr.resolvePath.bind(nr),dIe=nr.isAbsolutePath.bind(nr),Cj=nr.isEqualAuthority.bind(nr),wj=nr.hasTrailingPathSeparator.bind(nr),mIe=nr.removeTrailingPathSeparator.bind(nr),fIe=nr.addTrailingPathSeparator.bind(nr),NQ;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[p,m]=u.split(":");p&&m&&a.set(p,m)});let l=s.path.substring(0,s.path.indexOf(";"));return l&&a.set(o.META_DATA_MIME,l),a}o.parseMetaData=i})(NQ||={});function qr(r=process.platform){return/^win/.test(r)?"Windows":/^darwin/.test(r)?"OSX":/^linux/.test(r)?"Linux":"Unknown"}function mh(r,e){return r.replace(/^~(?=$|\/|\\)/,e)}function MQ(){if(!Uu())return FR.Uri.file(require("os").homedir())}function Ee(r){let e=qr()==="Windows";if(r){let t=na(r);return t&&t.startsWith(qn)&&t.length>1&&t[1]!==qn&&e?t.slice(1):t||""}return""}function V(r,e=[],t){t=t||MQ();let n;typeof r=="string"&&(n=FR.Uri.file(r)),typeof r!="string"&&(n=r);let i=Ej(n,void 0,t),o=e.map(a=>Ej(n,a.uri,t)),s=i;return[i,...o].forEach(a=>{a.length<s.length&&(s=a)}),s}function Ej(r,e,t){let n=qr()==="Windows";if(r&&e&&SS(r,e,!0)){let i=KR(e,r);if(i)return n?i.replace(/\//g,"\\"):i}if(r&&t&&SS(r,t,!0)){let i=KR(t,r);if(i)return i=n?i.replace(/\//g,"\\"):i,`~${qn}${i}`}return Ee(r)}var Nw="",Pj=3,Zd=[];function UR(r){return Zd.push(r),{dispose:()=>{Zd=Zd.filter(e=>e!==r)}}}var KQ=new Map([["error",40],["warn",30],["info",20],["debug",10],["none",100],["off",100],[void 0,40]]),hh=10;function jR(r){hh=typeof r=="number"?r:KQ.get(r)??40}function kj(r){Nw=r.toLowerCase()}function Dj(...r){return hh<=5?r:r.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let n=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(n.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&n.push(`Interpreter Id = ${V(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Ke(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?n.push(o[0]):o.length>1&&s?.length?n.push(s):n.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>n.push(`${o} = ${String(t[o]).trim()}`)),n.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function x(r,...e){hh<=40&&(e=Dj(...e),Zd.forEach(t=>t.traceError(r,...e)))}function j(r,...e){hh<=30&&(e=Dj(...e),Zd.forEach(t=>t.traceWarn(r,...e)))}function H(r,...e){hh<=20&&Zd.forEach(t=>t.traceInfo(r,...e))}function E(r,...e){hh<=5&&Zd.forEach(t=>t.traceVerbose(r,...e))}function re(r,...e){if(Zn)if(typeof r=="function"){let n=r(),i="",o=[];typeof n=="string"?i=n:(i=n.shift(),o=n),H(i,...o)}else H(r,...e)}function ti(r,e=Pj){return _j({message:r,opts:e,level:5})}function gh(r){return _j({message:r,opts:Pj,level:40})}var El=new WeakMap;function Pl(r){return(e,t,n)=>{El.has(e)||El.set(e,new Map);let i=El.get(e);i||El.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:n,propertyOfParameterToLog:r})}}function Hu(){return(r,e,t)=>{El.has(r)||El.set(r,new Map);let n=El.get(r);n||El.set(r,n=new Map),n.has(e)||n.set(e,[]),n.get(e).push({parameterIndex:t,ignore:!0})}}function _j(r){return ij((e,t)=>WQ(r,t,e),(r.opts&4)>0)}function FQ(r){let{kind:e,name:t,args:n}=r;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),n||(n=[]),{kind:e,name:t,args:n,methodName:r.methodName||"",target:r.target||void 0}}function LQ(r){if(!r)return!1;let e=r;return typeof e.path=="string"&&typeof e.scheme=="string"}function LR(r){let e=Nw?r.toLowerCase().indexOf(Nw):-1;return e===-1?r:`~${r.substring(e+Nw.length)}`}function UQ(r,e,t,n){if(LQ(t))return LR(t.path);if(!t)return t;let o=El.get(r)?.get(e)?.find(a=>a.parameterIndex===n);if(!o)return typeof t=="string"?LR(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?LR(s):s}function jQ(r,e,t){t=FQ(t);let n=[r.message];return n.push(`${t.kind} name = ${t.name}`.trim()),e?(n.push(`completed in ${e.elapsed}ms`),n.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):n[n.length-1]=`${n[n.length-1]} (started execution)`,(r.opts&1)===1&&(r.level===5?n.push(_R(t.args.map((i,o)=>t?UQ(t.target,t.methodName,i,o):i))):n.push(_R(t.args))),e&&(r.opts&2)===2&&n.push(oj(e.returnValue)),n.join(", ")}function WQ(r,e,t){let n=jQ(r,e,t);e?e.err===void 0?r.level&&r.level===40||(r.level?Aw(r.level,n):Aw(20,n)):Aw(40,n,e.err):r.level&&r.level!==40&&Aw(r.level,n)}function Aw(r,e,...t){switch(r){case 40:x(e,...t);break;case 30:j(e,...t);break;case 20:H(e,...t);break;case 10:E(e,...t);break;case 5:E(e,...t);break;default:break}}var lr=require("vscode");var ma=require("vscode");var rg=k(M());var Qu=Symbol("JupyterServerHelper"),pE=Symbol("INotebookImporter"),wh=Symbol("INotebookExporter"),Yu=Symbol("IJupyterInterpreterDependencyManager"),Eh=Symbol("INbConvertInterpreterDependencyChecker"),dE=Symbol("INbConvertExportToPythonService"),Ph=Symbol("IJupyterServerProvider"),Zt=Symbol("IJupyterServerUriStorage"),mE=Symbol("IJupyterKernelService"),Xu=Symbol("IJupyterRequestAgentCreator"),_l=Symbol("IJupyterRequestCreator"),fE=Symbol("INotebookStarter"),nm=Symbol("ILiveRemoteKernelConnectionUsageTracker"),hE=Symbol("IJupyterRemoteCachedKernelValidator"),Gt=Symbol("IJupyterServerProviderRegistry");var xc=k(M());var Xe=class extends Error{constructor(t,n){super(n);this.category=t;this.isJupyterError=!0}},sn=class r extends Xe{constructor(t,n,i){super(i||bA(n),t);this.originalException=n;n&&(this.stack=`${new Error("").stack}

${n.stack}`)}static from(t,n){return n instanceof Xe?n:new r(t,n)}static unwrap(t){return t&&(t instanceof r&&t.originalException&&t.originalException instanceof Xe&&(t=t.originalException),t)}};function bA(r){return r&&r instanceof Xe?r.category:"unknown"}var Zu=class extends Xe{constructor(t,n){super("remotejupyterserveruriprovider",n.message||n.toString());this.serverProviderHandle=t;this.originalError=n}};var Mh=require("vscode");function gE(r,e){let t=r.length>0?`?token=${r}`:"";return`${e}${t}`}var C=require("vscode");var at=require("vscode"),IA=60,SA=IA*60,kS=SA*24,t2=kS*7,r2=kS*30,n2=kS*365;function kh(r,e,t,n){typeof r!="number"&&(r=r.getTime());let i=Math.round((new Date().getTime()-r)/1e3);if(i<-30)return at.l10n.t("in {0}",kh(new Date().getTime()+i*1e3,!1));if(!n&&i<30)return at.l10n.t("now");let o;return i<IA?(o=i,e?o===1?t?at.l10n.t("{0} second ago",o):at.l10n.t("{0} sec ago",o):t?at.l10n.t("{0} seconds ago",o):at.l10n.t("{0} secs ago",o):o===1?t?at.l10n.t("{0} second",o):at.l10n.t("{0} sec",o):t?at.l10n.t("{0} seconds",o):at.l10n.t("{0} secs",o)):i<SA?(o=Math.floor(i/IA),e?o===1?t?at.l10n.t("{0} minute ago",o):at.l10n.t("{0} min ago",o):t?at.l10n.t("{0} minutes ago",o):at.l10n.t("{0} mins ago",o):o===1?t?at.l10n.t("{0} minute",o):at.l10n.t("{0} min",o):t?at.l10n.t("{0} minutes",o):at.l10n.t("{0} mins",o)):i<kS?(o=Math.floor(i/SA),e?o===1?t?at.l10n.t("{0} hour ago",o):at.l10n.t("{0} hr ago",o):t?at.l10n.t("{0} hours ago",o):at.l10n.t("{0} hrs ago",o):o===1?t?at.l10n.t("{0} hour",o):at.l10n.t("{0} hr",o):t?at.l10n.t("{0} hours",o):at.l10n.t("{0} hrs",o)):i<t2?(o=Math.floor(i/kS),e?o===1?at.l10n.t("{0} day ago",o):at.l10n.t("{0} days ago",o):o===1?at.l10n.t("{0} day",o):at.l10n.t("{0} days",o)):i<r2?(o=Math.floor(i/t2),e?o===1?t?at.l10n.t("{0} week ago",o):at.l10n.t("{0} wk ago",o):t?at.l10n.t("{0} weeks ago",o):at.l10n.t("{0} wks ago",o):o===1?t?at.l10n.t("{0} week",o):at.l10n.t("{0} wk",o):t?at.l10n.t("{0} weeks",o):at.l10n.t("{0} wks",o)):i<n2?(o=Math.floor(i/r2),e?o===1?t?at.l10n.t("{0} month ago",o):at.l10n.t("{0} mo ago",o):t?at.l10n.t("{0} months ago",o):at.l10n.t("{0} mos ago",o):o===1?t?at.l10n.t("{0} month",o):at.l10n.t("{0} mo",o):t?at.l10n.t("{0} months",o):at.l10n.t("{0} mos",o)):(o=Math.floor(i/n2),e?o===1?t?at.l10n.t("{0} year ago",o):at.l10n.t("{0} yr ago",o):t?at.l10n.t("{0} years ago",o):at.l10n.t("{0} yrs ago",o):o===1?t?at.l10n.t("{0} year",o):at.l10n.t("{0} yr",o):t?at.l10n.t("{0} years",o):at.l10n.t("{0} yrs",o))}function kte(r){let e=r.displayName||r.envName||"",t=V(r.uri);return e?` ${e} (${t})`:t}var ge;(D=>(D.bannerLabelYes=C.l10n.t("Yes"),D.bannerLabelNo=C.l10n.t("No"),D.canceled=C.l10n.t("Canceled"),D.cancel=C.l10n.t("Cancel"),D.ok=C.l10n.t("Ok"),D.refresh=C.l10n.t("Refresh"),D.refreshing=C.l10n.t("Refreshing..."),D.install=C.l10n.t("Install"),D.loadingExtension=C.l10n.t("Jupyter Extension loading..."),D.handleExtensionActivationError=C.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),D.doNotShowAgain=C.l10n.t("Do not show again"),D.reload=C.l10n.t("Reload"),D.moreInfo=C.l10n.t("More Info"),D.learnMore=C.l10n.t("Learn more"),D.and=C.l10n.t("and"),D.reportThisIssue=C.l10n.t("Report this issue"),D.clickHereForMoreInfoWithHtml=T=>C.l10n.t("Click <a href='{0}'>here</a> for more info.",T)))(ge||={});var ep;(t=>(t.notInGroup=n=>C.l10n.t("User does not belong to experiment group '{0}'",n),t.inGroup=n=>C.l10n.t("User belongs to experiment group '{0}'",n)))(ep||={});var xA;(e=>e.jupyter=C.l10n.t("Jupyter"))(xA||={});var CA;(e=>e.currentWorkingDirectory="cwd:")(CA||={});var wA;(e=>e.bannerMessage=C.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(wA||={});var EA;(e=>e.bannerMessage=C.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(EA||={});var vE;(t=>(t.bannerLabelYes=C.l10n.t("Yes, take survey now"),t.bannerLabelNo=C.l10n.t("No, thanks")))(vE||={});var y;(_=>(_.warnWhenSelectingKernelWithUnSupportedPythonVersion=C.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),_.installingPythonExtension=C.l10n.t("Installing Python extension and locating kernels."),_.pythonExtensionRequired=C.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),_.rendererExtensionRequired=C.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.rendererExtension1015Required=C.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),_.pythonExtensionInstalled=C.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),_.unknownPackage=C.l10n.t("unknown"),_.interactiveWindowTitleFormat=U=>C.l10n.t("Interactive - {0}",U),_.interactiveWindowModeBannerTitle=C.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),_.interactiveWindowModeBannerSwitchYes=C.l10n.t("Yes"),_.interactiveWindowModeBannerSwitchNo=C.l10n.t("No"),_.dataExplorerTitle=C.l10n.t("Data Viewer"),_.badWebPanelFormatString=U=>C.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[U],comment:["Only translate the text within the HTML tags"]}),_.installingMissingDependencies=C.l10n.t("Installing missing dependencies"),_.validatingKernelDependencies=C.l10n.t("Validating kernel dependencies"),_.performingExport=C.l10n.t("Performing Export"),_.exportNotebookToPython=C.l10n.t("Exporting Notebook to Python"),_.sessionDisposed=C.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),_.passwordFailure=C.l10n.t("Failed to connect to password protected server. Check that password is correct."),_.incorrectPassword=C.l10n.t("Incorrect Password."),_.exportDialogFilter=C.l10n.t("Jupyter Notebooks"),_.exportDialogComplete=U=>C.l10n.t("Notebook written to {0}",U),_.exportDialogFailed=U=>C.l10n.t("Failed to export notebook. {0}",U),_.exportOpenQuestion1=C.l10n.t("Open in editor"),_.runCellLensCommandTitle=C.l10n.t("Run Cell"),_.importDialogTitle=C.l10n.t("Import Jupyter Notebook"),_.importDialogFilter="Jupyter Notebooks",_.notebookCheckForImportNo=C.l10n.t("Later"),_.libraryRequiredToLaunchJupyterNotInstalled=U=>C.l10n.t("Running cells requires {0} package.",U),_.librariesRequiredToLaunchJupyterNotInstalled=U=>C.l10n.t("Running cells requires {0} package.",U),_.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(U,et)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,et),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(U,et)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,et),_.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(U,et)=>C.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",U,et),_.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(U,et)=>C.l10n.t("Running cells with '{0}' requires the {1} package.",U,et),_.installPackageInstructions=(U,et)=>C.l10n.t(`Run the following command to install '{0}' into the Python environment. 
Command: '{1}'`,U,et),_.pythonCondaKernelsWithoutPython=C.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),_.selectJupyterInterpreter=C.l10n.t("Select an Interpreter to start Jupyter"),_.jupyterInstall=C.l10n.t("Install"),_.currentlySelectedJupyterInterpreterForPlaceholder=U=>C.l10n.t("Selected Environment {0}",U),_.jupyterNotSupported=U=>C.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",U),_.jupyterNotebookNotInstalledOrNotFound=U=>{if(U){let et=kte(U);return C.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",et)}else return C.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},_.jupyterNotSupportedBecauseOfEnvironment=(U,et)=>C.l10n.t("Activating {0} to run Jupyter failed with {1}",U,et),_.jupyterNbConvertNotSupported=C.l10n.t("Jupyter nbconvert is not installed"),_.jupyterLaunchTimedOut=C.l10n.t("The Jupyter notebook server failed to launch in time"),_.jupyterLaunchNoURL=C.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),_.jupyterSelfCertFail=U=>C.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),_.jupyterExpiredCertFail=U=>C.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,U),_.jupyterSelfCertFailErrorMessageOnly=C.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertExpiredErrorMessageOnly=C.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),_.jupyterSelfCertEnable=C.l10n.t("Yes, connect anyways"),_.jupyterSelfCertClose=C.l10n.t("No, close the connection"),_.pythonInteractiveHelpLink=C.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),_.importingFormat=U=>C.l10n.t("Importing {0}",U),_.startingJupyter=C.l10n.t("Starting Jupyter Server"),_.connectingToKernel=U=>C.l10n.t("Connecting to kernel: {0}",U),_.connectingToJupyter=C.l10n.t("Connecting to Jupyter Server"),_.exportingFormat=U=>C.l10n.t("Exporting {0}",U),_.runAllCellsLensCommandTitle=C.l10n.t("Run All Cells"),_.runAllCellsAboveLensCommandTitle=C.l10n.t("Run Above"),_.runCellAndAllBelowLensCommandTitle=C.l10n.t("Run Below"),_.restartKernelMessage=C.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),_.restartKernelMessageYes=C.l10n.t("Restart"),_.restartKernelMessageDontAskAgain=C.l10n.t("Don't Ask Again"),_.automaticallyReconnectingToAKernelProgressMessage=U=>C.l10n.t("Reconnecting to the kernel {0}",U),_.restartingKernelStatus=U=>C.l10n.t("Restarting Kernel {0}",U),_.interruptingKernelFailed=C.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),_.sessionStartFailedWithKernel=U=>C.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyter=U=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterWithErrorInfo=(U,et)=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,et],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.failedToStartJupyterDueToOutdatedTraitlets=(U,et)=>C.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U,et],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),_.failedToStartKernel=C.l10n.t("Failed to start the Kernel."),_.failedToRestartKernel=C.l10n.t("Failed to restart the Kernel."),_.failedToInterruptKernel=C.l10n.t("Failed to interrupt the Kernel."),_.rawKernelStartFailedDueToTimeout=U=>C.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.rawKernelStartFailedDueToTimeoutWaitingForPort=U=>C.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.viewJupyterLogForFurtherInfo=C.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDied=U=>C.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.kernelDiedWithoutError=U=>C.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.failedToStartAnUntrustedKernelSpec=(U,et)=>C.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[U,et],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),_.kernelDiedWithoutErrorAndAutoRestarting=U=>C.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[U],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelCrashedDueToCodeInCurrentOrPreviousCell=C.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),_.kernelDisconnected=U=>C.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",U),_.cannotRunCellKernelIsDead=U=>C.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",U),_.showJupyterLogs=C.l10n.t("Show Jupyter Logs."),_.restartKernel=C.l10n.t("Restart Kernel"),_.reloadRequired=C.l10n.t("Please reload the window for new settings to take effect."),_.restartedKernelHeader=U=>C.l10n.t("Restarted {0}",U),_.connectedKernelHeader=U=>C.l10n.t("Connected to {0}",U),_.restartingKernelCustomHeader=U=>C.l10n.t("_Restarting {0}..._",U),_.restartingKernelHeader=C.l10n.t("_Restarting kernel..._"),_.startingNewKernelHeader=C.l10n.t("_Connecting to kernel..._"),_.startingNewKernelCustomHeader=U=>C.l10n.t("_Connecting to {0}..._",U),_.noKernelConnected=C.l10n.t("No kernel connected"),_.jupyterSelectUriCommandLabel=C.l10n.t("Enter the URL of the running Jupyter Server..."),_.jupyterSelectUriInputTitle=C.l10n.t("Enter the URL of the running Jupyter Server"),_.jupyterSelectUriInputPlaceholder=C.l10n.t("Enter the url of the running Jupyter Server"),_.connectToToTheJupyterServer=U=>C.l10n.t("Connect to the Jupyter Server {0}",U),_.enterOrSelectRemoteJupyterPlaceholder=C.l10n.t("Enter a remote url, or select a remote server"),_.selectRemoteJupyterPlaceholder=C.l10n.t("Select a remote server"),_.jupyterServerLastConnectionForQuickPickDescription=U=>C.l10n.t("Last connected {0}",kh(U,!0,!1,!1)),_.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=C.l10n.t("Jupyter Servers"),_.jupyterSelectURIInvalidURI=C.l10n.t("Invalid URL specified"),_.jupyterSelectURIMustBeHttpOrHttps=C.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),_.jupyterSelectLiveRemoteKernelDescription=(U,et)=>U?et===0?C.l10n.t("Last activity {0}",kh(U,!0,!1,!1)):et===1?C.l10n.t("Last activity {0}, 1 connection",kh(U,!0,!1,!1)):C.l10n.t("Last activity {0}, {1} connections",kh(U,!0,!1,!1),et.toString()):et===0?"":et===1?C.l10n.t("1 connection"):C.l10n.t("{0} connections",et.toString()),_.installJupyterHub=C.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),_.useJupyterHubExtension=C.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),_.useJupyterHubExtensionDetail=C.l10n.t("Use this option when connecting to JupyterHub servers"),_.installJupyterHubDetail=C.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),_.jupyterSelectUserAndPasswordTitle=C.l10n.t("Enter your user name and password to connect to Jupyter Hub"),_.jupyterRenameServer=C.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),_.jupyterServerUriDisplayNameInputPlaceholder=C.l10n.t("Enter a display name"),_.jupyterSelectUserPrompt=C.l10n.t("Enter your user name"),_.jupyterSelectPasswordPrompt=C.l10n.t("Enter your password"),_.jupyterSelectPasswordTitle=C.l10n.t("Enter your password for the Jupyter Server"),_.pythonNotInstalled=C.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),_.pleaseReloadVSCodeOncePythonHasBeenInstalled=C.l10n.t("Upon installing Python please reload VS Code."),_.jupyterNotebookFailure=U=>C.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,U),_.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=U=>C.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",U),_.remoteJupyterConnectionFailedWithServerWithError=(U,et)=>C.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",U,et),_.remoteJupyterConnectionFailedWithServer=U=>C.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",U),_.remoteJupyterConnectionFailedWithoutServerWithError=U=>C.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",U),_.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=U=>C.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),_.removeRemoteJupyterConnectionButtonText=C.l10n.t("Forget Connection"),_.jupyterNotebookRemoteConnectFailedWeb=U=>C.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,U),_.packageNotInstalledWindowsLongPathNotEnabledError=(U,et)=>C.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,U,et),_.changeRemoteJupyterConnectionButtonText=C.l10n.t("Manage Connections"),_.rawConnectionBrokenError=C.l10n.t("Direct kernel connection broken"),_.jupyterServerCrashed=U=>C.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,U.toString()),_.jupyterKernelSpecModuleNotFound=U=>C.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,U),_.interruptKernelStatus=U=>C.l10n.t("Interrupting Kernel {0}",U),_.exportPythonQuickPickLabel=C.l10n.t("Python Script"),_.exportHTMLQuickPickLabel=C.l10n.t("HTML"),_.exportPDFQuickPickLabel=C.l10n.t("PDF"),_.restartKernelAfterInterruptMessage=U=>C.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",U),_.documentMismatch=U=>C.l10n.t("Cannot run cells, duplicate documents for {0} found.",U),_.jupyterGetVariablesBadResults=C.l10n.t("Failed to fetch variable info from the Jupyter Server."),C.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),_.jupyterGetVariablesExecutionError=U=>C.l10n.t(`Failure during variable extraction: \r
{0}`,U),_.selectKernel=C.l10n.t("Change Kernel"),_.selectDifferentKernel=C.l10n.t("Select a different Kernel"),_.kernelFilterPlaceholder=C.l10n.t("Choose the kernels that are available in the kernel picker."),_.recommendedItemCategoryInQuickPick=C.l10n.t("Recommended"),_.selectedKernelCategoryInQuickPick=C.l10n.t("Selected"),_.createPythonEnvironmentInQuickPick=C.l10n.t("Create Python Environment"),_.createPythonEnvironmentInQuickPickTooltip=C.l10n.t("Create an isolated Python Environment per workspace folder"),_.selectDifferentJupyterInterpreter=C.l10n.t("Change Interpreter"),_.pandasTooOldForViewingFormat=(U,et)=>C.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[U,et],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.pandasRequiredForViewing=U=>C.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[U],comment:["Do not translate 'pandas' as that is a Python module name"]}),_.tooManyColumnsMessage=C.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),_.tooManyColumnsYes=C.l10n.t("Yes"),_.tooManyColumnsNo=C.l10n.t("No"),_.tooManyColumnsDontAskAgain=C.l10n.t("Don't Ask Again"),_.plotViewerTitle=C.l10n.t("Plots"),_.exportPlotTitle=C.l10n.t("Save plot image"),_.pdfFilter="PDF",_.pngFilter="PNG",_.svgFilter="SVG",_.exportImageFailed=U=>C.l10n.t("Error exporting image: {0}",U),_.jupyterDataRateExceeded=C.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),_.addCellBelowCommandTitle=C.l10n.t("Add cell"),_.debugCellCommandTitle=C.l10n.t("Debug Cell"),_.debugStepOverCommandTitle=C.l10n.t("Step over"),_.debugContinueCommandTitle=C.l10n.t("Continue"),_.debugStopCommandTitle=C.l10n.t("Stop"),_.runCurrentCellAndAddBelow=C.l10n.t("Run current cell and add empty cell below"),_.jupyterDebuggerNotInstalledError=U=>C.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",U),_.jupyterDebuggerOutputParseError=U=>C.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",U),_.cellStopOnErrorMessage=C.l10n.t("Cell was canceled due to an error in a previous cell."),_.scrollToCellTitleFormatMessage=U=>C.l10n.t("Go to [{0}]",U.toString()),_.instructionComments=U=>C.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,U),_.exportButtonTitle=C.l10n.t("Export"),_.exportAsQuickPickPlaceholder=C.l10n.t("Export As..."),_.openExportedFileMessage=C.l10n.t("Would you like to open the exported file?"),_.openExportFileYes=C.l10n.t("Yes"),_.openExportFileNo=C.l10n.t("No"),_.exportFailedGeneralMessage=C.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),_.exportToPDFDependencyMessage=C.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),_.failedExportMessage=C.l10n.t("Export failed."),_.startingJupyterLogMessage=(U,et)=>C.l10n.t("Starting Jupyter from {0} with arguments {1}",U,et),_.waitingForJupyterSessionToBeIdle=C.l10n.t("Waiting for Jupyter Session to be idle"),_.gettingListOfKernelsForRemoteConnection=C.l10n.t("Fetching Kernels"),_.gettingListOfKernelSpecs=C.l10n.t("Fetching Kernel specs"),_.startingJupyterNotebook=C.l10n.t("Starting Jupyter Notebook"),_.registeringKernel=C.l10n.t("Registering Kernel"),_.jupyterCommandLineReloadQuestion=C.l10n.t("Please reload the window when changing the Jupyter command line."),_.jupyterCommandLineReloadAnswer=C.l10n.t("Reload"),_.createdNewKernel=(U,et)=>C.l10n.t("{0}: Kernel started: {1}",U,et),_.kernelInvalid=U=>C.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",U),_.removeRemoteJupyterServerEntryInQuickPick=C.l10n.t("Remove"),_.loadClassFailedWithNoInternet=(U,et)=>C.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",U,et),_.useCDNForWidgetsNoInformation=C.l10n.t("Widgets require us to download supporting files from a 3rd party website."),_.enableCDNForWidgetsSetting=(U,et)=>C.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",U,et),_.enableCDNForWidgetsButton=C.l10n.t("Enable Downloads"),_.unhandledMessage=(U,et)=>C.l10n.t("Unhandled kernel message from a widget: {0} : {1}",U,et),_.cdnWidgetScriptNotAccessibleWarningMessage=(U,et)=>C.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,et),_.widgetScriptNotFoundOnCDNWidgetMightNotWork=(U,et,ih)=>C.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",U,et,ih),_.insecureSessionMessage=C.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),_.insecureSessionDenied=C.l10n.t("Denied connection to insecure server."),_.selectKernelForEditor=C.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),_.needIpykernel6=C.l10n.t("Ipykernel setup required for this feature"),_.setup=C.l10n.t("Setup"),_.showDataViewerFail=C.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),_.defaultNotebookName=C.l10n.t("default"),_.recommendExtensionForNotebookLanguage=(U,et)=>C.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",U,et),_.kernelWasNotStarted=C.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),_.noNotebookToDebug=C.l10n.t("No active notebook document to debug."),_.cantStartDebugging=C.l10n.t("Can't start debugging."),_.restartNotSupported=C.l10n.t("Restarting is not supported in the interactive window."),_.importingIpynb=C.l10n.t("Importing notebook file"),_.exportingToFormat=U=>C.l10n.t("Exporting to {0}",U),_.kernelCategoryForJupyterSession=C.l10n.t("Jupyter Session"),_.kernelDefaultRemoteDisplayName=C.l10n.t("Remote"),_.kernelCategoryForJupyterKernel=C.l10n.t("Jupyter Kernel"),_.kernelCategoryForRemoteJupyterKernel=C.l10n.t("Jupyter Kernel"),_.kernelCategoryForConda=C.l10n.t("Conda Env"),_.kernelCategoryForCondaWithoutPython=C.l10n.t("Conda Env Without Python"),_.kernelCategoryForPoetry=C.l10n.t("Poetry Env"),_.kernelCategoryForPipEnv=C.l10n.t("Pipenv Env"),_.kernelCategoryForPyEnv=C.l10n.t("PyEnv Env"),_.kernelCategoryForGlobal=C.l10n.t("Global Env"),_.kernelCategoryForVirtual=C.l10n.t("Virtual Env"),_.fileSeemsToBeInterferingWithKernelStartup=U=>C.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",U),_.moduleSeemsToBeInterferingWithKernelStartup=U=>C.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",U),_.pipCondaInstallHoverWarning=(U,et)=>C.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",U,et),_.percentPipCondaInstallInsteadOfBang=U=>C.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[U],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),_.replacePipCondaInstallCodeAction=U=>C.l10n.t("Replace with '%{0} install'",U),_.failedToStartKernelDueToMissingModule=U=>C.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",U),_.failedToStartKernelDueToImportFailure=U=>C.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",U),_.failedToStartKernelDueToImportFailureFromFile=(U,et)=>C.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",U,et),_.failedToStartKernelDueToUnknownDllLoadFailure=C.l10n.t("The kernel failed to start as a dll could not be loaded."),_.failedToStartKernelDueToDllLoadFailure=U=>C.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",U),_.failedToStartKernelDueToWin32APIFailure=C.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),_.failedToStartKernelDueToPyZmqFailure=C.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),_.failedToStartKernelDueToOldIPython=C.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),_.failedToStartKernelDueToOldIPyKernel=C.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),_.failedToStartKernelDueToMissingPythonEnv=U=>C.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",U),_.matplotlibWidgetInsteadOfOther=C.l10n.t("'%matplotlib' widget works best inside of VS Code"),_.matplotlibWidgetCodeActionTitle=C.l10n.t("More info"),_.allowExtensionToUseJupyterKernelApi=(U,et)=>C.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",U,et),_.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=U=>C.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",U),_.activatingPythonEnvironment=U=>C.l10n.t("Activating Python Environment '{0}'",U),_.runningKernelStartupHooksFor=U=>C.l10n.t("Running Kernel startup hooks in '{0}'",U),_.cellAtFormat=(U,et)=>C.l10n.t("{0} Cell {1}",U,et),_.jupyterServerConsoleOutputChannel=C.l10n.t("Jupyter Server Console"),_.kernelConsoleOutputChannel=U=>C.l10n.t("{0} Kernel Console Output",U),_.webNotSupported=C.l10n.t("Operation not supported in web version of Jupyter Extension."),_.failedToInstallPythonExtension=C.l10n.t("Failed to install the Python Extension."),_.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=U=>C.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",U),_.listOfFilesWithLinksThatMightNeedToBeRenamed=U=>C.l10n.t("File(s): {0} might need to be renamed.",U),_.failedToGetVersionOfPandas=C.l10n.t("Failed to get version of Pandas to use the Data Viewer."),_.failedToInstallPandas=C.l10n.t("Failed to install Pandas to use the Data Viewer."),_.localKernelSpecs=C.l10n.t("Jupyter Kernel..."),_.localPythonEnvironments=C.l10n.t("Python Environments..."),_.quickPickTitleForSelectionOfJupyterServer=C.l10n.t("Select a Jupyter Server"),_.UserJupyterServerUrlProviderDisplayName=C.l10n.t("Existing Jupyter Server..."),_.UserJupyterServerUrlProviderDetail=C.l10n.t("Connect to an existing Jupyter Server"),_.kernelPickerSelectKernelTitle=C.l10n.t("Select Kernel"),_.kernelPickerSelectLocalKernelSpecTitle=C.l10n.t("Select a Jupyter Kernel"),_.quickPickSelectPythonEnvironmentTitle=C.l10n.t("Select a Python Environment"),_.kernelPickerSelectKernelFromRemoteTitle=U=>C.l10n.t("Select a Kernel from {0}",U),_.kernelPickerSelectKernelFromRemoteTitleWithoutName=C.l10n.t("Select a Jupyter Kernel"),_.installPythonExtensionViaKernelPickerTitle=C.l10n.t("Install Python Extension"),_.installPythonExtensionViaKernelPickerToolTip=C.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),_.installPythonQuickPickTitle=C.l10n.t("Install Python"),_.installPythonQuickPickToolTip=C.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=C.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),_.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=C.l10n.t("Ensure the server is running and reachable.")))(y||={});var Bt;(Y=>(Y.collapseSingle=C.l10n.t("Collapse"),Y.expandSingle=C.l10n.t("Expand"),Y.noRowsInDataViewer=C.l10n.t("No rows match current filter"),Y.sliceIndexError=C.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),Y.sliceMismatchedAxesError=C.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),Y.fetchingDataViewer=C.l10n.t("Fetching data ..."),Y.dataViewerHideFilters=C.l10n.t("Hide filters"),Y.dataViewerShowFilters=C.l10n.t("Show filters"),Y.refreshDataViewer=C.l10n.t("Refresh data viewer"),Y.sliceSummaryTitle=C.l10n.t("SLICING"),Y.sliceData=C.l10n.t("Slice Data"),Y.sliceSubmitButton=C.l10n.t("Apply"),Y.sliceDropdownAxisLabel=C.l10n.t("Axis"),Y.sliceDropdownIndexLabel=C.l10n.t("Index"),Y.variableExplorerNameColumn=C.l10n.t("Name"),Y.variableExplorerTypeColumn=C.l10n.t("Type"),Y.variableExplorerCountColumn=C.l10n.t("Size"),Y.variableExplorerValueColumn=C.l10n.t("Value"),Y.collapseVariableExplorerLabel=C.l10n.t("Variables"),Y.variableLoadingValue=C.l10n.t("Loading..."),Y.showDataExplorerTooltip=C.l10n.t("Show variable snapshot in data viewer"),Y.noRowsInVariableExplorer=C.l10n.t("No variables defined"),Y.loadingRowsInVariableExplorer=C.l10n.t("Loading variables"),Y.previousPlot=C.l10n.t("Previous"),Y.nextPlot=C.l10n.t("Next"),Y.panPlot=C.l10n.t("Pan"),Y.zoomInPlot=C.l10n.t("Zoom in"),Y.zoomOutPlot=C.l10n.t("Zoom out"),Y.exportPlot=C.l10n.t("Export to different formats"),Y.deletePlot=C.l10n.t("Remove"),Y.selectedImageListLabel=C.l10n.t("Selected Image"),Y.selectedImageLabel=C.l10n.t("Image"),Y.errorOutputExceedsLinkToOpenFormatString=C.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']})))(Bt||={});var DS;(n=>(n.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=C.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=C.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),n.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=C.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(DS||={});var Dh;(n=>(n.noCondaOrPipInstaller=C.l10n.t("There is no Conda or Pip installer available in the selected environment."),n.noPipInstaller=C.l10n.t("There is no Pip installer available in the selected environment."),n.searchForHelp=C.l10n.t("Search for help")))(Dh||={});var PA;(e=>e.installingModule=t=>C.l10n.t("Installing {0}",t))(PA||={});var _S="Python Kernel Debug Adapter",TS="Python Interactive Window Debug Adapter";var xE=require("node-fetch"),NS=k(i2());var s2=k(M());var _h=class{async createHash(e,t="SHA-256"){return ca(e,t)}};_h=g([(0,s2.injectable)()],_h);var yE={},o2=!1,bE;typeof window=="object"?bE=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?bE=self.crypto:bE=require("node:crypto").webcrypto;async function ca(r,e){let t=r.includes("/")||r.includes("\\")||r.endsWith(".interactive");if(t&&yE[r])return yE[r];let n=await Tte(r,e);return t&&!o2&&(Object.keys(yE).length>1e4&&(o2=!0),yE[r]=n),n}async function Tte(r,e){let t=new TextEncoder().encode(r),n=await bE.subtle.digest({name:e},t);return Array.from(new Uint8Array(n)).map(o=>o.toString(16).padStart(2,"0")).join("")}function tp(r){try{let[e,t,n]=`${r.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?void 0:isNaN(t)?e.toString():isNaN(n)?`${e}.${t}`:`${e}.${t}.${n}`}catch(e){x(`Failed to parse version ${r}`,e)}}async function ht(r){return ca(r,"SHA-256")}var Th=require("vscode");var vs=class extends Xe{constructor(t,n,i){super("jupyterconnection",t+(n?`
${n}`:""));this.interpreter=i}};var fn=class extends Xe{constructor(){super("sessionDisposed",y.sessionDisposed)}};var IE=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function Rh(r=""){if(!r)return;let e=/\S+Error: /g,t=`${r.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let n=t[0],o=((n.match(e)?n:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function SE(r=""){let e=c2(r);return e?e[1]:void 0}function c2(r=""){if(!r)return;let e=r.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function l2(r){if(!r)return;let t=(Array.isArray(r)?r[0]:r).split(`
`).map(c=>c.trim().toLowerCase()).filter(c=>c.length).reverse().find(c=>c.startsWith("file ")&&c.includes(", line ")&&c.includes(".py")&&c.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function im(r,e,t,n="",i=[]){let o=e instanceof Xe?e.stdErr||e.stack||"":e.toString(),s=c2(o),a=o.toLowerCase();if(e instanceof fn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=a2(s[1]);if(u&&n){let p=Rte(u.moduleName,u.fileName,r,n);return p||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let c="No module named".toLowerCase(),l="is not a package".toLowerCase();if(a.includes(c)&&!l){let u=Ke(o).map(m=>m.trim()).filter(m=>m.length).find(m=>m.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:p,message:y.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(c)&&l){let u=Ke(o).map(b=>b.trim()).filter(b=>b.length).find(b=>b.toLowerCase().includes(c)),p=u?u.substring(u.toLowerCase().indexOf(c)+c.length).trim():"",m="",h="";p.split("'").length>2&&(m=p.split("'").slice(-2)[0]||"",m=m?`${m}.py`:"",h=m||"",p=p.split("'")[1]||p);let v=i.filter(b=>mn(b).toLowerCase()==="__init__.py").map(b=>mn(Si(b)));return p&&m&&p!==m&&i.some(b=>mn(b).toLowerCase()===m.toLowerCase())?{reason:"overridingBuiltinModules",fileName:m,moduleName:p,message:y.fileSeemsToBeInterferingWithKernelStartup(m),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:p&&v&&p!==h&&v.some(b=>b.toLowerCase()===h.toLowerCase())?{reason:"overridingBuiltinModules",folderName:h,moduleName:p,message:y.moduleSeemsToBeInterferingWithKernelStartup(h),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:p,message:y.failedToStartKernelDueToMissingModule(p),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof Xe&&e.category==="invalidkernel"&&i.length){let u=mn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:mn(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=a2(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof vs){let u=Ke(o).map(w=>w.trim()).reverse().find(w=>w.toLowerCase().includes("error: ")),p="AttributeError: 'Namespace' object has no attribute '_flags'",m=["jupyter.startup.failure"],h,v="jupyterStartFailure",b=Ke(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: "));if(b=b||Ke(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: ")),a.includes(p.toLowerCase())?(v="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",b||""),m.push("outdated.traitlets"),h="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=b?y.failedToStartJupyterWithErrorInfo(t||"",b):y.failedToStartJupyter(t||""),h=void 0),u)return{reason:v,message:u,pythonError:b,moreInfoLink:h,telemetrySafeTags:m}}}function a2(r){r=r.replace(/"/g,"'");let e=r.match(/'[^\\']*(\\'[^\\']*)*'/g),t=r.match(/\((.*?)\)/g),n,i;return e&&e[0].length>2&&(n=e[0],n=n.substring(1,n.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),n?{moduleName:n,fileName:i}:void 0}function Rte(r,e,t,n){if(n&&t.length!==0&&e&&!e.toLowerCase().startsWith(n)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:r,message:y.fileSeemsToBeInterferingWithKernelStartup(V(Th.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Ah(r){if(!r)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(r))!==null;)t.length===3&&(r=r.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let n=Ke(r,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Th.NotebookCellOutput([Th.NotebookCellOutputItem.error({message:"",name:"",stack:n})])}var Ate=[Nte,Mte];function u2(r){let e=[],t=Array.isArray(r)?r[0].toLowerCase():r.toLowerCase();Ate.forEach(i=>i(t,e));let n=im([],t,void 0);return n?.telemetrySafeTags.length&&e.push(...n.telemetrySafeTags),Array.from(new Set(e)).join(",")}function Nte(r,e=[]){r.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function Mte(r,e=[]){r.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function p2(){return(new Error().stack||"").split(`
`).filter(r=>r.includes(Pt))}async function d2(r,e){r.failed=!0,r.failureCategory=r.failureCategory||bA(e);let t=!xE.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||xE.FetchError!==void 0)&&Fte(e,t?TypeError:xE.FetchError);r.failureCategory==="unknown"&&i&&(r.failureCategory="fetcherror"),r.stackTrace=Ote(e),typeof e=="string"&&(r.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;r.failureSubCategory=r.failureSubCategory||u2(o);let s=l2(o);s&&([r.pythonErrorFile,r.pythonErrorFolder,r.pythonErrorPackage]=await Promise.all([Promise.resolve(r.pythonErrorFile||ht(s.fileName)),Promise.resolve(r.pythonErrorFolder||ht(s.folderName)),Promise.resolve(r.pythonErrorPackage||ht(s.packageName))]))}function kA(r){if(r.stack&&Array.isArray(r.stack)){let e={...r,stack:r.stack.join(`
`)};return NS.parse.call(NS,e)}return NS.parse.call(NS,r)}function Ote(r){let e="";for(let t of kA(r)){let n=t.getFileName();if(n){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${Kte(t)} ${n}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function Kte(r){let e=[];return typeof r.getTypeName()=="string"&&r.getTypeName().length>0&&e.push(r.getTypeName()),typeof r.getMethodName()=="string"&&r.getMethodName().length>0&&e.push(r.getMethodName()),typeof r.getFunctionName()=="string"&&r.getFunctionName().length>0&&(e.length!==2||e.join(".")!==r.getFunctionName())&&e.push(r.getFunctionName()),e.join(".")}function Fte(r,e){return e?r instanceof e||r instanceof sn&&r.originalException instanceof e:(console.error("Error type is not defined",r),!1)}var h2=require("vscode");function Lte(){try{return require("vscode")===void 0?!1:g2()!==void 0}catch{return!1}}function wE(){return h2.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}var CE={};function Nh(r,e){let t=r;cS()&&t.startsWith("ds_")||(e===void 0?delete CE[t]:CE[t]=e)}var DA;function g2(){if(DA)return DA;let r=require("@vscode/extension-telemetry").default;return DA=new r(zU)}function m2(r,e){let t={};return Object.getOwnPropertyNames(e).forEach(n=>{if(!(e[n]===void 0||e[n]===null))try{t[n]=typeof e[n]=="string"?e[n]:typeof e[n]=="object"?"object":e[n].toString()}catch(i){x(`Failed to serialize ${n} for ${r}`,i)}}),t}function A(r,e,t,n){Dr()||!Lte()||Ute(r,e,t,n)}function Ute(r,e,t,n){let i=g2(),o={},s=r;n?(o={},Object.assign(o,CE),Object.assign(o,t||{}),d2(o,n).then(()=>{o=m2(s,o),i.sendTelemetryEvent(s,o,e)}).catch(f)):(t&&(o=m2(s,t)),Object.assign(o,CE),i.sendTelemetryEvent(s,o,e))}var f2=new Set;function pr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){let a=e||{},c=new Be,l=`${r.toString()}${JSON.stringify(a)}`,u=!f2.has(l);f2.add(l);let p=o.apply(this,s);return p&&typeof p.then=="function"&&typeof p.catch=="function"?p.then(m=>{let h={...a};return u&&(h.firstTime=u),A(r,c?{duration:c?.elapsedTime}:void 0,h),m}).catch(m=>{let h={...a};h.failed=!0,A(r,c?{duration:c?.elapsedTime}:{},h,m)}):A(r,c?{duration:c?.elapsedTime}:void 0,a),p},i}}function Qr(r,e){return function(t,n,i){let o=i.value;return i.value=function(...s){return A(r,void 0,e),o.apply(this,s)},i}}function jte(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function Rt(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function Ao(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function lc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function qi(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...Ao()}}}var Axe={...Rt(),...lc(),...jte()};var Wte,Vte,Bte,qte,Jte,$te,Hte,Gte,zte,Qte,Yte,Xte,Zte,ere,tre,rre,nre,ire,ore,sre,are,cre,lre,ure,pre,dre,mre,fre,hre,gre,vre,yre,bre,Ire,Sre,xre,Cre,wre,Ere,Pre,kre,Dre,_re,Tre,Rre,Are,Nre,Mre,Ore,Kre,Fre,Lre,Ure,jre,Wre,Vre,Bre,qre,Jre,$re,Hre,Gre,zre,Qre,Yre,Xre,Zre,ene,tne,rne,nne,ine,one,sne,ane,cne,lne,une,pne,dne,mne,fne,hne,gne,vne,yne,bne,Ine,Sne,xne,Cne,wne,Ene,Pne,kne,Dne,_ne,Tne,Rne,Ane,Nne,Mne,One,Kne,Fne,Lne,Une,jne,Wne,Vne,Bne,qne,Jne,$ne,Hne,Gne,zne,Qne,Yne,Xne,Zne,eie,tie,rie,nie,iie,oie,sie,aie,cie,lie,uie,pie,die,mie,fie,hie,gie,vie,yie,bie,Iie,Sie,xie,Cie,wie,Eie,Pie,kie,Die,_ie,Tie,Rie,Aie,Nie,Mie,Oie,Kie,Fie,Lie,Uie,v2=class{constructor(){this[Wte]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Vte]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:Rt()};this[Bte]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[qte]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Jte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Ao()}};this[$te]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Rt()};this[Hte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Ao()}};this[Gte]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Rt()};this[zte]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[Qte]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[Yte]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[Xte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Rt()};this[Zte]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:Rt()};this[ere]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[tre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[rre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[nre]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[ire]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[ore]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[sre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...lc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:Rt()};this[are]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[cre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[lre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[ure]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[pre]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:qi().properties,measures:{...Rt()}};this[dre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[mre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[fre]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[hre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[gre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[vre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[yre]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[bre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Ire]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Sre]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[xre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Cre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[wre]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Ere]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Pre]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[kre]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[Dre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[_re]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Tre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Rre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Are]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Nre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Mre]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[Ore]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Kre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Fre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Lre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Ure]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[jre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Wre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Vre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Bre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[qre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Jre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[$re]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Hre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Gre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[zre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Qre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Yre]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:Rt()};this[Xre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[Zre]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[ene]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[tne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[rne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[nne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[ine]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[one]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[sne]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ane]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...Ao()},measures:Rt()};this[cne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[lne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:Rt()};this[une]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[pne]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[dne]={owner:"IanMatthewHuff",feature:["DataFrameViewer","VariableViewer"],source:"N/A"};this[mne]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[fne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failedWithoutBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},failedWithBackingFile:{classification:"SystemMetaData",purpose:"FeatureInsight"},localHost:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[hne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[gne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[vne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Rt()};this[yne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[bne]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ine]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...lc(),...Ao()},measures:{...Rt()}};this[Sne]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[xne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Cne]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[wne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Ene]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:Rt()};this[Pne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[kne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Dne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[_ne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Tne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Rne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Ane]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",measures:{totalOverheadInMs:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfMessagesWaitedOn:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},averageWaitTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},numberOfRegisteredHooks:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Nne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Mne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[One]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...Rt(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...qi().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Kne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:Rt()};this[Fne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...Rt(),pendingInspectRequestsBefore:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},pendingInspectRequestsAfter:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...qi().properties,...lc()}};this[Lne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:Rt(),properties:{...qi().properties,...lc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Une]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...qi().properties,...lc()}};this[jne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...qi().properties,...lc()}};this[Wne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:qi().properties};this[Vne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...Ao(),...lc(),...qi().properties},measures:{...Rt()}};this[Bne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Ao(),...lc(),...qi().properties},measures:Rt()};this[qne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...Ao(),...lc(),...qi().properties,envMissingReason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isEmptyCondaEnv:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},pythonEnvType:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},fileExists:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Jne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...Ao(),...qi().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[$ne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Ao(),...qi().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Hne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Ao(),...qi().properties}};this[Gne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...Ao(),...qi().properties}};this[zne]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[Qne]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Yne]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[Xne]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:Rt(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Zne]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:Rt()};this[eie]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[tie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:Rt()};this[rie]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:Rt()};this[nie]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[iie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[oie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[sie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[aie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[cie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[lie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[uie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[pie]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[die]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[mie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[fie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[hie]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[gie]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[vie]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[yie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...Rt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[bie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...Rt(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},pendingRequests:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestTimedout:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completedWithData:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Iie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Sie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[xie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Cie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[wie]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...Rt()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[Eie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Pie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[kie]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:Rt()};this[Die]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[_ie]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[Tie]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...qi().properties,...Ao()}};this[Rie]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[Aie]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[Nie]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Mie]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Oie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Kie]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:Rt()};this[Fie]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[Lie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Uie]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"}}static{Wte="EXTENSION.LOAD",Vte="DS_INTERNAL.EXPERIMENT_LOAD",Bte="ENVFILE_VARIABLE_SUBSTITUTION",qte="ENVFILE_WORKSPACE",Jte="HASHED_PACKAGE_NAME",$te="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",Hte="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",Gte="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",zte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",Qte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",Yte="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",Xte="DATASCIENCE.ADD_CELL_BELOW",Zte="DS_INTERNAL.CODE_LENS_ACQ_TIME",ere="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",tre="DATASCIENCE.DEBUG_CONTINUE",rre="DATASCIENCE.DEBUG_CURRENT_CELL",nre="DATASCIENCE.DEBUG_STEP_OVER",ire="DATASCIENCE.DEBUG_STOP",ore="DATASCIENCE.DEBUG_FILE_INTERACTIVE",sre="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",are="DS_INTERNAL.JUPYTER_KERNEL_SPEC",cre="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",lre="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",ure="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",pre="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",dre="DATASCIENCE.EXPORT_PYTHON_FILE",mre="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",fre="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",hre="DATASCIENCE.EXPORT_NOTEBOOK_AS",gre="DATASCIENCE.IMPORT_NOTEBOOK",vre="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",yre="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",bre="DS_INTERNAL.GET_PASSWORD_FAILURE",Ire="DS_INTERNAL.GET_PASSWORD_SUCCESS",Sre="DS_INTERNAL.JUPYTER_HUB_PASSWORD",xre="DS_INTERNAL.SHOW_DATA_NO_PANDAS",Cre="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",wre="DS_INTERNAL.SHOW_DATA_PANDAS_OK",Ere="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",Pre="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",kre="DATASCIENCE.OPEN_PLOT_VIEWER",Dre="DATASCIENCE.RUN_ALL_CELLS",_re="DATASCIENCE.RUN_SELECTION_OR_LINE",Tre="DATASCIENCE.RUN_CURRENT_CELL",Rre="DATASCIENCE.RUN_ALL_CELLS_ABOVE",Are="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",Nre="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",Mre="DATASCIENCE.RUN_FILE_INTERACTIVE",Ore="DATASCIENCE.RUN_TO_LINE",Kre="DATASCIENCE.RUN_FROM_LINE",Fre="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",Lre="DATASCIENCE.RUN_INSERT_CELL_BELOW",Ure="DATASCIENCE.RUN_INSERT_CELL_ABOVE",jre="DATASCIENCE.RUN_DELETE_CELLS",Wre="DATASCIENCE.RUN_SELECT_CELL",Vre="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",Bre="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",qre="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",Jre="DATASCIENCE.RUN_MOVE_CELLS_UP",$re="DATASCIENCE.RUN_MOVE_CELLS_DOWN",Hre="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",Gre="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",zre="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",Qre="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",Yre="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",Xre="DATASCIENCE.SELFCERTSMESSAGECLOSE",Zre="DATASCIENCE.SELFCERTSMESSAGEENABLED",ene="DATASCIENCE.USER_INSTALLED_JUPYTER",tne="DATASCIENCE.USER_INSTALLED_PANDAS",rne="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",nne="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",ine="DS_INTERNAL.PYTHON_NOT_INSTALLED",one="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",sne="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",ane="DS_INTERNAL.PYTHON_MODULE_INSTALL",cne="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",lne="DATASCIENCE.START_SHOW_DATA_EXPLORER",une="DATASCIENCE.SHOW_DATA_EXPLORER",pne="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",dne="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",mne="DATASCIENCE.REFRESH_DATA_VIEWER",fne="DS_INTERNAL.JUPYTER_STARTED_SESSION_WITH_BACKING_FILE",hne="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",gne="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",vne="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",yne="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",bne="DATASCIENCE.KERNEL_SPEC_LANGUAGE",Ine="DS_INTERNAL.KERNEL_LAUNCHER_PERF",Sne="GLOBAL_PYTHON_KERNELSPEC",xne="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Cne="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",wne="DS_INTERNAL.IPYWIDGET_USED_BY_USER",Ene="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",Pne="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",kne="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",Dne="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",_ne="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",Tne="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",Rne="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",Ane="DS_INTERNAL.IPYWIDGET_OVERHEAD",Nne="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Mne="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",One="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",Kne="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Fne="DATASCIENCE.EXECUTE_CELL",Lne="DATASCIENCE.EXECUTE_CODE",Une="DATASCIENCE.RESUME_EXECUTE_CELL",jne="DATASCIENCE.NOTEBOOK_START",Wne="DS_INTERNAL.SWITCH_KERNEL",Vne="DATASCIENCE.NOTEBOOK_INTERRUPT",Bne="DATASCIENCE.NOTEBOOK_RESTART",qne="DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",Jne="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",$ne="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",Hne="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",Gne="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",zne="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",Qne="DS_INTERNAL.KERNEL_COUNT",Yne="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",Xne="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",Zne="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",eie="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",tie="DATAVIEWER.WEBVIEW_LOADED",rie="PLOTVIEWER.WEBVIEW_LOADED",nie="DS_INTERNAL.COMMAND_EXECUTED",iie="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",oie="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",sie="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",aie="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",cie="DATASCIENCE.RECOMMENT_EXTENSION",lie="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",uie="DATASCIENCE.DEBUGGING.CLOSED_MODAL",pie="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",die="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",mie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",fie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",hie="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",gie="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",vie="DATASCIENCE.DEBUGGING.ENDED_SESSION",yie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",bie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",Iie="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",Sie="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",xie="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",Cie="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",wie="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",Eie="DATASCIENCE.JUPYTER_API_USAGE",Pie="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",kie="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",Die="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",_ie="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",Tie="DATASCIENCE.KERNEL_CRASH",Rie="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",Aie="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",Nie="DS_INTERNAL.RUNTEST",Mie="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",Oie="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",Kie="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",Fie="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",Lie="DATAVIEWER.USING_INTERPRETER",Uie="DATAVIEWER.USING_KERNEL"}};function Oh(r,e,t){return r?t.createSystemVariables(e).resolve(r):e?ut(Ee(e)):process.cwd()}async function EE(r,e){let t=y.jupyterSelfCertEnable,n=y.jupyterSelfCertClose,i=await Mh.window.showErrorMessage(y.jupyterSelfCertFail(e),{modal:!0},t,n);return i===t?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Mh.ConfigurationTarget.Workspace),!0):(i===n&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function PE(r,e){let t=y.jupyterSelfCertEnable,n=y.jupyterSelfCertClose,i=await Mh.window.showErrorMessage(y.jupyterExpiredCertFail(e),{modal:!0},t,n);return i===t?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await r.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Mh.ConfigurationTarget.Workspace),!0):(i===n&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function OS(r,e,t,n,i,o,s){let a=e.baseUrl,c=e.token,l=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0,p=u?()=>u:void 0,m={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},h=t.getRequestInit();(!(c===""||c==="null")||p)&&(m={...m,token:c,appendToken:!0});let b=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&b&&n){let T=n.createHttpRequestAgent();h={...h,agent:T}}let{ServerConnection:w}=require("@jupyterlab/services");return m={...m,init:h,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,b,p),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,b,p),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:r.id,serverProviderHandle:r,token:c,hostName:l,displayName:e&&e.displayName?e.displayName:gE(c,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:p,settings:w.makeSettings(m)}}async function y2(r){let e=Wt(r);return ca(e,"SHA-256")}var jie=new Set([Pt,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(r=>r.toLowerCase()));function Wt(r){return jie.has(r.extensionId.toLowerCase())?`${Ge.REMOTE_URI}?${Ge.REMOTE_URI_ID_PARAM}=${r.id}&${Ge.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}`:`${Ge.REMOTE_URI}?${Ge.REMOTE_URI_ID_PARAM}=${r.id}&${Ge.REMOTE_URI_HANDLE_PARAM}=${encodeURI(r.handle)}&${Ge.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(r.extensionId)}`}var No=class extends Xe{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){return e.message.indexOf("reason: self signed certificate")>=0}};var uc=class extends Xe{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var Yr=Symbol("IDataScienceErrorHandler"),Pn=class extends Xe{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}},pc=class extends sn{constructor(t,n,i){super(t,n);this.kernelConnectionMetadata=i}};var b2=Symbol("IsDevMode"),Mo=Symbol("IOutputChannel"),I2=Symbol("IS_WINDOWS"),K=Symbol("IDisposableRegistry"),$e=Symbol("IGlobalMemento"),yt=Symbol("IGlobalMemento"),ri=Symbol("IWorkspaceMemento");var dc=Symbol("IPersistentStateFactory"),Xxe=Symbol("IRandom"),ae=Symbol("IConfigurationService"),ct=Symbol("ExtensionContext"),sm=Symbol("IExtensions"),S2=Symbol("IJupyterExtensionBanner"),kE=Symbol("IFeaturesManager"),Kh=Symbol("ICryptoUtils"),ni=Symbol("IAsyncDisposableRegistry");var mc=Symbol("IExperimentService"),Fh=Symbol("IDataScienceCommandListener"),Lh=Symbol("IVariableScriptGenerator"),Uh=Symbol("IDataFrameScriptGenerator");var Pi=class extends Xe{constructor(t,n,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError(x2(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=n;this.originalError=i;this.baseUrl=x2(t)}};function x2(r){let e=new URL(r);return`${e.protocol}//${e.host}/`}var qS=require("vscode");var kV=require("vscode");var gV=k(O2()),ap=require("vscode");var rp=require("vscode");function vc(r){let e=gc(r.uri);return ht(e.path)}function Oo(r=rp.Uri.file(""),e=rp.Uri.file(""),t=qr(),n=!1){let i=gc(r,t,t=="Windows"||n),o=gc(e,t,t=="Windows"||n);return i===o||Ii(i,o,!0)}function gc(r=rp.Uri.file(""),e=qr(),t=!1){let n=Ee(r);return t&&(n=n.toLowerCase()),n.endsWith("/bin/python")?["Linux","OSX"].includes(e)?n.endsWith("/bin/python")&&n.split("/").length>4?rp.Uri.file(n.replace("/bin/python","/python")):rp.Uri.file(n):rp.Uri.file(n):rp.Uri.file(n)}var Ze=require("vscode");var zt=Symbol("IPythonApi"),ze=Symbol("IPythonExtensionChecker");var Ss=k(M());var K2=require("vscode");var ao=class{constructor(){this.promises=new Set;this._onStateChange=new K2.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(f)}};var _E=class extends sn{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var TE=class extends Xe{constructor(){super("pythonExtension","Python Extension API not exported")}};var Z2=k(Hh());function np(r){if("executable"in r){let s=[];typeof r.version?.major=="number"&&(s.push(r.version.major.toString()),typeof r.version.minor=="number"&&(s.push(r.version.minor.toString()),typeof r.version.micro=="number"&&s.push(r.version.micro.toString())));let a=s.length?s.join("."):"",c=r.environment?mn(r.environment?.folderUri):"",l=a?`Python ${a}`:"Python";return la(r)&&c?c:c?`${c} (${l})`:l}let e=(tp(r.version?.raw||"")||"").trim(),t=r.envType==="Conda"&&r.isCondaEnvWithoutPython===!0,n=e.trim()?`Python ${e}`:"Python",i=jE(r);if(t&&i)return i;let o=[];return i&&o.push(i),r.envType&&r.envType!=="Unknown"&&o.push(r.envType),[n,o.length?`(${o.join(": ")})`:""].join(" ").trim()}function jE(r){let e=r.envName;return r.envPath&&r.envType==="Conda"&&!r.envName&&(e=mn(r.envPath)),e}var Moe=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Jr(r){if(r.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,n]of e)if(r.tools.includes(t))return n;for(let t of Moe)if(r.tools.some(n=>n.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}function la(r){return Jr(r)==="Conda"&&!r.executable.uri}var um=require("vscode");var WE=class{};function bs(r,e=""){let t=r?um.workspace.getWorkspaceFolder(r):um.workspace.workspaceFolders?um.workspace.workspaceFolders[0]:void 0;return t?bn(qr()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function Is(){return(Array.isArray(um.workspace.workspaceFolders)&&um.workspace.workspaceFolders.length>0?um.workspace.workspaceFolders[0]:void 0)?.uri}function WS(r,e){if(r){let t={...r,sysPrefix:r.sysPrefix||"",uri:Ze.Uri.file(r.path||""),id:e||r.id,envPath:r.envPath?Ze.Uri.file(r.envPath):void 0,displayPath:"displayPath"in r&&typeof r.displayPath=="string"?Ze.Uri.file(r.displayPath):void 0};return delete t.path,r.envPath||delete t.envPath,t}}function Ooe(r,e){let t=r.tools,n=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]],i=t.length?t[0]:"Unknown";if(r.environment?.type==="Conda")i="Conda";else{for(let[l,u]of n)if(t.includes(l)){i=u;break}i==="Unknown"&&r.environment?.type==="VirtualEnvironment"&&(i="VirtualEnv")}let o=!1,s,a=r.id,c=r.executable.sysPrefix;if(r.executable.uri)s=r.executable.uri;else if(i==="Conda"&&e)o=!0,c=c||r.environment?.folderUri?.fsPath||"",s=qr()==="Windows"?Ze.Uri.joinPath(r.environment?.folderUri||Ze.Uri.file(r.path),"python.exe"):Ze.Uri.joinPath(r.environment?.folderUri||Ze.Uri.file(r.path),"bin","python");else{j(`Python environment ${V(r.id)} excluded as Uri is undefined`);return}return{id:a,sysPrefix:c||"",envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||Ze.Uri.file(r.path),envName:r.environment?.name||"",uri:s,displayName:r.environment?.name||"",envType:i,isCondaEnvWithoutPython:o,version:r.version?{major:r.version.major,minor:r.version.minor,patch:r.version.micro,raw:r.version.sysVersion}:void 0}}function VE(r,e){let t=Jr(r),n=!1,i,o=r.id,s=r.executable.sysPrefix;if(r.executable.uri)i=r.executable.uri;else if(t==="Conda"&&e)n=!0,s=s||r.environment?.folderUri?.fsPath||"",i=qr()==="Windows"?Ze.Uri.joinPath(r.environment?.folderUri||Ze.Uri.file(r.path),"python.exe"):Ze.Uri.joinPath(r.environment?.folderUri||Ze.Uri.file(r.path),"bin","python");else{j(`Python environment ${V(r.id)} excluded as Uri is undefined`);return}return{id:o,sysPrefix:s||"",envPath:r.environment?.folderUri,displayPath:r.environment?.folderUri||Ze.Uri.file(r.path),envName:r.environment?.name||"",uri:i,displayName:r.environment?.name||"",envType:t,isCondaEnvWithoutPython:n,version:r.version?{major:r.version.major||0,minor:r.version.minor||0,patch:r.version.micro||0,raw:r.version.sysVersion||""}:void 0}}function Rl(r){if(r){let e=Object.assign({},r,{path:Ee(r.uri),envPath:r.envPath?Ee(r.envPath):void 0,displayPath:r.displayPath?Ee(r.displayPath):void 0});return delete e.uri,e}}var Gh=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=ce();this.didActivatePython=new Ze.EventEmitter;this._pythonExtensionHooked=ce();this.extensionChecker.isPythonExtensionInstalled||Ze.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(f),this.api.promise}async getNewApi(){await this.init();let e=Ze.extensions.getExtension(ei);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new Z2.SemVer(e?.packageJSON?.version)),e?.exports}setApi(e){this.api.resolved||!Ze.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;Ze.extensions.getExtension(ei)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=Ze.extensions.getExtension(ei);if(!e)return;let t=!1;if(!e.isActive)try{await e.activate(),t=!0}catch(n){x("Failed activating the python extension: ",n),this.api.reject(new _E(n));return}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(x("Python extension is not exporting the jupyter API"),this.api.reject(new TE)),this._pythonExtensionHooked.resolve())}};Gh=g([(0,Ss.injectable)(),d(0,(0,Ss.inject)(K)),d(1,(0,Ss.inject)(ze))],Gh);var ip=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new Ze.EventEmitter;Ze.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return Ze.extensions.getExtension(ei)!==void 0}get isPythonExtensionActive(){return Ze.extensions.getExtension(ei)?.isActive===!0}async directlyInstallPythonExtension(){return Ze.commands.executeCommand("workbench.extensions.installExtension",ei,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!Ze.workspace.isTrusted)return;ip.promptDisplayed=!0;let e=ge.bannerLabelYes;A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await Ze.window.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){Ze.commands.executeCommand("extension.open",ei).then(f,f)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};ip=g([(0,Ss.injectable)(),d(0,(0,Ss.inject)(K))],ip);var zh=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=n;this.context=i;this.didChangeInterpreter=new Ze.EventEmitter;this.didChangeInterpreters=new Ze.EventEmitter;this._onDidEnvironmentVariablesChange=new Ze.EventEmitter;this._onDidRemoveInterpreter=new Ze.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this.interpreterListCachePromise=void 0;this._status="idle";this._onDidChangeStatus=new Ze.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new ao;this.pauseEnvDetection=!1;this.onResumeEnvDetection=new Ze.EventEmitter;this._interpreters=new Map;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&(this.extensionChecker.isPythonExtensionActive||this.apiProvider.onDidActivatePythonExtension(()=>{this.builtListOfInterpretersAtLeastOnce=!1,this.hookupOnDidChangeInterpreterEvent(),this.buildListOfInterpretersForFirstTime()},this,this.disposables)),Ze.workspace.onDidChangeWorkspaceFolders(this.onDidChangeWorkspaceFolders,this,n),Ze.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"}),Ze.workspace.onDidGrantWorkspaceTrust(()=>this.populateCachedListOfInterpreters(!0).catch(f),this,this.disposables)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}get known(){return this.api?.environments.known||[]}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let n=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(n||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}get resolvedEnvironments(){return this.hookupOnDidChangeInterpreterEvent(),Array.from(this._interpreters.values()).map(e=>e.resolved)}get environmentsFound(){return this.getApi().catch(f),this.hookupOnDidChangeInterpreterEvent(),(this.api?.environments?.known.length??0)>0}getInterpreters(){if(this.hookupOnDidChangeInterpreterEvent(),!this.interpreterListCachePromise){this.getInterpretersCancellation?.cancel(),this.getInterpretersCancellation?.dispose();let e=this.getInterpretersCancellation=new Ze.CancellationTokenSource;this.interpreterListCachePromise=this.getInterpretersImpl(e.token),this.interpreterListCachePromise.finally(()=>e.dispose()).catch(f),this.refreshPromises.push(this.interpreterListCachePromise)}return this.interpreterListCachePromise}pauseInterpreterDetection(e){e.isCancellationRequested||(this.pauseEnvDetection=!0,e.onCancellationRequested(()=>{this.pauseEnvDetection=!1,this.triggerPendingEvents()},this,this.disposables))}async refreshInterpreters(e=!1){let t=(async()=>{let n=await this.getApi();if(n)try{await n.environments.refreshEnvironments({forceRefresh:e}),this.interpreterListCachePromise=void 0,await this.getInterpreters(),E("Refreshed Environments")}catch{x("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>ji(1e3))),await t}async getActiveInterpreter(e){if(!Ze.workspace.isTrusted)return;let t=new Be;this.hookupOnDidChangeInterpreterEvent(),!e&&Ze.workspace.workspaceFolders?.length===1&&(e=Ze.workspace.workspaceFolders[0].uri),Ze.workspace.workspaceFolders?.length&&(e=(e?Ze.workspace.getWorkspaceFolder(e)?.uri:void 0)||Ze.workspace.workspaceFolders[0].uri);let n=bs(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(n)||(this.workspaceCachedActiveInterpreter.add(n),A("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{j(`Failed to get active interpreter from Python for workspace ${n}`,o)}),(Zn||[Ze.ExtensionMode.Development,Ze.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${V(e)}'-${V(o?.id)}`;this.lastLoggedResourceAndInterpreterId!==s&&(this.lastLoggedResourceAndInterpreterId=s,H(`Active Interpreter ${e?`for '${V(e)}' `:""}is ${V(o?.id)} (${o?.envType}, '${o?.envName}', ${o?.version?.major}.${o?.version?.minor}.${o?.version?.patch})`))}).catch(f),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!Ze.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async n=>{if(!n||t?.isCancellationRequested)return;let i=n.environments.known.find(c=>Vn(e)?Oo(c.executable.uri,e):typeof e=="string"?c.id===e:Oo(Ze.Uri.file(c.path),Ze.Uri.file(e.path))),o=Vn(e)?V(e):typeof e=="string"?e:V(Ze.Uri.file(e.path));if(i){let c=await n.environments.resolveEnvironment(i),l=this.trackResolvedEnvironment(c);return re(`Interpreter details for ${o} from Python is ${JSON.stringify(c)} and our mapping is ${JSON.stringify(l)}`),l}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),j(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await n.environments.resolveEnvironment(Vn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(n){j(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:V(Vn(e)?e:Ze.Uri.file(e.path))}`,n);return}}trackResolvedEnvironment(e){if(e){let t=this.apiProvider.pythonExtensionVersion&&this.apiProvider.pythonExtensionVersion.compare("2023.3.10341119")>=0,n=Ooe(e,!!t);if(!n)return;if(vc(n).then(i=>{this.pythonEnvHashes.set(n.id,i)}).catch(f),!this._interpreters.get(e.id)||!Ro(n,this._interpreters.get(e.id)?.resolved)){let i=this._interpreters.get(e.id);i?.resolved&&Object.assign(i.resolved,n),this._interpreters.set(e.id,{resolved:n}),this.triggerEventIfAllowed("interpretersChangeEvent",n)}return n}}triggerEventIfAllowed(e,t){if(e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),!this.pauseEnvDetection){this.triggerPendingEvents();return}}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(n=>!!n);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi(),this.apiPromise.then(e=>e?this.api=e:void 0).catch(f)),this.apiPromise}onDidChangeWorkspaceFolders(){this.interpreterListCachePromise=void 0}populateCachedListOfInterpreters(e){e&&(this.interpreterListCachePromise=void 0);let t=this.getInterpreters().catch(f);return this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>ji(1e3))),t}async getInterpretersImpl(e,t=0){if(!Ze.workspace.isTrusted)return[];this.extensionChecker.isPythonExtensionInstalled&&(this.builtListOfInterpretersAtLeastOnce=!0);let n=[],i=!1;return await this.getApi().then(async o=>{if(!o||e.isCancellationRequested)return[];let s=o.environments.known.length;try{await Promise.all(o.environments.known.map(async a=>{try{let c=await o.environments.resolveEnvironment(a),l=this.trackResolvedEnvironment(c);l?n.push(l):a.executable.uri&&a.environment?.type!=="Conda"&&x(`Failed to get env details from Python API for ${V(a.id)} without an error`)}catch(c){x(`Failed to get env details from Python API for ${V(a.id)}`,c)}})),this.triggerEventIfAllowed("interpretersChangeEvent",void 0)}catch(a){x("Failed to refresh list of interpreters and get their details",a)}s<o.environments.known.length&&(i=!0)}),e.isCancellationRequested?[]:i&&t<10?(E(`List of interpreters changed after a while, will need to rebuild it again, counter = ${t}`),this.getInterpretersImpl(e,t++)):(E(`Full interpreter list is length: ${n.length}, ${n.map(o=>`${o.id}:${o.displayName}:${o.envType}:${V(o.uri)}`).join(", ")}`),n)}buildListOfInterpretersForFirstTime(){this.builtListOfInterpretersAtLeastOnce||(this.extensionChecker.isPythonExtensionActive&&(this.builtListOfInterpretersAtLeastOnce=!0,this.populateCachedListOfInterpreters().catch(f)),this.extensionChecker.onPythonExtensionInstallationStatusChanged(e=>{e==="installed"&&this.extensionChecker.isPythonExtensionActive&&this.populateCachedListOfInterpreters().catch(f)},this,this.disposables))}hookupOnDidChangeInterpreterEvent(){this.eventHandlerAdded||(this.buildListOfInterpretersForFirstTime(),this.getApi().then(e=>{!this.eventHandlerAdded&&e&&(this.eventHandlerAdded=!0,e.environments.onDidEnvironmentVariablesChange(t=>{E(`Detected changes to env file ${t.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),e.environments.onDidChangeActiveEnvironmentPath(()=>{E("Detected change in Active Python environment via Python API"),this.interpreterListCachePromise=void 0,this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),e.environments.onDidChangeEnvironments(async t=>{E(`Python API env change detected, ${t.type} => '${t.env.id}'`),t.type==="remove"&&this._interpreters.delete(t.env.id);let n=!!(t.type==="update"&&this._interpreters.get(t.env.id)?.resolved.isCondaEnvWithoutPython&&t.env.executable.uri);this.populateCachedListOfInterpreters(!0).finally(()=>{let i=this._interpreters.get(t.env.id);t.type==="remove"&&!i?(this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:t.env.id})):t.type==="update"&&i&&n&&!i.resolved.isCondaEnvWithoutPython&&(this.triggerEventIfAllowed("interpreterChangeEvent",i.resolved),this.triggerEventIfAllowed("interpretersChangeEvent",i.resolved))}).catch(f)},this,this.disposables))}).catch(f))}};zh=g([(0,Ss.injectable)(),d(0,(0,Ss.inject)(zt)),d(1,(0,Ss.inject)(ze)),d(2,(0,Ss.inject)(K)),d(3,(0,Ss.inject)(ct))],zh);var op=class{constructor(e,t,n,i){this.specFile=t;this.interpreterPath=n;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var ii=require("vscode"),mV=k(YA());var nV=k(Hh());var iV=require("vscode");var Foe={output_type:"stream",name:"stdout",text:""},Loe={output_type:"error",ename:"",evalue:"",traceback:[""]},Uoe={output_type:"display_data",data:{},metadata:{}},joe={output_type:"execute_result",execution_count:0,data:{},metadata:{}},Woe={stream:new Set(Object.keys(Foe)),error:new Set(Object.keys(Loe)),display_data:new Set(Object.keys(Uoe)),execute_result:new Set(Object.keys(joe))};function $i(r){return r&&$u(r).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function Voe(r){let e;switch(r.output_type){case"stream":case"error":case"execute_result":case"display_data":e=Woe[r.output_type];break;default:return r}let t={...r};for(let n of Object.keys(r))e.has(n)||delete t[n];return t}function oV(r){let e={...r,source:bc(r.source)};if(e.cell_type!=="code")delete e.outputs,delete e.execution_count;else if(e.cell_type){let t=e;t.outputs=t.outputs?t.outputs.map(Voe):[]}return e}function xs(r){return r=r.toLowerCase(),r.length===2&&r.endsWith("#")?`${r.substring(0,1)}sharp`:YU.get(r)||r}function _t(r){return typeof r=="string"?r===It||r===Et:r.notebookType===It||r.notebookType===Et}function co(r){let e=r.metadata?.custom;return JSON.parse(JSON.stringify(e?.metadata||{}))}function sV(r){let e=r.metadata?.custom;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}function Qh(r){return iV.workspace.notebookDocuments.find(e=>_t(e)&&e.getCells().some(t=>t.document===r))}function Cs(r){if(Array.isArray(r)){let e="";for(let t=0;t<r.length;t+=1){let n=r[t];t<r.length-1&&!n.endsWith(`
`)?e=e.concat(`${n}
`):e=e.concat(n)}return e}return r.toString()}function bc(r){if(Array.isArray(r))return r;let e=r.toString();if(e.length>0){let t=e.split(`
`);return t.map((n,i)=>i<t.length-1?`${n}
`:n).filter(n=>n.length>0)}return[]}function Boe(r){let e=r;do r=e,e=r.replace(/[^\n]\x08/gm,"");while(e.length<r.length);return r}function qoe(r){for(r=r.replace(/\r+\n/gm,`
`);r.search(/\r[^$]/g)>-1;){var e=r.match(/^(.*)\r+/m)[1],t=r.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),r=r.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return r}function aV(r){return qoe(Boe(r))}var BE="'''",qE='"""';function pm(r,e,t){let n,i,o=0;for(let s of r){let a=s.trim(),c=a.startsWith(BE)?BE:a.startsWith(qE)?qE:void 0,l=a.includes(BE)?BE:a.includes(qE)?qE:void 0;if(i)i===l&&(i=void 0),t(s,o);else if(n)n===c&&(n=void 0),n&&e(s,o);else if(l&&!c){let u=a.indexOf(l);i=a.lastIndexOf(l)!==u?void 0:l,t(s,o)}else if(c){let u=a.indexOf(c,3);n=u>=0?void 0:c,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function Ic(r,e=`
`,t){return r.map((n,i)=>{let o=t?t(n):n;return i===r.length-1?`${o}`:`${o}${e}`})}function Joe(r){let e=[];return pm(r,t=>e.push(t),t=>{}),e}function JE(r){return Ic(Joe(r.slice(r.length>1?1:0)))}function cV(r){let e=r.length,t=-1;return r.forEach((n,i)=>{n.trim()&&(e=i,t<0&&(t=i))}),t>=0?r.slice(t,e+1):[]}function $E(r){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(r);if(e&&e.length>2){let t=parseInt(e[1],10),n=parseInt(e[2],10),i=parseInt(e[3],10);return(0,nV.parse)(`${t}.${n}.${i}`,!0)??void 0}}var XA=class{constructor(e,t,n,i=!1){this._impl=e;this.controllerId=t;this._endCallback=n;this.clearOutputOnStartWithTime=i;this.started=!1}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this.started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(E(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(f,f)):E(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t),H(`End cell ${this.cell.index} execution after ${((t||0)-(this._startTime||0))/1e3}s, completed @ ${t}, started @ ${this._startTime}`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},Hi=class r{static{this._map=new WeakMap}static getOrCreate(e,t,n=!1){let i,o=e.document;if(i=this.get(e),!i)i=r.create(o,e,t,n);else if(i.controllerId!==t.id){let s=i;s.end(void 0),i=r.create(o,e,t,n),s.started&&i.start(new Date().getTime())}return i}static get(e){let t=e.document;return r._map.get(t)}static create(e,t,n,i=!1){let o=new XA(n.createNotebookCellExecution(t),n.id,()=>{r._map.delete(e)},i);return r._map.set(e,o),o}};function GE(r){let e;return r.kind===ii.NotebookCellKind.Markup?e=Goe(r):"document"in r&&r.document.languageId==="raw"||"languageId"in r&&r.languageId==="raw"?e=$oe(r):e=Hoe(r),e}function $oe(r){let e=r.metadata?.custom,t={cell_type:"raw",source:bc("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}function Hoe(r){let e=r.metadata?.custom,t="document"in r?r.document.getText():r.value;return{cell_type:"code",execution_count:r.executionSummary?.executionOrder??null,source:bc(t),outputs:(r.outputs||[]).map(QE),metadata:e?.metadata||{}}}function Goe(r){let e=r.metadata?.custom,t={cell_type:"markdown",source:bc("document"in r?r.document.getText():r.value),metadata:e?.metadata||{}};return e?.attachments&&(t.attachments=e.attachments),t}var lV=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function uV(r){if(r.mime.startsWith("application/vnd."))try{return Buffer.from(r.data).toString().length===0}catch{}return!1}function zoe(r){return r.sort((e,t)=>{let n=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=lV.findIndex(s=>n(s,e.mime)),o=lV.findIndex(s=>n(s,t.mime));return uV(e)&&(i=-1),uV(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var Al=class r{static{this.cellStates=new WeakMap}static getCellState(e){return r.cellStates.get(e)?.state}static getCellStatus(e){return(r.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let n=r.cellStates.get(e)?.start||new Be,i=r.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${n.elapsedTime}ms`}`),r.cellStates.set(e,{stateTransition:i,state:t,start:n})}};function gt(r,e){re(()=>`Cell Index:${r.index}, of document ${mn(r.notebook.uri)} with state:${Al.getCellStatus(r)}, exec: ${r.executionSummary?.executionOrder}. ${e}. called from ${p2()}`)}var Yh=new Map;Yh.set("display_data",zE);Yh.set("error",Zoe);Yh.set("execute_result",zE);Yh.set("stream",Qoe);Yh.set("update_display_data",zE);function ua(r){let e=Yh.get(r.output_type),t;return e?t=e(r):(j(`Unable to translate cell from ${r.output_type} to NotebookCellData for VS Code.`),t=zE(r)),t}function ZA(r){let e={outputType:r.output_type};switch(r.transient&&(e.transient=r.transient),r.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=r.execution_count,e.metadata=r.metadata?JSON.parse(JSON.stringify(r.metadata)):{};break}default:break}return e}function zE(r){let e=ZA(r);("image/svg+xml"in r.data||"image/png"in r.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(r.data)for(let n in r.data)t.push(Xoe(n,r.data[n]));return new ii.NotebookCellOutput(zoe(t),e)}function Qoe(r){let e=Cs(r.text),t=r.name==="stderr"?ii.NotebookCellOutputItem.stderr:ii.NotebookCellOutputItem.stdout;return new ii.NotebookCellOutput([t(e)],ZA(r))}function Yoe(r){if(r.items.length>0)return r.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function pV(r){let e=r.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=r.metadata?.originalError,n=JSON.parse(Buffer.from(e.data).toString("utf8"));return{output_type:"error",ename:n.name,evalue:n.message,traceback:t?.traceback||bc(n.stack||n.message||"")}}var dm=new TextDecoder,fV=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function HE(r,e){if(!e)return"";try{if(r==="application/vnd.code.notebook.error"){let t=dm.decode(e);return JSON.parse(t)}else if(r.startsWith("text/")||fV.includes(r)){let t=dm.decode(e);return bc(t)}else if(r.startsWith("image/")&&r!=="image/svg+xml"){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(e).toString("base64");{let t=dm.decode(e);return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,i){return String.fromCharCode(Number.parseInt("0x"+i))}))}}else if(r.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&r.toLowerCase().endsWith("+json")){let t=dm.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(r.toLowerCase().includes("json")){let t=dm.decode(e);return t.length>0?JSON.parse(t):t}else return dm.decode(e)}catch(t){return x(`Failed to convert ${r} output from a buffer ${typeof e}, ${e}`,t),""}}function Xoe(r,e){if(!e)return ii.NotebookCellOutputItem.text("",r);try{if((r.startsWith("text/")||fV.includes(r))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?Cs(e):e;return ii.NotebookCellOutputItem.text(t,r)}else if(r.startsWith("image/")&&typeof e=="string"&&r!=="image/svg+xml"){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return new ii.NotebookCellOutputItem(Buffer.from(e,"base64"),r);{let t=Uint8Array.from(atob(e),n=>n.charCodeAt(0));return new ii.NotebookCellOutputItem(t,r)}}else return typeof e=="object"&&e!==null&&!Array.isArray(e)?ii.NotebookCellOutputItem.text(JSON.stringify(e),r):(e=Array.isArray(e)?Cs(e):e,ii.NotebookCellOutputItem.text(e,r))}catch(t){return x(`Failed to convert ${r} output to a buffer ${typeof e}, ${e}`,t),ii.NotebookCellOutputItem.text("")}}function dV(r){let e=[];r.items.filter(n=>n.mime==="application/vnd.code.notebook.stderr"||n.mime==="application/vnd.code.notebook.stdout").map(n=>dm.decode(n.data)).forEach(n=>{let i=n.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let n=0;n<e.length-1;n++)e[n]=`${e[n]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:Yoe(r)||"stdout",text:e}}function QE(r){let e=r.metadata,t;switch(e?.outputType){case"error":{t=pV(r);break}case"stream":{t=dV(r);break}case"display_data":{t={output_type:"display_data",data:r.items.reduce((i,o)=>(i[o.mime]=HE(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:r.items.reduce((i,o)=>(i[o.mime]=HE(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:r.items.reduce((i,o)=>(i[o.mime]=HE(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=r.items.length===1&&r.items.every(c=>c.mime==="application/vnd.code.notebook.error"),o=r.items.every(c=>c.mime==="application/vnd.code.notebook.stderr"||c.mime==="application/vnd.code.notebook.stdout");if(i)return pV(r);let s=e?.outputType||(o?"stream":"display_data");A("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=dV(r):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),r.items.length>0&&(a.data=r.items.reduce((c,l)=>(c[l.mime]=HE(l.mime,l.data),c),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function Zoe(r){return r=r||{output_type:"error",ename:"",evalue:"",traceback:[]},new ii.NotebookCellOutput([ii.NotebookCellOutputItem.error({name:r?.ename||"",message:r?.evalue||"",stack:(r?.traceback||[]).join(`
`)})],{...ZA(r),originalError:r})}async function YE(r,e,t){let n=!1,i;if(!r)return{changed:n,kernelId:i};r?.language_info?.name||(r.language_info=r.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=xe;break;default:break}if(r.language_info.name!==o&&o&&(r.language_info.name=o,n=!0),t&&"language_info"in t&&t.language_info)(0,mV.default)(r.language_info,t.language_info)||(r.language_info=JSON.parse(JSON.stringify(t.language_info)),n=!0);else{let a=Kt(e),c=a?hV(e):void 0,l=c?.version?`${c.version.major}.${c.version.minor}.${c.version.patch}`:"";c&&c.version&&r&&r.language_info&&r.language_info.version!==l?(r.language_info.version=l,n=!0):!c&&r?.language_info&&a&&(r.language_info=void 0,n=!0)}let s=e&&Xh(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,c=a.display_name||e.interpreter.displayName||"",l="";switch(Mn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":l="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{l=(a.metadata?.vscode?.originalSpecFile?De(ut(a.metadata.vscode.originalSpecFile)):void 0)||a.name,c=a.metadata?.vscode?.originalDisplayName||c;break}default:l=a.name;break}r.kernelspec?.name!==l&&(n=!0,r.kernelspec={name:l,language:xe,display_name:c},"vscode"in r&&delete r.vscode,"interpreter"in r&&delete r.interpreter)}else if(s&&!r.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?De(ut(s.metadata.vscode.originalSpecFile)):void 0;r.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(r.kernelspec.language=s.language),i=s.id,n=!0}else if(s&&r.kernelspec){let c=(s.metadata?.vscode?.originalSpecFile?De(ut(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",l=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(r.kernelspec.name!==c||r.kernelspec.language!==u||r.kernelspec.display_name!==l||i!==s.id)&&(n=!0,r.kernelspec.name=c,r.kernelspec.display_name=l,r.kernelspec.language=u,i=s.id);try{delete r.kernelspec.metadata}catch{}}return{changed:n,kernelId:i}}async function sp(r,e,t,n){let i=Ah(t);if(!i){let s=Hi.get(r);n&&s?.started&&s.end(n?void 0:!1,r.executionSummary?.timing?.endTime);return}Hi.get(r)||(n=!0);let o=Hi.getOrCreate(r,e);o.started||(o.start(r.executionSummary?.timing?.endTime),o.executionOrder=r.executionSummary?.executionOrder),await o.appendOutput(i),o.end(n?void 0:!1,r.executionSummary?.timing?.endTime)}function XE(r){if(r.hasOwnProperty("text/html")){let e=r["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(r["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return r}function VS(r){let e=this,t=!1,n;return function(){return t||(t=!0,n=r.apply(e,arguments)),n}}var mm="{connection_file}";function vV(r){return r.argv.findIndex(e=>e.includes(mm))}var Zh="-jvsc-",ese=/^python\d*.?\d*$/;async function ws(r,e){return tse(await nN(r),r,e)}function tse(r,e,t){let n=e?{path:Ee(e.uri)}:{},i={name:r,language:"python",display_name:e?.displayName||"Python 3",metadata:{interpreter:n},argv:["python","-m","ipykernel_launcher","-f",mm],env:{},resources:{}},o=t&&i.name?sr(t,i.name,"kernel.json"):void 0;return new op(i,o?Ee(o):void 0,Ee(e?.uri),"registeredByNewVersionOfExt")}function yV(r){let e=JSON.parse(JSON.stringify(r));return e.env&&Object.keys(e.env).forEach(n=>{if(e.env){let i=e.env[n];i!=null&&(e.env[n]=i.toString())}}),e}function ZE(r){let e=r?.kernelspec;return r?.language_info?.name&&r.language_info.name!==xe?!1:e?.name?.includes(xe)?!0:e?.language===xe||r?.language_info?.name===xe}function eP(r){let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?De(ut(e)):r.name||"",n=r.metadata?.vscode?.originalDisplayName||r.display_name||"";return!!(t.toLowerCase().match(ese)||n.toLowerCase()==="python 3 (ipykernel)"||n.toLowerCase()==="python 3")}function rse(r){if(r.includes(Zh)){let e=/[a-f0-9]$/;if(r.substring(r.lastIndexOf(Zh)+Zh.length).search(e)!==-1){let t=r.substring(0,r.lastIndexOf(Zh));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return r}function tP(r){return r.kind!=="connectToLiveRemoteKernel"}function Xh(r){return r.kind==="connectToLiveRemoteKernel"}function ki(r,e,t){e=eN(r)?e:void 0;let n=r.name,i=Mn(r);if(i&&n.includes(BS)&&(n=n.substring(n.indexOf(BS)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let l=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile;l&&(n=`${n}#${De(ut(l))}`)}let o="";eN(r)?o=r.argv.slice(1).filter(l=>!["-f","{connection_file}"].includes(l)).join("#").toLowerCase():o=r.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Ee(gc(r.interpreterPath?ap.Uri.file(r.interpreterPath):ap.Uri.file(r.executable))),c=Ee(gc(e?.uri))||"";return`${s}${r.id||""}.${n}.${a}.${c}.${o}`}function pt(r){let e=nse(r);if(!r)return e;switch(r.kind){case"connectToLiveRemoteKernel":{let n=rse(r.kernelModel?.notebook?.path||r.kernelModel?.model?.path||"");return n?`${e} (${n})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(r.interpreter?.envType&&r.interpreter.envType!=="Unknown"){let n=jE(r.interpreter);if(r.kernelSpec.language===xe){let i=`Python ${tp(r.interpreter.version?.raw||"")||""}`.trim();return r.interpreter.envName?`${e} (${i})`:e}else return n?`${e} (${n})`:e}else return e;case"startUsingPythonInterpreter":let t=(tp(r.interpreter.version?.raw||"")||"").trim();if(r.interpreter.envType&&r.interpreter.envType!=="Unknown"){if(r.kernelSpec.display_name&&Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return r.kernelSpec.display_name;let n=r.interpreter.envType==="Conda"&&r.interpreter.isCondaEnvWithoutPython===!0,i=t.trim()?`Python ${t}`:"Python",o=jE(r.interpreter);return n&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function nse(r){if(!r)return"";let e=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.display_name:r.kernelSpec?.display_name,t=r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name,n=r.kind==="startUsingPythonInterpreter"?r.interpreter.displayName:void 0;return[e,t,n,""].find(i=>typeof i=="string"&&i.length>0)||""}function eg(r,e=""){return r?r.kind==="connectToLiveRemoteKernel"?r.kernelModel.name:r.kernelSpec?.name:e}function ise(r){if(!r)return;let e=Xh(r)?r.kernelModel:void 0,t=tP(r)?r.kernelSpec:void 0;if(r.kind==="startUsingPythonInterpreter"||(r.kind==="startUsingRemoteKernelSpec"||r.kind==="startUsingLocalKernelSpec")&&r.kernelSpec.language===xe){let n=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;return n==="/python"||n==="python"?r.interpreter?.displayPath:n?ap.Uri.file(n):void 0}else{let n=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return n?ap.Uri.file(n):void 0}}function tN(r,e=""){if(r?.kind==="connectToLiveRemoteKernel"){let t;if(typeof r.kernelModel.lastActivityTime=="string")try{t=new Date(r.kernelModel.lastActivityTime)}catch(n){E(`Error parsing date ${n}`)}else t=r.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,r.kernelModel.numberOfConnections)}return e}function rN(r,e){if(r?.kind==="connectToLiveRemoteKernel")return;let t=ise(r),n=ap.workspace.workspaceFolders?ap.workspace.workspaceFolders:[];return t?V(t,n,e.homeDir):""}function hV(r){if(!r)return;if(r.interpreter)return r.interpreter;let e=Xh(r)?r.kernelModel:void 0;if(e?.metadata?.interpreter)return WS(e?.metadata?.interpreter,"");let t=tP(r)?r.kernelSpec:void 0;return WS(t?.metadata?.interpreter,"")}function tg(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"&&r.kernelSpec&&Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function Kt(r){if(!r)return!1;if(r.kind==="startUsingPythonInterpreter")return!0;let e=Xh(r)?r.kernelModel:void 0,t=tP(r)?r.kernelSpec:void 0;return e?.language===xe||eN(t)}function eN(r){return(r?.language||"").toLowerCase()===xe}function Di(r){if(!r)return;if(r.kind==="startUsingPythonInterpreter")return xe;let e=Xh(r)?r.kernelModel:void 0,t=tP(r)?r.kernelSpec:void 0;return e?.language||bV(t)}function rP(r){if(!r)return;let e=r.kernelspec;return bV(e)||r.language_info?.name}function bV(r){return r?.language}var BS="jvsc74a57bd0";async function nN(r){let t=(r?.sysVersion?tp(r.sysVersion)||"3":"").replace(/\./g,""),n=r?`python${t}`:"";return r?`${n}${BS}${await vc(r)}`:"python3"}function Mn(r){if(r.isRegisteredByVSC)return r.isRegisteredByVSC;if(!r.name)return;let e=r.metadata?.vscode?.originalSpecFile||r.metadata?.originalSpecFile,t=e?De(ut(e)):r.name,n=eP({...r,name:t})?Object.keys(r.env||{}).length>0:typeof e=="string"&&!e.includes(BS);if(r.name.includes(BS))return n?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(r.metadata?.interpreter&&r.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function IV(r,e){return!r&&!e?!0:!r&&e||r&&!e?!1:r?.id===e?.id}function nP(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"){let e=new gV.default(r.baseUrl);return e.hostname.toLocaleLowerCase()==="localhost"||e.hostname==="127.0.0.1"}return!1}async function hn(r,e,t){E(`Executing silently Code (${r.status}) = ${Ke(e.substring(0,100)).join("\\n")}`);let n=require("@jupyterlab/services"),i=r.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(n.KernelMessage.isStreamMsg(a))if(re(`Got io pub message (stream), ${Ke(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let c=o[o.length-1];c.text+=a.content.text}else{let c={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(c)}else if(n.KernelMessage.isExecuteResultMsg(a)){re("Got io pub message (execresult)}");let c={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(c)}else if(n.KernelMessage.isDisplayDataMsg(a)){re("Got io pub message (displaydata)}");let c={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(c)}else if(n.KernelMessage.isErrorMsg(a)){if(re(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let l=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;x(`${l} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let c={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(c)}else re(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Ke(e.substring(0,100)).join("\\n");return t&&ose(o,t,s),E(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function SV(r,e,t,n){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=r.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=VS(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?n(ua({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?n(ua({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?n(ua({output_type:"display_data",data:XE(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?n(ua({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||j(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function ose(r,e,t){r.filter(n=>n.output_type==="error").forEach(n=>{let i=n,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?x(s):j(s),e.telemetryName&&A(e.telemetryName)})}var wV=k(xV());var oN;(w=>{function r(D){return D&&typeof D=="object"&&typeof D[Symbol.iterator]=="function"}w.is=r;let e=Object.freeze([]);function t(){return e}w.empty=t;function*n(D){yield D}w.single=n;function i(D){return r(D)?D:n(D)}w.wrap=i;function o(D){return D||e}w.from=o;function s(D){return!D||D[Symbol.iterator]().next().done===!0}w.isEmpty=s;function a(D){return D[Symbol.iterator]().next().value}w.first=a;function c(D,T){for(let F of D)if(T(F))return!0;return!1}w.some=c;function l(D,T){for(let F of D)if(T(F))return F}w.find=l;function*u(D,T){for(let F of D)T(F)&&(yield F)}w.filter=u;function*p(D,T){let F=0;for(let ee of D)yield T(ee,F++)}w.map=p;function*m(...D){for(let T of D)for(let F of T)yield F}w.concat=m;function h(D,T,F){let ee=F;for(let de of D)ee=T(ee,de);return ee}w.reduce=h;function*v(D,T,F=D.length){for(T<0&&(T+=D.length),F<0?F+=D.length:F>D.length&&(F=D.length);T<F;T++)yield D[T]}w.slice=v;function b(D,T=Number.POSITIVE_INFINITY){let F=[];if(T===0)return[F,D];let ee=D[Symbol.iterator]();for(let de=0;de<T;de++){let Z=ee.next();if(Z.done)return[F,w.empty()];F.push(Z.value)}return[F,{[Symbol.iterator](){return ee}}]}w.consume=b})(oN||={});var EV;function PV(r){EV=r}function oP(r){return EV?.push(r),r}function Q(r){if(oN.is(r)){for(let e of r)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}var Ko=class r{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),oP(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Q(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},er=class{constructor(...e){this._store=new Ko;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),oP(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},iP=class extends er{constructor(){super();this._onDidDispose=new wV.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var CV=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{Q(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var cp=class r{constructor(e){this.serverSettings=e;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get isDisposed(){return this.disposed===!0}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(e){return new r(e)}async dispose(){if(!this.disposed){this.disposed=!0,E("Disposing Jupyter Lab Helper");try{this.contentsManager&&(E("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(E("ShutdownSessionAndConnection - dispose session manager"),await _r(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(e){x("Exception on Jupyter Lab Helper shutdown: ",e)}finally{E("Finished disposing Jupyter Lab Helper")}}}async getRunningSessions(){if(!this.sessionManager)return[];await _r(1e4,this.sessionManager.ready).catch(f),await this.sessionManager.refreshRunning();let e=[],t=this.sessionManager.running(),n=t.next();for(;n;)e.push(n),n=t.next();return e}async getRunningKernels(){let e=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),t=new Set;return e.map(n=>{let i=n;return{id:n.id,name:n.name,lastActivityTime:i.last_activity?new Date(Date.parse(i.last_activity.toString())):new Date,numberOfConnections:i.connections?parseInt(i.connections.toString(),10):0}}).filter(n=>t.has(n.id)?!1:(t.add(n.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new fn;try{let e=new Be,t=this.kernelSpecManager;if(!t)return x(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await ws()];let n={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:t.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,waitedForChangeEvent:!1},i=(c={})=>t.specs&&Object.keys(t.specs.kernelspecs).length?t.specs.kernelspecs:c,o=i();await _r(1e4,this.sessionManager.ready),n.sessionManagerReady=this.sessionManager.isReady,await _r(1e4,t.refreshSpecs()),n.specsManagerReady=t.isReady;let s=!1;if(t&&Object.keys(t.specs?.kernelspecs||{}).length===0){let c=[],l=ce(),u=l.resolve.bind(l);t.specsChanged.connect(u),c.push(new kV.Disposable(()=>t.specsChanged.disconnect(u)));let p=Promise.all([l.promise,t.ready,t.refreshSpecs(),this.sessionManager.ready]);await _r(1e4,p),n.waitedForChangeEvent=!0,l.completed||(s=!0,A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:t.isReady,reason:t.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),Q(c)}let a=i(o);if(Object.keys(a||{}).length){let c=[];return Object.entries(a).forEach(([l,u])=>{u&&c.push(new op(u))}),A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:e.elapsedTime},n),c}else return x(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(a)}.`),s||A("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await ws()]}catch(e){return x("Jupyter Lab Helper:getKernelSpecs failure: ",e),[]}}};var In=class{constructor(e,t,n,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=n;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let n={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return OS(e,n,this.requestCreator,this.requestAgentCreator,this.configService,qS.Uri.file(""))}async validateRemoteUri(e,t,n){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=OS(e,t,this.requestCreator,this.requestAgentCreator,this.configService,qS.Uri.file(""));try{i=cp.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(No.isSelfCertsError(s)){if(!await EE(this.configService,s.message))throw s}else if(uc.isSelfCertsExpiredError(s)){if(!await PE(this.configService,s.message))throw s}else throw t&&!n&&await this.errorHandler.handleError(new Pi(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose().catch(f)}}async getJupyterServerUri(e){let t=new qS.CancellationTokenSource;try{let n=this.jupyterPickerRegistration.jupyterCollections.find(c=>c.extensionId===e.extensionId&&c.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!n)return;let o=(await Promise.resolve(n.serverProvider.provideJupyterServers(t.token)))?.find(c=>c.id===e.handle);if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(n.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(n){throw n instanceof Xe?n:new Zu(e,n)}finally{t.dispose()}}};In=g([(0,xc.injectable)(),d(0,(0,xc.inject)(Gt)),d(1,(0,xc.inject)(ae)),d(2,(0,xc.inject)(Yr)),d(3,(0,xc.inject)(Xu)),d(3,(0,xc.optional)()),d(4,(0,xc.inject)(_l))],In);var pa=class{constructor(e,t,n){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=n}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=Va.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){x(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};pa=g([(0,rg.injectable)(),d(0,(0,rg.inject)(Zt)),d(1,(0,rg.inject)(In)),d(2,(0,rg.inject)(Gt))],pa);var DV=" (Interactive)",St=Symbol("IControllerRegistration");var sP=Symbol("IRemoteNotebookKernelSourceSelector"),aP=Symbol("ILocalNotebookKernelSourceSelector"),fm=Symbol("ILocalPythonNotebookKernelSourceSelector"),lp=Symbol("IConnectionDisplayData");async function cP(r){if(!Uu()&&r.interpreter?.uri){let e=r.interpreter.uri.fsPath,t=gc(r.interpreter.uri).fsPath,n=r.id.replace(e,t);return ht(n)}return ht(r.id)}var Es=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=WS(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return up.create(t);case"connectToLiveRemoteKernel":return JS.create(t);case"startUsingRemoteKernelSpec":return $S.create(t);case"startUsingPythonInterpreter":return Fo.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},JS=class r{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,uP(this)}static create(e){return new r(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return cP(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:Rl(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Es.fromJSON(e)}},up=class r{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,uP(this)}static create(e){return new r(e)}getHashId(){return cP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Rl(this.interpreter),kind:this.kind}}static fromJSON(e){return Es.fromJSON(e)}},$S=class r{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,uP(this)}static create(e){return new r(e)}getHashId(){return cP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Rl(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Es.fromJSON(e)}},Fo=class r{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,uP(this)}static create(e){return new r(e)}getHashId(){return cP(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:Rl(this.interpreter),kind:this.kind}}updateInterpreter(e){e.sysPrefix||re(`WARNING: Interpreter ${e.id} has no sysPrefix and existing item ${this.interpreter.sysPrefix} will be blown away, ${new Error().stack}`),Object.assign(this.interpreter,e)}static fromJSON(e){return Es.fromJSON(e)}};function dt(r){return r.kind==="startUsingLocalKernelSpec"||r.kind==="startUsingPythonInterpreter"}function Ut(r){return!dt(r)}var Fe=Symbol("IKernelProvider"),hm=Symbol("IThirdPartyKernelProvider");var lP=Symbol("IJupyterServerConnector"),HS=Symbol("IKernelSessionFactory");var Ps=Symbol("IKernelDependencyService"),Tr=Symbol("IKernelFinder"),ng=Symbol("ITracebackFormatter");var da=Symbol("IStartupCodeProviders"),_V=new Set;function uP(r){if(_V.has(r.id))return;_V.add(r.id);let e="kernelSpec"in r?r.kernelSpec:void 0,t=e?.language||(r.kind==="startUsingPythonInterpreter"?xe:void 0),n="",i="",o="interpreter"in r?r.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(n=e.argv[0],a=n.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),De(n)!==n&&(n=`<P>${De(n)}`),i=e.argv.map(h=>h.includes("/")||h.includes("\\")?`<P>${De(h)}`:h).join(s));let c="kernelSpec"in r&&r.kernelSpec.specFile?ht(r.kernelSpec.specFile):Promise.resolve(""),l=ht(r.id),u=Ut(r)?ht(Wt(r.serverProviderHandle)):Promise.resolve(""),p=Ut(r)?r.serverProviderHandle.extensionId:Pt,m=Ut(r)?ht(r.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([c,l,u,m]).then(([h,v,b,w])=>A("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:v,serverIdHash:b,kernelSpecHash:h,baseUrlHash:w,providerExtensionId:p,kernelConnectionType:r.kind,kernelLanguage:t,envType:o?.envType,isArgv0SameAsInterpreter:a,argv0:n,argv:i})).catch(f)}var FV=require("vscode");var TV=require("events"),GS=k(M());try{(0,GS.decorate)((0,GS.injectable)(),TV.EventEmitter)}catch(r){j("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",r)}var _e=class{constructor(e){this.container=e;_e._instance=this}static get instance(){return _e._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};_e=g([(0,GS.injectable)()],_e);var kn=require("vscode");function gm(r){return(e,t=null,n)=>{let i=!1,o;return o=r(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,n),i&&o.dispose(),o}}function sN(r,e=null,t){return new Promise(n=>gm(r)(n,e,t))}var cN=class{constructor(e,t){let n=kn.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=kn.workspace.notebookDocuments.find(i=>i.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=pt(t.kernelConnectionMetadata),this.title=kn.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,n),this.eventHandler=kn.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}dispose(){this.eventHandler.dispose(),this.disposable?.dispose()}show(){if(this.deferred&&!this.deferred.completed){let e=this.deferred;return this.deferred=ce(),e.resolve(),this.disposable=new kn.Disposable(()=>this.deferred?.resolve())}return this.deferred=ce(),this.showProgress().catch(f),this.disposable=new kn.Disposable(()=>this.deferred?.resolve())}async showProgress(){await ji(500),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){!this.notebook||!this.shouldDisplayProgress||kn.window.visibleNotebookEditors.some(e=>e.notebook===this.notebook)&&(this.displayInProgress=!0,await kn.window.withProgress({location:kn.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1)}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}},lN=class r extends er{constructor(t,n,i,o){super();this.extensionId=t;this.kernel=n;this.execution=i;this.kernelAccess=o;this._onDidChangeStatus=this._register(new kn.EventEmitter);this.progress=this._register(new cN(t,n)),this._register(gm(n.onDisposed)(()=>this.progress.dispose())),this.language=n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?xe:n.kernelConnectionMetadata.kernelSpec.language||xe,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status),this));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus,executeCode:(a,c)=>this.executeCode(a,c)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}static createApiKernel(t,n,i,o){let s=new r(t,n,i,o);return _e.instance.get(K).push(s),s._api}async*executeCode(t,n){if(!this.kernelAccess.accessAllowed)throw new Error(kn.l10n.t("Access to Jupyter Kernel has been revoked"));this.previousProgress?.dispose();let i=!1,o={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},s={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},a=new Be,c=new Set;if(cse(this.extensionId,this.kernel,"executeCode",o.executionCount).catch(f),this.kernel.disposed)throw s.failed=!0,aN(this.kernel,o,s).catch(f),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw s.failed=!0,aN(this.kernel,o,s).catch(f),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let l=[];l.push({dispose:()=>{o.duration=a.elapsedTime,s.mimeTypes=Array.from(c).join(","),i=!0,aN(this.kernel,o,s).catch(f)}});let u=_e.instance.get(Fe).getKernelExecution(this.kernel),p={started:new kn.EventEmitter,executionAcknowledged:new kn.EventEmitter};p.started.event(()=>{if(s.requestSent=!0,o.requestSentAfter=a.elapsedTime,!n.isCancellationRequested){let m=this.previousProgress=this.progress.show();l.push(m)}},this,l),p.executionAcknowledged.event(()=>{s.requestAcknowledged=!0,o.requestAcknowledgedAfter=a.elapsedTime},this,l),n.onCancellationRequested(()=>{i||(s.cancelled=!0,o.cancelledAfter=a.elapsedTime,s.cancelledBeforeRequestSent=!s.requestSent,s.cancelledBeforeRequestAcknowledged=!s.requestAcknowledged,E(`Code execution cancelled by extension ${this.extensionId}`))},this,l);try{for await(let m of u.executeCode(t,this.extensionId,p,n))m.items.forEach(h=>c.add(h.mime)),yield m}finally{Q(l)}}};async function cse(r,e,t,n){let i=await ht(e.id);A("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:n},{kernelId:i,pemUsed:t,extensionId:r})}async function aN(r,e,t){t.kernelId=await ht(r.id),A("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function RV(r,e,t){let n=_e.instance.get(Fe);return lN.createApiKernel(r,e,n.getKernelExecution(e),t)}var On=require("vscode");var ig=new Map,AV=new Set;async function NV(r){if(!On.workspace.isTrusted)return{accessAllowed:!1};if(r===Pt)return{accessAllowed:!0};let e=ig.get(r);return e||(e=lse(r),ig.set(r,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&ig.get(r)===e&&(ig.delete(r),AV.add(r))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function lse(r){let e=await uN();if(e.get(r)===!0)return{result:"allowed"};if(e.get(r)===!1)return{result:"denied"};let t=On.extensions.getExtension(r)?.packageJSON?.displayName;if(!t)return x(`Kernel API access revoked, as extension ${r} does not exist!`),{result:"denied"};let n=On.l10n.t("Allow"),i=On.l10n.t("Deny"),o=await On.window.showInformationMessage(On.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,r),{modal:!0,detail:On.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},n,ge.learnMore,i);switch(o===ge.learnMore?On.env.openExternal(On.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(f,f):(o===n||o===i)&&await use(r,o===n),o){case n:return{result:"allowed"};case ge.learnMore:return{result:"learnMore"};case i:return{result:"denied"};default:return{result:"cancelled"}}}async function MV(){let r=new Set,[e]=await Promise.all([uN().then(t=>new Map(t)),...Array.from(ig.entries()).map(async([t,n])=>{(await n).result!=="allowed"&&r.add(t)})]);return r.forEach(t=>e.set(t,!1)),AV.forEach(t=>e.set(t,e.get(t)===!0)),e}var pP="API.Access",pp;async function uN(r=!1){let e=_e.instance.get(ct);if(e.extensionMode===On.ExtensionMode.Test)return new Map;if(VS(()=>{_e.instance.get(K).push(e.secrets.onDidChange(i=>{i.key===pP&&(pp=void 0)}))})(),pp&&!r)return pp;let t="";try{return t=await e.secrets.get(pP),!t||t.length===0?new Map:(pp=new Map(Object.entries(JSON.parse(t))),pp)}catch(n){return x(`Failed to parse API access information ${t}`,n),new Map}}var dP=Promise.resolve();async function OV(r){return dP=dP.then(async()=>{await Promise.all(Array.from(ig.entries()).map(async([t,n])=>{let i=await n;i.result=r.includes(t)===!0?"allowed":"denied"})),pp=new Map(r.map(t=>[t,!0]));let e=_e.instance.get(ct);if(e.extensionMode!==On.ExtensionMode.Test)try{await e.secrets.store(pP,JSON.stringify(Object.fromEntries(pp)))}catch(t){x(`Failed to update API access information ${JSON.stringify(Object.fromEntries(pp))}`,t)}})}async function use(r,e){return dP=dP.then(async()=>{let t=_e.instance.get(ct);if(t.extensionMode===On.ExtensionMode.Test)return;let n=await uN(!0);if(e!==n.get(r)){n.set(r,e);try{await t.secrets.store(pP,JSON.stringify(Object.fromEntries(n)))}catch(i){x(`Failed to store API access information ${JSON.stringify(Object.fromEntries(n))}`,i)}}})}var KV=new WeakMap;function LV(r){return{async getKernel(e){let t,n=_e.instance.get(Fe),i=FV.workspace.notebookDocuments.find(l=>l.uri.toString()===e.toString()),o=n.get(i||e);if(!o||!o.startedAtLeastOnce){A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let s=n.getKernelExecution(o);if(!Ut(o.kernelConnectionMetadata)&&s.executionCount===0){A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t});return}let a=await NV(r);if(t=a.accessAllowed,A("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:r,pemUsed:"getKernel",accessAllowed:t}),!t)return;let c=KV.get(o)||RV(r,o,a);return KV.set(o,c),c}}}var UV=k(M()),Cc=require("vscode");var dp=require("vscode");function dr(r,e=!1){return typeof r!="object"||!r?!1:!!(r instanceof dp.CancellationError||e&&(r.message.includes("Canceled")||r.message.includes(ge.canceled)))}async function mr(r,e,...t){let n;return vw(e)?(t.push(e),n=void 0):n=e,r?r.isCancellationRequested?n:new Promise((i,o)=>{if(r.isCancellationRequested)return i(n);let s=r.onCancellationRequested(()=>{s.dispose(),i(n)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function ar(r,...e){if(!r)return Promise.race(e);if(r.isCancellationRequested)throw new dp.CancellationError;return new Promise((t,n)=>{if(r.isCancellationRequested)return n(new dp.CancellationError);let i=r.onCancellationRequested(()=>{i.dispose(),n(new dp.CancellationError)});Promise.race(e).then(t,n).finally(()=>i.dispose())})}function mP(...r){let e=new dp.CancellationTokenSource,t=[];for(let i of r)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let n=e.dispose.bind(e);return e.dispose=()=>{n(),Q(t)},e}var gn;(e=>{function r(t){if(t?.isCancellationRequested)throw new dp.CancellationError}e.throwIfCanceled=r})(gn||={});function jV(r){let e=new Map,t=(a,c)=>{if(!e.has(a)){let l={id:a,label:c.displayName,connectionInformation:{baseUrl:Cc.Uri.parse(c.baseUrl),token:c.token,fetch:c.fetch,headers:c.authorizationHeader,WebSocket:c.WebSocket}};e.set(a,{serverUri:c,server:l})}return e.get(a).server},n=new Cc.EventEmitter,i={async provideJupyterServers(a){let c=r.getHandles?await ar(a,r.getHandles()):[];return!c||c.length===0?[]:ar(a,Promise.all(c.map(l=>r.getServerUri(l).then(u=>t(l,u)))))},resolveJupyterServer(a,c){return a},onDidChangeServers:n.event};if(!r.handleQuickPick||!r.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,c){let l=o.get(a.label);if(!l||!r.handleQuickPick)return;let u=await ar(c,r.handleQuickPick(l,!0));if(u==="back")return;if(!u)throw new Cc.CancellationError;let p=await r.getServerUri(u);return t(u,p)},async provideCommands(a,c){return r.getQuickPickEntryItems?(await ar(c,Promise.resolve(r.getQuickPickEntryItems()))).map(u=>{let p={label:ph(u.label),canBeAutoSelected:u.default,description:ph(u.description)};return o.set(p.label,u),p}):[]}}}}var pN=class extends iP{constructor(t,n,i,o){super();this.extensionId=t;this.id=n;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Cc.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},og=class extends er{constructor(){super();this._onDidChangeCollections=new Cc.EventEmitter;this._collections=new Map;_e.instance.get(K).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,n){return await this.loadExtension(t,n).catch(f),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===n)}async loadExtension(t,n){if(t===Pt)return;let i=Cc.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${n}' not found`);i.isActive||await i.activate().then(f,f)}createJupyterServerCollection(t,n,i,o){let s=`${t}#${n}`;if(this._collections.has(s)&&t!==Pt)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new pN(t,n,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};og=g([(0,UV.injectable)()],og);var dN=Symbol("IExportedKernelServiceFactory");function pse(r,e){return new Promise(t=>{e.onDidChange(n=>{for(let i of n.added)Ut(i.connection)&&i.connection.serverProviderHandle.id===r.id&&i.connection.serverProviderHandle.handle===r.handle&&t()})})}function WV(r,e,t,n){let i=!1,o=t.get(sm),s=(c,l,u,p)=>{A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:p,pemUsed:"createJupyterServerCollection"});let h=t.get(Gt).createJupyterServerCollection(p,c,ph(l),u);return{dispose:()=>{h?.dispose()},get id(){return c},set label(b){h.label=ph(b)},get label(){return h.label},set documentation(b){h.documentation=b},get documentation(){return h.documentation},set commandProvider(b){h.commandProvider=b},get commandProvider(){return h.commandProvider}}},a={ready:r.catch(c=>(x("Failure during activation.",c),Promise.reject(c))),registerPythonApi:c=>{if(i)return;i=!0,t.get(zt).setApi(c)},registerRemoteServerProvider(c){let l=t.get(sm),u=c.id.startsWith("_builtin")?Pt:l.determineExtensionFromCallStack().extensionId;if(x(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${u}).`),u.toLowerCase()!=Va.toLowerCase())throw new Error("Deprecated API");A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:u,pemUsed:"registerRemoteServerProvider"});let{serverProvider:p,commandProvider:m}=jV(c),h=s(c.id,c.displayName||c.detail||c.id,p,u);return m&&(h.commandProvider=m),{dispose:()=>{h.dispose()}}},getKernelService:async()=>(A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:o.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),t.get(dN).getService()),addRemoteJupyterServer:async(c,l)=>{x("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let u=o.determineExtensionFromCallStack().extensionId;if(u.toLowerCase()!=Va.toLowerCase())throw new Error("Deprecated API");A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:u,pemUsed:"addRemoteJupyterServer"});let p=t.get(pa),m=t.get(St),h=pse({id:c,handle:l},m);await p.addJupyterServer({id:c,handle:l,extensionId:u}),await h},openNotebook:async(c,l)=>{A("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:o.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let u=t.get(St),p=typeof l=="string"?l:void 0,m=typeof l=="string"?void 0:l,h=p&&u.all.find(b=>b.id===l)?.id;if(!h&&m&&!Uu()&&(h=u.all.find(b=>b.kind==="startUsingPythonInterpreter"&&b.interpreter.id===m.id)?.id,!h)){let w=await t.get(fm).getKernelConnection(m);h=w&&u.all.find(D=>D.id===w?.id)?.id}if(!h)throw new Error(`Kernel ${l} not found.`);let v=ma.window.activeNotebookEditor?.notebook?.uri?.toString()===c.toString()?ma.window.activeNotebookEditor:await ma.window.showNotebookDocument(await ma.workspace.openNotebookDocument(c));return await ma.commands.executeCommand("notebook.selectKernel",{notebookEditor:v,id:h,extension:Pt}),v.notebook},createJupyterServerCollection:(c,l,u)=>s(c,l,u,o.determineExtensionFromCallStack().extensionId),get kernels(){return LV(o.determineExtensionFromCallStack().extensionId)}};return(Dr()||n.extensionMode===ma.ExtensionMode.Development||n.extensionMode===ma.ExtensionMode.Test)&&(a.serviceContainer=t,a.serviceManager=e),a}var VV=Symbol("IServiceManager"),lt=Symbol("IServiceContainer");var BV=require("vscode");async function qV(r,e,t){if(!Dr())try{await r,e.totalActivateTime=t.elapsedTime,await $V(e),A("EXTENSION.LOAD",e)}catch(n){x("sendStartupTelemetry() failed.",n)}}async function JV(r,e){try{let t={};try{await $V(e)}catch(n){x("getActivationTelemetryProps() failed.",n)}A("EXTENSION.LOAD",e,t,r)}catch(t){x("sendErrorTelemetry() failed.",t)}}async function $V(r){let e=BV.workspace.workspaceFolders?.length??0;r.workspaceFolderCount=e}var fP=Symbol("IExtensionActivationManager"),Ie=Symbol("IExtensionSyncActivationService");var Nl=k(M());var wc=Symbol("IEnvironmentVariablesService"),Ec=Symbol("ICustomEnvironmentVariablesProvider");var Qe=Symbol("IInterpreterService");var vP=k(M()),Pc=require("vscode");var dse={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function gP(r){return dse[r]}var ft=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),ft.instance=this}activate(){}dispose(){Q(Array.from(ft.disposables))}static createProgressReporter(e,t,n){if(!ft.instance)return new Pc.Disposable(f);let i=e?dn(e):"";return ft.instance.kernelResourceProgressReporter.has(i)?ft.reportProgress(e,t):ft.createProgressReporterInternal(i,t,n)}static wrapAndReportProgress(e,t,n){let i=e?dn(e):"";if(!ft.instance)return n();let o=ft.reportProgressInternal(i,t);return n().finally(()=>o?.dispose())}static reportProgress(e,t){let n=gP(t)||t,i=e?dn(e):"";return n?ft.reportProgressInternal(i,n||""):new Pc.Disposable(()=>f)}static reportProgressInternal(e,t){if(!ft.instance)return new Pc.Disposable(f);let n=ft.instance.kernelResourceProgressReporter.get(e);if(n||(n={title:t,pendingProgress:[],progressList:[],dispose:f},ft.instance.kernelResourceProgressReporter.set(e,n)),n.reporter)n.progressList.push(t),n.reporter.report({message:t});else{if(n.progressList.includes(t))return new Pc.Disposable(f);n.pendingProgress.push(t)}return{dispose:()=>{try{if(!n)return;let i=n.progressList.findIndex(o=>o===t);if(i>=0&&n.progressList.splice(i),n.progressList.length>0){let o=n.progressList[n.progressList.length-1];n.reporter&&n.reporter.report({message:o===n.title&&n.reporter?"":o})}else ft.instance.kernelResourceProgressReporter.delete(e),n.dispose()}catch(i){x(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,n){let i=ce(),o=new Pc.Disposable(()=>i.resolve()),s=ft.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,c=()=>{a||(a=!0,Pc.window.withProgress({location:Pc.ProgressLocation.Notification,title:t},async(l,u)=>{let p=ft.instance.kernelResourceProgressReporter.get(e);if(p){for(p.reporter=l;p.pendingProgress.length>0;){let m=p.pendingProgress.shift();m===t?p.progressList.push(m):m!==t&&m&&(p.progressList.push(m),l.report({message:m}))}await mr(u,i.promise),ft.instance.kernelResourceProgressReporter.get(e)===p&&ft.instance.kernelResourceProgressReporter.delete(e),ft.disposables.delete(o)}}).then(f,f))};return ft.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:c}),ft.disposables.add(o),s.pendingProgress.push(t),n||c(),{dispose:()=>o.dispose(),show:c}}};ft.disposables=new Set,ft=g([(0,vP.injectable)(),d(0,(0,vP.inject)(K))],ft);var sg=k(M()),yP=require("vscode");var Cr=Symbol("IPlatformService"),st=Symbol("IFileSystem");var Fke=Symbol("IBufferDecoder"),_i=Symbol("IProcessServiceFactory"),zS=class extends Xe{constructor(e){super("unknown",e)}};var mN=class{constructor(e,t){this.uri=e;this.value=t}};function mse(r){return Array.isArray(r)}var fse,lo=class r{constructor(e,t){this[fse]="ResourceMap";if(e instanceof r)this.map=new Map(e.map),this.toKey=t??r.defaultToKey;else if(mse(e)){this.map=new Map,this.toKey=t??r.defaultToKey;for(let[n,i]of e)this.set(n,i)}else this.map=new Map,this.toKey=e??r.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new mN(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,n]of this.map)e(n.value,n.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(fse=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},hse,kc=class{constructor(e,t){this[hse]="ResourceSet";!e||typeof e=="function"?this._map=new lo(e):(this._map=new lo(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((n,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(hse=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var gse,HV=class{constructor(){this[gse]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let n=this._map.get(e);if(n)return t!==0&&this.touch(n,t),n.value}set(e,t,n=0){let i=this._map.get(e);if(i)i.value=t,n!==0&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}[(gse=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};var Dc=class{constructor(e,t,n){this.processFactory=e;this.platform=t;this.fs=n;this.userSitePaths=new lo}async getExecutablesPath(e){let t=e.executable.uri;if(!(Jr(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let n=this.getUserSitePathImpl(t);n.catch(()=>{this.userSitePaths.get(t)===n&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,n)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),n="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${n}");print(site.${i});print("${n}");`]);if(o.includes(n)){let s=o.substring(o.indexOf(n)+n.length,o.lastIndexOf(n)).trim(),a=yP.Uri.file(s),c;if(this.platform.isWindows?c=yP.Uri.joinPath(Si(a),"Scripts"):c=yP.Uri.joinPath(a,"bin"),!c||!this.fs.exists(c))throw new Error(`USER_SITE ${c.fsPath} dir does not exist for the interpreter ${V(e)}`);return E(`USER_SITE for ${V(e)} is ${c.fsPath}`),c}else throw new Error(`USER_SITE not found for the interpreter ${V(e)}. Stdout: ${o}`)}};g([Nr()],Dc.prototype,"getExecutablesPath",1),Dc=g([(0,sg.injectable)(),d(0,(0,sg.inject)(_i)),d(1,(0,sg.inject)(Cr)),d(2,(0,sg.inject)(st))],Dc);var fN=require("vscode");var GV=6e4,mp=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=n;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,n){let i=this.interpreterService.known.find(s=>s.id===t.id)||await this.interpreterService.resolveEnvironment(t.id);if(!i)return;let o=y.activatingPythonEnvironment(np(i));return ft.wrapAndReportProgress(e,o,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,await this.interpreterService.resolveEnvironment(i)||i,n))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,n){let i=`${e?.toString()||""}${t.id}`,o=this.activatedEnvVariablesCache.get(i);if(o&&o.time.elapsedTime>=GV&&this.activatedEnvVariablesCache.delete(i),!this.activatedEnvVariablesCache.has(i)){let a=this.getActivatedEnvironmentVariablesImpl(e,t,n);a.catch(f),this.activatedEnvVariablesCache.set(i,{promise:a,time:new Be})}let s=this.activatedEnvVariablesCache.get(i).promise;return n?s:mr(n,s)}async getActivatedEnvironmentVariablesImpl(e,t,n){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Be;return this.getActivatedEnvironmentVariablesFromPython(e,t,n).then(o=>{if(!n?.isCancellationRequested)return o}).catch(o=>{x(`Failed to get env vars with python ${V(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,n){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>GV&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,n);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Be})}return mr(n,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,n){e=e||(fN.workspace.workspaceFolders?.length?fN.workspace.workspaceFolders[0].uri:void 0);let i=new Be,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,c=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,Rl(VE(t,!0)),!1).catch(p=>{x(`Failed to get activated env variables from Python Extension for ${V(t.path)}`,p),s="failedToGetActivatedEnvVariablesFromPython"}));if(n?.isCancellationRequested)return;let l=Jr(t);if(A("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:l,source:"python",failed:Object.keys(c||{}).length===0,reason:s},a),c?E(`Got env vars with python ${V(t.path)}, with env var count ${Object.keys(c||{}).length} in ${i.elapsedTime}ms. 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`):l==="Conda"?x(`Failed to get activated conda env vars for ${V(t.path)}
                 in ${i.elapsedTime}ms`):j(`Failed to get activated env vars for ${V(t.path)} in ${i.elapsedTime}ms`),!c){let u=await o;if(c={},Jr(t)==="Conda"){let b=this.interpreterService.known.find(w=>w.id===t.id)?.executable.sysPrefix||(await this.interpreterService.resolveEnvironment(t))?.executable.sysPrefix;b?c.CONDA_PREFIX=b:j(`Failed to get the SysPrefix for the Conda Environment ${V(t.path)}}`)}this.envVarsService.mergeVariables(process.env,c),this.envVarsService.mergeVariables(u,c),this.envVarsService.mergePaths(process.env,c),process.env.PYTHONPATH&&(c.PYTHONPATH=process.env.PYTHONPATH);let p=u?Object.keys(u).find(b=>b.toLowerCase()=="path"):void 0;p&&u[p]&&this.envVarsService.appendPath(c,u[p]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(c,u.PYTHONPATH);let m=await this.globalExecPaths.getExecutablesPath(t).catch(f);if(n?.isCancellationRequested)return;let h=c.PATH||c.Path,v=h?h.split(Jn):[];m&&v[1]!==m.fsPath?(E(`Prepend PATH with user site path for ${V(t.path)}, user site ${m.fsPath}`),this.envVarsService.prependPath(c,m.fsPath)):la(t)||x(`Unable to determine site packages path for python ${V(t.path)} (${Jr(t)})`),!c.PATH&&c.Path&&(c.PATH=c.Path)}return E(`Prepend PATH with python bin for ${V(t.path)}`),t.executable.uri&&this.envVarsService.prependPath(c,ut(t.executable.uri.fsPath)),E(`Activated Env Variables for ${V(t.path)}, 
    PATH value is ${c.PATH} and 
    Path value is ${c.Path}`),c}};g([ti("Getting activated env variables",5),d(1,Pl("id"))],mp.prototype,"getActivatedEnvironmentVariablesImpl",1),g([d(1,Pl("id")),d(2,Hu())],mp.prototype,"getActivatedEnvironmentVariablesFromPython",1),mp=g([(0,Nl.injectable)(),d(0,(0,Nl.inject)(Qe)),d(1,(0,Nl.inject)(Ec)),d(2,(0,Nl.inject)(zt)),d(3,(0,Nl.inject)(ze)),d(4,(0,Nl.inject)(wc)),d(5,(0,Nl.inject)(Dc))],mp);var ks=Symbol("IEnvironmentActivationService");var cg=k(M()),lg=require("vscode");var ag=class{constructor(e,t,n){this.disposables=e;this.extensionChecker=t;this.pythonApi=n;this._changed=new lg.EventEmitter;this._registered=!1;lg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(lg.window.activeNotebookEditor&&_t(lg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(f))}};ag=g([(0,cg.injectable)(),d(0,(0,cg.inject)(K)),d(1,(0,cg.inject)(ze)),d(2,(0,cg.inject)(zt))],ag);function zV(r){r.addSingleton(zt,Gh),r.addSingleton(ze,ip),r.addSingleton(Qe,zh),r.addSingleton(Ie,ag),r.addSingleton(ks,mp)}var QV=k(M());var QS=require("vscode");var ug=class{activate(){QS.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await QS.window.showInformationMessage(e,ge.reload)===ge.reload&&QS.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};ug=g([(0,QV.injectable)()],ug);var YV=k(M()),Gi=require("vscode");var Ml=class{get activeDebugConsole(){return Gi.debug.activeDebugConsole}get activeDebugSession(){return re(`Getting active debug session, ${Gi.debug.activeDebugSession?.name}`),Gi.debug.activeDebugSession}get breakpoints(){return Gi.debug.breakpoints}get onDidChangeActiveDebugSession(){return Gi.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return Gi.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return Gi.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return Gi.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return Gi.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return Gi.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return Gi.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,n){return Gi.debug.startDebugging(e,t,n)}addBreakpoints(e){Gi.debug.addBreakpoints(e)}removeBreakpoints(e){Gi.debug.removeBreakpoints(e)}};Ml.instance=new Ml,Ml=g([(0,YV.injectable)()],Ml);var bP=k(M()),hN=require("vscode");var pg=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,n){if(Zn&&this.extensionContext.extensionMode!==hN.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,n||"");return}if(n)await this.extensionContext.secrets.store(`${e}.${t}`,n);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){x(i)}}async retrieve(e,t){if(Zn&&this.extensionContext.extensionMode!==hN.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){x(i)}}}};pg=g([(0,bP.injectable)(),d(0,(0,bP.inject)(ct))],pg);var XV=k(M()),gN=require("vscode");var dg=class{determineExtensionFromCallStack(e){e=e||new Error().stack;try{if(e){let t=gN.extensions.getExtension(Pt).extensionUri.toString().toLowerCase(),n=e.split(`
`).map(i=>{let o=/\((.*)\)/.exec(i);if(o)return o[1]}).filter(i=>i&&!i.toLowerCase().startsWith(t));kA(new Error("Ex")).forEach(i=>{let o=i.getFileName();o&&!o.toLowerCase().startsWith(t)&&n.push(o)});for(let i of n){let o=gN.extensions.all.find(s=>s.id!==Pt&&(i.toLowerCase().startsWith(s.extensionUri.fsPath.toLowerCase())||i.toLowerCase().startsWith(s.extensionUri.path.toLowerCase())));if(o)return{extensionId:o.id,displayName:o.packageJSON.displayName}}}return{extensionId:pS,displayName:y.unknownPackage}}catch(t){return x("Unable to determine the caller of the extension API for trace stack.",e),x("Failure error",t),{extensionId:pS,displayName:y.unknownPackage}}}};dg=g([(0,XV.injectable)()],dg);var IP=Symbol("IWorkspaceService"),Ti=Symbol("IDebugManager"),_c=Symbol("IApplicationEnvironment"),s_e=Symbol("IWebviewPanelMessageListener"),a_e=Symbol("IWebviewViewMessageListener"),c_e=Symbol("IWebview"),l_e=Symbol("IWebviewView"),u_e=Symbol("IWebviewPanel"),fp=Symbol("IWebviewPanelProvider"),SP=Symbol("IWebviewViewProvider"),YS=Symbol("IEncryptedStorage");var ZV=k(M());var mg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};mg=g([(0,ZV.injectable)()],mg);var xp=k(M()),sB=require("vscode"),cx=k(oB());var YP=class{setSharedProperty(e,t){Nh(e,t)}postEvent(e,t){let n={};t.forEach((i,o)=>{n[o]=i}),A(e,void 0,n)}};var wM=k(require("vscode")),XP=k(M());var wg=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};wg=g([(0,XP.injectable)(),d(0,(0,XP.inject)(ct))],wg);function mo(){return wM.env.appName.indexOf("Insider")>0||wM.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var Qle="VSCode.ABExp.FeatureData",EM="vscode",Eg=class{constructor(e,t,n){this.configurationService=e;this.appEnvironment=t;this.globalState=n;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(c=>!c.endsWith("control")),this._optOutFrom=o.filter(c=>!c.endsWith("control")),!this.enabled)return;let s;mo()==="insiders"?s=cx.TargetPopulation.Insiders:s=cx.TargetPopulation.Public;let a=new YP;this.experimentationService=(0,cx.getExperimentationService)(Pt,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(E(`Experimentation service retrieved: ${this.experimentationService}`),await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(EM,e),!0):e==="KernelCompletions"&&(mo()==="insiders"||Ou())||e==="DoNotWaitForZmqPortsToBeUsed"&&(mo()==="insiders"||Ou())||e==="DataViewerContribution"&&(mo()==="insiders"||Ou())?!0:this.experimentationService.getTreatmentVariable(EM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(EM,e)}getFeatures(){return this.globalState.get(Qle,{features:[]}).features}logExperiments(){let e=sB.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(H("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(H("Telemetry level is off"),t=!0),t&&H("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){H(ep.inGroup("All"));return}let n=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{H(ep.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),H(ep.inGroup(o))}),t&&!i.has("KernelCompletions")&&(mo()==="insiders"||Ou())&&H(ep.inGroup("KernelCompletions")),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(mo()==="insiders"||Ou())&&H(ep.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(n.add(o),H(ep.inGroup(o)))})}};Eg=g([(0,xp.injectable)(),d(0,(0,xp.inject)(ae)),d(1,(0,xp.inject)(_c)),d(2,(0,xp.inject)($e)),d(2,(0,xp.named)(yt))],Eg);var ek=k(M()),Uo=require("vscode");var ZP=require("vscode");function Cp(r){ZP.env.openExternal(typeof r=="string"?ZP.Uri.parse(r):r).then(f,f)}var Yle=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:DS.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:DS.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:DS.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Pg=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Uo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Uo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){Yle.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Uo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let n="Learn more",i="Never show again",o=await Uo.window.showInformationMessage(e.message,n,i);if(o)switch(o){case n:{Cp(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Uo.workspace.workspaceFolders)&&Uo.workspace.workspaceFolders.length>0?Uo.workspace.workspaceFolders.forEach(n=>{t||(t=this.isDeprecatedSettingAndValueUsed(Uo.workspace.getConfiguration("jupyter",n.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Uo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(n=>E("Jupyter Extension: notifyDeprecation",n))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let n=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(n)?n.length>0:!0:!Array.isArray(t.values)||t.values.length===0?n===void 0?!1:Array.isArray(n)?n.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Pg=g([(0,ek.injectable)(),d(0,(0,ek.inject)(dc))],Pg);var wp=k(M());var tk=class{constructor(e,t,n,i){this.storage=e;this.key=t;this.defaultValue=n;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},kg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,n){return new tk(this.globalState,e,t,n)}createWorkspacePersistentState(e,t,n){return new tk(this.workspaceState,e,t,n)}};kg=g([(0,wp.injectable)(),d(0,(0,wp.inject)($e)),d(0,(0,wp.named)(yt)),d(1,(0,wp.inject)($e)),d(1,(0,wp.named)(ri))],kg);var aB="Path",cB="PATH",lB=/^win/.test(process.platform);var uB=k(M()),Ac=require("vscode");var Ae=class r extends Error{static{this.back=new r("back")}static{this.cancel=new r("cancel")}static{this.resume=new r("resume")}},lx=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:n,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:c,matchOnDescription:l,matchOnDetail:u,acceptFilterBoxTextAsSelection:p,startBusy:m,stopBusy:h,validate:v,onDidTriggerItemButton:b,onDidTriggerButton:w,supportBackInFirstStep:D,onDidChangeItems:T,ignoreFocusOut:F}){let ee=[],de=ce(),Z=Ac.window.createQuickPick();return Z.title=e,Z.step=t,Z.totalSteps=n,Z.placeholder=s,Z.ignoreFocusOut=F??!0,Z.items=i,h&&(Z.busy=m??!1,h(()=>{Z.enabled&&(Z.busy=!1)},this,ee)),T&&(Z.keepScrollPosition=!0,T(ye=>{Z.items=ye},this,ee)),b&&Z.onDidTriggerItemButton(ye=>b(ye),void 0,ee),Z.matchOnDescription=l||!1,Z.matchOnDetail=u||!1,o?Z.activeItems=[o]:Z.activeItems=[],Z.buttons=[...this.steps.length>1||D?[Ac.QuickInputButtons.Back]:[],...a||[]],ee.push(Z.onDidTriggerButton(ye=>{ye===Ac.QuickInputButtons.Back?de.reject(Ae.back):w?w(ye):de.resolve(ye)}),Z.onDidChangeSelection(async ye=>{let ue=ye.length?ye[0].label:"",le=!!ue;if(ue&&v&&ye.length){Z.enabled=!1,Z.busy=!0;let Oe=await v(ye[0]);Oe&&(le=!1,await Ac.window.showErrorMessage(Oe,{modal:!0})),Z.enabled=!0,Z.busy=!1}le&&de.resolve(ye[0])}),Z.onDidHide(()=>{(async()=>{de.reject(c&&await c()?Ae.resume:Ae.cancel)})().catch(de.reject)})),p&&ee.push(Z.onDidAccept(async()=>{if(!Z.busy){let ye=v?await v(Z):void 0;ye?(Z.enabled=!1,Z.busy=!0,await Ac.window.showErrorMessage(ye),Z.enabled=!0,Z.busy=!1):de.resolve(Z.value)}})),this.current&&this.current.dispose(),this.current=Z,this.current.show(),de.promise.finally(()=>Q(ee)).catch(f),{quickPick:Z,selection:de.promise}}async showInputBox({title:e,step:t,totalSteps:n,value:i,prompt:o,validate:s,password:a,buttons:c,shouldResume:l,validationMessage:u}){let p=[];try{return await new Promise((m,h)=>{let v=Ac.window.createInputBox();v.title=e,v.step=t,v.totalSteps=n,v.password=!!a,v.value=i||"",v.prompt=o,v.validationMessage=u||"",v.ignoreFocusOut=!0,v.validationMessage=u||"",v.buttons=[...this.steps.length>1?[Ac.QuickInputButtons.Back]:[],...c||[]],p.push(v.onDidTriggerButton(b=>{b===Ac.QuickInputButtons.Back?h(Ae.back):m(b)}),v.onDidAccept(async()=>{let b=v.value;v.enabled=!1,v.busy=!0;let w=await s(b);w?(v.validationMessage=w,v.show()):(v.validationMessage="",m(b)),v.enabled=!0,v.busy=!1}),v.onDidChangeValue(async()=>{v.validationMessage=""}),v.onDidHide(()=>{(async()=>{v.busy||h(l&&await l()?Ae.resume:Ae.cancel)})().catch(h)})),this.current&&this.current.dispose(),this.current=v,this.current.show()})}finally{p.forEach(m=>m.dispose())}}async stepThrough(e,t){let n=e;for(;n;){this.steps.push(n),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{n=await n(this,t)}catch(i){if(i===Ae.back)this.steps.pop(),n=this.steps.pop();else if(i===Ae.resume)n=this.steps.pop();else if(i===Ae.cancel)n=void 0;else throw i;if(!n)return i}}this.current&&this.current.dispose()}},_g=Symbol("IMultiStepInputFactory"),Dg=class{create(){return new lx}};Dg=g([(0,uB.injectable)()],Dg);var pB=k(M()),dB=require("vscode");var Tg=class{activate(){dB.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{lS.includes(t)||lS.push(t)})},f)}};Tg=g([(0,pB.injectable)()],Tg);var Ll=k(Fl());function kp(r){return qr()==="Windows"?bn(r).toUpperCase():bn(r)}function Dp(r,e){return kp(r)===kp(e)}function Og(r,e){return e.endsWith(qn)||(e+=qn),r.endsWith(qn)||(r+=qn),kp(r).startsWith(kp(e))}var m6=require("os"),GM;function f6(r){GM=r}async function h6(r,e={}){return(await GM.get(_i).create(void 0)).shellExec(r,e)}function Kg(r){return Ll.pathExists(r)}function zM(r){return Ll.pathExistsSync(r)}function g6(r){return Ll.readFile(r,"utf-8")}function v6(r){return Ll.readFileSync(r,"utf-8")}var hk=r=>mh(r,(0,m6.homedir)());function y6(r){return GM.get(ae).getSettings()[r]}var x6=k(M()),km=k(require("os")),C6=k(Hh()),YM=require("vscode");var QM=require("vscode"),I6=k(require("os"));var b6=I6.homedir();function Pm(r){return process.env[r]}function Fg(){if(qr()==="Windows")return QM.Uri.file(Pm("USERPROFILE")||b6);let r=Pm("HOME")||Pm("HOMEPATH")||b6;return QM.Uri.file(r.replace(/\\/g,"/"))}var Lg=k(Hh());function S6(r){r=r.replace(/\.00*(?=[1-9]|0\.)/,".");let e=Lg.coerce(r);return e===null||!Lg.valid(e)?new Lg.SemVer("0.0.0"):e}var Oc=class{constructor(){this._homeDir=Fg()||YM.Uri.file(km.homedir());this._tempDir=YM.Uri.file(km.tmpdir());this.osType=qr();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?aB:cB}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,C6.coerce)(km.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return S6(km.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Oc=g([(0,x6.injectable)()],Oc);function w6(r){r.addSingleton(Cr,Oc),f6(r.get(lt))}var bk=k(M()),k6=require("vscode");var Dm=require("child_process"),yk=require("vscode");var XM="utf8";var gk=require("vscode"),E6=require("os"),vk=gk.Uri.file((0,E6.homedir)());function P6(r,e){let t=e?[{uri:gk.Uri.file(e),name:"",index:0}]:[];return V(r?gk.Uri.file(r):void 0,t,vk)}function yn(r,e=[]){return V(r,e,vk)}function ZM(r,e,t){let n=e.reduce((o,s,a)=>{let c=fS(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(c=`${s[0]}${yn(s.substr(1))}`),a===0?c:`${o} ${c}`},""),i=[`Process Execution: ${yn(r)} ${n}`];t&&t.cwd&&i.push(`    > ${CA.currentWorkingDirectory} ${yn(t.cwd.toString())}`),H(i.join(`
`))}var eO=class{decode(e){return Buffer.concat(e).toString(XM)}},_p=class _p{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new eO}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Dm.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=!1;re(`Exec observable ${e}, ${t.join(" ")}`);let a=[],c={dispose:function(){o&&!o.killed&&!s&&_p.kill(o.pid),o&&o.unref(),Q(a)}};this.processesToKill.add(c);let l=Kpe();a.push(l);let u=(m,h,v)=>{m.on(h,v),a.push({dispose:()=>m.removeListener(h,v)})};n.token&&a.push(n.token.onCancellationRequested(()=>{!s&&!o.killed&&(_p.kill(o.pid),s=!0)}));let p=(m,h)=>{let v=this.decoder.decode([h]);m==="stderr"&&n.throwOnStdErr?l.reject(new zS(v)):l.fire({source:m,out:v})};return u(o.stdout,"data",m=>p("stdout",m)),u(o.stderr,"data",m=>p("stderr",m)),o.once("close",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("exit",()=>{s=!0,l.resolve(),a.forEach(m=>m.dispose())}),o.once("error",m=>{s=!0,l.reject(m),a.forEach(h=>h.dispose())}),ZM(e,t,n),{proc:o,out:l,dispose:c.dispose}}exec(e,t,n={}){let i=this.getDefaultOptions(n),o=(0,Dm.spawn)(e,t,i),s=ce(),a={dispose:()=>{!o.killed&&!s.completed&&_p.kill(o.pid)}};this.processesToKill.add(a);let c=[],l=(m,h,v)=>{m.on(h,v),c.push({dispose:()=>m.removeListener(h,v)})};n.token&&c.push(n.token.onCancellationRequested(a.dispose));let u=[];l(o.stdout,"data",m=>u.push(m));let p=[];return l(o.stderr,"data",m=>{n.mergeStdOutErr&&u.push(m),p.push(m)}),o.once("close",()=>{if(s.completed)return;let m=p.length===0?void 0:this.decoder.decode(p);if(m&&m.length>0&&n.throwOnStdErr)s.reject(new zS(m));else{let h=this.decoder.decode(u);s.resolve({stdout:h,stderr:m})}c.forEach(h=>h.dispose())}),o.once("error",m=>{s.reject(m),c.forEach(h=>h.dispose())}),ZM(e,t,n),s.promise}shellExec(e,t={}){let n=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Dm.exec)(e,n,(l,u,p)=>{s?.dispose(),l&&l!==null?o(l):n.throwOnStdErr&&p&&p.length?o(new Error(p)):i({stderr:p&&p.length>0?p:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new yk.CancellationError),_p.kill(a.pid))}));let c={dispose:()=>{a.killed||_p.kill(a.pid)}};this.processesToKill.add(c)})}getDefaultOptions(e){let t={...e},n=t;if(n){let i=n.encoding=typeof n.encoding=="string"&&n.encoding.length>0?n.encoding:XM;delete n.encoding,n.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t}};g([ti("Execing shell command",5),d(1,Hu())],_p.prototype,"shellExec",1);var Kc=_p;function Kpe(){let r=new yk.EventEmitter,e=ce();return e.promise.catch(f),{get onDidChange(){return r.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:r.fire.bind(r),dispose:()=>{r.dispose()}}}var _m=class{constructor(e){this.envVarsService=e}async create(e,t){if(!k6.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return oP(new Kc(n))}};g([ti("Create ProcessService",5)],_m.prototype,"create",1),_m=g([(0,bk.injectable)(),d(0,(0,bk.inject)(Ec))],_m);function D6(r){r.addSingleton(_i,_m)}var T6=k(require("os")),Sk=k(M());var Ug=k(require("vscode")),_6;(c=>{let r=Ug.FileSystemError.FileNotFound().name,e=Ug.FileSystemError.FileExists().name,t=Ug.FileSystemError.FileIsADirectory().name,n=Ug.FileSystemError.FileNotADirectory().name,i=Ug.FileSystemError.NoPermissions().name,o=[r,e,t,n,i];function s(l,u){if(o.includes(l.name))return l.name===u}function a(l){return s(l,r)}c.isFileNotFound=a})(_6||={});function Fpe(r,e){let t=r.code;if(t)return t===e}function Ik(r){let e=_6.isFileNotFound(r);return e!==void 0?e:Fpe(r,"ENOENT")}var R6=require("vscode");var jg=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return Lpe(await this.fs.readFile(R6.Uri.file(e)),t)}catch(n){Ik(n)||x(`Failed to parse env file ${e}`,n)}}mergeVariables(e,t){t&&Object.keys(e).forEach(n=>{let i=n.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||n;t[o]=e[n]})}mergePaths(e,t){let n=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||n;n&&i&&(t[i]=e[n])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,n,...i){let o=i.filter(m=>typeof m=="string"&&m.trim().length>0).map(m=>m.trim()).join(Jn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(m=>m.toLowerCase()==s):void 0,c=e&&a?e[a]:void 0,l=a||t;c&&typeof c=="string"&&c.length>0?n&&!(e[l]||"").endsWith(Jn+o)?e[l]=c+Jn+o:!n&&!(e[l]||"").startsWith(o+Jn)&&(e[l]=o+Jn+c):e[l]=o;let p=["Path","PATH"].find(m=>m!==l);if(T6.platform()==="win32"&&p&&p in e&&typeof e[p]=="string"){let m=e[p],h=p;m&&typeof m=="string"&&m.length>0?n&&!(e[h]||"").endsWith(Jn+o)?e[h]=m+Jn+o:!n&&!(e[h]||"").startsWith(o+Jn)&&(e[h]=o+Jn+m):e[h]=o}return e}};jg=g([(0,Sk.injectable)(),d(0,(0,Sk.inject)(st))],jg);function Lpe(r,e){let t=e||{},n={};return r.toString().split(`
`).forEach((i,o)=>{let[s,a]=Upe(i);s!==""&&(n[s]=Wpe(a,n,t))}),n}function Upe(r){let e=r.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],n=e[2];return n&&n!==""?n[0]==="'"&&n[n.length-1]==="'"?(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n[0]==='"'&&n[n.length-1]==='"'&&(n=n.substring(1,n.length-1),n=n.replace(/\\n/gm,`
`)):n="",[t,n]}var jpe=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Wpe(r,e,t,n=""){let i=!1,o=r;return o=o.replace(jpe,(s,a,c,l,u)=>l>0&&u[l-1]==="\\"?s:c&&c!==""||!a||a===""?(i=!0,s):e[a]||t[a]||n),!i&&o!==r&&(r=o,A("ENVFILE_VARIABLE_SUBSTITUTION")),r.replace(/\\\$/g,"$")}var Fc=k(M());var go=require("vscode");var va=require("vscode");var tO={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function rO(r){return Array.isArray?Array.isArray(r):!!(r&&typeof r.length===tO.number&&r.constructor===Array)}function xk(r){return typeof r===tO.string||r instanceof String}function nO(r){return typeof r===tO.object&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}var Ck=class{resolve(e){return xk(e)?this.__resolveString(e):rO(e)?this.__resolveArray(e):nO(e)?this.__resolveLiteral(e):e}resolveAny(e){return xk(e)?this.__resolveString(e):rO(e)?this.__resolveAnyArray(e):nO(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(n,i)=>{let o=this[i];return xk(o)?o:n&&(n.indexOf("env.")>0||n.indexOf("env:")>0)?"":n})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(n=>{let i=e[n];t[n]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var Wg=class extends Ck{constructor(t,n){super();let i=t?va.workspace.getWorkspaceFolder(t):void 0;this._workspaceFolder=i?i.uri.fsPath:n?.fsPath||__dirname,this._workspaceFolderName=De(this._workspaceFolder),this._filePath=t?t.fsPath:void 0,va.window&&va.window.activeTextEditor&&(this._lineNumber=va.window.activeTextEditor.selection.anchor.line+1,this._selectedText=va.window.activeTextEditor.document.getText(new va.Range(va.window.activeTextEditor.selection.start,va.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(o=>{this[`env:${o}`]=this[`env.${o}`]=process.env[o]})}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?Tw(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?ut(this.relativeFile):void 0}get fileBasename(){return this.file?De(this.file):void 0}get fileBasenameNoExtension(){return this.file?mj(this.file).name:void 0}get fileDirname(){return this.file?ut(this.file):void 0}get fileExtname(){return this.file?Wi(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var Ek=require("vscode"),gx,wk=!1;function A6(){O6()&&M6()}async function N6(r,e){if(O6()){let n=new Wg(e,void 0).resolveAny(K6());await r.exists(Ek.Uri.file(n))&&M6()}}function M6(){A("ENVFILE_WORKSPACE"),wk=!0}function O6(){return!wk}function K6(){return gx||(gx=Ek.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),gx}var Bpe;(t=>{function r({telemetrySent:n,defaultSetting:i}){n!==void 0&&(wk=n),K6!==void 0&&(gx=i)}t.setState=r;function e(){gx=void 0,wk=!1}t.resetState=e})(Bpe||={});var qpe=60*1e3,Tm=class{constructor(e,t,n,i,o=qpe){this.envVarsService=e;this.extensionChecker=n;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new go.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),Q(this.disposables)}async getEnvironmentVariables(e,t,n){if(e=e||(go.workspace.workspaceFolders?.length?go.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,n);let i=new zd(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return E(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,n);return o.then(s=>{n?.isCancellationRequested||(i.data=s)}).catch(f),o}async getCustomEnvironmentVariables(e,t,n){e=e||(go.workspace.workspaceFolders?.length?go.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){re(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let c=await this.pythonApi.getNewApi();if(c&&!n?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,c.environments.onDidEnvironmentVariablesChange(l=>{E(`Python env vars changed ${l.resource?.uri?.path}`),this.onEnvironmentFileChanged(l.resource?.uri),this.changeEventEmitter.fire(l.resource?.uri)},this,this.disposables)),c.environments.getEnvironmentVariables(i)}let o=new zd(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return E(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(n?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(c=>{n?.isCancellationRequested||(o.data=c)}).catch(f),a}createFileWatcher(e,t){let n=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(n))return;let i=new go.RelativePattern(go.Uri.file(ut(e)),De(e)),o=go.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(n),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):x("Failed to create file watcher for environment file")}getEnvFile(e){return We(e.fsPath,".env")}async _getEnvironmentVariables(e,t,n){let i=await this.getCustomEnvironmentVariables(e,t,n);if(n?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=go.workspace.workspaceFolders||[],n=t.length===1?t[0].uri:void 0;return e&&go.workspace.getWorkspaceFolder(e)?.uri||n}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),A6()}onEnvironmentFileChanged(e){new zd(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new zd(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${bs(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${bs(e)}:RunNonPythonCode:CustomVars`}};g([ti("Get Custom Env Variables",5)],Tm.prototype,"getEnvironmentVariables",1),Tm=g([(0,Fc.injectable)(),d(0,(0,Fc.inject)(wc)),d(1,(0,Fc.inject)(K)),d(2,(0,Fc.inject)(ze)),d(3,(0,Fc.inject)(zt)),d(4,(0,Fc.inject)("number")),d(4,(0,Fc.optional)())],Tm);function F6(r){r.addSingleton(wc,jg),r.addSingleton(Ec,Tm)}var L6=k(M()),Tp=require("vscode");var iO=require("vscode");var Vg=class{activate(){Tp.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=iO.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let n=t+1,i={"ms-toolsai.jupyter":n,"ms-toolsai.jupyter-renderers":n};Tp.extensions.getExtension(ei)&&(i[ei]=n),Tp.extensions.getExtension(Hd)&&(i[Hd]=n),await iO.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Tp.ConfigurationTarget.Global),Tp.commands.executeCommand("workbench.action.reloadWindow").then(f,f)}};Vg=g([(0,L6.injectable)()],Vg);var vx=require("vscode");var Lc=k(M());var U6=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],Bg=class{constructor(e,t,n,i){this.globalState=e;this.crypto=t;this.workspaceState=n;this.extensionContext=i}activate(){this.removeOldCachedItems().then(f,f)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(U6).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(f,f)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(U6.map(t=>this.globalState.keys().filter(n=>n.startsWith(t)).map(n=>this.globalState.update(n,void 0).then(f,f))).flat()),await this.extensionContext.secrets.delete(`${ps.JupyterServerRemoteLaunchService}.remote-uri-list`).then(f,f)}async getUriAccountKey(){let e=Is();return e?this.crypto.createHash(Ee(e),"SHA-512"):vx.workspace.workspaceFile?this.crypto.createHash(Ee(vx.workspace.workspaceFile),"SHA-512"):vx.env.machineId}};Bg=g([(0,Lc.injectable)(),d(0,(0,Lc.inject)($e)),d(0,(0,Lc.named)(yt)),d(1,(0,Lc.inject)(Kh)),d(2,(0,Lc.inject)($e)),d(2,(0,Lc.named)(ri)),d(3,(0,Lc.inject)(ct))],Bg);function j6(r){r.addSingletonInstance(I2,lB),r.addSingleton(sm,dg),r.addSingleton(dc,kg),r.addSingleton(Ti,Ml),r.addSingleton(_c,wg),r.addSingleton(YS,pg),r.addSingleton(Kh,_h),r.addSingleton(mc,Eg),r.addSingleton(kE,Pg),r.addSingleton(ni,mg),r.addSingleton(_g,Dg),r.addSingleton(Ie,Tg),r.addSingleton(Ie,Bg),r.addSingleton(Ie,ug),r.addSingleton(Ie,Vg),w6(r),D6(r),F6(r)}var kk=k(M());var qo=We(__dirname,"..");var oO=We(qo,"pythonFiles"),Jpe=oO;function W6(){let e=[We(Jpe,"normalizeSelection.py")];function t(n){return n}return[e,t]}var Ai=require("vscode");var Pk=class{async normalizeLines(e,t){return e}async getFileToExecute(){let e=Ai.window.activeTextEditor;if(!e){Ai.window.showErrorMessage("No open file to run in terminal").then(f,f);return}if(e.document.isUntitled){Ai.window.showErrorMessage("The active file needs to be saved before it can be run").then(f,f);return}if(e.document.languageId!==xe){Ai.window.showErrorMessage("The active file is not a Python source file").then(f,f);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,n;return t.isEmpty?n=e.document.lineAt(t.start.line).text:t.isSingleLine?n=this.getSingleLineSelectionText(e):n=this.getMultiLineSelectionText(e),this.dedentCode(n.trimEnd())}async saveFileIfDirty(e){let t=Ai.workspace.textDocuments.filter(n=>n.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}dedentCode(e){let t=e.split(`
`),n=t.find(i=>i.trim().length>0);if(n){let i=n.match(/^\s*/)[0];return t.map(o=>o.startsWith(i)?o.replace(i,""):o).join(`
`)}return e}getSingleLineSelectionText(e){let t=e.selection,n=new Ai.Range(t.start,t.end),i=e.document.getText(n),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,n=new Ai.Range(t.start,t.end),i=e.document.getText(n),o=new Ai.Range(new Ai.Position(t.start.line,0),new Ai.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,c=new Ai.Range(t.start,new Ai.Position(t.start.line,a.length)),l=e.document.getText(c);return l.trimStart()===a.trimStart()?a+i.substring(l.length):i}};var qg=class extends Pk{constructor(t){super();this.processServiceFactory=t.get(_i),this.interpreterService=t.get(Qe)}async normalizeLines(t,n){let i=[];try{let o=t.trim();if(o.length===0)return"";if(t=t.replace(new RegExp("\\r","g"),""),o.indexOf(`
`)===-1)return o+`
`;let s=await this.interpreterService.getActiveInterpreter(n),a=await this.processServiceFactory.create(n),[c,l]=W6(),u=a.execObservable(Ee(s?.uri)||"python",c,{throwOnStdErr:!0}),p="";u.out.onDidChange(T=>{T.source==="stdout"&&(p+=T.out)},this,i);let m=JSON.stringify({code:t});u.proc?.stdin?.write(m),u.proc?.stdin?.end(),await u.out.done;let v=JSON.parse(p),b=l(v.normalized),w=Ke(t,{trim:!0,removeEmptyEntries:!1}).findIndex(T=>T.length),D=Ke(b,{trim:!0,removeEmptyEntries:!1}).findIndex(T=>T.length);if(w>D){let T=w-D;return`${`
`.repeat(T)}${b}`}return b}catch(o){return x(o,"Python: Failed to normalize code for execution in Interactive Window"),t}finally{Q(i)}}};qg=g([(0,kk.injectable)(),d(0,(0,kk.inject)(lt))],qg);var Dk=Symbol("ICodeExecutionHelper");function V6(r){r.addSingleton(Dk,qg)}var Rp=k(M()),q6=k(Hh()),yx=require("vscode");var B6="CONDA_INFORMATION_CACHE";function sO(r){return r&&dh(r.fsPath)&&r.fsPath.startsWith(qn)&&`${qn}${De(r.fsPath)}`===r.fsPath?De(r.fsPath):r?.fsPath}var As=class{constructor(e,t,n){this.pythonApi=e;this.globalState=t;this.fs=n}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(f)}).catch(f);let n=ds(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.version?this._version=n.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return sO(this._file);if(this._previousFileCall)return this._previousFileCall.then(sO);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{E(`Conda file returned by Python Extension is ${i}`),this._file=i?yx.Uri.file(i):void 0,this.updateCache().catch(f)}).catch(f);let n=ds(this.getCachedInformation());return await Promise.race([n.promise,t]),n.completed&&n.value?.file?this._file=n.value.file:t.then(i=>i?yx.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(sO)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(B6,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(B6,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(yx.Uri.file(e.file));if(e.fileHash===t)return{version:new q6.SemVer(e.version),file:yx.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};As=g([(0,Rp.injectable)(),d(0,(0,Rp.inject)(zt)),d(1,(0,Rp.inject)($e)),d(1,(0,Rp.named)(yt)),d(2,(0,Rp.inject)(st))],As);var bx=k(M());var $6=k(_k());var J6="_VSCODE_getDataFrame",Tk=$6.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Uc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${J6}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Tk}:{code:`${t}

${i}

${Tk}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),n=e.isDebugging?"True":"False",i=`${J6}("rows", ${n}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:Tk}:{code:`${t}

${i}

${Tk}`}}async getContentsOfDataFrameScript(){if(Uc.contentsOfDataFrameScript)return Uc.contentsOfDataFrameScript;let e=sr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Uc.contentsOfDataFrameScript=t,t}};Uc=g([(0,bx.injectable)(),d(0,(0,bx.inject)(st)),d(1,(0,bx.inject)(ct))],Uc);var Jg=k(M()),jl=require("jsonc-parser"),lO=require("vscode");var Rk=k(M()),Ul=require("vscode");var ai=class{constructor(e){this.disposables=[];this._onDidChange=new Ul.EventEmitter;e.push(this),Br()||Ul.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),Q(this.disposables)}isPythonEnvironmentExcluded(e){if(Br())return!1;let t=this.getExcludedPythonEnvironments(),n=cO(e,t),i="uri"in e?e.uri:e.executable.uri;return n&&(A("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),E(`Python Env hidden via filter: ${V(i)}`)),n}getExcludedPythonEnvironments(){if(!Ul.workspace.workspaceFolders||Ul.workspace.workspaceFolders.length===0)return Ul.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Ul.workspace.workspaceFolders.forEach(t=>{e.push(...Ul.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};ai=g([(0,Rk.injectable)(),d(0,(0,Rk.inject)(K))],ai);function cO(r,e){let t="uri"in r?r.envPath:r.environment?.folderUri,n="uri"in r?r.uri:r.executable.uri;return!n&&!t?!1:e.some(o=>{let s=V(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=V(n).toLowerCase().replace(/\\/g,"/"),c=n?n.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===c||s===c)return!0;let l=V(t||"").toLowerCase().replace(/\\/g,"/"),u=V(t||"").toLowerCase().replace(/\\/g,"/");return o===l||s===l||o===u||s===u})}var Ap=class{constructor(e,t,n){this.disposableRegistry=e;this.interpreters=t;this.pythonExtChecker=n;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(lO.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(lO.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,n){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||this.interpreters.resolvedEnvironments.length===0||!Ap.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return this.interpreters.resolvedEnvironments.filter(o=>!cO(o,i)).map(o=>{let s=np(o),a=V(o.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(De(e.uri.fsPath)!=="settings.json")return!1;let n=(0,jl.getLocation)(e.getText(),e.offsetAt(t));return n.path[0]==="jupyter.kernels.excludePythonEnvironments"&&n.path.length===2}getCurrentItemsInList(e,t){try{let n=e.getText(),i=(0,jl.getLocation)(n,e.offsetAt(t)),o=(0,jl.parseTree)(n),s=(0,jl.findNodeAtLocation)(o,[i.path[0]]);if(!s)return[];let a=(0,jl.getNodeValue)(s);return Array.isArray(a)?a:[]}catch(n){return j("Failed to provide completions for python env filter",n),[]}}};Ap=g([(0,Jg.injectable)(),d(0,(0,Jg.inject)(K)),d(1,(0,Jg.inject)(Qe)),d(2,(0,Jg.inject)(ze))],Ap);var H6=k(M()),Ni=require("vscode");var $g=class{activate(){this.migrateFilters().catch(f)}async migrateFilters(){let e=Array.isArray(Ni.workspace.workspaceFolders)?Ni.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Ni.workspace.getConfiguration("jupyter",void 0),Ni.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Ni.workspace.getConfiguration("jupyter",void 0),Ni.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Ni.workspace.getConfiguration("jupyter",e[0].uri),Ni.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Ni.workspace.getConfiguration("jupyter",void 0),Ni.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Ni.workspace.getConfiguration("jupyter",t.uri),Ni.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let n=e.inspect("kernels.filter"),i=[];switch(t){case Ni.ConfigurationTarget.Global:i=n?.globalValue||[];break;case Ni.ConfigurationTarget.Workspace:i=n?.workspaceValue||[];break;default:i=n?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};$g=g([(0,H6.injectable)()],$g);var Ak=k(M());var uO=require("vscode");var Hg=class{constructor(e){this.disposables=e}activate(){this.disposables.push(uO.commands.registerCommand("jupyter.filterKernels",()=>uO.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(f,f),this))}};Hg=g([(0,Ak.injectable)(),d(0,(0,Ak.inject)(K))],Hg);var Mk=k(M());var Rm=Symbol("IModuleInstaller"),ANe=Symbol("IPythonInstallation"),Nk=Symbol("IInstallationChannelManager"),Ix=Symbol("IProductService"),Sx=Symbol("IProductPathService");var Mi=Symbol("IInstaller");var zg=require("vscode");var Gg=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let n=await this.getInstallationChannels(t);if(n.length>=1)return n[0];if(n.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Rm),n=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(n.length>0)break;i=o.priority}await o.isSupported(e)&&n.push(o)}return n}async showNoInstallersMessage(e){if(await zg.window.showErrorMessage(e.envType==="Conda"?Dh.noCondaOrPipInstaller:Dh.noPipInstaller,{modal:!0},Dh.searchForHelp)===Dh.searchForHelp){let n=this.serviceContainer.get(Cr),i=n.isWindows?"Windows":n.isMac?"MacOS":"Linux";zg.env.openExternal(zg.Uri.parse(`https://www.bing.com/search?q=Install Pip ${i} ${e.envType==="Conda"?"Conda":""}`))}}};Gg=g([(0,Mk.injectable)(),d(0,(0,Mk.inject)(lt))],Gg);var Fk=k(M());var Ok=require("vscode");function Qi(r){switch(r){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${r} cannot be installed as a Python Module.`)}}var G6=require("os");var Qg=class extends Xe{constructor(t,n,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=n;this.originalMessage=i}};var Or=Symbol("IPythonExecutionFactory"),GNe=Symbol("IPythonExecutionService");var jc=class{constructor(e){this.serviceContainer=e}async installModule(e,t,n,i){let o=typeof e=="string"?e:Qi(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Or),c=this.serviceContainer.get(_i),l=this.serviceContainer.get(ks),u=this.serviceContainer.get(wc);if(n.token.isCancellationRequested)return;let p=async(h,v)=>{let b=ce(),w=[];v.onCancellationRequested(()=>{n.cancel(),b.resolve()},this,w);let D;if(s.useShellExec){let Z=await c.create(void 0);if(n.token.isCancellationRequested)return;try{let ye=await Z.shellExec(s.args.join(" "),{cwd:s.cwd});E(ye.stdout),b.resolve()}catch(ye){b.reject(ye)}}else if(s.exe){let Z=await l.getActivatedEnvironmentVariables(void 0,t);if(n.token.isCancellationRequested)return;let ye={...process.env};u.mergeVariables(Z||{},ye),u.mergePaths(Z||{},ye);let ue=await c.create(void 0);if(n.token.isCancellationRequested)return;D=ue.execObservable(s.exe,s.args,{encoding:"utf-8",token:v,env:ye,cwd:s.cwd})}else{let Z=await a.createActivatedEnvironment({interpreter:t});if(n.token.isCancellationRequested)return;D=Z.execObservable(s.args,{encoding:"utf-8",token:v,cwd:s.cwd})}let T,F,ee=[".","..","..."],de=0;return D&&(D.out.onDidChange(Z=>{let ye=ee[de%3],ue=Z.out.trim();de+=1;let le=ue.length>28?`${ue.substring(0,28)}${ye}`:ue;h.report({message:le}),E(Z.out),Z.source==="stderr"&&(F?F+=Z.out:!F&&Z.out.includes("ERROR: Could not install packages")&&(F=Z.out.substring(Z.out.indexOf("ERROR: Could not install packages"))),T=Z.out)},this,w),D.out.done.then(()=>{D?.proc?.exitCode!==0?F&&F.includes("https://pip.pypa.io/warnings/enable-long-paths")?(F=Ke(F,{trim:!0,removeEmptyEntries:!0}).filter(Z=>!Z.startsWith("[notice]")).join(G6.EOL),b.reject(new Qg(e,t,F))):b.reject(T||D?.proc?.exitCode):b.resolve()},Z=>{b.reject(Z)}).finally(()=>Q(w))),b.promise},m={location:Ok.ProgressLocation.Notification,cancellable:!0,title:PA.installingModule(o)};await Ok.window.withProgress(m,async(h,v)=>p(h,v))}};var Gpe=[Qi(18),Qi(20)];function Kk(r,e){return Gpe.includes(e)?r==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var z6=require("vscode");var Yg=class extends jc{constructor(t){super(t)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(t){if(this._isCondaAvailable===!1)return!1;let n=this.serviceContainer.get(As);return this._isCondaAvailable=await n.isCondaAvailable(),this._isCondaAvailable?("executable"in t?Jr(t):t.envType)==="Conda":!1}async installModule(t,n,i,o){if(await super.installModule(t,n,i,o),("executable"in n?Jr(n):n.envType==="Conda")&&("executable"in n?la(n):n.isCondaEnvWithoutPython)){if(!this.serviceContainer.get(ze).isPythonExtensionActive)return;let c=await this.serviceContainer.get(Qe).getInterpreterDetails(n.id);c&&!c.isCondaEnvWithoutPython&&Object.assign(n,c)}}async getExecutionArgs(t,n,i=0){let s=await this.serviceContainer.get(As).getCondaFile(),a="executable"in n?n.environment?.name:n.envName,c=this.getEnvironmentPath(n),l=[i&1?"update":"install"];return[19,23,22,18,20].map(Qi).includes(t)&&l.push("-c","conda-forge"),a?(l.push("--name"),l.push(fS(a))):c&&(l.push("--prefix"),l.push(hS(c))),i&2&&l.push("--update-deps"),i&4&&l.push("--force-reinstall"),l.push(t),l.push(...Kk("conda",t)),l.push("-y"),{exe:s,args:l}}getEnvironmentPath(t){let n;if("executable"in t){if(t.environment?.folderUri)return t.environment.folderUri.fsPath;n=t.executable.uri||z6.Uri.file(t.path)}else n=t.uri;let i=ut(n.fsPath),o=De(i);return["BIN","SCRIPTS"].indexOf(o.toUpperCase())!==-1?We(i,".."):i}};Yg=g([(0,Fk.injectable)(),d(0,(0,Fk.inject)(lt))],Yg);var Uk=k(M());function zpe(){let r=Pm("PIPENV_MAX_DEPTH");if(r===void 0)return 3;let e=parseInt(r,10);return isNaN(e)?(x(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${r}' to number results in NaN`),1):e}async function Q6(r,e){let t=Pm("PIPENV_PIPFILE")||"Pipfile",n=e.lookIntoParentDirectories?zpe():1;for(;n>0&&!Dp(r,ut(r));){let i=We(r,t);if(await Kg(i))return i;r=ut(r),n-=1}}async function Qpe(r){let e=We(r,".project");if(!await Kg(e))return;let t=await g6(e);if(!await Kg(t)){x(`The .project file inside environment folder: ${r} doesn't contain a valid path to the project`);return}return t}async function Ype(r){let e=ut(ut(r.fsPath)),t=await Qpe(e);if(!(t===void 0||!De(kp(e)).startsWith(`${De(kp(t))}-`)))return Q6(t,{lookIntoParentDirectories:!1})}async function Y6(r,e){let t=await Ype(r);if(!t)return!1;let n=Pm("PIPENV_NO_INHERIT")===void 0,i=await Q6(e.fsPath,{lookIntoParentDirectories:n});return i?Dp(t,i):!1}var Lk=require("vscode");function xx(r){let e="executable"in r?r.executable.uri||Lk.Uri.file(r.path):r.uri;return Lk.workspace.getWorkspaceFolder(e)?.uri||Is()}var Z6=require("vscode");var X6="pipenv",Xg=class extends jc{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return X6}get priority(){return 10}async isSupported(e){if(Lu(e)){let t=await this.serviceContainer.get(Qe).getActiveInterpreter(e),n=e?Z6.workspace.getWorkspaceFolder(e):void 0;return!t||!n||t.envType!=="PipEnv"?!1:Y6(t.uri,n.uri)}else return("executable"in e?Jr(e):e.envType)==="PipEnv"}async getExecutionArgs(e,t,n=0){let o=[n&4||n&2||n&1?"update":"install",e,"--dev"],s=xx(t);return{args:o,exe:X6,cwd:s?Ee(s):void 0}}};Xg=g([(0,Uk.injectable)(),d(0,(0,Uk.inject)(lt))],Xg);var jk=k(M());var eJ=require("vscode");var Zg=class extends jc{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch("executable"in e?Jr(e):e.envType){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,n=0){if(e===Qi(27))return await this.serviceContainer.get(Mi).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[We(oO,"get-pip.py")]};let i=[],o=eJ.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),n&4&&i.push("--force-reinstall"),("executable"in t?Jr(t):t.envType)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(Kk("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Or).create({resource:void 0,interpreter:e}).then(n=>n.isModuleInstalled("pip")).catch(()=>!1)}};Zg=g([(0,jk.injectable)(),d(0,(0,jk.inject)(lt))],Zg);var Cx=k(M());var Xpe=5e4,Wl=class Wl{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(Zpe(e))return(Wl.poetryPromise.get(e)===void 0||Dr())&&Wl.poetryPromise.set(e,Wl.locate(e)),Wl.poetryPromise.get(e)}static async locate(e){E(`Getting poetry for cwd ${e}`);function*t(){let n=y6("poetryPath");n&&n!=="poetry"&&(yield n),yield"poetry";let i=Fg();if(i){let o=We(i.fsPath,".poetry","bin","poetry");zM(o)&&(yield o)}}for(let n of t()){E(`Probing poetry binary for ${e}: ${n}`);let i=new Wl(n,e);if(await i.getEnvList()!==void 0)return E(`Found poetry via filesystem probing for ${e}: ${n}`),i;E(`Failed to find poetry for ${e}: ${n}`)}E(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let n=await this.safeShellExecute(`${e} env list --full-path`);if(!n)return;let i="(Activated)";return(await Promise.all(Ke(n.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await Kg(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(qr()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let n=new Be,i=await h6(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:Xpe}).catch(o=>{t?E(o):x(o)});return E(`Time taken to run ${e} in ms`,n.elapsedTime),i}};g([PR(3e4)],Wl.prototype,"getEnvListCached",1),g([PR(2e4)],Wl.prototype,"getActiveEnvPathCached",1);var Wk=Wl;async function tJ(r,e,t){let i=await(t?new Wk(t,e):await Wk.getPoetry(e))?.getActiveEnvPath();return i?Og(r,i):!1}function Zpe(r){let e=We(r,"pyproject.toml");return!(!zM(e)||!v6(e).includes("[tool.poetry]"))}var rJ=require("vscode");var ede="poetry",ev=class extends jc{constructor(t,n){super(t);this.configurationService=n}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return ede}get priority(){return 10}async isSupported(t){if(("executable"in t?Jr(t):t.envType)!=="Poetry")return!1;let n=xx(t);if(n){let i="executable"in t?t.executable.uri||rJ.Uri.file(t.path):t.uri;return tJ(i.fsPath,n.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,n){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=xx(n)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};ev=g([(0,Cx.injectable)(),d(0,(0,Cx.inject)(lt)),d(1,(0,Cx.inject)(ae))],ev);var Wc=k(M()),cJ=require("vscode");var fr=new Map;fr.set(18,"jupyter");fr.set(20,"notebook");fr.set(19,"ipykernel");fr.set(22,"nbconvert");fr.set(21,"kernelspec");fr.set(23,"pandas");fr.set(27,"pip");fr.set(28,"ensurepip");var Np=k(M());var nJ=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(r=>r.toLowerCase())),iJ="NOT INSTALLED",Ns=class{constructor(e,t,n,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=n;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;Ns._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return Ns._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=dn(e.uri),n=this.interpreterInformation.get(t);return n||(n=ce(),this.interpreterInformation.set(t,n),this.trackInterpreterPackages(e).catch(f)),n.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let n=await this.getPackageVersions(e),i=await ht(t.toLocaleLowerCase());if(!n.has(i))return;let o=n.get(i);if(o)return o===iJ?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(f)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=bs(e);if(!this.interpreterPackages.has(t)){let n=this.listPackagesImpl(e);this.interpreterPackages.set(t,n),n.catch(i=>{this.interpreterPackages.get(t)===n&&this.interpreterPackages.delete(t),j(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(n=>Array.from(n))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let n=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await n.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(c=>c.toLowerCase())))}else return x(`Failed to get list of installed packages for ${yn(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let n;if(Lu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;n=i}else n=e;this.trackInterpreterPackages(n,t).catch(f)}async trackInterpreterPackages(e,t){let n=dn(e.uri);if(this.pendingInterpreterInformation.has(n)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(n)===i&&this.pendingInterpreterInformation.delete(n)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(f),this.pendingInterpreterInformation.set(n,i)}async getPackageInformation({interpreter:e}){if(e.isCondaEnvWithoutPython)return;let n=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(nJ).map(async a=>{i.set(await ht(a),iJ)})),await Promise.all(n.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let c=a.split(" ").filter(m=>m.trim().length);if(c.length<2)return;let[l,u]=c;if(!nJ.has(l.toLowerCase().trim()))return;let p=tp(u);i.set(await ht(l),p||"")}));let o=dn(e.uri),s=this.interpreterInformation.get(o);s||(s=ce(),this.interpreterInformation.set(o,s)),s.resolve(i)}};Ns=g([(0,Np.injectable)(),d(0,(0,Np.inject)(ze)),d(1,(0,Np.inject)(Qe)),d(2,(0,Np.inject)(Or)),d(3,(0,Np.inject)(zt)),d(4,(0,Np.inject)(K))],Ns);async function Vk(r,e,t){if(Lu(t))return;let n=`${await vc(t)}#${fr.get(e)}`;await r.update(n,!0)}async function oJ(r,e,t){let n=`${await vc({uri:t})}#${fr.get(e)}`;await r.update(n,void 0)}async function sJ(r,e,t){let n=`${await vc(t)}#${fr.get(e)}`;return r.get(n,!1)}var Bk=Symbol("IReservedPythonNamedProvider"),Mp=Symbol("IInterpreterPackages"),qk=Symbol("IWorkspaceInterpreterTracker");async function lJ(r,e,t){let n=`${await vc(t)}#${fr.get(e)}`;if(r.get(n,!1))return!0;let i=Qi(e),o=Ns.instance?Ns.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{x("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await _r(500,o);if(typeof s=="string")return s==="found"}catch{x(`Failed to check if package exists ${fr.get(e)}`)}}var Jk=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(ae),this.productService=e.get(Ix),this.persistentStateFactory=e.get(dc)}async install(e,t,n,i,o){let a=await this.serviceContainer.get(Nk).getInstallationChannel(e,t);if(!a)return 2;if(n.token.isCancellationRequested)return 3;let c=i===!0?6:void 0;return o===!0&&(c=c?c|8:8),await a.installModule(e,t,n,c),n.token.isCancellationRequested?3:(t.isCondaEnvWithoutPython&&(t.isCondaEnvWithoutPython=!1),this.isInstalled(e,t).then(l=>l?0:2))}async isInstalled(e,t){let n=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Or).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(n):(await this.serviceContainer.get(_i).create(void 0)).exec(n,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Sx,n).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let n=this.productService.getProductType(e);return this.serviceContainer.get(Sx,n).isExecutableAModule(e,t)}};g([ti("Checking if product is installed"),d(1,Pl("path"))],Jk.prototype,"isInstalled",1);var tv=class{constructor(e,t,n,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=n;this.output=i;this._onInstalled=new cJ.EventEmitter;this.productService=e.get(Ix)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,n,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,n,i,o);switch(Vk(this.memento,e,t).catch(f),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{A("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:fr.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return Qi(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new Jk(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};tv=g([(0,Wc.injectable)(),d(0,(0,Wc.inject)(lt)),d(1,(0,Wc.inject)(Mp)),d(2,(0,Wc.inject)($e)),d(2,(0,Wc.named)(yt)),d(3,(0,Wc.inject)(Mo)),d(3,(0,Wc.named)(Ku))],tv);var $k=k(M());var fO=class{constructor(e){this.serviceContainer=e;this.configService=e.get(ae),this.productInstaller=e.get(Mi)}isExecutableAModule(e,t){if(e===21)return!1;let n;try{n=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof n=="string"&&n.length>0&&De(i)===i}},rv=class extends fO{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};rv=g([(0,$k.injectable)(),d(0,(0,$k.inject)(lt))],rv);var uJ=k(M());var nv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};nv=g([(0,uJ.injectable)()],nv);var hO=require("vscode"),iv=k(M());var Ms=class{constructor(e,t,n){this.title=y.localPythonEnvironments;this._onDidChange=new hO.EventEmitter;this._onDidChangeStatus=new hO.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new ao;this._status="idle";n.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>x("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(f)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){Q(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(f)}withFilter(e){return new Proxy(this,{get(t,n){switch(n){case"items":return t.items.filter(e);case"dispose":return f;default:return t[n]}}})}};Ms=g([(0,iv.injectable)(),d(0,(0,iv.inject)(zt)),d(1,(0,iv.inject)(ze)),d(2,(0,iv.inject)(K))],Ms);var sv=k(M());function gO(r,e){if(Array.isArray(r)){let t=r.slice(1);return e&&t.push(...e),{args:t,command:r[0],python:[...r],pythonExecutable:r[r.length-1]}}return{command:r,args:e||[],python:[r],pythonExecutable:r}}function pJ(r,e){let t={command:r.command,args:[...r.args],python:[...r.python],pythonExecutable:r.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var hJ=require("vscode");function vO(r,e){return["-m",r,...e]}function dJ(){let r=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[r,e]}function mJ(r){let e=["-c",`import ${r};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(n){return n.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(E(`Module ${r} is not installed. Output ${n}`),!1)}return[e,t]}async function gJ(r,e){let[t,n]=dJ(),i=pJ(r,t),o=await e(i.command,i.args);return hJ.Uri.file(n(o.stdout))}var Hk=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return gO(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return gO(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return gJ(e,this.deps.exec)}async isModuleInstalled(e){let[t,n]=mJ(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return n(o.stdout)}catch(o){return j(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function vJ(r,e,t,n,i){return{getPythonArgv:o=>e||[Ee(o)],getObservablePythonArgv:o=>t||[Ee(o)],isValidExecutable:r,exec:async(o,s,a)=>n(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function yJ(r,e,t){let n=vJ(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new Hk(r,n)}function bJ(r,e,t,n,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[r,...o,"python"],a=vJ(async c=>i.exists(c),s,void 0,(c,l,u)=>n.exec(c,l,u),(c,l)=>n.shellExec(c,l));return new Hk(t,a)}var Gk=class extends Xe{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var yO=class{constructor(e){this.deps=e}execObservable(e,t){let n={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,n)}execModuleObservable(e,t,n){let i=vO(e,t),o={...n},s=this.deps.getExecutionObservableInfo(i),a={...n};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let n={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,n)}async execModule(e,t,n){let i=vO(e,t),o={...n},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&IE.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new Gk(e);return a}};function IJ(r,e){let t={isModuleInstalled:async n=>e.isModuleInstalled(n),getExecutionInfo:n=>e.getExecutionInfo(n),getExecutionObservableInfo:n=>e.getExecutionObservableInfo(n),exec:async(n,i,o)=>r.exec(n,i,o),execObservable:(n,i,o)=>r.execObservable(n,i,o)};return new yO(t)}var zk=require("vscode");var ov=class{constructor(e,t,n){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=n;this.disposables=this.serviceContainer.get(K),this.fileSystem=this.serviceContainer.get(st)}async create(e){let t=await this.processServiceFactory.create(e.resource);return SJ(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:zk.workspace.workspaceFolders?.length?zk.workspace.workspaceFolders[0].uri:void 0,!zk.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new Kc({...t});return this.disposables.push(i),SJ(e.interpreter,i,this.fileSystem)}};ov=g([(0,sv.injectable)(),d(0,(0,sv.inject)(lt)),d(1,(0,sv.inject)(ks)),d(2,(0,sv.inject)(_i))],ov);function SJ(r,e,t,n){let i=yJ(r,e,t);if(n){let[s,a]=n;i=bJ(s,a,r,e,t)}let o=IJ(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,c)=>o.execModuleObservable(s,a,c),exec:(s,a)=>o.exec(s,a),execModule:(s,a,c)=>o.execModule(s,a,c)}}var Vl=k(M()),Bl=require("vscode");var xJ="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",CJ=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var qJ=k(Ex());var hr=Symbol("IFileSystemNode");var xde="jupyter.pythonPackages",wO="diagnostics.reservedPythonNames.exclude",cv=class{constructor(e,t,n,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];n.push(this),this.cachedModules=new Set(this.cache.get(xde,CJ).map(o=>o.toLowerCase())),Bl.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${wO}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){Q(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,n]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>Bl.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(n.map(a=>Bl.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,qJ.default)(t,o,{dot:!0}))return!0}))return!1;let n=mn(e,$u(e)).toLowerCase(),i=n==="__init__"?mn(Si(e)).toLowerCase():n;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=Bl.workspace.getConfiguration("jupyter"),n=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(n),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(wO,Array.from(this.ignoredFiles),Bl.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=Bl.workspace.getConfiguration("jupyter").get(wO,[]);this.platform.isWindows&&(t=t.map(n=>n.toLowerCase())),this.ignoredFiles=new Set(t)}};cv=g([(0,Vl.injectable)(),d(0,(0,Vl.inject)($e)),d(0,(0,Vl.named)(yt)),d(1,(0,Vl.inject)(Cr)),d(2,(0,Vl.inject)(K)),d(3,(0,Vl.inject)(hr))],cv);var kx=k(M());var Xk=k(_k());var Px="_VSCODE_getVariable",ql=Xk.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,Vc=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Px}("info", ${n}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:ql}:{code:`${t}

${i}

${ql}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=`${Px}("properties", ${n}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:ql}:{code:`${t}

${i}

${ql}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfScript(),n=e.isDebugging?"True":"False",i=e.parent?t:`${t}

_VSCODE_rwho_ls = %who_ls
`,o=Xk.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=e.parent?`${Px}("AllChildrenDescriptions", ${n}, "${e.parent.root}", ${JSON.stringify(e.parent.propertyChain)}, ${e.startIndex})`:`${Px}("AllVariableDescriptions", ${n}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:i,code:s,cleanupCode:e.parent?ql:`${ql}
${o}`}:{code:`${i}

${s}

${ql}`}}async generateCodeToGetVariableTypes(e){let n=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=Xk.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${Px}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:n,code:s,cleanupCode:`${ql}
${o}`}:{code:`${n}${s}

${ql}
${o}`}}async getContentsOfScript(){if(Vc.contentsOfScript)return Vc.contentsOfScript;let e=sr(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return Vc.contentsOfScript=t,t}};Vc=g([(0,kx.injectable)(),d(0,(0,kx.inject)(st)),d(1,(0,kx.inject)(ct))],Vc);var lv=k(M());var ya=class{constructor(e){this.workspaceInterpreterTracker=e;ya.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};ya.isActiveWorkspaceInterpreter=()=>!1,ya=g([(0,lv.injectable)(),d(0,(0,lv.inject)(qk)),d(0,(0,lv.optional)())],ya);var Dx=require("vscode");var pv=k(M());var uv=class{constructor(e,t,n){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=n;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),Dx.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let n=bs(e),i=this.workspaceInterpreters.get(n);return i?Oo(i,t.uri):!1}trackActiveInterpreters(){Br()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(Dx.workspace.workspaceFolders)?Dx.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let n=bs(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(n,i?.uri)}catch{}}))},this,this.disposables))}};uv=g([(0,pv.injectable)(),d(0,(0,pv.inject)(ze)),d(1,(0,pv.inject)(K)),d(2,(0,pv.inject)(Qe))],uv);function JJ(r){r.addSingleton(Or,ov),r.addSingleton(As,As),r.addSingleton(Dc,Dc),r.addSingleton(Mp,Ns),r.addSingleton(Ie,ya),r.addSingleton(qk,uv),r.addSingleton(Ie,$g),r.addSingleton(Ie,Hg),r.addSingleton(Ie,Ap),r.addSingleton(ai,ai),r.addSingleton(Bk,cv),r.addSingleton(Lh,Vc),r.addSingleton(Uh,Uc),r.addSingleton(Rm,Yg),r.addSingleton(Rm,Zg),r.addSingleton(Rm,Xg),r.addSingleton(Rm,ev),r.addSingleton(Nk,Gg),r.addSingleton(Ix,nv),r.addSingleton(Mi,tv),r.addSingleton(Sx,rv,"DataScience"),r.addSingleton(Ms,Ms),r.addBinding(Ms,Ie)}var zJ=k(M()),mv=require("vscode");var HJ=new Set;function GJ(r){HJ.add(r)}function $J(r){try{HJ.forEach(e=>e.report(r))}catch(e){x("Failed to report progress",e)}}function dv(r){return function(e,t,n){let i=n.value;n.value=async function(...o){return $J({action:r,phase:"started"}),i.apply(this,o).finally(()=>{$J({action:r,phase:"completed"})})}}}var $o=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];GJ(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let n=new mv.CancellationTokenSource,i=ce(),o={location:mv.ProgressLocation.Notification,cancellable:t,title:e};return mv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&n.cancel(),i.resolve()}),n.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(f,f),{token:n.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=gP(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};$o=g([(0,zJ.injectable)()],$o);var QJ=k(M());var zn=require("vscode");var Jl=require("vscode");var _x=class r{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLes.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(r.migratedSettings))e.push(...this.migrateSetting(t,r.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){fv(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(n?.globalValue===n?.defaultValue||!i||i?.globalValue&&i.globalValue[xe])return;if(typeof n?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[xe]=n.globalValue.split(""),await this.jupyterConfig.update(t,o,Jl.ConfigurationTarget.Global).then(f,fv)}}finally{n?.globalValue&&await this.jupyterConfig.update(e,void 0,Jl.ConfigurationTarget.Global).then(f,fv)}}migrateSetting(e,t){let n=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(n?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceValue,Jl.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jl.ConfigurationTarget.Workspace),fv))}if(n?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,n.workspaceFolderValue,Jl.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jl.ConfigurationTarget.WorkspaceFolder),fv))}if(n?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,n.globalValue,Jl.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,Jl.ConfigurationTarget.Global),fv))}return o}};function fv(r){j("Error migrating Jupyter configuration",r)}function Cde(r){return(e,t,n)=>{let i=null,o=null;if(typeof n.value=="function"?(i="value",o=n.value):typeof n.get=="function"&&(i="get",o=n.get),!o)throw new Error("not supported");n[i]=r(o,t)}}function hv(r,e,t){return Cde((n,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{n.apply(this,a),this[s]=t?t():void 0},r)}})}var ba=class ba{constructor(e,t,n){this._systemVariablesCtor=t;this._type=n;this.logging={level:"error"};this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.normalizeSelectionForInteractiveWindow=!0;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this._changeEmitter=new zn.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),zn.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,n){let i=ba.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=ba.jupyterSettings.get(o);return s?s._type==="web"&&n==="node"&&(s._systemVariablesCtor=t,s._type=n):(s=new ba(i,t,n),ba.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?zn.workspace.getWorkspaceFolder(e):void 0,n=t?t.uri:void 0;!n&&Array.isArray(zn.workspace.workspaceFolders)&&zn.workspace.workspaceFolders.length>0&&(n=zn.workspace.workspaceFolders[0].uri);let i=n?zn.ConfigurationTarget.WorkspaceFolder:zn.ConfigurationTarget.Global;return{uri:n,target:i}}static dispose(){if(!Dr())throw new Error("Dispose can only be called from unit tests");ba.jupyterSettings.forEach(e=>e&&e.dispose()),ba.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(n=>e[n]=this[n]),e}update(e,t){let n=this.createSystemVariables(void 0),i=n.resolveAny(e.get("logging"));i&&(i.level=wde(i.level),this.logging?Object.assign(this.logging,i):this.logging=i);let o=n.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,o):this.experiments=o,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let s=(c,l)=>{let u=_x.fullSettingIds[c],p=u&&l.get(u)!==void 0?l.get(u):l.get(c),m=n.resolveAny(p);m!==void 0&&(this[c]=m)};this.getSerializableKeys().filter(c=>c!=="experiments"&&c!=="logging"&&c!=="kernelPickerType").forEach(c=>s(c,e)),t&&s("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(zn.workspace.workspaceFolders||[]).map(i=>i.uri.path),n=Array.from(ba.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)ba.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=zn.workspace.getConfiguration("jupyter",this._workspaceRoot),o=zn.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(zn.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(zn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=zn.workspace.getConfiguration("jupyter",this._workspaceRoot),n=zn.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,n),this.migrateSettings(t).catch(f))}async migrateSettings(e){await new _x(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};g([hv(1)],ba.prototype,"debounceChangeNotification",1);var gv=ba;function wde(r){switch(r){case"info":return 20;case"warn":return 30;case"off":return"off";case"debug":return 10;case"verbose":return 5;default:return 40}}var Bc=require("vscode");var Zk=class{async updateSectionSetting(e,t,n,i,o){let a={uri:i,target:o||Bc.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==Bc.ConfigurationTarget.Global&&(a=gv.getSettingsUriAndTarget(i));let c=Bc.workspace.getConfiguration(e,a.uri),l=c.inspect(t);l!==void 0&&(o===Bc.ConfigurationTarget.Global&&l.globalValue===n||o===Bc.ConfigurationTarget.Workspace&&l.workspaceValue===n||o===Bc.ConfigurationTarget.WorkspaceFolder&&l.workspaceFolderValue===n)||(await c.update(t,n,o),o&&await this.verifySetting(c,o,t,n))}async updateSetting(e,t,n,i){return this.updateSectionSetting("jupyter",e,t,n,i)}async verifySetting(e,t,n,i){if(Dr()&&!cS()){let o=0;do{let s=e.inspect(n);if(!s&&i===void 0||s&&i!==void 0&&(t===Bc.ConfigurationTarget.Global?s.globalValue:t===Bc.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var vv=class extends Zk{getSettings(e){return gv.getInstance(e,Wg,"node")}};vv=g([(0,QJ.injectable)()],vv);var Fn=k(Fl()),q8=k(FO()),J8=k(M()),$8=k(L8()),H8=require("util");var B8=k(M()),jp=k(require("vscode"));var W8=k(j8()),V8=require("vscode"),Gl=class{constructor(){this.requestOptions={};let e=V8.workspace.getConfiguration("http").get("proxy","");e&&(this.requestOptions={headers:{proxy:e}})}async downloadFile(e){return W8.fetch(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return E(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var XO="utf8",xv=class{constructor(){this.vscfs=jp.workspace.fs}arePathsSame(e,t){return Ii(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(n=>n[1]===jp.FileType.File).map(n=>jp.Uri.file(n[0]))}async copy(e,t,n){await this.vscfs.copy(e,t,n)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return Buffer.from(t).toString(XO)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){let n=typeof t=="string"?Buffer.from(t):t;return this.vscfs.writeFile(e,n)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new Gl().exists(e.toString());let n;try{n=await this.stat(e)}catch(i){return Ik(i)||x(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===jp.FileType.Unknown?n.type===jp.FileType.Unknown:(n.type&t)===t}async getFileHash(e){let t=await this.stat(e),n=`${t.ctime}-${t.mtime}`;return ca(n,"SHA-512")}};xv=g([(0,B8.injectable)()],xv);var G8=require("vscode");var zl=class extends xv{constructor(){super();this.globFiles=(0,H8.promisify)(q8.default)}createLocalWriteStream(t){return Fn.createWriteStream(t)}async createTemporaryLocalFile(t){let n=typeof t=="string"?t:t.fileExtension,i=t&&typeof t=="object"?t.prefix:void 0,o={postfix:n,prefix:i};return new Promise((s,a)=>{$8.file(o,(c,l,u,p)=>{if(c)return a(c);s({filePath:l,dispose:p})})})}async searchLocal(t,n,i){let o;n&&(o={...o,cwd:n}),i&&(o={...o,dot:i});let s=await this.globFiles(t,o);return Array.isArray(s)?s:[]}async writeLocalFile(t,n){return await Fn.ensureDir(ut(t)),Fn.writeFile(t,n)}async readFile(t){if(Fm(t)){let n=await Fn.readFile(Ee(t));return Buffer.from(n).toString(XO)}else return super.readFile(t)}async delete(t){Fm(t)?await this.exists(t)&&((await this.stat(t)).type===G8.FileType.Directory?await new Promise(i=>Fn.rm(Ee(t),{force:!0,recursive:!0},i)):await Fn.unlink(Ee(t))):await super.delete(t)}async exists(t,n){return Fm(t)?Fn.pathExists(Ee(t)):super.exists(t,n)}async createDirectory(t){Fm(t)?await Fn.ensureDir(Ee(t)):await this.vscfs.createDirectory(t)}async writeFile(t,n){if(Fm(t)){let i=Ee(t);return await Fn.ensureDir(ut(i)),Fn.writeFile(i,n)}else await this.vscfs.writeFile(t,typeof n=="string"?Buffer.from(n):n)}async copy(t,n,i){if(Fm(t)&&Fm(n)){let o=typeof i===void 0||typeof i?.overwrite==null?!0:i?.overwrite;await Fn.copy(Ee(t),Ee(n),{overwrite:o})}else await super.copy(t,n,i)}};zl=g([(0,J8.injectable)()],zl);function Fm(r){return r.scheme==="file"}var Kx=k(Fl());var z8=k(M()),Q8=require("vscode");var Cv=class extends WE{async computeWorkingDirectory(e){return Fx(e)}};Cv=g([(0,z8.injectable)()],Cv);async function Fx(r){let e=r&&r.scheme==="file"?await Kx.pathExists(r.fsPath):!1;return(r&&r.scheme==="file"?await Kx.pathExists(ut(r.fsPath)):!1)&&r&&r.fsPath.includes(".")?ut(r.fsPath):e&&r&&(await Kx.stat(r.fsPath)).isDirectory()?r.fsPath:r&&Q8.workspace.getWorkspaceFolder(r)?.uri.fsPath||Is()?.fsPath||process.cwd()}var Lm=k(M());var Y8=require("vscode");var wv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(Y8.commands.registerCommand(J.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};wv=g([(0,Lm.injectable)(),d(0,(0,Lm.inject)(Mo)),d(0,(0,Lm.named)(Ku)),d(1,(0,Lm.inject)(K))],wv);var Lx=k(M()),Z8=require("vscode");var X8=require("vscode");var Ev=class{constructor(e,t,n,i=[]){this.fs=e;this.disposableRegistry=t;this.options=n;this.loadFailedEmitter=new X8.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};n.webviewHost?(this.webviewHost=n.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),n=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString(),i="false";return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Ge.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${n}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return ${i};
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){x(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var ZO=class extends Ev{constructor(t,n,i,o=[]){super(t,n,i,o);this.panelOptions=i;this._onDidChangeVisibility=new Z8.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(n=>{this.panelOptions.listener.onMessage(n.type,n.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Pv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new ZO(this.fs,this.disposableRegistry,e)}};Pv=g([(0,Lx.injectable)(),d(0,(0,Lx.inject)(K)),d(1,(0,Lx.inject)(st))],Pv);var Dv=k(M()),sD=require("vscode");var eK=class extends Ev{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,n,i=[]){super(e,t,n,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return sD.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose().catch(f)})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},kv=class{constructor(e,t,n){this.disposableRegistry=e;this.fs=t;this.context=n}async create(e){let t=[sD.Uri.file(We(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new eK(this.fs,this.disposableRegistry,e,t)}};kv=g([(0,Dv.injectable)(),d(0,(0,Dv.inject)(K)),d(1,(0,Dv.inject)(st)),d(2,(0,Dv.inject)(ct))],kv);function e7(r){r.addSingleton(zl,zl),r.addBinding(zl,hr),r.addBinding(zl,st),r.addSingleton(IP,Cv),r.addSingleton(ae,vv),zV(r),j6(r),V6(r),JJ(r),r.addSingletonInstance(XU,Date.now()),r.addSingleton($o,$o),r.addSingleton(Ie,ft),r.addSingleton(Fh,wv),r.add(SP,Pv),r.add(fp,kv)}var Um=k(M()),s7=require("vscode");var Bp=k(M()),Rv=require("vscode");var Ux=k(M()),Ql=require("vscode");var _v=Symbol("IJupyterCommandFactory"),Wp=Symbol("IJupyterSubCommandExecutionService");function hme(r){r.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function tK(r,e){let t=e.displayName||e.envName||e.envPath?.fsPath||e.uri.fsPath,n=r.map(i=>fr.get(i)).filter(i=>!!i).map(i=>i);switch(n.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,n[0]):y.libraryRequiredToLaunchJupyterNotInstalled(n[0]);default:{let i=n.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${n.join(", ")} ${ge.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${n.join(", ")} ${ge.and} ${i}`)}}}var Os=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let n=new Ql.CancellationTokenSource;try{let i=e.envType==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=tK(s===!1?[27].concat(o):o,e);switch(A("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:fr.get(18),pythonEnvType:e.envType}),await Ql.window.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let l=o.filter(p=>p!==21);hme(l);let u=l.shift();for(;u;)if(await mr(n.token,2,this.installer.install(u,e,n,void 0,s===!1))===0){u=l.shift();continue}else return 2;return A("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return Ql.env.openExternal(Ql.Uri.parse(aS.PythonInteractiveHelpLink)),A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return A("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{n.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(n=>n.length===0)}async getDependenciesNotInstalled(e,t){let n=dn(e.uri);if(this.dependenciesInstalledInInterpreter.has(n))return[];let i=[];if(await mr(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(n),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(x("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await Ql.window.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};g([dv("InstallingMissingDependencies")],Os.prototype,"installMissingDependencies",1),Os=g([(0,Ux.injectable)(),d(0,(0,Ux.inject)(Mi)),d(1,(0,Ux.inject)(_v))],Os);var pD=k(M());var dD=require("vscode");var r7=require("vscode");function aD(r,e){let t=np(r),i={label:`${r.id===e.recommended?.id?"$(star-full) ":la(r)?"$(warning) ":""}${t}`};return i.description=V(r.executable.uri||r.path,r7.workspace.workspaceFolders||[],new Oc().homeDir),i.tooltip=la(r)?y.pythonCondaKernelsWithoutPython:"",i}function cD(r){switch(Jr(r)){case"Conda":return la(r)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var Ks=k(M()),n7=require("vscode");var lD="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",rK="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",Ia=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get(rK,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(lD,void 0);if(e)return n7.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(lD,e?.toString()).then(f,f),this.memento.update(rK,!0).then(f,f)}};Ia=g([(0,Ks.injectable)(),d(0,(0,Ks.inject)($e)),d(0,(0,Ks.named)(yt))],Ia);var Tv=class{constructor(e,t,n,i){this.api=e;this.memento=t;this.checker=n;this.disposables=i}activate(){this.activateBackground().catch(f),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(lD)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(lD,t),await this.memento.update(rK,!0)}};Tv=g([(0,Ks.injectable)(),d(0,(0,Ks.inject)(zt)),d(1,(0,Ks.inject)($e)),d(1,(0,Ks.named)(yt)),d(2,(0,Ks.inject)(ze)),d(3,(0,Ks.inject)(K))],Tv);var Ho=require("vscode");var nK=class{constructor(e){this.label=e}},uD=class extends nK{constructor(t,n){super(t);this.sortKey=n;this.kind=Ho.QuickPickItemKind.Separator}},Vp=class extends er{constructor(t,n,i,o,s,a){super();this.provider=t;this.createQuickPickItem=n;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=new Set;this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let n=this._recommended?.id!==t?.id;this._recommended=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let n=this._selected!==t;this._selected=t,n&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],n={iconPath:new Ho.ThemeIcon("refresh"),tooltip:ge.refresh},i=this.quickPick=Ho.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.buttons=this.options.supportsBack?[Ho.QuickInputButtons.Back,n]:[n],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>Q(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===n&&(i.busy=!0,await o.refresh().catch(f),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new Ho.Disposable(()=>s&&clearTimeout(s)));break}},this,t),i7(o.items.map(a=>this.toQuickPickItem(a)),(a,c)=>o7(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{let c=this.connectionToCategory(a[0].item);this.quickPickItems.push(c),a.sort((l,u)=>l.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(c,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>x(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.has(t)}addCommand(t,n){let i=t;return i.execute=n,this.commands.add(i),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{this.commands.delete(i)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:n,disposables:i}=this.createQuickPick();n.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{n.onDidChangeSelection(c=>{if(c.length){let l=c[0];this.isSelectorQuickPickItem(l)?s(l.item):this.isCommandQuickPickItem(l)?s(l):this.isErrorQuickPickItem(l)}}),n.onDidTriggerButton(c=>c===Ho.QuickInputButtons.Back?s(Ae.back):void 0,this,i),n.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof Ae)return o===Ae.back?Ae.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===Ae.back)continue;return s instanceof Ae,s}return o||void 0}finally{Q(i)}}}updateQuickPickItems(t,n){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(n.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let c=i.get(a.item.id);if(c&&c!==a.item)return this.toQuickPickItem(c);let l=o.get(a.item.id);if(l){let u=this.toQuickPickItem(l);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(l)}}return a});let s=n.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,n),i7(s,(a,c)=>o7(this.getCategory(a.item,this),this.getCategory(c.item,this))).forEach(a=>{a.sort((u,p)=>u.label.localeCompare(p.label));let c=this.connectionToCategory(a[0].item),l=this.quickPickItems.find(u=>u.kind===Ho.QuickPickItemKind.Separator&&u.label===c.label);if(l){let u=this.quickPickItems.indexOf(l),p=this.categories.get(l),m=new Map(Array.from(p).map(b=>[b.item.id,b])),h=p.size;a.forEach(b=>{let w=m.get(b.item.id);w&&p.delete(w),p.add(b)});let v=Array.from(p);v.sort((b,w)=>b.label.localeCompare(w.label)),this.quickPickItems.splice(u+1,h,...v)}else{let u=this.quickPickItems.filter(h=>h instanceof uD).map((h,v)=>[h,v]);u.push([c,-1]),u.sort((h,v)=>h[0].sortKey.localeCompare(v[0].sortKey));let p=u.findIndex(h=>h[1]===-1),m=0;p>0&&(m=u.length===p+1?this.quickPickItems.length:u[p+1][1]),a.sort((h,v)=>h.label.localeCompare(v.label)),this.quickPickItems.splice(m,0,c,...a),this.categories.set(c,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];n&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:Ho.QuickPickItemKind.Separator},n);let o=n;o=this.selected?this.quickPickItems.filter(p=>this.isSelectorQuickPickItem(p)).map(p=>p).find(p=>p.item.id===this.selected?.id):o;let s=this.quickPickItems.filter(p=>!this.isSelectorQuickPickItem(p)||p.item.id!==n?.item?.id),a=t.activeItems.length?t.activeItems[0]:void 0;o&&a&&(this.isSelectorQuickPickItem(a)?a.item.id!==o.item.id&&(o=void 0):o=void 0);let c=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,l=[].concat(Array.from(this.commands.values())).concat(i).concat(s).concat(c?[c]:[]),u=o?[o]:t.activeItems.length?[t.activeItems[0]]:[];if(u.length&&!l.includes(u[0])){let p=u[0],m=this.isSelectorQuickPickItem(p)&&l.find(h=>this.isSelectorQuickPickItem(h)&&h.item.id===p.item.id);m?u[0]=m:u.length=0}t.items=l,t.activeItems=u,!t.activeItems.length&&this.previouslySelectedItem&&l.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let n=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(n),n}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let n=this.createQuickPickItem(t,this);return n.item=t,this.quickPickItemMap.add(n),n}removeOutdatedQuickPickItems(t,n){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(n.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((c,l)=>{c.forEach(u=>{s.includes(u.item.id)&&(c.delete(u),a.push(u))}),c.size||(a.push(l),this.categories.delete(l))}),this.quickPickItems=this.quickPickItems.filter(c=>!a.includes(c)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let n=this.getCategory(t,this);return new uD(n.label,n.sortKey||n.label)}};function i7(r,e){let t=[],n;for(let i of r.slice(0).sort(e))!n||e(n[0],i)!==0?(n=[i],t.push(n)):n.push(i);return t}function o7(r,e){return(r.sortKey||r.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var Yl=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(Qe).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new dD.CancellationTokenSource,t=new Oc,n=this.serviceContainer.get(Ia).selectedPythonPath,i=_e.instance.get(ai),o=_e.instance.get(Ms).withFilter(u=>!la(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Oo(u.executable.uri,n,t.osType)),a=n?y.currentlySelectedJupyterInterpreterForPlaceholder(V(n,dD.workspace.workspaceFolders||[],t.homeDir)):"",c=[],l=new Vp(Promise.resolve(o),aD,cD,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);l.placeholder=a,l.selected=s(),c.push(l),c.push(e);try{if(!l.selected&&n){let p=o.onDidChange(()=>{l.selected=s(),l.selected&&p.dispose()});c.push(p)}let u=await l.selectItem(e.token);return!u||u instanceof Ae?void 0:u}catch(u){x("Failed to select a Python Environment to start Jupyter",u)}finally{Q(c)}}};Yl=g([(0,pD.injectable)(),d(0,(0,pD.inject)(lt))],Yl);var li=class{constructor(e,t,n,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=n;this.interpreterService=i;this._onDidChangeInterpreter=new Rv.EventEmitter;Rv.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),n=t;if(!n&&(n=await this.interpreterService.getActiveInterpreter(void 0),!n))return e&&await Rv.window.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(n,e);return i===1?(n=await this.selectInterpreter(),n?0:2):(i===0&&n!==t&&await this.setAsSelectedInterpreter(n),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let n=await mr(t,this.interpreterService.getInterpreterDetails(e));if(n&&await this.interpreterConfiguration.areDependenciesInstalled(n,t))return n}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let n=await this.interpreterService.getActiveInterpreter(void 0);n&&await this.interpreterConfiguration.areDependenciesInstalled(n,e)&&(t=n)}return t}};li=g([(0,Bp.injectable)(),d(0,(0,Bp.inject)(Ia)),d(1,(0,Bp.inject)(Yl)),d(2,(0,Bp.inject)(Os)),d(3,(0,Bp.inject)(Qe)),d(4,(0,Bp.inject)(K))],li);var mD=Symbol("IKernelLauncher"),ui=Symbol("IRawNotebookSupportedService"),fD=Symbol("IRawKernelSessionFactory");var Av=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=n;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(s7.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){_t(e)&&(this.notebookOpened=!0,A("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",sV(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(f)}};Av=g([(0,Um.injectable)(),d(0,(0,Um.inject)(li)),d(1,(0,Um.inject)(K)),d(2,(0,Um.inject)(ui)),d(3,(0,Um.inject)(ze))],Av);var hD=k(M()),a7=require("vscode");var Xr=class{static dispose(){Q(Xr.disposables)}constructor(e){e.push({dispose:()=>{Xr.dispose()}})}activate(){a7.workspace.onDidChangeNotebookDocument(e=>{_t(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let n=Xr.cellToDisplayIdMapping.get(t.cell);n&&(Xr.cellToDisplayIdMapping.delete(t.cell),Xr.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(n))})})}static trackOutputByDisplayId(e,t,n,i){let o=Xr.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,Xr.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:n,cell:e,outputItems:i}),Xr.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let n=Xr.displayIdCellOutputMappingPerDocument.get(e);if(!n)return;let i=n.get(t);return i?.cell.document.isClosed?void 0:i}};Xr.displayIdCellOutputMappingPerDocument=new WeakMap,Xr.cellToDisplayIdMapping=new WeakMap,Xr.disposables=[],Xr=g([(0,hD.injectable)(),d(0,(0,hD.inject)(K))],Xr);var jm=k(M());var iK="Active_Kernel_Id_List",gme=100,Go=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(iK,[]);if(t.length){let n=await this.crypto.createHash(e.toString()),i=t.find(o=>o.fileHash===n);return E(`Preferred Remote kernel for ${V(e)} is ${i?.kernelId}`),i?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let n=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(iK,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(n=!0,i.splice(s,1)),t&&(n=!0,i.push({fileHash:o,kernelId:t}),E(`Storing Preferred remote kernel for ${V(e)} is ${t}`));i.length>gme;)n=!0,i.shift();n&&await this.globalMemento.update(iK,i)}};Go=g([(0,jm.injectable)(),d(0,(0,jm.inject)($e)),d(0,(0,jm.named)(yt)),d(1,(0,jm.inject)(Kh))],Go);var Mv=k(M()),oK=require("vscode");var vme=1e3,Nv=class{constructor(e,t,n){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.monitoredKernels=new WeakSet;this.timeouts=new Set;n.push(this)}dispose(){Q(this.disposables),Q(Array.from(this.timeouts.values()))}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.kernelProvider.onDidRestartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){let t=e.kernelConnectionMetadata;if(!Ut(t)||this.monitoredKernels.has(e))return;this.monitoredKernels.add(e);let n=[];this.disposables.push(new oK.Disposable(()=>Q(n)));let i=()=>{if(Q(n),e.disposed||e.disposing)return;let o=setTimeout(()=>{this.serverStorage.update(t.serverProviderHandle).catch(f)},vme);n.push(new oK.Disposable(()=>clearTimeout(o)))};this.kernelProvider.getKernelExecution(e).onPreExecute(i,this,this.disposables),i()}};Nv=g([(0,Mv.injectable)(),d(0,(0,Mv.inject)(Zt)),d(1,(0,Mv.inject)(Fe)),d(2,(0,Mv.inject)(K))],Nv);var Sa=k(M()),jx=require("vscode");var c7=require("vscode"),Yt=class{constructor(e){this._event=new c7.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}};var yme="last-python-notebook-created",l7="last-notebook-created",Ov=class{constructor(e,t,n,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=n;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;jx.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,n)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(l7);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(f)}shouldAutoStartStartServer(e){if(!e)return!1;let n=new Date().getTime()-e.getTime();return Math.floor(n/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!jx.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new jx.CancellationTokenSource,t=new Yt(!0);try{H("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(n){x("Error starting server in serverPreload: ",n)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){_t(e)&&this.createServerIfNecessary().catch(f)}kernelStarted(e){let t=Di(e.kernelConnectionMetadata);this.mementoStorage.update(l7,Date.now()).then(f,f),t===xe&&this.mementoStorage.update(yme,Date.now()).then(f,f)}};Ov=g([(0,Sa.injectable)(),d(0,(0,Sa.inject)(ae)),d(1,(0,Sa.inject)(lP)),d(2,(0,Sa.inject)(K)),d(3,(0,Sa.inject)(ui)),d(4,(0,Sa.inject)($e)),d(4,(0,Sa.named)(ri)),d(5,(0,Sa.inject)(Fe))],Ov);var bo=k(M());var Fs=k(M());var Yi=class extends Xe{constructor(e){super("jupyterinstall",e)}};var Rr=require("vscode");var Wm=class extends Pn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(pt(e)),e)}};var qp=class extends pc{constructor(t,n,i,o){super(t,i,o);this.stdErr=n}};var Kv=class extends Pn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(pt(e)),e)}};var Jp=class extends Pn{constructor(t=-1,n,i){super("kerneldied",y.kernelDied(n.trim()),i);this.exitCode=t;this.stdErr=n}};var Vm=class extends Pn{constructor(t,n){super("noipykernel",y.kernelInvalid(pt(n)),n);this.reason=t}};var $p=class extends pc{constructor(e){super(y.kernelDiedWithoutError(pt(e)),void 0,e)}};var gD=class extends Xe{constructor(e){super("jupyterexpiredcert",e)}};var Hp=class extends Xe{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var vD=new Map,aK=new Map,sK;function u7(r){sK=r}function cK(r,e){if(!r.pythonEnvironmentPath)return;let t=ce();bme({interpreterHash:r.pythonEnvironmentPath}).then(n=>{r.pythonEnvironmentPackages=n||r.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=n||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function bme(r){if(!sK)return x("Python package provider is not initialized."),"{}";let e;if("interpreter"in r?e=r.interpreter:e=aK.get(r.interpreterHash),!e)return"{}";let t=await sK(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function p7(r){if(!r)return{};let e=vD.get(dn(r)),t=$i(r);if(!e&&t)return{resourceType:t,resourceHash:r?await ht(r.toString()):void 0};if(!e)return{};let n=JSON.parse(JSON.stringify(e[0]));return cK(e[0],n),n}function Tt(r,e,t,n,i){p7(r).then(o=>{Object.assign(o,n||{}),A(e,t,o,i)}).catch(f)}var Xl=class extends Xe{constructor(t,n,i){super("jupyternotebooknotinstalled",t+(n?`
${n}`:""));this.interpreter=i}};var d7=new Map;function yD(r,e){d7.set(Wt(r),e)}function Fv(r,e,t){let n=e.jupyterCollections.find(i=>i.extensionId===r.extensionId&&i.id===r.id);return d7.get(Wt(r))||n?.label||t||`${r.id}:${r.handle}`}var Uv=class{constructor(e,t,n,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=n;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(j("DataScience Error",e),e=sn.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof Yi)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof No)await EE(this.configuration,e.message);else if(e instanceof gD)await PE(this.configuration,e.message);else if(!dr(e))if(e instanceof Wm||e instanceof Kv)Rr.window.showErrorMessage(e.message).then(f,f);else if(e instanceof qp||e instanceof Jp||e instanceof Xl||e instanceof vs)Rr.window.showErrorMessage(Lv(e)).then(f,f);else if(e instanceof Pi&&Br())Rr.window.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(f,f);else if(e instanceof Pi){let t=await this.handleJupyterServerConnectionError(e,void 0);Rr.window.showErrorMessage(t).then(f,f)}else if(e instanceof Zu){let t=await this.handleJupyterServerUriProviderError(e,void 0);Rr.window.showErrorMessage(t).then(f,f)}else{let t=m7(e.message||e.toString());Rr.window.showErrorMessage(t).then(f,f)}}}async getErrorMessageForDisplayInCell(e,t,n){if(e=sn.unwrap(e),dr(e)||x("Error in execution (get message for cell)",e),e instanceof $p)return"";if(e instanceof Vm)return lK(e.kernelConnectionMetadata)||e.message;if(e instanceof Yi)return xme(e)||e.message;if(e instanceof Pi&&!Br())return e.message;if(e instanceof Pi&&Br())return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(dr(e))return"";if(e instanceof Qg){let i=typeof e.product=="string"?e.product:fr.get(e.product)||`${e.product}`,o=np(e.interpreter)||e.interpreter.id||"",s=V("executable"in e.interpreter?e.interpreter.executable.uri:e.interpreter.uri),a=o?` ${o} (${s})`:s;return y.packageNotInstalledWindowsLongPathNotEnabledError(i,a)}else{if((e instanceof qp||e instanceof Jp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(e.kernelConnectionMetadata.interpreter.displayName||e.kernelConnectionMetadata.interpreter.envName||V(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof qp||e instanceof Jp)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0))return lK(e.kernelConnectionMetadata)||e.message;if(e instanceof Pn||e instanceof pc){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n),o=im(Rr.workspace.workspaceFolders||[],e,pt(e.kernelConnectionMetadata),e.kernelConnectionMetadata.interpreter?.sysPrefix,i.map(s=>s.uri));if(o){if(o.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(o.moduleName))return lK(e.kernelConnectionMetadata)||e.message;let s=[o.message];return o.moreInfoLink&&s.push(ge.clickHereForMoreInfoWithHtml(o.moreInfoLink)),dt(e.kernelConnectionMetadata)&&o.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(o.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(s,n),s.join(`
`)}}else{if(e instanceof Pi)return this.handleJupyterServerConnectionError(e,t);if(e instanceof Zu)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof Hp){let i=Rr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return Lv(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(i),t)}}}return Lv(e,t)}async handleJupyterServerUriProviderError(e,t){let n=await Fv(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return Lv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerConnectionError(e,t){let n=await Fv(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return Lv(y.remoteJupyterConnectionFailedWithServerWithError(n,i),t)}async handleJupyterServerProviderConnectionError(e,t){let n=new Rr.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(f)),!0}catch{return!1}finally{n.dispose()}}async handleKernelError(e,t,n,i,o){if(dr(e)||j(`Kernel Error, context = ${t}`,e),e=sn.unwrap(e),dr(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof Vm)if(j(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new Rr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof Yi)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof Pi||e instanceof Zu||e instanceof Hp){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof Hp?"":e instanceof Pi?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,c=e.serverProviderHandle.id,l=this.jupyterUriProviderRegistration.jupyterCollections.find(b=>b.extensionId===a&&b.id==c);if(!l||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,l))return 3;let u=e instanceof Pi?e.baseUrl:"",p=Fv(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),m=e instanceof Hp?Rr.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",h=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await Rr.window.showErrorMessage(e instanceof Hp?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(m):y.remoteJupyterConnectionFailedWithServer(p),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...h)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(f),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof No){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return Rr.window.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(c=>{c===s?(A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,Rr.ConfigurationTarget.Workspace).catch(f)):c===a&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(f,f),2}else{if((t==="start"||t==="restart")&&n.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(n.interpreter.uri))return this.interpreterService.getInterpreterDetails(n.interpreter.id).then(async s=>{let a=await this.fs.exists(n.interpreter.uri);s?Tt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"Unknown",isEmptyCondaEnv:s.isCondaEnvWithoutPython,pythonEnvType:s.envType,fileExists:a}):Tt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"EmptyEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:a})}).catch(async()=>{let s=await this.fs.exists(n.interpreter.uri);Tt(i,"DATASCIENCE.KERNEL_START_FAILURE_MISSING_ENV",void 0,{envMissingReason:"FailedToGetEnvDetailsFromPython",isEmptyCondaEnv:n.interpreter.isCondaEnvWithoutPython,pythonEnvType:n.interpreter.envType,fileExists:s})}).catch(f),this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),Rr.window.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(n.interpreter.displayName||n.interpreter.envName||V(n.interpreter.uri))).then(f,f),this.interpreterService.refreshInterpreters(!0).catch(f),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(n,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new Rr.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:n,ui:new Yt(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let s=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),a=im(Rr.workspace.workspaceFolders||[],e,pt(n),n.interpreter?.sysPrefix,s.map(c=>c.uri));return this.sendKernelTelemetry(e,t,i,a?.reason),a?this.showMessageWithMoreInfo(a.message,a?.moreInfoLink).catch(f):this.showMessageWithMoreInfo(Lv(e,t)).catch(f),2}}}}sendKernelTelemetry(e,t,n,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&Tt(n,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(J.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let n=t?[ge.learnMore]:[];await Rr.window.showErrorMessage(e,...n).then(i=>{i===ge.learnMore&&t&&Rr.env.openExternal(Rr.Uri.parse(t))})}};Uv=g([d(0,(0,Fs.inject)(Yu)),d(0,(0,Fs.optional)()),d(1,(0,Fs.inject)(ae)),d(2,(0,Fs.inject)(Ps)),d(2,(0,Fs.optional)()),d(3,(0,Fs.inject)(Zt)),d(4,(0,Fs.inject)(Gt)),d(5,(0,Fs.inject)(st)),d(6,(0,Fs.inject)(Qe)),d(6,(0,Fs.optional)())],Uv);var Ime={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function Lv(r,e){r=typeof r=="string"?r:sn.unwrap(r);let t=e?Ime[e]:"",n="";return r instanceof Xl?n=y.jupyterNotebookNotInstalledOrNotFound(r.interpreter):r instanceof Xe?n=SE(r.stdErr)||r.stdErr||r.message:n=typeof r=="string"?r:r.message,m7(t,n)}function Sme(r){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(r)?.length??0)>0}function m7(r="",e=""){r&&e.startsWith(r.substring(0,r.length-1))&&(r="");let t=[r,e].map(n=>n.trim()).filter(n=>n.length>0).join(` 
`);return!Sme(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function lK(r){if(r.kind==="connectToLiveRemoteKernel"||r.kind==="startUsingRemoteKernelSpec"||!r.interpreter)return;let e=r.interpreter.displayName||Ee(r.interpreter.uri),t=fr.get(19),n=Qi(19),i=`${hS(Ee(r.interpreter.uri))} -m pip install ${n} -U --force-reinstall`;r.interpreter?.envType==="Conda"?r.interpreter?.envName?i=`conda install -n ${r.interpreter?.envName} ${n} --update-deps --force-reinstall`:r.interpreter?.envPath&&(i=`conda install -p ${Ee(r.interpreter?.envPath)} ${n} --update-deps --force-reinstall`):r.interpreter?.envType==="Unknown"&&(i=`${hS(Ee(r.interpreter.uri))} -m pip install ${n} -U --user --force-reinstall`);let o=y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(e,fr.get(19)),s=y.installPackageInstructions(t,i);return o+`
`+s}function xme(r){let e=`${fr.get(18)} ${ge.and} ${fr.get(20)}`,t=[18,20].map(Qi).join(" "),n=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,n);return r.message+`
`+i+`
`+ge.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var jv=class extends Uv{constructor(t,n,i,o,s,a,c,l){super(t,n,i,o,s,c,l);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,n){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(n);if(i.length>0){let o=n?Si(n):void 0,s=i.map(c=>{if(c.type==="file"){let l=n?V(c.uri,[],o):mn(c.uri);return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}else{let l=n?V(c.uri,[],o):`${mn(Si(c.uri))}/__init__.py`;return`<a href='${c.uri.toString()}?line=1'>${l}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${ge.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(ge.clickHereForMoreInfoWithHtml(xJ))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Si(t)):[]}};jv=g([(0,bo.injectable)(),d(0,(0,bo.inject)(Yu)),d(0,(0,bo.optional)()),d(1,(0,bo.inject)(ae)),d(2,(0,bo.inject)(Ps)),d(2,(0,bo.optional)()),d(3,(0,bo.inject)(Zt)),d(4,(0,bo.inject)(Gt)),d(5,(0,bo.inject)(Bk)),d(6,(0,bo.inject)(st)),d(7,(0,bo.inject)(Qe))],jv);var ID=k(M());var Wx=class{constructor(e,t,n,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=n;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>n.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let n={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,n)}},uK=class extends Wx{constructor(e,t,n,i){super(e,t,n,i)}},pK=class extends Wx{constructor(e,t,n,i){super(e,t,n,i)}async exec(e,t){let n,i={stdout:""};try{i=await super.exec(e,t)}catch(a){n=a}if(!i.stderr&&!n)return i;let o=()=>{if(n)throw x("Exception attempting to enumerate kernelspecs: ",n),n;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){x("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We(qo,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We(qo,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Wv=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,n,i){return e==="notebook"?new uK(t,n,this.executionFactory,i):e==="kernelspec"?new pK(t,n,this.executionFactory,i):new Wx(t,n,this.executionFactory,i)}};Wv=g([(0,ID.injectable)(),d(0,(0,ID.inject)(Or))],Wv);var Vx=k(M());var f7=require("vscode");var Vv=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(f7.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(f)}))}};Vv=g([(0,Vx.injectable)(),d(0,(0,Vx.inject)(li)),d(1,(0,Vx.inject)(K))],Vv);var Ls=k(M());var zo=k(M());var wr=require("vscode");var h7=k(Fl()),g7=require("vscode");async function SD(r){try{let e=await h7.realpath(r.fsPath);return qr()!="Windows"&&(e=e.replace(/\\/g,"/")),g7.Uri.file(e)}catch{return r}}var Cme=We("AppData","Roaming","jupyter","kernels"),v7=We(".local","share","jupyter","kernels"),y7=We("Library","Jupyter","kernels"),wme=We("AppData","Roaming","jupyter","runtime"),Eme=We("Library","Jupyter","runtime"),b7=We("share","jupyter","kernels"),xD="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",dK="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",Kr=class{constructor(e,t,n,i,o,s,a,c){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.interpreters=c;this.cachedDataDirs=new Map;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,n)}async getKernelSpecTempRegistrationFolder(){let e=sr(this.context.extensionUri,"temp","jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?SD(sr(t,Cme)):this.platformService.isMac?sr(t,y7):sr(t,v7)})(),this.cachedKernelSpecRootPath.then(t=>{E(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(f),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e,t=this.platformService.homeDir;if(t&&(this.platformService.isWindows?e=await SD(sr(t,wme)):this.platformService.isMac?e=sr(t,Eme):e=process.env.$XDG_RUNTIME_DIR?wr.Uri.file(We(process.env.$XDG_RUNTIME_DIR,"jupyter","runtime")):sr(t,".local","share","jupyter","runtime")),!e){x("Failed to determine Jupyter runtime directory");return}try{return await this.fs.createDirectory(e),e}catch(n){x(`Failed to create runtime directory, reverting to temp directory ${e}`,n)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let n=new lo,i=await this.getJupyterPaths();for(let p of i)p&&!n.has(p)&&n.set(p,n.size);if(t)try{re(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let p=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),m=wr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),h=await p.exec([m.fsPath],{});if(h.stdout.trim().length){let v=wr.Uri.file(h.stdout.trim());await this.fs.exists(v)?n.has(v)||n.set(v,n.size):j(`Got a non-existent Jupyter Data Dir ${v}`)}else j(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${h.stderr}`)}catch(p){x(`Failed to get DataDir based on ENABLE_USER_SITE for ${t.displayName}`,p)}if(t&&!t.sysPrefix){j(`sysPrefix was not set for ${t.id}`);let p=await this.interpreters.getInterpreterDetails(t.uri);t.sysPrefix=p?.sysPrefix||t.sysPrefix,re(`sysPrefix after getting details ${t.sysPrefix}`)}let o=t?.sysPrefix?wr.Uri.joinPath(wr.Uri.file(t.sysPrefix),"share","jupyter"):void 0,s=this.getSystemJupyterPaths(),a=o?new kc(s).has(o)?void 0:o:void 0,c=this.getJupyterDataDir(),l=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(l)?[c,a].forEach(p=>{p&&!n.has(p)&&n.set(p,n.size)}):[a,c].forEach(p=>{p&&!n.has(p)&&n.set(p,n.size)}),s.forEach(p=>{p&&!n.has(p)&&n.set(p,n.size)}),Array.from(n.entries()).sort((p,m)=>p[1]-m[1]).map(p=>p[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?wr.Uri.file(bn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?wr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?bn(process.env.PROGRAMDATA):void 0;return e?[wr.Uri.joinPath(wr.Uri.file(e),"jupyter")]:[]}else return[wr.Uri.file("/usr/local/share/jupyter"),wr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return wr.Uri.file(bn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return wr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?wr.Uri.file(bn(process.env.APPDATA)):"";if(e)return wr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?wr.Uri.joinPath(t,"data"):wr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let n=process.env.XDG_DATA_HOME?wr.Uri.file(bn(process.env.XDG_DATA_HOME)):wr.Uri.joinPath(this.platformService.homeDir,".local","share");return wr.Uri.joinPath(n,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Be,n=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:n,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===n&&(this.cachedKernelSpecRootPaths=void 0)},this);return n.finally(()=>i.dispose()).catch(f),n}async getKernelSpecRootPathsImpl(e){let t=new kc(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let n=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];n&&t.add(n),process.env.PROGRAMDATA&&t.add(wr.Uri.file(We(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let n=this.platformService.isMac?y7:v7;t.add(wr.Uri.file(We("/","usr","share","jupyter","kernels"))),t.add(wr.Uri.file(We("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(sr(this.platformService.homeDir,n))}return E(`Kernel Spec Root Paths, ${Array.from(t).map(n=>V(n)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(f,f)},f),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let n=new kc,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(Jn).map(s=>t?We(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>SD(wr.Uri.file(a))))).forEach(a=>{a&&n.add(a)}),E(`Jupyter Paths ${V(t)}: ${Array.from(n).map(s=>V(s))}`),Array.from(n)}getCachedPaths(){return this.globalState.get(dK,[]).map(e=>wr.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(dK,[]),n=e.map(wr.Uri.toString);t.join(",")!==n.join(",")&&await this.globalState.update(dK,n)}getCachedRootPath(){if(this.globalState.get(xD)){let e=this.globalState.get(xD);if(e)return wr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update(xD,e.toString()).then(f,f):this.globalState.update(xD,void 0).then(f,f)}};g([ti("getDataDirsImpl",7),d(1,Pl("id"))],Kr.prototype,"getDataDirsImpl",1),g([d(0,Hu())],Kr.prototype,"getJupyterPathKernelPaths",1),Kr=g([(0,zo.injectable)(),d(0,(0,zo.inject)(Cr)),d(1,(0,zo.inject)(Ec)),d(2,(0,zo.inject)(K)),d(3,(0,zo.inject)($e)),d(3,(0,zo.named)(yt)),d(4,(0,zo.inject)(hr)),d(5,(0,zo.inject)(ct)),d(6,(0,zo.inject)(Or)),d(7,(0,zo.inject)(Qe))],Kr);var Bm=class{constructor(e,t,n,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=n;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let n=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return n.length===0?"":n.length===1&&n[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):tK(n,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let n=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage(yn(n.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:n}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,n)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(Jn).filter(l=>l.trim().length);a.push(Si(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(Jn)},E(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(Jn)}`),E(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let c=Object.keys(s).filter(l=>l.toLowerCase()==="path");if(c.length){let l=c.map(u=>`${u}=${s[u]}`).join(",");E(`Start Jupyter Notebook with PATH variable. ${l}`)}else x("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),n=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=We(qo,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await n.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(c){j("Failed to parse JSON when getting server info out from getServerInfo.py",c);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let n=await this.getReasonForJupyterNotebookNotBeingSupported();throw new Yi(n)}return t}};Bm=g([(0,Ls.injectable)(),d(0,(0,Ls.inject)(li)),d(1,(0,Ls.inject)(Qe)),d(2,(0,Ls.inject)(Os)),d(3,(0,Ls.inject)(Or)),d(4,(0,Ls.inject)(Mo)),d(4,(0,Ls.named)(ah)),d(5,(0,Ls.inject)(Kr)),d(6,(0,Ls.inject)(ks))],Bm);var CD=k(M());var qm=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,n,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=n?[e.fsPath,"--to","python","--stdout","--template",n]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw x("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};g([dv("ExportNotebookToPython")],qm.prototype,"exportNotebookToPython",1),qm=g([(0,CD.injectable)(),d(0,(0,CD.inject)(Or))],qm);var Bx=k(M());var Bv=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new kc}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let n=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return n===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),n}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return $E(i.stdout)}};Bv=g([(0,Bx.injectable)(),d(0,(0,Bx.inject)(Mi)),d(1,(0,Bx.inject)(_v))],Bv);var Hm=k(M());var qv=require("vscode");var Gp=k(M());var I7=require("vscode");async function Xi(r,e){if(!r)return;let t=dn(r),[n,i]=vD.get(t)||[{resourceType:$i(r),resourceHash:r?await ht(r.toString()):void 0,kernelSessionId:await ht(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(n.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(n.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(n.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(n.userExecutedCell=e.userExecutedCell,n.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(n.kernelSessionId=await ht(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=xe;break;default:break}let c="kernelSpec"in o&&o.kernelSpec.specFile?ht(o.kernelSpec.specFile):Promise.resolve("");n.kernelLanguage=a,[n.kernelId,n.kernelSpecHash]=await Promise.all([ht(o.id),c]),i.previouslySelectedKernelConnectionId=o.id;let l=o.interpreter;if(l){if(n.isUsingActiveInterpreter=ya.isActiveWorkspaceInterpreter(r,l),n.pythonEnvironmentType=l.envType,n.pythonEnvironmentPath=await ht(Ee(gc(l.uri))),aK.set(n.pythonEnvironmentPath,l),l.version){let{major:u,minor:p,patch:m}=l.version;n.pythonEnvironmentVersion=`${u}.${p}.${m}`}else n.pythonEnvironmentVersion=void 0;cK(n)}n.kernelConnectionType=n.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";vD.set(t,[n,i])}async function Qo(r,e){await Xi(r,{kernelConnection:e,userExecutedCell:!0})}var xa=class{constructor(e,t,n,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=n;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,n,i){let o=n.env&&Object.keys(n.env).length>0?n.env:void 0,s=(n.language||"").toLowerCase()===xe;if(!t&&n.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(I7.Uri.file(n.interpreterPath),i).catch(u=>{x("Failed to fetch interpreter information for interpreter that owns a kernel",u)})),i?.isCancellationRequested)return;let[a,c]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(f),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(u=>{x("Failed to get env variables for interpreter, hence no variables for Kernel",u)}):void 0]);if(i?.isCancellationRequested)return;await Xi(e,{capturedEnvVars:Object.keys(c||{}).length>0}),!c&&Object.keys(a||{}).length===0&&E("No custom variables nor do we have a conda environment");let l={...process.env};return process.platform==="win32"&&(l={},Object.keys(process.env).forEach(u=>{l[u.toUpperCase()]=process.env[u]})),o=o||{},a=a||{},s||t?(c=c||a,Object.assign(l,c,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(H(`Adding env Variable PYTHONNOUSERSITE to ${V(t?.uri)}`),l.PYTHONNOUSERSITE="True"),s&&(l.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,l),this.envVarsService.mergeVariables(a,l)),E(`Kernel Env Variables for ${n.specFile||n.name}, PATH value is ${l.PATH}`),l}};xa=g([(0,Gp.injectable)(),d(0,(0,Gp.inject)(Qe)),d(1,(0,Gp.inject)(ks)),d(2,(0,Gp.inject)(wc)),d(3,(0,Gp.inject)(Ec)),d(4,(0,Gp.inject)(ae))],xa);var S7=require("vscode");async function x7(r,e,t){if(!t.interpreter||!Kt(t)||!r.kernel||r.kernel.status==="dead"||r.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let n=new Be;try{let i=await hn(r.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=Cs(o.text).trim().toLowerCase(),a=Oo(t.interpreter.uri,S7.Uri.file(s));await Xi(e,{interpreterMatchesKernel:a})}catch(i){x(`Failed to compare interpreters after ${n.elapsedTime}ms`,i)}E(`End sendTelemetryForPythonKernelExecutable after ${n.elapsedTime}ms`)}function Pme(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:r;return wD(t.argv[0])}function Jm(r){let e="kernelSpec"in r?r:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!dt(e))return!1;let t=e?e.kernelSpec:r;if(t.language&&t.language.toLowerCase()!==xe||!Pme(r))return!1;let n=t.argv.indexOf("-m");if(n===-1)return!1;let i=t.argv.length-1>=n?t.argv[n+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function wD(r){return r=De(r).trim().toLowerCase(),r==="python"||r==="python3"||r==="python.exe"||r==="python3.exe"}var $m=class{constructor(e,t,n,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=n;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,n,i,o){if(E(`Check if a kernel ${t.id} is usable`),Jm(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new Vm(a,t);default:break}}var s=void 0;dt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(qv.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&De(ut(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(E(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):E(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let n=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=sr(n,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return H(`Kernel spec file for ${e.id} already exists ${V(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!Dp(Ee(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:Rl(e.interpreter)}),H(`RegisterKernel for ${e.id} into ${V(i)}`),E(`RegisterKernel for ${e.id} into ${V(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=ut(s),c=ut(i.fsPath),l=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(l.map(async u=>{let p=We(a,u),m=We(c,u);await this.fs.copy(qv.Uri.file(p),qv.Uri.file(m))}))}return i.fsPath}async updateKernelEnvironment(e,t,n,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),c=s;if(n&&a){let l=De(n).toLowerCase()===s.name.toLowerCase()?n:sr(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(qv.Uri.file(l))){j(`Spec file for ${t.id} does not exist ${l} hence not updating env vars.`);return}let u=qv.Uri.file(l);try{let p=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(p.metadata?.interpreter?(Jm(s)&&(E(`Python KernelSpec argv[0] updated for ${t.id} from '${p.argv[0]}' to '${V(o.uri)}'`),p.argv[0]=o.uri.fsPath),p.metadata=p.metadata||{},p.metadata.interpreter=o):E(`KernelSpec argv[0] not updated for ${t.id} ('${p.argv[0]}')`),p.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,c),p=yV(p),await this.fs.writeFile(u,JSON.stringify(p,void 0,2)),E(`Updated kernel spec for ${t.id} with environment variables for ${V(u)}`),i?.isCancellationRequested))return;c.metadata=p.metadata}catch(p){if(i?.isCancellationRequested)return;throw x(`Failed to update kernel spec for ${t.id} with environment variables for ${V(u)}`,p),p}}else j(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};g([gh("Failed to register an interpreter as a kernel")],$m.prototype,"registerKernel",1),$m=g([(0,Hm.injectable)(),d(0,(0,Hm.inject)(Ps)),d(1,(0,Hm.inject)(hr)),d(2,(0,Hm.inject)(Kr)),d(3,(0,Hm.inject)(xa))],$m);var qx=k(M());var C7=require("vscode");var Jv=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return j(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let n=new C7.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(n.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(j(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return j(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{n.dispose()}}};Jv=g([(0,qx.injectable)(),d(0,(0,qx.inject)(nm)),d(1,(0,qx.inject)(Gt))],Jv);var T7=k(Io()),ED=require("vscode"),Us=k(M());var $v=class extends Pn{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var Hv=class{constructor(e,t,n,i,o,s){this.interpreterService=e;this.disposableRegistry=t;this.configuration=i;this.notebookStarter=o;this.jupyterInterpreterService=s;this.disposed=!1;this._disposed=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),ED.workspace.onDidChangeConfiguration(a=>{a.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),n.push(this)}async dispose(){H("Disposing HostJupyterExecution"),this._disposed||(this._disposed=!0,E("Disposing super HostJupyterExecution"),this.disposed=!0,E("Cleaning up server cache"),await this.cache?.then(e=>e.dispose()).catch(f)),E("Finished disposing HostJupyterExecution")}async startServer(e,t){if(this._disposed)throw new Error("Notebook server is disposed");if(!this.cache){let n=this.cache=this.startJupyterWithRetry(e,t);n.catch(i=>{x("Failed to start the Jupyter Server",i),this.cache===n&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(e){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(e):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(e){return!this.usablePythonInterpreter&&!this.disposed&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await ar(e,this.jupyterInterpreterService.getSelectedInterpreter(e))),this.usablePythonInterpreter}startJupyterWithRetry(e,t){return ar(t,(async()=>{let i,o=1,s=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),a;for(;o<=s&&!this.disposed;){try{return i=await this.startImpl(e,t),E("Connection complete server"),i}catch(c){if(a=c,c instanceof $v&&o<s)H("Retry because of wait for idle problem."),i?.dispose(),o+=1;else throw i&&this.disposed,c}throw a}throw new Error("Max number of attempts reached")})())}async startImpl(e,t){H("Launching server");let n=this.configuration.getSettings(e),i=n.useDefaultConfigForJupyter,o=await Fx(e),s=Is(),a=Oh(o,s?sr(s,`${(0,T7.default)()}.txt`):void 0,n);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(e,i,this.configuration.getSettings(void 0).jupyterCommandLineArguments,ED.Uri.file(a),t)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};Hv=g([(0,Us.injectable)(),d(0,(0,Us.inject)(Qe)),d(1,(0,Us.inject)(K)),d(2,(0,Us.inject)(ni)),d(3,(0,Us.inject)(ae)),d(4,(0,Us.inject)(fE)),d(4,(0,Us.optional)()),d(5,(0,Us.inject)(Wp)),d(5,(0,Us.optional)())],Hv);var $x=k(M());var PD=class extends sn{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var Gv=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Yt(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new PD}};Gv=g([(0,$x.injectable)(),d(0,(0,$x.inject)(Ph)),d(1,(0,$x.inject)(ze))],Gv);var Gm=k(M());var kD=class extends Xe{constructor(){super("nodeonly",y.webNotSupported)}};var zv=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new kD;try{if(E("Checking for server usability."),!await this.checkUsable())throw E("Server not usable (should ask for install now)"),new Yi(y.jupyterNotSupported(await t.getJupyterServerError()));E("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return gn.throwIfCanceled(e.token),i}catch(n){throw e.token?.isCancellationRequested&&dr(n)||await t.refreshCommands(),n}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let n=t.displayName?t.displayName:Ee(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(n,e.toString()))}else throw new Yi(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};zv=g([(0,Gm.injectable)(),d(0,(0,Gm.inject)(Qu)),d(0,(0,Gm.optional)()),d(1,(0,Gm.inject)(Qe))],zv);var R7=k(require("child_process")),Zl=k(M()),A7=k(require("os"));var N7=k(Io()),Hx=require("vscode");var _D=require("vscode");var Qv=class extends Xe{constructor(t,n,i){super("jupytercannotbelaunchedwitheroot",t+(n?`
${n}`:""));this.interpreter=i}};var Ame=new RegExp(Gd.UrlPatternRegEx),DD=class{constructor(e,t,n,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=n;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=ce();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let c=o.get(ae).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},c);let l=0;e.proc&&e.proc.on("exit",u=>l=u||0),this.subscriptions.push(e.out.onDidChange(u=>{E(u.out),this.output+=u.out,Gd.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(p=>this.getJupyterURL(p,this.output)).catch(p=>j("Failed to get server info",p))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(l))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),Q(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let n=e.find(i=>Dp(Ee(this.notebookDir),Ee(_D.Uri.file(i.notebook_dir))));if(n){let i=n.url,o=n.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Ame.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(l){x(`Failed to parse ${s}`,l),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let c=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${c}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let n=this.serviceContainer.get(ae),i=this.serviceContainer.get(_l),o=this.serviceContainer.get(Xu),s=OS({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:Pt},{baseUrl:e,token:t,displayName:gE(t,e)},i,o,n,this.rootDir,new _D.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,n=this.output;n.includes("Jupyter command `jupyter-notebook` not found")?t=new Xl(e,n,this.interpreter):n.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new Qv(e,n,this.interpreter):t=new vs(e,n,this.interpreter),this.startPromise.reject(t)}}};var So=new Set;var Yv=class{constructor(e,t,n,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=n;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,n,i,o){H("Starting Notebook");let s=0,a,c=[],l=ft.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(w=>this.disposables.push(w)).catch(f);let p=await this.generateArguments(t,n,u,i.fsPath);gn.throwIfCanceled(o),E("Starting Jupyter Notebook");let[m,h,v]=await Promise.all([this.jupyterInterpreterService.startNotebook(p||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);m.proc&&(m.proc.on("exit",w=>s=w),m.out.onDidChange(w=>this.jupyterOutputChannel.append(w.out))),m&&o.onCancellationRequested(()=>{m.dispose()},this,c),E("Waiting for Jupyter Notebook"),a=new DD(m,Hx.Uri.file(h.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,v),gn.throwIfCanceled(o);let b=await ar(o,a.ready);try{let w=parseInt(new URL(b.baseUrl).port||"0",10);w&&!isNaN(w)&&(m.proc&&m.proc.on("exit",()=>So.delete(w)),So.add(w))}catch(w){x(`Parsing failed ${b.baseUrl}`,w)}return Q(c),b}catch(u){throw Q(c),dr(u)||u instanceof vs||u instanceof Qv||u instanceof Xl?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):sn.from(y.jupyterNotebookFailure(u),u):new Yi(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{l.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,n){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(n))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,n,i){return!t||t.length===0?this.generateDefaultArguments(e,n,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,n=We(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(Hx.Uri.file(n),""),H(`Generating custom default config at ${n}`),`--config=${n}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(Hx.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(n=>{R7.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),n(e)})}))}catch{return e}}async generateTempDir(){let e=Hx.Uri.file(We(A7.tmpdir(),(0,N7.default)()));return await this.fs.createDirectory(e),{path:Ee(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};Yv=g([(0,Zl.injectable)(),d(0,(0,Zl.inject)(Wp)),d(1,(0,Zl.inject)(st)),d(2,(0,Zl.inject)(lt)),d(3,(0,Zl.inject)(Mo)),d(3,(0,Zl.named)(ah))],Yv);var qc=require("vscode"),zm=k(M());var Xv=class extends er{constructor(t,n){super();this._onDidLoad=this._register(new qc.EventEmitter);this._onDidChangeUri=this._register(new qc.EventEmitter);this._onDidRemoveUris=this._register(new qc.EventEmitter);this._onDidAddUri=this._register(new qc.EventEmitter);this._all=[];n.push(this),this.newStorage=this._register(new mK(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,n){this.hookupStorageEvents(),re(`setUri: ${t.id}.${t.handle}`);let i={time:n?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};Xv=g([(0,zm.injectable)(),d(0,(0,zm.inject)($e)),d(0,(0,zm.named)(yt)),d(1,(0,zm.inject)(K))],Xv);var mK=class{constructor(e){this.memento=e;this._onDidChangeUri=new qc.EventEmitter;this._onDidRemoveUris=new qc.EventEmitter;this._onDidAddUri=new qc.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${qc.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),n=t.find(a=>Wt(a.provider)===Wt(e.provider)),o=[{displayName:e.displayName||n?.displayName||Wt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,c)=>c.time-a.time).filter(a=>Wt(a.provider)!==Wt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(ps.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),n||this._onDidAddUri.fire(e),s.length){let a=s.map(c=>({provider:c.serverHandle,time:c.time,displayName:c.displayName||""}));this._onDidRemoveUris.fire(a.map(c=>c.provider))}this._onDidChangeUri.fire()}).catch(f)}async update(e){let n=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:n?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let n=this.getAll();if(n.length===0)return;let i=n.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=n.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>x(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async n=>{let i=Wt(n.serverHandle),o={time:n.time,displayName:n.displayName||i,provider:n.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var zp=k(M());var TD="removeKernelUrisAndSessionsUsedByResources",Zv=class{constructor(e,t,n){this.disposables=e;this.uriStorage=t;this.memento=n;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(TD,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Wt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,n){let i=Wt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][n]=this.usedRemoteKernelServerIdsAndSessions[i][n]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][n];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(TD,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}trackKernelIdAsNotUsed(e,t,n){let i=Wt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(n in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][n];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][n],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(TD,this.usedRemoteKernelServerIdsAndSessions).then(f,f))}onDidRemoveServers(e){e.forEach(t=>{let n=Wt(t);delete this.usedRemoteKernelServerIdsAndSessions[n],this.memento.update(TD,this.usedRemoteKernelServerIdsAndSessions).then(f,f)})}};Zv=g([(0,zp.injectable)(),d(0,(0,zp.inject)(K)),d(1,(0,zp.inject)(Zt)),d(2,(0,zp.inject)($e)),d(2,(0,zp.named)(yt))],Zv);var Zm=k(require("node-fetch")),J$=k(B$());var q$=require("vscode");function BK(r){return class extends r{constructor(...n){super(...n);this._onAnyMessage=new q$.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(n){super.emit=n}send(n,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(n,i)))).then(()=>super.send(n,i)):super.send(n,i)}handleEvent(n,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>n(i,...o)).catch(s=>x(`Exception while handling messages: ${s}`)),!0):n(i,...o)}emit(n,...i){return this.handleEvent((o,...s)=>super.emit(o,...s),n,...i)}addReceiveHook(n){this.receiveHooks.push(n)}removeReceiveHook(n){this.receiveHooks=this.receiveHooks.filter(i=>i!==n)}addSendHook(n){this.sendHooks.push(n)}removeSendHook(n){this.sendHooks=this.sendHooks.filter(i=>i!==n)}}}var $$=k(M());var Zi=new Map;var ry=class{getRequestCtor(e,t,n){class i extends Zm.Request{constructor(s,a){super(s,a);let c=this.headers,l=n();Object.keys(l).forEach(m=>c.append(m,l[m].toString())),c.set("Content-Type","application/json");let p=c.append.bind(c);c.append=(m,h)=>{m.toLowerCase()!=="authorization"&&p(m,h)}}}return n&&Object.keys(n()||{}).length?i:Zm.Request}getWebsocketCtor(e,t,n){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),n){let c=n();a=a?{...a,...c}:c}return a&&(s={...s,headers:a}),s};class o extends BK(J$.default){constructor(c,l){super(c,l,i());let u,p=/.*\/kernels\/(.*)\/.*/.exec(c);p&&p.length>1&&(this.kernelId=p[1]),this.kernelId?(Zi.set(this.kernelId,this),this.on("close",()=>{u&&this.timer!==u&&clearInterval(u),Zi.get(this.kernelId)===this&&Zi.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),u=this.timer=setInterval(()=>this.ping(f),3e4)}}return o}wrapWebSocketCtor(e){class t extends BK(e){constructor(o,s,a){super(o,s,a);let c,l=/.*\/kernels\/(.*)\/.*/.exec(o);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(Zi.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),Zi.get(this.kernelId)===this&&Zi.delete(this.kernelId)})):x("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(f),3e4)}}return t}getFetchMethod(){return Zm.default}getHeadersCtor(){return Zm.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};ry=g([(0,$$.injectable)()],ry);var H$=require("https"),G$=k(M());var ny=class{createHttpRequestAgent(){return new H$.Agent({rejectUnauthorized:!1})}};ny=g([(0,G$.injectable)()],ny);var Xo=k(M());var Yo=require("vscode");var Ufe=["/bin/sh","/bin/bash","/bin/zsh"];function WD(r,e){let t=(r.argv||[]).some(n=>(n=n.toLowerCase(),Ufe.some(i=>n.includes(i))));A("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:r.language,kind:e,usesShell:t})}var iy="remoteKernelSpecCache.json";var jfe=2e3,VD=class extends er{constructor(t,n,i,o,s,a,c,l,u,p){super();this.id=t;this.displayName=n;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=c;this.jupyterConnection=l;this.fs=u;this.context=p;this._status="idle";this._onDidChangeStatus=new Yo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ao;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new Yo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new Yo.EventEmitter;this.onDidChange=this._onDidChange.event;this.numberOfFailures=0;this.cacheFile=Yo.Uri.joinPath(p.globalStorageUri,iy),this.cacheKey=Wt(c),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(f,f),this._register(this.kernelProvider.onDidStartKernel(t=>{Ut(t.kernelConnectionMetadata)&&this.updateCache().then(f,f)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&Ut(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let n=setTimeout(()=>{this.updateCache().then(f,f)},jfe);return this.kernelDisposeDelayTimer=new Yo.Disposable(()=>clearTimeout(n)),n}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,n=!1){let i=!!this.cachedConnection;return this.cachedConnection=this.cachedConnection||this.getRemoteConnectionInfo(t),this.cachedConnection.then(o=>(this.numberOfFailures=0,o&&!i&&(this.cachedConnection=Promise.resolve(o)),o?this.listKernelsFromConnection(o):Promise.resolve([]))).catch(o=>(this.numberOfFailures+=1,this.isDisposed?Promise.reject(o):this.numberOfFailures>9?(j(`Remote Kernel Finder: ${this.id} has failed to connect 10 times in a row.`,o),Promise.reject(o)):i?this.getListOfKernelsWithCachedConnection(t,n):(this.cachedConnection=void 0,Promise.reject(o))))}async loadCache(t=!1,n=!1){re(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(f,f),this.loadCache(!0).then(f,f);else try{s=await this.getListOfKernelsWithCachedConnection(n),this._lastError=void 0}catch(a){a instanceof Yo.CancellationError||(x("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let n=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new Yo.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{n=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){j(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),n=await this.getFromCache(i.token),n=n.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(n)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let n=[];return t&&n.push(ft.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>Q(n))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new Yo.CancellationError;let n=this.cache;(!n||n.length===0)&&(n=await this.getCacheContents());let i=[],o=Promise.all(n.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await mr(t,o),i}catch(n){x("UniversalRemoteKernelFinder: Failed to get from cache",n)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),n=JSON.parse(t);if(n.extensionVersion!==this.env.extensionVersion)return[];let i=n.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>Es.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let n=[];try{let i=cp.create(t.settings);n.push(i);let[o,s,a,c]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),y2(t.serverProviderHandle)]),l=s.map(m=>(WD(m,"remote"),$S.create({kernelSpec:m,id:ki(m,void 0,c),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(m=>{let h=m.kernel,v=h.last_activity?new Date(Date.parse(h.last_activity.toString())):new Date,b=h.connections?parseInt(h.connections.toString(),10):0,w=o.find(F=>F.id===m.kernel?.id)||{},D=s.find(F=>F.name===m.kernel?.name)||{};return JS.create({kernelModel:{...m.kernel,...D,...w,name:m.kernel?.name||"",lastActivityTime:v,numberOfConnections:b,model:m},baseUrl:t.baseUrl,id:m.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(m=>!this.kernelIdsToHide.has(m.kernelModel.id||"")),...l]}catch(i){throw x(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(n.map(i=>i.dispose().catch(f)))}}async writeToCache(t){try{E(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let n=this.cache,i=new Map(n.map(m=>[m.id,m])),o=new Map(t.map(m=>[m.id,m])),s=t.filter(m=>!i.has(m.id)),a=t.filter(m=>i.has(m.id)&&!Ro(m,i.get(m.id))),c=n.filter(m=>!o.has(m.id)),l=this.cacheKey;this.cache=n.filter(m=>o.has(m.id)).concat(s),this.cache.forEach(m=>{let h=o.get(m.id);m!==h&&h.kind==="connectToLiveRemoteKernel"&&m.kind==="connectToLiveRemoteKernel"&&m.updateModel(h.kernelModel)});let u=t.map(m=>m.toJSON()),p={extensionVersion:this.env.extensionVersion,data:{}};try{let m=await this.fs.readFile(this.cacheFile),h=JSON.parse(m);h.extensionVersion===this.env.extensionVersion&&(p=h)}catch{}p.data[l]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(p))).catch(m=>{x("Failed to cache the remote kernels.",m)}),(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}catch(n){x("UniversalRemoteKernelFinder: Failed to write to cache",n)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var BD=require("vscode");var iu=class{constructor(e,t,n,i,o,s,a,c,l,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=n;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=c;this.context=l;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(f)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(f))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new BD.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let n=t.serverProvider;if(!(!n||this.mappedProviders.has(n)))return this.mappedProviders.add(n),n?.onDidChangeServers&&n?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(f)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Wt(o.provider))),n=e.serverProvider;if(!n)return;let i=new BD.CancellationTokenSource;try{let o=await Promise.resolve(n.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let c={extensionId:e.extensionId,handle:a.id,id:e.id},l=Wt(c);s.add(l),yD(c,a.label),!(this.mappedServers.has(l)||!t.has(l))&&(this.mappedServers.add(l),this.createRemoteKernelFinder(c,a.label))}),this.serverFinderMapping.forEach((a,c)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Wt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(c))})}catch(o){x(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Wt(e.provider);if(this.serverFinderMapping.has(t))return;let n=new BD.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(l=>l.extensionId===e.provider.extensionId&&l.id===e.provider.id);if(!s||!s.serverProvider)return;let c=(await Promise.resolve(s.serverProvider.provideJupyterServers(n.token)))?.find(l=>l.id===e.provider.handle)?.label;c&&this.createRemoteKernelFinder(e.provider,c)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===Va&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(f),o().catch(f)]),n.dispose()}getOrCreateRemoteKernelFinder(e,t){let n=Wt(e);if(!this.serverFinderMapping.has(n)){let i=new VD(`remote-${n}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(n,i),i.activate().then(f,f)}return this.serverFinderMapping.get(n)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let n=Wt(t),i=this.serverFinderMapping.get(n);i&&i.dispose(),this.serverFinderMapping.delete(n)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};g([Nr("Handle Jupyter Provider Changes")],iu.prototype,"handleProviderChanges",1),g([Nr("Check Servers in Jupyter Server Provider")],iu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),g([Nr("Failed to create a Remote Kernel Finder")],iu.prototype,"validateAndCreateFinder",1),iu=g([(0,Xo.injectable)(),d(0,(0,Xo.inject)(Zt)),d(1,(0,Xo.inject)(_c)),d(2,(0,Xo.inject)(hE)),d(3,(0,Xo.inject)(Tr)),d(4,(0,Xo.inject)(Fe)),d(5,(0,Xo.inject)(In)),d(6,(0,Xo.inject)(K)),d(7,(0,Xo.inject)(st)),d(8,(0,Xo.inject)(ct)),d(9,(0,Xo.inject)(Gt))],iu);var Xp=k(M());var ly=require("vscode");var XD=k(Io());var zc=k(M());var qD=class extends Xe{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function sy(r){if(Dr()){let e=r;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(n=>{n._status!==void 0&&(n._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var oy=class extends sn{constructor(e){super(e.message,e)}};var Xx=require("vscode");var ef=class extends Pn{constructor(e){super("invalidkernel",y.kernelInvalid(pt(e)),e)}};async function ay(r,e,t,n,i){if(!t.kernel)throw new ef(r);let o=ft.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{E(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=ce();i.onCancellationRequested(()=>a.reject(new Xx.CancellationError),void 0,s);let c=(m,h)=>{E(`Got status ${h} in waitForIdleOnSession`),h=="idle"&&a.resolve(h)};t.kernel.statusChanged?.connect(c),s.push(new Xx.Disposable(()=>An(()=>t.kernel?.statusChanged?.disconnect(c)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let l=ce(),u=()=>l.resolve("");t.disposed.connect(u,l),s.push(new Xx.Disposable(()=>An(()=>t.disposed.disconnect(u,l)))),l.promise.catch(f),a.promise.catch(f);let p=await _r(n,"",a.promise,l.promise);if(t.isDisposed)throw x("Session disposed while waiting for session to be idle."),new ef(r);if(E(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),p=="idle")return;throw x(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new $v(r)}catch(a){throw re("Error waiting for idle",a),a}finally{Q(s)}}var YD=require("vscode");var Gc=k(GD()),zD=require("vscode");var cy=class{constructor(e,t){this.kind=e;this.session=t;this.propertyChanged=new Gc.Signal(this);this.kernelChanged=new Gc.Signal(this);this.statusChanged=new Gc.Signal(this);this.connectionStatusChanged=new Gc.Signal(this);this.iopubMessage=new Gc.Signal(this);this.unhandledMessage=new Gc.Signal(this);this.anyMessage=new Gc.Signal(this);this.disposables=[];this.disposed=new Gc.Signal(this);this._disposed=new zD.EventEmitter;this.didShutdown=new zD.EventEmitter;this._onDidKernelSocketChange=new zD.EventEmitter;t.propertyChanged.connect(this.onPropertyChanged,this),t.kernelChanged.connect(this.onKernelChanged,this),t.statusChanged.connect(this.onStatusChanged,this),t.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),t.iopubMessage.connect(this.onIOPubMessage,this),t.unhandledMessage.connect(this.onUnhandledMessage,this),t.anyMessage.connect(this.onAnyMessage,this),this.disposables.push({dispose:()=>{this.didShutdown.dispose(),this._disposed.dispose(),this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get isDisposed(){return this._isDisposed===!0}get onDidDispose(){return this._disposed.event}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}async disposeAsync(){this.dispose()}dispose(){this.disposeInvoked||(this.statusChanged.emit("dead"),this._disposed.fire(),this.disposed.emit(),this.previousAnyMessageHandler?.dispose(),Q(this.disposables),Gc.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),H(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let e={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:Zi.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(e.kernel.model)&&this.previousKernelSocketInformation?.kernel===e.kernel&&this.previousKernelSocketInformation?.kernel.id===e.kernel.id&&this.previousKernelSocketInformation?.socket===e.socket||(this.previousKernelSocketInformation=e,this.previousAnyMessageHandler?.dispose(),this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(e,t){this.propertyChanged.emit(t)}onKernelChanged(e,t){this.kernelChanged.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t);let n=this.status;re(`Server Status = ${n}`)}onConnectionStatusChanged(e,t){this.connectionStatusChanged.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){j(`Unhandled message found: ${t.header.msg_type}`),this.unhandledMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}setPath(e){return this.session.setPath(e)}setName(e){return this.session.setName(e)}setType(e){return this.session.setType(e)}changeKernel(e){return this.session.changeKernel(e)}onKernelConnectionStatusHandler(e,t){re(`Server Kernel Status = ${t}`)}};var QD=class extends cy{constructor(t,n,i,o,s){super(dt(i)?"localJupyter":"remoteJupyter",t);this.resource=n;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(re(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).catch(f)}async disposeAsync(){await this.shutdownImplementation(!1).catch(f),await super.disposeAsync()}async waitForIdle(t,n){try{await ay(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw re("Error waiting for idle",i),await this.shutdown().catch(f),i}}async restart(){let t=[],n=new YD.CancellationTokenSource;this.restartToken=n;let i=new Yt(!1);t.push(i),t.push(n);try{await this.validateLocalKernelDependencies(n.token,i),await super.restart()}finally{Q(t)}}async validateLocalKernelDependencies(t,n){if(!(!this.kernelConnectionMetadata?.interpreter||!dt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new YD.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,n,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this._isDisposed)return;this._isDisposed=!0;let n=(new Error().stack||"").split(`
`).filter(o=>o.includes(Pt));E(`Shutdown session - current session, called from 
 ${n.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;E(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{E(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),sy(this.session.kernel),this.session.isDisposed||await _r(1e3,this.session.shutdown().catch(f))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){j("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else E(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){j("Failures in disposing the session",o)}super.dispose(),E("Shutdown session -- complete")}catch(o){j("Failures in disposing the session",o)}E(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return dt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&$i(this.resource)==="interactive"?!0:!(this.resource&&$i(this.resource)==="notebook"&&Ut(this.kernelConnectionMetadata))}};var ou=class{constructor(e,t,n,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=n;this.kernelService=i;this.configService=o}async create(e){let t=[],n,i=()=>{e.ui.disableUI||n||(n=ft.createProgressReporter(e.resource,Ut(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(n))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=Ut(e.kernelConnection)?await ar(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await ar(e.token,this.validateLocalKernelDependencies(e));let c=cp.create(o.settings);this.asyncDisposables.push(c),s.push(new ly.Disposable(()=>c.dispose().catch(f))),await ar(e.token,this.validateRemoteServer(e,c));let l=await this.connectToOrCreateSession({...e,contentsManager:c.contentsManager,sessionManager:c.sessionManager,kernelManager:c.kernelManager,kernelSpecManager:c.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await l.shutdown().catch(f),An(()=>l.dispose())),gn.throwIfCanceled(e.token),H(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new QD(l,e.resource,e.kernelConnection,this.kernelService,e.creator),p=l.disposed,m=()=>{c.dispose().catch(f),p.disconnect(m)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),l.disposed.connect(m);let h=u.onDidDispose(m);return this.asyncDisposables.push(h),u}catch(c){throw Q(s),Ut(e.kernelConnection)?o?No.isSelfCertsError(c)?new No(o.baseUrl):uc.isSelfCertsExpiredError(c)?new uc(o.baseUrl):new Pi(o.baseUrl,e.kernelConnection.serverProviderHandle,c):c:c instanceof Xe?c:new qD(c)}finally{Q(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new fn;if(!dt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(n){throw x("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",n),new Pi(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,n)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new ly.CancellationError;e.kernelConnection?.interpreter&&dt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new ly.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await ar(e.token,yw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else E(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await ay(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(f);if(e.token.isCancellationRequested)throw new ly.CancellationError;return t}catch(n){let i=e.ui.disableUI?E:x;throw n instanceof Xe?(i("Failed to change kernel, re-throwing",n),n):(i("Failed to change kernel",n),new ef(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),n=t?.path,i=eg(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?$u(e.resource):"";o=`${e.resource?mn(e.resource,a):""}-${(0,XD.default)()}${a}`}let s={path:n||Bfe(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await ar(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new oy(new Error("No kernel created"));return H(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof oy?a:new oy(a)}}};ou=g([(0,zc.injectable)(),d(0,(0,zc.inject)(Ph)),d(1,(0,zc.inject)(In)),d(2,(0,zc.inject)(ni)),d(3,(0,zc.inject)(mE)),d(3,(0,zc.optional)()),d(4,(0,zc.inject)(ae))],ou);function Vfe(){return`${Zh}${(0,XD.default)()}`}function Bfe(r){let e=`${Vfe()}${(0,XD.default)()}.ipynb`;return r?`${mn(r,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var uy=class{constructor(e,t,n){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=n}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&dt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};uy=g([(0,Xp.injectable)(),d(0,(0,Xp.inject)(ui)),d(1,(0,Xp.inject)(fD)),d(1,(0,Xp.optional)()),d(2,(0,Xp.inject)(ou))],uy);var Zx=Symbol("RemoteKernelFinderController");function e5(r,e){r.add(_v,Wv),r.addSingleton(Ie,Vv),r.addSingleton(Ie,Tv),r.addSingleton(Qu,Hv),r.addSingleton(Os,Os),r.addSingleton(Eh,Bv),r.addSingleton(dE,qm),r.addSingleton(Yl,Yl),r.addSingleton(li,li),r.addSingleton(Ia,Ia),r.addSingleton(pa,pa),r.addSingleton(mE,$m),r.addSingleton(Ph,zv),r.addSingleton(Yu,Bm),r.addSingleton(Wp,Bm),r.addSingleton(Zt,Xv),r.addSingleton(fE,Yv),r.addSingleton(lP,Gv),r.addSingleton(HS,uy),r.addSingleton(ou,ou),r.addSingleton(_l,ry),r.addSingleton(Xu,ny),r.addSingleton(In,In),r.addSingleton(nm,Zv),r.addBinding(nm,Ie),r.addSingleton(hE,Jv),r.addSingleton(Yr,jv),r.addSingleton(Zx,iu),r.addBinding(Zx,Ie),r.addSingleton(Gt,og)}var tf=k(M()),Zo=require("vscode");var py=class{constructor(e,t,n,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=n;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(Zo.notebooks.onDidChangeNotebookCellExecutionState(e=>{if(!_t(e.cell.notebook)||e.state!==Zo.NotebookCellExecutionState.Idle)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}onDidStartKernel(e){if(!this.kernelsStartedSuccessfully.has(e)){if(this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry),!e.session?.kernel)return;this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),e.onDisposed(()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this,this.disposableRegistry),e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this,this.disposableRegistry),e.onRestarted(()=>this.kernelsRestarting.delete(e),this,this.disposableRegistry)}}onKernelStatusChanged(e,t){let n=this.kernelConnectionToKernelMapping.get(e);if(n&&!this.kernelsRestarting.has(n))switch(t){case"connected":{this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n);return}case"disconnected":{this.kernelReconnectProgress.has(n)&&(this.kernelReconnectProgress.get(n)?.dispose(),this.kernelReconnectProgress.delete(n),this.onKernelDisconnected(n)?.catch(f));return}case"connecting":this.kernelReconnectProgress.has(n)||this.onKernelConnecting(n)?.catch(f);return;default:return}}async onKernelConnecting(e){let t=ce(),n=new Zo.Disposable(()=>t.resolve());if(this.kernelReconnectProgress.set(e,n),Ut(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let i=y.automaticallyReconnectingToAKernelProgressMessage(pt(e.kernelConnectionMetadata));Zo.window.withProgress({location:Zo.ProgressLocation.Notification,title:i},async()=>t.promise).then(f,f),this.disposableRegistry.push(n)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(Tt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),Ut(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=dt(e.kernelConnectionMetadata)?y.kernelDisconnected(pt(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);Zo.window.showErrorMessage(t).then(f,f);try{let n=this.lastExecutedCellPerKernel.get(e);if(!n||n.document.isClosed||n.notebook.isClosed||n.executionSummary?.success===!1)return;await sp(n,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let n=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!n)return!1;let i=new Zo.CancellationTokenSource;try{return(await Promise.resolve(n.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};py=g([(0,tf.injectable)(),d(0,(0,tf.inject)(K)),d(1,(0,tf.inject)(Fe)),d(2,(0,tf.inject)(Zt)),d(3,(0,tf.inject)(Gt))],py);var eC=k(M());var dy=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=ft.createProgressReporter(e.resourceUri,y.restartingKernelStatus(pt(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};dy=g([(0,eC.injectable)(),d(0,(0,eC.inject)(K)),d(1,(0,eC.inject)(Fe))],dy);var tC=k(M()),qK=require("vscode");var rf=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),this.kernelProvider.getKernelExecution(e).onPreExecute(t=>this.lastExecutedCellPerKernel.set(e,t),this,this.disposableRegistry)}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(qK.window.showErrorMessage(y.kernelDiedWithoutError(pt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(qK.window.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(pt(e.kernelConnectionMetadata))).then(f,f),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(Tt(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return sp(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};g([Nr()],rf.prototype,"onKernelStatusChanged",1),rf=g([(0,tC.injectable)(),d(0,(0,tC.inject)(K)),d(1,(0,tC.inject)(Fe))],rf);var su=k(M()),ed=require("vscode");var Zp=class{constructor(e,t,n,i){this.installer=e;this.memento=t;this.rawSupport=n;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:n,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!dt(t)||!Kt(t)||!t.interpreter)return 0;H(`Check & install missing Kernel dependencies for ${V(t.interpreter?.uri)}, ui.disabled=${n.disableUI} for resource '${V(e)}'`);let c=async()=>{if(await ft.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let h=await c();if(h===0||h===1)return h}let l=dn(t.interpreter.uri),u=this.installPromises.get(l),p;if(!u){let h=new ed.CancellationTokenSource,v=i.onCancellationRequested(()=>{h.cancel(),v.dispose()});u=ft.wrapAndReportProgress(e,y.installingMissingDependencies,async()=>{if(a){let b=await c();if(b===0||b===1)return b}return this.runInstaller(e,t.interpreter,n,h,s,a)}),u.finally(()=>{v.dispose(),h.dispose()}).catch(f),this.installPromises.set(l,u)}let m=2;try{m=await u,(p?.token?.isCancellationRequested||i.isCancellationRequested)&&(m=1)}catch(h){re("Failed to install kernel dependency",h),m=2}finally{this.installPromises.delete(l)}return m}async areDependenciesInstalled(e,t,n){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!n&&this.rawSupport.isSupported&&await sJ(this.memento,19,e.interpreter))return H(`IPyKernel found previously in this environment ${V(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&Vk(this.memento,19,e.interpreter).catch(f)},f),mr(t,!1,i)}async runInstaller(e,t,n,i,o,s){if(re(`Run Installer for ${V(e)} ui.disableUI=${n.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),n.disableUI)return 4;let[a,c]=await Promise.all([lJ(this.memento,19,t),t.envType==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let l=a?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,u=c===!1?[19,27]:[19],p=l(t.displayName||t.uri.fsPath,u.map(F=>fr.get(F)).join(` ${ge.and} `)),m=u.map(F=>fr.get(F)).join(", "),h=e?$i(e):void 0,v=e?await ht(e.toString()):void 0;Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let b=ge.install,w=y.selectKernel,D=ge.moreInfo,T=[b];e&&!o&&T.push(w),T.push(D);try{(!$d()||!s)&&Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let F;do F=$d()||s?b:await mr(i.token,ed.window.showInformationMessage(p,{modal:!0},...T)),F===D&&(Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),ed.env.openExternal(ed.Uri.parse("https://aka.ms/AAhi594")));while(F===D);if(i.token.isCancellationRequested)return Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),1;if(F===w)return Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),3;if(F===b){Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType});let ee=await mr(i.token,3,this.installer.install(19,t,i,a===!0,c===!1));if(ee===0)return Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),0;if(ee===2)return Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),2}return Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),1}catch(F){throw x(`Failed to install ${m}`,F),Tt(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:m,resourceType:h,resourceHash:v,pythonEnvType:t.envType}),F}}};g([ti("Install Missing Dependencies")],Zp.prototype,"installMissingDependencies",1),g([ti("Are Dependencies Installed"),d(0,Pl("id"))],Zp.prototype,"areDependenciesInstalled",1),Zp=g([(0,su.injectable)(),d(0,(0,su.inject)(Mi)),d(1,(0,su.inject)($e)),d(1,(0,su.named)(yt)),d(2,(0,su.inject)(ui)),d(3,(0,su.inject)(lt))],Zp);var e_=k(M()),ZD=require("vscode");var my=class{constructor(e){this.disposables=e;this._onDidChangeRegistrations=new ZD.EventEmitter;this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=new ZD.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=new ZD.EventEmitter;e.push(this._onDidChangeStatus),e.push(this._onDidChangeRegistrations)}get status(){return this._status}set status(e){this._status!=e&&(this._status=e,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(e){this._finders.push(e),e.status==="discovering"&&(this.status="discovering");let t=e.onDidChangeStatus(()=>this.status=this._finders.every(i=>i.status==="idle")?"idle":"discovering",this,this.disposables),n=e.onDidChangeKernels(()=>this._onDidChangeKernels.fire());return this.disposables.push(n),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[e],removed:[]}),{dispose:()=>{let i=this._finders.findIndex(o=>o===e);this._finders.splice(i,1),n.dispose(),t.dispose(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[e]})}}}get kernels(){let e=[];this.connectionFinderMapping.clear();let t=new Set;this._finders.filter(i=>i.kind==="localPythonEnvironment").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.add(o.kernelSpec.specFile),e.push(o),this.connectionFinderMapping.set(o.id,i)})}),this._finders.filter(i=>i.kind==="localKernelSpec").forEach(i=>{i.kernels.forEach(o=>{(o.kind==="startUsingLocalKernelSpec"||o.kind==="startUsingPythonInterpreter")&&o.kernelSpec.specFile&&t.has(o.kernelSpec.specFile)||(e.push(o),this.connectionFinderMapping.set(o.id,i))})});let n=this._finders.filter(i=>i.kind==="remote");for(let i of n){let o=i.kernels;o.forEach(s=>{this.connectionFinderMapping.set(s.id,i)}),e.push(...o)}return e}getFinderForConnection(e){return this.connectionFinderMapping.get(e.id)}get registered(){return this._finders}};my=g([(0,e_.injectable)(),d(0,(0,e_.inject)(K))],my);var ln=k(M());var di=require("vscode");var t_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new di.EventEmitter;this._onDidStartKernel=new di.EventEmitter;this._onDidCreateKernel=new di.EventEmitter;this._onDidDisposeKernel=new di.EventEmitter;this._onKernelStatusChanged=new di.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),di.workspace.onDidCloseNotebookDocument(n=>this.disposeOldKernel(n),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){let e=new Set;return di.workspace.notebookDocuments.forEach(t=>{let n=this.get(t);n&&e.add(n)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){if(Vn(e)){let t=di.workspace.notebookDocuments.find(n=>n.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){re("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByNotebook.set(e,{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${V(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByNotebook.get(e);t&&(E(`Disposing kernel associated with ${V(e.uri)}, isClosed=${e.isClosed}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>j("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){di.workspace.notebookDocuments.forEach(t=>{let n=this.kernelsByNotebook.get(t);if(n){let i=n.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(n.kernel.id))}})}},r_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new di.EventEmitter;this._onDidStartKernel=new di.EventEmitter;this._onDidCreateKernel=new di.EventEmitter;this._onDidDisposeKernel=new di.EventEmitter;this._onKernelStatusChanged=new di.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),di.workspace.onDidCloseNotebookDocument(n=>{E(`Notebook document ${V(n.uri)} got closed`),this.disposeOldKernel(n.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){re("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,n){this.kernelsByUri.set(e.toString(),{options:t,kernel:n}),this.kernelsById.set(n.id,{options:t,kernel:n}),this._onDidCreateKernel.fire(n)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),E(`Kernel got disposed, hence there is no longer a kernel associated with ${V(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(re(`Disposing kernel associated with ${V(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(n=>j("Failed to dispose old kernel",n)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(f)),this.kernelsByUri.delete(e.toString())}};var $K=k(Io()),$r=require("vscode");var n5=k(_k());var JK="KERNEL_INFO",qfe=1e3*60*60*24*2;async function r5(r,e,t){let n=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!r.kernel)return;r.kernel?.info&&(n.push(r.kernel.info),r.kernel.info.then(a=>t5(t,e,a)).catch(f));let o=r.kernel.requestKernelInfo().then(a=>a?.content);if(n.push(o),o.then(a=>t5(t,e,a)).catch(f),e.kind==="connectToLiveRemoteKernel"){let a=Jfe(t,e);a?n.push(Promise.resolve(a)):n.push(ji(5e3).then(()=>i))}let s=await Promise.race(n);return s===i?j("Failed to Kernel info in a timely manner, defaulting to empty info!"):E("Got Kernel info"),s}async function t5(r,e,t){if(!t||!Ut(e))return;let n=r.get(JK,[]).filter(i=>Date.now()-i.age<qfe).filter(i=>i.id!==e.id);n.push({id:e.id,age:Date.now(),info:t}),await r.update(JK,n)}function Jfe(r,e){if(Ut(e))return r.get(JK,[]).find(t=>t.id===e.id)?.info}var n_=class extends Pn{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};var i_="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function c_(r){let e=typeof r=="string"?r:"";return typeof r!="string"&&"content"in r&&"code"in r.content&&typeof r.content.code=="string"&&(e=r.content.code),!e.includes(i_)}function l_(r){return r.status==="dead"||r.status==="terminating"&&!r.disposed&&!r.disposing||!r.disposed&&!r.disposing&&(r.session?.status=="unknown"||r.session?.kernel?.status=="unknown")&&(r.session.kernel?.isDisposed||r.session.isDisposed)}function i5(r){return r.status==="dead"||r.status==="terminating"&&!r.isDisposed||!r.isDisposed&&(r.status=="unknown"||r.kernel?.status=="unknown")&&(r.kernel?.isDisposed||r.isDisposed)}var o_=class{constructor(e,t,n,i,o,s,a,c,l){this.id=e;this.uri=t;this.resourceUri=n;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=c;this.workspaceMemento=l;this.disposables=[];this._onIPyWidgetVersionResolved=new $r.EventEmitter;this._onDidKernelSocketChange=new $r.EventEmitter;this._onStatusChanged=new $r.EventEmitter;this._onRestarted=new $r.EventEmitter;this._onStarted=new $r.EventEmitter;this._onDisposed=new $r.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new $r.CancellationTokenSource;this.startupUI=new Yt(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),Xi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(f),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||Xi(this.resourceUri,{disableUI:!1}).catch(f)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,n,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=n?t.bind(n):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){return this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new $r.CancellationTokenSource),this.startJupyterSession(e)}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(n=>n()));H(`Interrupt requested ${V(this.resourceUri||this.uri)}`);let t;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;H("Interrupt kernel execution"),n?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(n,e)),this._interruptPromise=void 0):(H("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(n=>n())).catch(f)}if(H(`Interrupt requested & sent for ${V(this.uri)} in notebookEditor.`),t==="timeout"){let n=y.restartKernelAfterInterruptMessage(pt(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await $r.window.showInformationMessage(n,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(H(`Dispose Kernel '${V(this.uri)}' associated with '${V(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(n=>n())).then(f).catch(f)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._session&&(t.push(this._session.disposeAsync().catch(f)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),Q(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=$i(this.resourceUri);H(`Restart requested ${V(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(n=>n(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Be;try{let n=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;n?(this._restartPromise||(this._restartPromise=n.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(f)),await this._restartPromise,this.startCancellation=new $r.CancellationTokenSource):await this.start(new Yt(!1)),Tt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(n){x(`Restart failed ${V(this.uri)}`,n),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,Tt(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,n),await i?.disposeAsync().catch(f),this._ignoreJupyterSessionDisposedErrors=!1,n}await this.initializeAfterStart(this._session),this._onRestarted.fire()}catch(e){throw x(`Failed to restart kernel ${V(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(f)}}async startJupyterSession(e=new Yt(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)}),this.startupUI.disableUI?this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||Qo(this.resourceUri,this.kernelConnectionMetadata).catch(f)},this,this.disposables):await Qo(this.resourceUri,this.kernelConnectionMetadata),this.disposing)throw new $r.CancellationError;if(gn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new Be;if(await Xi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator}),this.disposing)throw new $r.CancellationError;gn.throwIfCanceled(this.startCancellation.token),this._jupyterSessionPromise=this.createJupyterSession().then(n=>(Tt(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),n)).catch(n=>{throw re(`Failed to create Jupyter Session in Kernel.startNotebook for ${V(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,n})}return this._jupyterSessionPromise.finally(()=>this.sendKernelStartedTelemetry()).catch(f),this._jupyterSessionPromise}async interruptExecution(e,t){let n=ce(),i=new Be,o=[],s=l=>{(l==="restarting"||l==="autorestarting")&&(j("Kernel restarting during interrupt"),n.resolve(!0))},a=(l,u)=>s(u);return e.statusChanged.connect(a),o.push(new $r.Disposable(()=>An(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(H(`Interrupting kernel: ${e.kernel.name}`),await bw(this.kernelSettings.interruptTimeout,new n_(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(l=>{j(`Error during interrupt: ${l}`),n.resolve(!0)})),(async()=>{let l=ce();this.status==="busy"&&(this.onDisposed(()=>l.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?l.resolve("dead"):void 0,this,o));try{return await _r(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),n.promise.then(()=>"restart"),l.promise)}catch(u){if(n.completed)return"restart";throw Tt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{Q(o)}})().then(l=>(Tt(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:l}),l))}async createJupyterSession(){if(this.disposing)throw new $r.CancellationError;gn.throwIfCanceled(this.startCancellation.token);let e=[];try{let t="",n=this.kernelConnectionMetadata.interpreter;if(n){let o=[];o.push(`Python Path: ${V(n.uri)}`),o.push(n.envType||""),o.push(n.envName||""),n.version&&o.push(`${n.version.major}.${n.version.minor}.${n.version.patch}`),t=` (${o.filter(s=>s).join(", ")})`}H(`Starting Kernel ${this.kernelConnectionMetadata.kind}, ${this.kernelConnectionMetadata.id} ${t} for '${V(this.uri)}' (disableUI=${this.startupUI.disableUI})`),this.createProgressIndicator(e),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new $r.CancellationError;if(gn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new $r.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),i}catch(t){if(this.startupUI.disableUI?E(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t):!this.startCancellation.token&&!dr(t)&&x(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,t),gn.throwIfCanceled(this.startCancellation.token),t instanceof vs)throw t;let n=y.sessionStartFailedWithKernel(pt(this.kernelConnectionMetadata));throw sn.from(n+" "+("message"in t?t.message:t.toString()),t)}finally{Q(e)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,Tt(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=ft.createProgressReporter(this.resourceUri,y.connectingToKernel(pt(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(t=>t(e,this.startCancellation.token).catch(f))),E(`Started running kernel initialization for ${V(this.uri)}`),!e){E("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(n=>this._onDidKernelSocketChange.fire(n)),e.onDidDispose(()=>{if(re(`Kernel got disposed as a result of session.onDisposed (1) ${V(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){H(`Kernel got disposed as a result of session.onDisposed ${V(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let n=this._session===e;this._jupyterSessionPromise=void 0,this._session=void 0,n&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let t=(n,i)=>this._onStatusChanged.fire(i);e.statusChanged.connect(t),this.disposables.push(new $r.Disposable(()=>An(()=>e.statusChanged.disconnect(t))))}if(e.kernel?.registerCommTarget(Ge.DefaultCommTarget,f),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(t=>x("Failed to determine IPyWidget version",t)),this.gatherInternalStartupCode().then(t=>this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(t=>x("Failed to execute internal startup code",t));else{await this.determineVersionOfIPyWidgets(e);let t=await this.gatherInternalStartupCode();await this.executeSilently(e,t,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}try{E("Requesting Kernel info"),this._info=await r5(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(t){j("Failed to request KernelInfo",t)}this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(E("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),E("End running kernel initialization, session is idle"))}async determineVersionOfIPyWidgets(e){if(!Kt(this.kernelConnectionMetadata)){this._ipywidgetsVersion==uS,this._onIPyWidgetVersionResolved.fire(uS);return}let t=async()=>{let n=n5.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${i_}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[n]).catch(o=>x("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(c=>(c.text||"")?.toString().includes(`${i_}8.`)),s=i.some(c=>(c.text||"")?.toString().includes(`${i_}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;E(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else j("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let n=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[Ui]||"target_name"in s.content&&s.content.target_name===Ge.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(f),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(n,this)))};this.session.kernel.anyMessage.connect(n,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((n,i)=>i.priority-n.priority).map(n=>n.getCode(this)));for(let n of t)e.push(...n);if(Kt(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let n=Ee(this.resourceUri);n&&e.push(`__vsc_ipynb_file__ = "${n.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(Ba.DisableJedi),e.push(...$fe(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){re(`Initialize config for plots for ${V(this.resourceUri||this.uri)}`);let t=Ba.MatplotLibInit;E(`Initialize matplotlib for ${V(this.resourceUri||this.uri)}`),e.push(...Ke(t,{trim:!1}));let n=$r.window.activeColorTheme.kind===$r.ColorThemeKind.Dark;e.push(n?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Ge.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Ke(t,{trim:!1})}return[]}async executeSilently(e,t,n){if(t.join("").trim().length!==0){if(!e.kernel){E(`Not executing startup as there is no session, code: ${t}`);return}return hn(e.kernel,t.join(`
`),n)}}},s_=class extends o_{get creator(){return"3rdPartyExtension"}constructor(e,t,n,i,o,s,a){super(`3rdPartyKernel_${(0,$K.default)()}`,e,t,n,i,o,s,"3rdPartyExtension",a)}},a_=class extends o_{constructor(t,n,i,o,s,a,c,l){super((0,$K.default)(),n.uri,t,i,o,s,c,"jupyterExtension",l);this.notebook=n;this.controller=a}get creator(){return"jupyterExtension"}};function $fe(r,e){return!r||r.length===0||(r=r.map(t=>`    ${t}`),r.unshift("try:"),r.push("except:",`    print('${e}')`)),r}function u_(r){if(r.length>0){let e=r[0].data;if(e&&e.hasOwnProperty("text/plain"))return Cs(e["text/plain"]);if(r[0].output_type==="stream"){let t=r[0];return Cs(t.text)}}}function HK(r,e){return{get enableExtendedPythonKernelCompletions(){return r.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return r.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return r.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return r.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return r.getSettings(e).themeMatplotlibPlots}}}var js=require("vscode");var Ca=require("vscode");var GK=k(YA()),Er=require("vscode");var fy=new WeakMap;function au(r){if(r.parent_header&&"msg_id"in r.parent_header)return r.parent_header.msg_id}var td=class td{constructor(e,t,n,i,o,s,a,c){this.cell=e;this.controller=t;this.context=n;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new Er.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=ce();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(f),this.executeRequestMessageId=c,this.ownedRequestMsgIds.add(c),Er.workspace.onDidChangeNotebookDocument(l=>{if(!_t(l.notebook))return;let u=l.cellChanges.find(({cell:p})=>p===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=l=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(l)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(f))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,gt(this.cell,"Execution Message Handler disposed"),Q(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:n}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=au(n);i.KernelMessage.isStatusMsg(n)&&n.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),n.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(n)&&n.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,c=typeof n.parent_header=="object"&&n.parent_header&&"msg_type"in n.parent_header&&n.parent_header.msg_type==="interrupt_request",l=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],p="msg_type"in n&&typeof n.msg_type=="string"&&u.includes(n.msg_type);if(!this.completedExecution&&l)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(p||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),c?1e3:100),this.disposables.push(new Er.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(n)&&this.ownedCommIds.has(n.content.comm_id)&&this.ownedRequestMsgIds.add(n.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(n){x("Failed to handle iopub message as a result of some comm message",t,n),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(n)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(){if(this.cell.document.isClosed)return;let e=fy.get(this.cell.notebook);return e||(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=Hi.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),H(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let n=e;this.handleStatusMessage(n)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||j(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Ge.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let n="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||n&&this.ownedRequestMsgIds.has(n.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let n="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return j("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(n))return j(`Came across a comm update message a child that start start with ${n}`,i);let o=i.substring(n.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(gt(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(f,f),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&Ui in e.data){let c=e.data[Ui];if(c&&this.context.extensionMode===Er.ExtensionMode.Test&&(c._vsc_test_cellIndex=this.cell.index),c&&"model_id"in c){let l=td.modelIdsOwnedByCells.get(this.cell)||new Set;l.add(c.model_id),td.modelIdsOwnedByCells.set(this.cell,l)}}let n=ua(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;gt(this.cell,"Update output");let o=this.execution||this.createTemporaryTask();this.clearOutputIfNecessary(o),i&&Xr.trackOutputByDisplayId(this.cell,i,n,n.items),this.clearLastUsedStreamOutput(),gt(this.cell,"Append output in addToCellData");let s=!0,a=au(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&n.items.every(c=>this.canMimeTypeBeRenderedByWidgetManager(c))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:n},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([n]).then(f,f),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===Ui){let n=JSON.parse(Buffer.from(e.data).toString());return!(typeof n.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(n.model_id))}return!t.startsWith("application/vnd")}updateJupyterOutputWidgetWithOutput(e,t){let n=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:n;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(w=>td.modelIdsOwnedByCells.get(w)?.has(s));if(!a){j(`Unable to find a cell that owns the model ${s}`);return}let c=a.outputs.find(w=>w.items.find(D=>{if(D.mime!==Ui)return!1;try{return JSON.parse(Buffer.from(D.data).toString()).model_id===s}catch(T){j("Failed to deserialize the widget data",T)}return!1}));if(!c)return;let l=td.outputsOwnedByWidgetModel.get(s)||new Set,p=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let m=a.outputs.slice().filter(w=>p?!l.has(w.id):!0),h=m.slice(0,m.indexOf(c)+1),v=m.slice(m.indexOf(c)+1);td.outputsOwnedByWidgetModel.set(s,l),o&&l.add(o.id);let b=o?h.concat(o).concat(v):h.concat(v);return v.length===0&&o?t?.appendOutput(o,a).then(f,f):p&&!o&&v.length===0||t?.replaceOutput(b,a).then(f,f),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new Er.CancellationTokenSource;this.prompts.add(t);let n=e.content.password!==null&&e.content.password;await Er.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:n},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"})},f),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(n=>{n.source&&n.source==="set_next_input"&&"text"in n&&"replace"in n&&this.handleSetNextInput(n),n.data&&n.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:n.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new Er.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new Er.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{gt(this.cell,"Create new cell after current");let n=new Er.NotebookCellData(Er.NotebookCellKind.Code,e.text,this.cell.document.languageId);n.outputs=[],n.metadata={};let i=Er.NotebookEdit.insertCells(this.cell.index+1,[n]);t.set(this.cell.notebook.uri,[i])}Er.workspace.applyEdit(t).then(f,f)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){gt(this.cell,`Kernel switching to ${e.content.execution_state}`)}handleStreamMessage(e){if(au(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==au(e))return;gt(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.execution||this.createTemporaryTask(),n=e.content.name==="stdout"?Er.NotebookCellOutputItem.stdout("").mime:Er.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===n)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=ua({output_type:"stream",name:e.content.name,text:e.content.text});gt(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(f,f)}else if(i){let o=Cs(e.content.text),s=ua({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},gt(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(f,f)}else{let o=aV(Cs(e.content.text)),s=ua({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},gt(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(f,f)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:XE(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===au(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.execution||this.createTemporaryTask();this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.execution||this.createTemporaryTask();this.clearLastUsedStreamOutput(),t?.clearOutput().then(f,f),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;re(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),re(`Traceback for error after formatting ${t}`);let n={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};this.addToCellData(n,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){j("Update display data message received, but no display id",e.content);return}let n=Xr.getMappedOutput(this.cell.notebook,t);if(!n){j("Update display data message received, but no output found to update",e.content);return}if(n.cell.document.isClosed){j("Update display data message received, but output cell is closed",e.content);return}let i=QE(new Er.NotebookCellOutput(n.outputItems,n.outputContainer.metadata)),o=ua({...i,data:e.content.data,metadata:e.content.metadata});if(n.outputItems.length===0&&o.items.length===0){E("Update display data message received, but no output to update",e.content);return}let s=!1;if(n.outputItems.length===o.items.length){let c=!0;if((0,GK.default)(n.outputContainer.metadata||{},o.metadata||{})||(s=!0,c=!1),c){for(let l=0;l<n.outputItems.length;l++)if(!(0,GK.default)(n.outputItems[l],o.items[l])){c=!1;break}}if(c){E("Update display data message received, but no output to update (data is the same)",e.content);return}}let a=this.execution||this.createTemporaryTask();if(gt(this.cell,`Replace output items in display data ${o.items.length}`),s){let c=n.cell.outputs.map(l=>{let u=QE(l);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:l});a?.replaceOutput(c,n.cell).then(f,f),Xr.trackOutputByDisplayId(n.cell,t,o,o.items)}else a?.replaceOutputItems(o.items,n.outputContainer).then(f,f),Xr.trackOutputByDisplayId(n.cell,t,n.outputContainer,o.items);this.endTemporaryTask()}};g([Nr()],td.prototype,"handleReply",1);var rC=td;var rd=class extends Error{constructor(t){super(t.evalue||t.ename);this.ename=t.ename,this.evalue=t.evalue,this.traceback=t.traceback}};var p_=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,n,i){return zK.fromCell(e,t,n,this.controller,this.requestListener,i)}},zK=class r{constructor(e,t,n,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=n;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=ce();this.cancelHandled=!1;this.disposables=[];this._preExecuteEmitter=new Ca.EventEmitter;if(Ca.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){H(`Disposing request as the cell (${this.cell.index}) was deleted ${V(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(c){x(`Error during cell execution dispose: ${c}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),Al.setCellState(e,Ca.NotebookCellExecutionState.Idle),this.canExecuteCell())this.execution=Hi.getOrCreate(e,this.controller,!s?.msg_id),Al.setCellState(e,Ca.NotebookCellExecutionState.Pending);else{let a=Hi.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get preExecute(){return this._preExecuteEmitter.event}static fromCell(e,t,n,i,o,s){return new r(e,t,n,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){gt(this.cell,"Not starting as it was cancelled");return}if(gt(this.cell,"Start execution"),re(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(f,f),this.completedWithErrors(new fn),this.result):this.started?(gt(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),x(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,fy.set(this.cell.notebook,this.execution),Al.setCellState(this.cell,Ca.NotebookCellExecutionState.Executing),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(f),this.result)}async resume(e,t){if(this.cancelHandled){gt(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(gt(this.cell,"Start resuming execution"),re(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(x(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,fy.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),Al.setCellState(this.cell,Ca.NotebookCellExecutionState.Executing),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(n=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,n),this.completedWithErrors(n.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(f),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){gt(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(f);return}this.cancelHandled||this._completed||(gt(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,gt(this.cell,"Execution disposed"),Q(this.disposables))}completedWithErrors(e,t,n=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?j("Cell completed with errors",e):j(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),gt(this.cell,"Completed with errors"),n){let i,o;e&&!(e instanceof Xe)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&i5(this.session)&&(e=new fn),e&&(e instanceof Xe?i=im(Ca.workspace.workspaceFolders||[],e,pt(this.kernelConnection),this.kernelConnection.interpreter?.sysPrefix)?.message:i=e.message||e.name||e.stack),o=Ah(i||""),o&&this.execution?.appendOutput(o).then(f,f)}this.endCellTask("failed",t),gt(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){gt(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),gt(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}fy.get(this.cell.notebook)===this.execution&&fy.set(this.cell.notebook,void 0),Al.setCellState(this.cell,Ca.NotebookCellExecutionState.Idle),this.execution=void 0}}completedDueToCancellation(){gt(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),gt(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(gt(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(f,f)),gt(this.cell,"Empty cell execution"),this.completedSuccessfully();let n={cellId:this.cell.document.uri.toString(),...this.cell.metadata?.custom?.metadata||{}},i=t.kernel;try{this._preExecuteEmitter.fire(this.cell),E(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,n),this.request.done.then(f,f)}catch(o){return x(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{x(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{gt(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();gt(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new rd(o.content),s,!1):this.completedSuccessfully(s),gt(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&x("Error in waiting for cell to complete",o),gt(this.cell,"Some other execution error"),o&&o instanceof Error&&dr(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var o5=require("vscode");var d_=class{constructor(e,t,n,i){this.controller=e;this.context=t;this.formatters=n;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;o5.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){Q(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new rC(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,n),n}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let n=new rC(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,n),n}};var QK=require("vscode");var m_=require("vscode");function Qc(r,e){E(`Execution Id:${r}. ${e}.`)}var s5=new Map,f_=class r{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new m_.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new m_.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new m_.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=ce();this.cancelHandled=!1;this.disposables=[];let n=s5.get(t)||0;n+=1,s5.set(t,n),this.executionId=`${t}-${n}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new r(e,t)}async start(e){if(this.session=e,this.cancelHandled){Qc(this.executionId,"Not starting as it was cancelled");return}if(Qc(this.executionId,"Start Code execution"),re(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new fn);return}if(this.started)return Qc(this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),x(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(f)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){Qc(this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&await e.interrupt().catch(f),this.request?.dispose(),await this.request?.done.catch(f)}this.cancelHandled||this._completed||(Qc(this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||Qc(this.executionId,"Execution disposed"),Q(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}Qc(this.executionId,"Send code for execution");let n=t.kernel;try{this.started=!0,this._onRequestSent.fire(),Qc(this.executionId,"Execution Request Sent to Kernel"),this.request=SV(n,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(f,f)}catch(i){x(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(Qc(this.executionId,"Executed with errors"),this._done.reject(new rd(i.content))):(Qc(this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested?x(`Error in waiting for code ${this.executionId} to complete`,i):x(`Some other execution error for exec ${this.executionId}`,i),this._done.reject(i)}}};var h_=class{constructor(e,t,n,i){this.session=e;this.executionFactory=t;this.metadata=n;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this._onPreExecute=new QK.EventEmitter;this._onPostExecute=new QK.EventEmitter;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}get onPreExecute(){return this._onPreExecute.event}get onPostExecute(){return this._onPostExecute.event}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,n){return this.enqueue({code:e,extensionId:t,token:n})}enqueue(e){let t;if("cell"in e){let{cell:n,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===n);if(o)return gt(n,"Use existing cell execution"),o;let s=this.executionFactory.create(n,i,this.metadata);t=s,this.disposables.push(s),s.preExecute(a=>this._onPreExecute.fire(a),this,this.disposables),this.queueOfItemsToExecute.push(s),gt(n,"User queued cell for execution")}else{let{code:n,extensionId:i,token:o}=e,s=f_.fromCode(n,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(gm(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){gt(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),gt(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,E("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(n=>e===n.cell):this.queueOfItemsToExecute;await Promise.all(t.map(n=>n.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(f),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){x("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(n=>n.type==="cell"&&gt(n.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let n=this.queueOfItemsToExecute[0];this.lastCellExecution=n,n.type==="cell"&&gt(n.cell,"Before Execute individual cell");let i=!0;try{n.type==="cell"&&n.cell.notebook.isClosed?e=!0:n.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await n.start(t).then(()=>!0).catch(()=>!1))}finally{n.type==="cell"&&gt(n.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(n);s>=0&&this.queueOfItemsToExecute.splice(s,1),n.type==="cell"&&this._onPostExecute.fire(n.cell)}let o=!1;if(n.type==="cell"&&GE(n.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){j(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,j("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var d5=require("vscode");function Yc(r){if(typeof r!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof r}\``);var e=c5();let t=e;return t.default&&(t=t.default),r.replace(t(),"")}var nf=require("vscode");var Hfe=new Map([["julia",Yfe],["python",zfe],["r",Xfe]]);function l5(r,e){let t=Hfe.get(e.toLowerCase());return t?t(r):r}var Gfe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function zfe(r){let e=Ke(r,{trim:!1,removeEmptyEntries:!1}),t=-1,n=!1,i=!1,o=[],s=new Set,a=!1,c="",l=!1,u=!1;if(e.map((m,h)=>{if(h===0){let b=["Signature:","Init signature:"].find(w=>m.toLowerCase().startsWith(w.toLowerCase()));if(b){n=!0,m=m.substring(b.length).trim(),o.push("```python"),m.trim().length&&(o.push(m),l=!0);return}}if(m.startsWith("File:")&&h===e.length-1||m.startsWith("Type:")&&h===0)return;if(!a&&m.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let v=Gfe.find(b=>m.trim().toLowerCase().startsWith(b.toLowerCase()));if(v&&!s.has(v)){c=v.toLowerCase(),s.add(v),a=!0,t=h,i=!1,n&&o.push("```","----------"),n=!1,u=!1,c!=="docstring:"&&o.push(`## ${v}`);let b=m.includes(":")?m.split(":")[1].replace("<no docstring>","").trim():"";b.length&&(o.push(b),l=!0);return}if(!i){if(t+1===h&&m.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=h,i=!1,n=!1,u=!1;return}if(c==="parameters"||c==="see also"){m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="options:"){m.startsWith("-")&&m.trim().length&&m.includes(":")&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="returns"){m.trim().length&&m.substring(0,1)===m.trim().substring(0,1)?o.push(`* ${m}`):o.push(m),l=l||m.trim().length>0;return}if(c==="examples"&&!n&&(t+1===h||t+2===h))return i=!1,n=!0,l=l||m.trim().length>0,o.push("```python",m);if(!n&&m.startsWith("class ")&&m.trim().endsWith("):")){n=!0,u=!0,o.push("```python",m),l=l||m.trim().length>0;return}if(n&&u&&m.trim().length>0&&m.substring(0,1)!==" "&&m.substring(0,1)!=="	")return n=!1,u=!1,o.push(m,"```");l=l||m.trim().length>0,o.push(m)}}),!l)return"";let p=o.join(`  
`);return n?new nf.MarkdownString(p+"  \n```"):new nf.MarkdownString(p)}var Qfe=[{section:"Examples:",header:"Examples",nextLine://g},{section:"Usage note",header:"Usage note",nextLine://g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:String.fromCharCode(9474)}];function Yfe(r){let e=Ke(r,{trim:!1,removeEmptyEntries:!1}),t=!1,n=[],i=new Set,o="",s=!1,a=!1;e.every(l=>l.trim().length===0||l.startsWith("  "))&&e.forEach((l,u)=>e[u]=l.trim().length?l.substring(2):l),e.map((l,u)=>{if(l.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,n.push(l);if(!a)return o="signature",t=!0,a=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");o==="signature"&&l.trim()===""&&(o="",t=!1,s=!1,n.push("```"));let p=Qfe.find(m=>l.trim().toLowerCase().startsWith(m.header.toLowerCase()));if(p&&(typeof p.nextLine=="string"?e[u+1].trim()===p.nextLine.trim():e[u+1].trim().replace(p.nextLine,"").length===0)){e[u+1]="",o=p.section.toLowerCase(),i.add(p.header),t&&n.push("```"),t=!1,n.push(`## ${p.section}`),o==="note:"&&!e.slice(u+1).every(m=>m.trim().length===0||m.trim().startsWith("|")||m.trim().startsWith(String.fromCharCode(9474)))&&(o="");return}if(o==="examples:"&&!t)return t=!0,l.trim().length?(s=!0,n.push("```julia",l)):n.push("```julia");if(o==="note:"){n.push(l.trim()?l.trim().substring(1):"");return}t&&!s&&l.trim().length===0||n.push(l)});let c=n.join(`  
`);return t?new nf.MarkdownString(c+"  \n```"):new nf.MarkdownString(c)}function Xfe(r){let e=Ke(r,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,c)=>e[c]=a.indexOf("     ")===0?a.substring(5):a);let n="",i=!1,o=!1;e.map(a=>{let c=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes(String.fromCharCode(8))&&a.split("_").length===a.split(String.fromCharCode(8)).length&&c){i&&t.push("```"),i=!1,n=c.trim().toLowerCase(),t.push(`## ${c}`);return}if((n==="examples"||n==="examples:"||n==="usage"||n==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(n==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new nf.MarkdownString(s+"  \n```"):new nf.MarkdownString(s)}var Zfe=5,ehe=3,m5=ps.IntellisenseTimeout,YK=new Set,u5=new Map,g_=class extends Error{constructor(){super("Request timed out")}};async function f5(r,e,t,n,i,o,s,a,c){if(!r.range||!n.session?.kernel||YK.has(i))return r;let l=new Be,u={duration:0,pendingRequests:0,requestDuration:0},p={kernelId:i,kernelConnectionType:n.kernelConnectionMetadata.kind,kernelLanguage:Di(n.kernelConnectionMetadata),monacoLanguage:xs(Di(n.kernelConnectionMetadata)||""),cancelled:!1,completed:!1,completedWithData:!1,kernelStatusBeforeRequest:n.status,requestSent:!1};if(n.status!=="idle")return A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",u,p),r;p.requestSent=!0;let m=ihe(e||r,s,a),h=nhe(m,n.session.kernel,t,p,u,c);try{let v=await bw(m5,new g_,mr(t,h));if(p.kernelStatusAfterRequest=n.status,p.cancelled=t.isCancellationRequested,p.completed=!t.isCancellationRequested,u.duration=l.elapsedTime,!p.cancelled&&v?.status==="ok"&&v?.found){let b=the(v);r.documentation=l5(b,o),p.completedWithData=b.length>0}}catch(v){p.requestTimedout=v instanceof g_,rhe(n,o)}return A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",u,p),r}function the(r){return!r||r.status!=="ok"||!r.found?";":!r.data||typeof r.data!="object"?"":"text/plain"in r.data?Yc(r.data["text/plain"]):""}function rhe(r,e){let t=r.kernelConnectionMetadata.id;if(YK.has(t))return;let n=u5.get(t)||0;if(n+=1,u5.set(t,n),n>=Zfe){j(`Failed to inspect code in kernel ${pt(r.kernelConnectionMetadata)} ${n} times.}`),A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:r.kernelConnectionMetadata.kind,kernelLanguage:e}),YK.add(t);return}}async function nhe(r,e,t,n,i,o){if(i.pendingRequests=p5(e),XK(e)&&(H(`Too many pending requests ${p5(e)} for kernel ${e.id}, waiting for it to be ready.`),await mr(t,ahe(e,t))),t.isCancellationRequested)return Promise.resolve({data:{},found:!1,status:"ok",metadata:{}});let s=she(e),a=new Be,c=Ke(r.code).reverse()[0].slice(-50);E(`Inspecting code ${c}`);let l=e.requestInspect(r).finally(()=>{n.completed=!0,i.requestDuration=a.elapsedTime,n.kernelStatusAfterRequest=e.status,s.dispose()});return ohe(l,a,n,i,o,c),l.then(({content:u})=>(t.isCancellationRequested?E(`Inspected code ${c} in ${a.elapsedTime}ms (but cancelled)`):E(`Inspected code ${c} in ${a.elapsedTime}ms`),u))}function ihe(r,e,t){let n=e.getText(),i=(typeof r.insertText=="string"?r.insertText:r.insertText?.value)||(typeof r.label=="string"?r.label:r.label.label)||"",o=n.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}function ohe(r,e,t,n,i,o){let s=m5*10,a=setTimeout(()=>{t.requestTimedout=!0,n.requestDuration=e.elapsedTime,A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",n,t),j(`Timeout (after ${s}ms) waiting to inspect code '${o}'`)},s),c=new d5.Disposable(()=>clearTimeout(a));i.add(c),r.finally(()=>{!t.cancelled||!t.requestTimedout||(c.dispose(),t.completed=!0,n.requestDuration=e.elapsedTime,A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_RESOLVE",n,t))})}var wa=new WeakMap;function XK(r){return wa.has(r)||wa.set(r,{count:0}),(wa.get(r)?.count||0)>=ehe}function p5(r){return wa.has(r)||wa.set(r,{count:0}),wa.get(r)?.count||0}function she(r){let e=wa.get(r)||{count:0};return wa.set(r,e),e.count+=1,{dispose:()=>{e.count-=1}}}async function ahe(r,e){let t=[];await mr(e,new Promise(n=>{let i=()=>{XK(r)||(n(),Q(t))},o=setInterval(()=>{XK(r)||(n(),Q(t))},50);gm(e.onCancellationRequested)(()=>{n(),r.statusChanged.disconnect(i)},void 0,t),r.statusChanged.connect(i),t.push({dispose:()=>{clearInterval(o),r.statusChanged.disconnect(i)}})}))}var v_=class{constructor(e,t,n,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this._onPreExecute=new js.EventEmitter;this.onPreExecute=this._onPreExecute.event;this._onPostExecute=new js.EventEmitter;this.onPostExecute=this._onPostExecute.event;this.documentExecutions=new WeakMap;let o=new d_(e.controller,t,n,i);this.disposables.push(o),this.executionFactory=new p_(e.controller,o),js.notebooks.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===js.NotebookCellExecutionState.Idle&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),this.disposables.push(this._onPreExecute)}get executionCount(){return this._visibleExecutionCount}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(gt(e,`NotebookKernelExecution.resumeCellExecution (start), ${V(e.notebook.uri)}`),e.kind==js.NotebookCellKind.Markup)return;await Qo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata),Tt(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let n=this.kernel.start(new Yt(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,n);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);gt(e,`NotebookKernelExecution.resumeCellExecution (completed), ${V(e.notebook.uri)}`),E(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){gt(e,`NotebookKernelExecution.executeCell (1), ${V(e.notebook.uri)}`);let n=this.kernel.session?.kernel&&wa.get(this.kernel.session.kernel)?.count||0,i=new Be;if(e.kind==js.NotebookCellKind.Markup)return;gt(e,`NotebookKernelExecution.executeCell, ${V(e.notebook.uri)}`),await Qo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let o=this.kernel.start(new Yt(!1));await this.kernel.restarting,gt(e,`NotebookKernelExecution.executeCell (2), ${V(e.notebook.uri)}`);let s=this.getOrCreateCellExecutionQueue(e.notebook,o);s.queueCell(e,t);let a=!0;try{await s.waitForCompletion(e)}catch(c){throw a=!1,c}finally{gt(e,`NotebookKernelExecution.executeCell completed (3), ${V(e.notebook.uri)}`),E(`Cell ${e.index} executed ${a?"successfully":"with an error"}`);let c=this.kernel.session?.kernel&&wa.get(this.kernel.session.kernel)?.count||0;Tt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:i.elapsedTime,pendingInspectRequestsAfter:c,pendingInspectRequestsBefore:n})}}async*executeCode(e,t,n,i){let o=new Be;await Qo(this.kernel.resourceUri,this.kernel.kernelConnectionMetadata);let s=this.kernel.start(new Yt(!1));await this.kernel.restarting;let c=this.getOrCreateCellExecutionQueue(this.notebook,s).queueCode(e,t,i);E(`Queue code ${c.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let l=!1,u=[];c.result.finally(()=>{l=!0,!i.isCancellationRequested&&H(`Execution of code ${c.executionId} completed in ${o.elapsedTime}ms`),Tt(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),Q(u)}).catch(f);let p=ds(c.result),m=[],h=ce();for(u.push(c.onRequestSent(()=>n.started.fire())),u.push(c.onRequestAcknowledged(()=>n.executionAcknowledged.fire())),c.onDidEmitOutput(v=>{m.push(v),h.resolve(),h=ce()},this,u),i.onCancellationRequested(()=>{l||E(`Code execution cancelled by extension ${t}`)},this,u);;){for(await Promise.race([h.promise,p.promise]),l&&(h=ce());m.length;)yield m.shift();if(p.completed)break}}executeHidden(e){return this.kernel.start().then(n=>n.kernel?hn(n.kernel,e):Promise.reject(new fn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(H("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(f)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),n=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(f)):Promise.resolve();n||(H("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let n=this.documentExecutions.get(e);if(n&&!n.isEmpty&&!n.failed)return n;let i=new h_(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),js.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(E(`Cancel executions after closing notebook ${V(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),i.onPreExecute(o=>this._onPreExecute.fire(o),this,this.disposables),i.onPostExecute(o=>this._onPostExecute.fire(o),this,this.disposables),this.documentExecutions.set(e,i),i}};var hy=class extends t_{constructor(t,n,i,o,s,a,c,l,u){super(t,n);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=c;this.startupCodeProviders=l;this.workspaceStorage=u;n.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t.notebookType===Et?n.resourceUri:t.uri,s=HK(this.configService,o),a=t.uri.path.endsWith(".interactive")||n.resourceUri?.path.endsWith(".interactive")?Et:It,c=new a_(o,t,n.metadata,this.sessionCreator,s,n.controller,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.executions.set(c,new v_(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(c),c}};hy=g([(0,ln.injectable)(),d(0,(0,ln.inject)(ni)),d(1,(0,ln.inject)(K)),d(2,(0,ln.inject)(HS)),d(3,(0,ln.inject)(ae)),d(4,(0,ln.inject)(ct)),d(5,(0,ln.inject)(Zt)),d(6,(0,ln.multiInject)(ng)),d(7,(0,ln.inject)(da)),d(8,(0,ln.inject)($e)),d(8,(0,ln.named)(ri))],hy);var gy=class extends r_{constructor(t,n,i,o,s,a){super(t,n);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,n){let i=this.getInternal(t);if(i&&i.options.metadata.id===n.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=HK(this.configService,o),a=o.path.endsWith(".interactive")?Et:It,c=new s_(t,o,n.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(l=>this._onKernelStatusChanged.fire({kernel:c,status:l}),this,this.disposables),this.asyncDisposables.push(c),this.storeKernel(t,n,c),this.deleteMappingIfKernelIsDisposed(t,c),c}};gy=g([(0,ln.injectable)(),d(0,(0,ln.inject)(ni)),d(1,(0,ln.inject)(K)),d(2,(0,ln.inject)(HS)),d(3,(0,ln.inject)(ae)),d(4,(0,ln.inject)(da)),d(5,(0,ln.inject)($e)),d(5,(0,ln.named)(ri))],gy);var of=k(M()),cu=require("vscode");var vy=class{constructor(e,t,n,i){this.extensionChecker=t;this.interpreterService=n;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){Q(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();H(`Start refreshing Kernel Picker (${t})`);let n=cu.notebooks.createNotebookControllerDetectionTask(It),i=cu.notebooks.createNotebookControllerDetectionTask(Et);this.disposables.push(n),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(H(`End refreshing Kernel Picker (${t})`),n.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;cu.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&_t(o.notebook)&&(e=!0,H("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables),cu.workspace.onDidOpenNotebookDocument(o=>{!e&&_t(o)&&(e=!0,H("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(f))},this,this.disposables);let t,n="",i=()=>(t&&!t.isDisposed||(n=Date.now().toString(),H(`Start refreshing Kernel Picker (${n})`),t=new Ko(cu.notebooks.createNotebookControllerDetectionTask(It),cu.notebooks.createNotebookControllerDetectionTask(Et)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(H(`End refreshing Kernel Picker (${n})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(H(`End refreshing Kernel Picker (${n})`),t?.dispose()):i()},this,this.disposables)}};vy=g([(0,of.injectable)(),d(0,(0,of.inject)(K)),d(1,(0,of.inject)(ze)),d(2,(0,of.inject)(Qe)),d(3,(0,of.inject)(Tr))],vy);var h5=k(M());var yy=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};yy=g([(0,h5.injectable)()],yy);var nC=k(M());var by=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await x7(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};by=g([(0,nC.injectable)(),d(0,(0,nC.inject)(Fe)),d(1,(0,nC.inject)(K))],by);var iC=k(M());var g5=require("vscode");var Iy=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){Q(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=ft.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${pt(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new Ko,n=setTimeout(()=>{t.isDisposed||t.add(ft.createProgressReporter(e.resourceUri,y.interruptKernelStatus(pt(e.kernelConnectionMetadata))))},1e3);t.add(new g5.Disposable(()=>clearTimeout(n))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};Iy=g([(0,iC.injectable)(),d(0,(0,iC.inject)(Fe)),d(1,(0,iC.inject)(K))],Iy);var y_=k(M()),v5=require("vscode"),b_=require("vscode");var Sy=class{constructor(e){this.disposables=e}activate(){try{this.disposables.push(v5.workspace.registerPortAttributesProvider({},this))}catch(e){x("Failure in registering port attributes",e)}}providePortAttributes(e,t){try{if(So.has(e.port))return new b_.PortAttributes(b_.PortAutoForwardAction.Ignore)}catch(n){x("Failure in returning port attributes",n)}}};Sy=g([(0,y_.injectable)(),d(0,(0,y_.inject)(K))],Sy);var uu=k(M()),sC=require("vscode");var Pa=k(M()),oC=require("vscode");var Ea=require("vscode");var che=/python\s\d*.?\d*$/,ZK="__old_vscode_kernelspecs",eF=class{constructor(e,t,n){this.fs=e;this.globalState=t;this.jupyterPaths=n;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&E(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(f,f)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){Q(this.disposables)}async loadKernelSpec(e,t,n){if(e.fsPath.includes(ZK))return;let i=dn(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,n).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),c=s&&a&&Mn(s)&&s.specFile&&SS(Ea.Uri.file(s.specFile),a);if(s&&!c)return s;s?.specFile&&c&&this.deleteOldKernelSpec(s.specFile).catch(f),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(l=>Ii(l.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(f)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=De(ut(e)),n=We(ut(ut(e)),ZK);this.oldKernelSpecsFolder=n;let i=We(n,t,De(e));await this.fs.createDirectory(Ea.Uri.file(ut(i))),await this.fs.copy(Ea.Uri.file(e),Ea.Uri.file(i)).catch(f),await this.fs.delete(Ea.Uri.file(e)),E(`Old KernelSpec '${e}' deleted and backup stored in ${n}`)}async loadKernelSpecImpl(e,t,n){return lhe(e,this.fs,t,n)}async findKernelSpecsInPaths(e,t){let n=dn(e),i=this.findKernelSpecsInPathCache.get(n);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(c=>sr(e,c)):[])();this.findKernelSpecsInPathCache.set(n,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),s.dispose()}).catch(f),o.catch(a=>{this.findKernelSpecsInPathCache.get(n)===o&&this.findKernelSpecsInPathCache.delete(n),E(`Failed to search for kernels in ${V(e)} with an error`,a)}),o}},xy=class{constructor(e,t,n,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=n;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new ao;this._onDidChangeStatus=new Ea.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new Ea.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new eF(e,n,s),this.disposables.push(this.kernelSpecFinder)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let n=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(n),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Es.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}async writeToMementoCache(e,t){await this.memento.update(t,JSON.stringify({kernels:e.map(n=>n.toJSON()),extensionVersion:this.env.extensionVersion}))}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(Ea.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(n=>n&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function lhe(r,e,t,n){if(r.fsPath.includes(ZK))return;let i;try{E(`Loading kernelspec from ${V(r)} ${n?.uri?`for ${V(n.uri)}`:""}`),i=JSON.parse(await e.readFile(r))}catch(l){x(`Failed to parse kernelspec ${r}`,l);return}if(t.isCancellationRequested||(i.name=n?await nN(n):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(che)&&i.language===xe&&i.argv.length>2){let l=i.argv.slice(1).map(u=>u.toLowerCase()).filter(u=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(u));l.length&&(i.name=`${i.name}.${l.join("#")}`)}i.metadata=i.metadata||{},i.metadata.vscode=i.metadata.vscode||{},i.metadata.vscode.originalSpecFile||(i.metadata.vscode.originalSpecFile=r.fsPath),i.metadata.vscode.originalDisplayName||(i.metadata.vscode.originalDisplayName=i.display_name),i.metadata.originalSpecFile&&(i.metadata.vscode.originalSpecFile=i.metadata.originalSpecFile,delete i.metadata.originalSpecFile);let s=new op(i,r.fsPath,n?.uri.fsPath||i?.metadata?.interpreter?.path,Mn(i));s.name=i?.name||De(ut(r.fsPath));let a=n?.uri.fsPath||i?.metadata?.interpreter?.path,c=!!n?.isCondaEnvWithoutPython;if(!(a&&!c&&!await e.exists(Ea.Uri.file(a))))return i.isRegisteredByVSC=Mn(i),s}function y5(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${oC.env.appHost}:${oC.env.remoteName||""}`}var es=class extends xy{constructor(t,n,i,o,s,a){super(t,i,o,s,a,n);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(y5()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(n=>this._kernels.set(n.id,n)),this._onDidChangeKernels.fire())}).catch(f),this.refresh().then(f,f)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new oC.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),y5()).catch(f)}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,p)=>u.id.localeCompare(p.id)),a=o.sort((u,p)=>u.id.localeCompare(p.id)),c=new Set(o.map(u=>u.id)),l=s.filter(u=>!c.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),l.length&&(E(`Local kernel spec connection deleted ${l.map(u=>`${u.kind}:'${u.id}'`)}`),l.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||l.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let n=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(n.map(c=>this.kernelSpecFinder.findKernelSpecsInPaths(c,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async c=>{try{let l=await this.kernelSpecFinder.loadKernelSpec(c,t);if(!l||t.isCancellationRequested)return;if(WD(l,"local"),l.metadata?.originalSpecFile){if(o.has(l.metadata.originalSpecFile))return;o.add(l.metadata.originalSpecFile)}if(l.specFile){if(o.has(l.specFile))return;o.add(l.specFile)}let u=a.get(l.display_name),p=up.create({kernelSpec:l,interpreter:void 0,id:ki(l)});u&&u.executable!==l.executable?(s.push(p),Ro(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?j(`Duplicate kernel found ${l.display_name} ${l.executable} in ${l.specFile}`):(s.push(p),a.set(l.display_name,l),Ro(p,this._kernels.get(p.id))||(this._kernels.set(p.id,p),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(l){x(`Failed to load kernelSpec for ${c}`,l);return}})),s}};g([hv(100)],es.prototype,"writeKernelsToMemento",1),es=g([(0,Pa.injectable)(),d(0,(0,Pa.inject)(hr)),d(1,(0,Pa.inject)(Kr)),d(2,(0,Pa.inject)(ze)),d(3,(0,Pa.inject)($e)),d(3,(0,Pa.named)(yt)),d(4,(0,Pa.inject)(K)),d(5,(0,Pa.inject)(_c))],es);var wo=k(M()),b5=require("vscode");var nd=Symbol("ITrustedKernelPaths");var Qn=require("vscode");function tF(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Qn.env.appHost}:${Qn.env.remoteName||""}`}async function uhe(r,e,t,n,i){let o=Qn.Uri.file(We(r.sysPrefix,b7)),s=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||s.some(u=>Ii(u,o)))return;let a=await n.findKernelSpecsInPaths(o,e);if(e.isCancellationRequested)return;let c=new Set,l=new Map;await Promise.all(a.map(async u=>{try{let p=await n.loadKernelSpec(u,e,r);if(e.isCancellationRequested||!p)return;if(p.metadata?.originalSpecFile){if(c.has(p.metadata.originalSpecFile))return;c.add(p.metadata.originalSpecFile)}if(p.specFile){if(c.has(p.specFile))return;c.add(p.specFile)}let m=l.get(p.display_name);m&&m.executable!==p.executable?i.fire(p):m||(l.set(p.display_name,p),i.fire(p))}catch(p){x(`Failed to load kernel spec ${u}`,p)}}))}var I_=class extends er{constructor(t,n,i,o,s){super();this.interpreter=t;this.interpreterService=n;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new Qn.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new Qn.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new Qn.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>E(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=this.interpreterService.resolvedEnvironments.find(n=>n.id===this.interpreter.id);t&&(this.interpreter.envPath!==t.envPath||this.interpreter.version?.raw!==t.version?.raw||this.interpreter.envType!==t.envType||this.interpreter.sysPrefix!==t.sysPrefix)&&this.listKernelSpecs(!0).catch(f)}async listKernelSpecsImpl(){let t=this.cancelToken.token;E(`Search for KernelSpecs in Interpreter ${yn(this.interpreter.uri)}`);let n=new Map,i=new Qn.EventEmitter,o=i.event(p=>{if(t.isCancellationRequested)return;if(p.language===xe&&(!p.env||Object.keys(p.env).length===0)&&eP(p)){E(`Hiding default kernel spec '${p.display_name}', '${p.name}', ${yn(p.argv[0])} for interpreter ${yn(p.interpreterPath)} and spec ${yn(p.specFile)}`);return}let m=Jm(p)?Fo.create({kernelSpec:p,interpreter:this.interpreter,id:ki(p,this.interpreter)}):up.create({kernelSpec:p,interpreter:this.interpreter,id:ki(p,this.interpreter)});m&&!this._kernels.has(m.id)&&(this._kernels.set(m.id,m),this._onDidChangeKernels.fire({added:[m],removed:[]})),m&&!n.has(m.id)&&n.set(m.id,m)}),[s]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),uhe(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,i)]);if(i.dispose(),o.dispose(),t.isCancellationRequested)return;let c=await ws(this.interpreter,s);if(t.isCancellationRequested)return;let l=Fo.create({kernelSpec:c,interpreter:this.interpreter,id:ki(c,this.interpreter)});this._kernels.has(l.id)||(this._kernels.set(l.id,l),this._onDidChangeKernels.fire({added:[l],removed:[]})),n.has(l.id)||n.set(l.id,l);let u=Array.from(this._kernels.keys()).filter(p=>!n.has(p)).map(p=>this._kernels.get(p));u.forEach(p=>this._kernels.delete(p.id)),this._onDidChangeKernels.fire({added:[],removed:u})}},S_=class r{constructor(e,t,n,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=n;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Qn.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!Ro(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){Q(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Qn.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,n){let i=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await ht(e.specFile):"",c=!!Mn(e);if(e.language&&e.language!==xe){!c&&o&&e.specFile&&wD(o)&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:De(o)!==o,argv0:De(o),language:s,isCreatedByUs:c});return}let l=i.find(u=>e.metadata?.interpreter?.path&&Oo(Qn.Uri.file(e.metadata.interpreter.path),u.uri)?(E(`Kernel ${e.name} matches ${yn(u.id)} based on metadata.interpreter.`),!0):!1);if(l)return l;if(o&&De(o)===o&&e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:De(o),language:s,isCreatedByUs:c}),o&&De(o)!==o){let u=Qn.Uri.file(o),p=i.find(m=>Oo(u,m.uri)?(E(`Kernel ${e.name} matches ${yn(m.id)} based on argv.`),!0):!1);if(p)return e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"found",language:s,isCreatedByUs:c}),p;if(!e.specFile||this.trustedKernels.isTrusted(Qn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(n?.isCancellationRequested)return;if(m)return e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:c}),m;e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:c})}else e.specFile&&!c&&A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:De(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:c})}if(e.interpreterPath){let u=Qn.Uri.file(e.interpreterPath),p=i.find(m=>e.interpreterPath&&Oo(u,m.uri)?(E(`Kernel ${e.name} matches ${yn(m.id)} based on interpreterPath.`),!0):!1);if(p)return p;if(!e.specFile||this.trustedKernels.isTrusted(Qn.Uri.file(e.specFile))){let m=await this.interpreterService.getInterpreterDetails(u,n);if(m)return m}}if(!n?.isCancellationRequested)return i.find(u=>e.display_name===u.displayName?(E(`Kernel ${e.name} matches ${yn(u.id)} based on display name`),A("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?De(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:c}),!0):!1)}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===xe)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(r.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),j(`Kernel Spec for '${e.display_name}' (${yn(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){E("Finding Global Python KernelSpecs");let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Mn(s.kernelSpec)),n=s=>{if(s.kernelSpec.language!==xe)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),c=a.indexOf("-m");if(c===-1)return!1;let l=a.length-1>=c?a[c+1]:void 0;return l?l!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Mn(s.kernelSpec);return!!(!a&&(n(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===xe&&!eP(s.kernelSpec))}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let l=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(wD(l)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let c=up.create({kernelSpec:s.kernelSpec,interpreter:a,id:ki(s.kernelSpec,a)});i.set(c.id,c),c.kernelSpec.specFile&&o.add(c.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var lu=class extends xy{constructor(t,n,i,o,s,a,c,l,u){super(n,o,a,c,l,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new S_(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f)},this,this.disposables),t.onDidRemoveInterpreter(p=>{E(`Interpreter removed ${p.id}`);let m=[];this._kernels.forEach(h=>{h.interpreter?.id===p.id&&(E(`Interpreter ${p.id} deleted, hence deleting corresponding kernel ${h.kind}:'${h.id}`),m.push(h),this._kernels.delete(h.id))}),m.length&&(E(`Local Python connection deleted ${m.map(h=>`${h.kind}:'${h.id}: (interpreter id=${yn(h.interpreter?.id)})'`)}`),this.updateCache().catch(f))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(tF()).then(t=>{t.length&&(t.filter(n=>!this._kernels.has(n.id)).forEach(n=>{this._kernelsFromCache.push(n),this._kernels.set(n.id,n)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(f),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,n=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==n.length||!Ro(t,n))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(f))},this,this.disposables)}).catch(f)}get kernels(){return Array.from(this._kernels.values())}dispose(){Q(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(f),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let n=this.refreshCancellation=new b5.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(n.token,t).catch(o=>x("Failure in listKernelsImplementation",o)),!n.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(l=>!this._kernelsExcludingCachedItems.has(l.id)),s=[];o.length&&(j(`Kernels ${o.map(l=>`${l.kind}:'${l.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(l=>`${l.kind}:'${l.id}'`).join(", ")}`),o.forEach(l=>{this._kernels.delete(l.id),s.push(l)}));let a=new Set(this.interpreterService.resolvedEnvironments.map(l=>l.id)),c=Array.from(this._kernels.values()).filter(l=>!!(l.interpreter&&!a.has(l.interpreter.id)));c.length&&(j(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${c.map(l=>`${l.kind}:'id=${l.id}'(interpreterId='${yn(l.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),c.forEach(l=>{this._kernels.delete(l.id),s.push(l)})),s.length&&(E(`Local Python connection deleted ${s.map(l=>`${l.kind}:'${l.id}: (interpreter id=${yn(l.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>x("Failed to discover kernels in interpreters",o)).finally(()=>{n===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,tF()).catch(f)),this.updateCachePromise}async listKernelsImplementation(t,n){let i=this.extensionChecker.isPythonExtensionInstalled?this.interpreterService.resolvedEnvironments:[],o=Promise.all(i.map(async a=>{let c=this.interpreterKernelSpecs.get(a.id);c||(c=new I_(a,this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(c),this.interpreterKernelSpecs.set(a.id,c),c.onDidChangeKernels(l=>{l.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(l.added),!l.added.length&&l.removed.length&&this.updateCache()},this,this.disposables)),await mr(t,[],c.listKernelSpecs(n))})),s=mr(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(n)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(n=>{dt(n)&&n.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(n.id,n),this._kernels.has(n.id)?this._kernels.set(n.id,n):this._kernels.set(n.id,n)):j(`Found a kernel ${n.kind}:'${n.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===xe).filter(i=>t?!0:!Mn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};lu=g([(0,wo.injectable)(),d(0,(0,wo.inject)(Qe)),d(1,(0,wo.inject)(hr)),d(2,(0,wo.inject)(Kr)),d(3,(0,wo.inject)(ze)),d(4,(0,wo.inject)(es)),d(5,(0,wo.inject)($e)),d(5,(0,wo.named)(ri)),d(6,(0,wo.inject)(K)),d(7,(0,wo.inject)(_c)),d(8,(0,wo.inject)(nd))],lu);var sf=class{constructor(e,t,n,i,o,s){this.nonPythonKernelFinder=e;this.pythonKernelFinder=t;this.disposables=i;this.extensionChecker=o;this.interpreters=s;this._status="idle";this._onDidChangeStatus=new sC.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new ao;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new sC.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];n.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let e,t=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?e||(e=ce(),this.promiseMonitor.push(e.promise)):(e?.resolve(),e=void 0)};t(),this.nonPythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(t,this,this.disposables),this.interpreters.onDidChangeStatus(t,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),sC.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let e=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(e),await e}updateCache(){try{let e=[],t=this.nonPythonKernelFinder.kernels.filter(i=>this.extensionChecker.isPythonExtensionInstalled?i.kernelSpec.language!==xe:!0),n=this.pythonKernelFinder.kernels.filter(i=>tg(i));e=e.concat(t).concat(n),this.writeToCache(e)}catch(e){x("Exception Saving loaded kernels",e)}}get kernels(){let e=new Set,t=[];return this.pythonKernelFinder.kernels.forEach(n=>{let i=Mn(n.kernelSpec);n.kernelSpec.specFile&&i==="registeredByNewVersionOfExtForCustomKernelSpec"&&(e.add(n.kernelSpec.specFile),t.push(n))}),this.cache.forEach(n=>{n.kernelSpec.specFile&&e.has(n.kernelSpec.specFile)||t.push(n)}),t}writeToCache(e){let t=new Set;e=e.filter(l=>t.has(l.id)?!1:(t.add(l.id),!0));let n=this.cache,i=new Map(n.map(l=>[l.id,l])),o=new Map(e.map(l=>[l.id,l])),s=e.filter(l=>!i.has(l.id)),a=e.filter(l=>i.has(l.id)&&!Ro(l,i.get(l.id))),c=n.filter(l=>!o.has(l.id));this.cache=e,(s.length||a.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}};g([gh("List kernels failed")],sf.prototype,"updateCache",1),sf=g([(0,uu.injectable)(),d(0,(0,uu.inject)(es)),d(1,(0,uu.inject)(lu)),d(2,(0,uu.inject)(Tr)),d(3,(0,uu.inject)(K)),d(4,(0,uu.inject)(ze)),d(5,(0,uu.inject)(Qe))],sf);var af=k(M());var aC=require("vscode"),S5=require("os");function I5(r){return!!(x5(r)&&(r?.envType==="Unknown"||r?.envType==="Pyenv"||r?.envType==="Conda"))}function x5(r){return(r?.version?.major??3)>=3&&(r?.version?.minor??6)>=6}var pu=class{constructor(e,t,n,i){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.interpreters=n;this.context=i;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(n){return x("Failed to create interrupter, trying again",n),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let n=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!n)throw x("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:n,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:n},e,t)},dispose:async()=>{await this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:n},e,t).catch(i=>x(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&I5(e))return e;let t=this.interpreters.resolvedEnvironments;return t.length===0?e:t.find(I5)||t.find(x5)||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let n=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=aC.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=aC.Uri.joinPath(s,"kernel_interrupt_daemon.py"),c=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((l,u)=>{let p=!1,m=c.out.onDidChange(h=>{if(re(`Output from interrupt daemon started = ${p}, output (${h.source}) = ${h.out} ('END)`),h.source==="stdout"&&h.out.trim().includes("DAEMON_STARTED:")&&!p)p=!0,l();else if(h.source==="stderr"&&h.out.includes("INTERRUPT:")&&h.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&p)Ke(h.out,{trim:!0,removeEmptyEntries:!0}).filter(v=>v.includes("INTERRUPT:")).forEach(v=>{try{let b=v.split(":"),w=parseInt(b[b.indexOf("INITIALIZE_INTERRUPT")+1],10),D=this.messages.get(w);D&&(x(`Failed to initialize interrupt daemon for ${w}, ${h.out}`),D.deferred.reject(new Error(`Failed to start interrupt daemon ${h.out}`)),this.messages.delete(w))}catch(b){x(`Failed to parse interrupt daemon response, ${h.out}`,b)}});else if(h.source==="stdout"&&h.out.includes("INTERRUPT:")&&p)Ke(h.out,{trim:!0,removeEmptyEntries:!0}).filter(v=>v.includes("INTERRUPT:")).forEach(v=>{try{let[b,w,D]=v.split(":"),T=this.messages.get(parseInt(w,10));T?(E(`Got a response of ${D} for ${b}:${w}`),T.deferred.resolve(D),this.messages.delete(parseInt(w,10))):x(`Got a response of ${D} for ${b}:${w} but no command entry found in ${h.out}`)}catch(b){x(`Failed to parse interrupt daemon response, ${h.out}`,b)}});else if(h.out.includes("ERROR: handling command")){if(j(`Error output in interrupt daemon response ${h.out} ('END')`),!p)return u(new Error(`Interrupt daemon failed to start, ${h.out}`));try{let v=h.out.split(":")[2],b=this.messages.get(parseInt(v,10));if(b){b.deferred.reject(new Error(h.out)),this.messages.delete(parseInt(v,10));return}}catch(v){x(`Failed to parse interrupt daemon response, ${h.out}`,v)}}});this.disposableRegistry.push(m)}),this.disposableRegistry.push(new aC.Disposable(()=>An(()=>c.proc?.kill()))),c.proc?.on("close",()=>{re("Interrupt daemon closed"),this.startupPromise=void 0}),c.proc?.on("exit",()=>{re("Interrupt daemon exited"),this.startupPromise=void 0}),c})();return n.catch(i=>x(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=n,n}async sendCommand(e,t,n){let i=ce(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,n);if(!a||!a.stdin)throw x("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${S5.EOL}`),re(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let c=await i.promise;if(re(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(c,10)}};pu=g([(0,af.injectable)(),d(0,(0,af.inject)(Or)),d(1,(0,af.inject)(K)),d(2,(0,af.inject)(Qe)),d(3,(0,af.inject)(ct))],pu);var x_=k(M());var cC=require("vscode");var Xc=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?cC.Uri.file(bn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return cC.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!Xc.IsKernelSpecHidden.completed&&Xc.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>cC.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};Xc.IsKernelSpecHidden=ce(),Xc=g([(0,x_.injectable)(),d(0,(0,x_.inject)(Cr))],Xc);var K_=k(Fl()),rs=k(M()),dF=k(require("os"));var AH=require("util"),NH=k(Io()),F_=require("vscode");var hH=require("process"),gH=k(Fl()),Ey=k(require("os"));var Py=require("vscode");var vH=k(K5());var dH="To connect another client to this kernel, use:",mH=`NOTE: When using the \`ipython kernel\` entry point, Ctrl-C will not work.

To exit, you will have to explicitly quit this process, by either sending
"quit" from a client, or using Ctrl-\\ in UNIX-like environments.

To read more about this, see https://github.com/ipython/ipython/issues/2049


`,wy=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.processExecutionFactory=e;this._connection=t;this.fileSystem=i;this.resource=o;this.extensionChecker=s;this.kernelEnvVarsService=a;this.pythonExecFactory=c;this.outputChannel=l;this.jupyterSettings=u;this.jupyterPaths=p;this.pythonKernelInterruptDaemon=m;this.platform=h;this.exitEvent=new Py.EventEmitter;this._kernelConnectionMetadata=n}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return Kt(this.kernelConnectionMetadata)&&Jm(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)H("Interrupting kernel via SIGINT"),this._process.pid&&(0,hH.kill)(this._process.pid,"SIGINT");else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&Kt(this._kernelConnectionMetadata))return H("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();x("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(e,t,n){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0,await this.updateConnectionArgs(),gn.throwIfCanceled(n);let i=await this.launchAsObservable(e,n),o=i.proc;if(n.isCancellationRequested)throw new Py.CancellationError;H(`Kernel process ${o?.pid}.`);let s="",a="",c="",l=!1,u,p=ce();p.promise.catch(f),o&&(o.on("exit",h=>{if(h=h||u,this.disposed){E(`KernelProcess Exited, Exit Code - ${h}`);return}E(`KernelProcess Exited, Exit Code - ${h}`,c),l||(this.exitEvent.fire({exitCode:h||void 0,reason:Rh(c)||c}),l=!0),n.isCancellationRequested||(re("KernelProcessExitedError raised",a),p.reject(new Jp(h||-1,a,this.kernelConnectionMetadata)))}),o.stdout?.on("data",h=>{E(`Kernel output: ${(h||"").toString()}`),this.sendToOutput((h||"").toString())}),o.stderr?.on("data",h=>{let v=fH((h||"").toString());c+=v,v.trim().length&&E(`KernelProcess error: ${v}`),this.sendToOutput(v)}));let m=!1;i.out.onDidChange(h=>{if(h.source==="stderr")h.out=fH(h.out),a+=h.out,h.out.trim().length&&j(`StdErr from Kernel Process ${h.out.trim()}`);else{if(s+=h.out,!m){s=s.replace(mH,""),s=s.replace(mH.split(/\r?\n/).join(Ey.EOL),""),s=s.trimStart();let v=Ke(s,{trim:!0,removeEmptyEntries:!0});v.length===2&&v[0]===dH&&v[1].startsWith("--existing")&&v[1].endsWith(".json")&&(s=`${v.join(" ")}${Ey.EOL}`)}s.includes(dH)&&(m=!0)}this.sendToOutput(h.out)}),i.out.done.catch(h=>{if(this.disposed){j("Kernel died",h,a);return}x("Kernel died",h,a),p.reject(h)});try{p.rejected&&await p.promise;let h=_e.instance.get(mc).inExperiment("DoNotWaitForZmqPortsToBeUsed"),v=(await Promise.resolve().then(()=>k(pH()))).default,b=new Be;h&&t>1e4&&(t=1e4);let w=Promise.all([v.waitUntilUsed(this.connection.shell_port,200,t),v.waitUntilUsed(this.connection.iopub_port,200,t)]).catch(D=>{if(!(n.isCancellationRequested||p.rejected)&&(console.error("ex"),console.error(D),j(`Waited ${b.elapsedTime}ms for kernel to start`,D),!h))return Promise.reject(new Kv(this.kernelConnectionMetadata))});await ar(n,w,p.promise)}catch(h){let v=(c||a||"").trim();if(!n?.isCancellationRequested&&!dr(h)&&(x("Disposing kernel process due to an error",h),h&&h instanceof Error&&v.length&&h.message.includes(v)||x(v)),await this.dispose(),!n?.isCancellationRequested&&h instanceof Xe)throw h;{n?.isCancellationRequested&&E("User cancelled the kernel launch");let b=SE(v)||v.substring(0,100);throw re("KernelDiedError raised",b,c+`
`+a+`
`),console.error("KernelDiedError raised",h),new qp(y.kernelDied(b),c+`
`+a+`
`,h,this.kernelConnectionMetadata)}}}async dispose(){if(this._disposingPromise)return this._disposingPromise;if(this.disposed)return;this.disposed=!0;let e=this._process?.pid;H(`Dispose Kernel process ${e}.`),this._disposingPromise=(async()=>{await _r(1e3,this.killChildProcesses(this._process?.pid).catch(f));try{this.interrupter?.dispose().catch(f),this._process?.kill(),this.exitEvent.fire({})}catch(t){x(`Error disposing kernel process ${e}`,t)}An(async()=>{this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(t=>j(`Failed to delete connection file ${this.connectionFile} for pid ${e}`,t))}),E(`Disposed Kernel process ${e}.`)})()}async killChildProcesses(e){if(!(!e||!Kc.isAlive(e)))try{if(this.platform.isWindows){let t=process.env.WINDIR||"C:\\Windows",n=We(t,"System32","taskkill.exe");await new Kc().exec(n,["/F","/T","/PID",e.toString()])}else await new Promise(t=>{(0,vH.default)(e,(n,i)=>{n?j(`Failed to kill children for ${e}`,n):i.forEach(o=>Kc.kill(o)),t()})})}catch(t){j(`Failed to kill children for ${e}`,t)}}sendToOutput(e){this.outputChannel&&this.outputChannel.append(e)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let e=this._kernelConnectionMetadata.kernelSpec;if(!e)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(e.argv)?this._launchKernelSpec={...e,argv:[...e.argv]}:(x("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let e=vV(this.launchKernelSpec);if(e===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&e===0&&this.launchKernelSpec.argv[e-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.connectionFile=await this.createConnectionFile(),this.isPythonKernel)this.launchKernelSpec.argv.splice(e-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let t=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[e].includes("--connection-file")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(mm,t):this.launchKernelSpec.argv[e].includes(`=${mm}`)&&!this.launchKernelSpec.argv[e].trim().startsWith("=")?this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(mm,t):this.launchKernelSpec.argv[e]=this.launchKernelSpec.argv[e].replace(mm,this.connectionFile.fsPath)}}async createConnectionFile(){let e=await this.jupyterPaths.getRuntimeDir(),t=await this.fileSystem.createTemporaryLocalFile({fileExtension:".json",prefix:"kernel-v2-"}),n=e?We(e.fsPath,De(t.filePath)):t.filePath;return await t.dispose(),Py.Uri.file(n)}addPythonConnectionArgs(e){let t=[],n=e.fsPath.includes(" ")?`"${e.fsPath}"`:e.fsPath;return t.push(`--f=${n}`),t}async launchAsObservable(e,t){let n;if(E(`Launching kernel ${this.kernelConnectionMetadata.id} for ${V(this.resource)} in ${V(e)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let i=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),[o,s,a]=await Promise.all([i,gH.pathExists(e),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,t)]);if(gn.throwIfCanceled(t),Ey.platform()==="win32"){a=a||process.env;try{let l=await this.getWin32InterruptHandle();a.JPY_INTERRUPT_EVENT=`${l}`,re(`Got interrupt handle kernel id ${l} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(l){x(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,l)}}gn.throwIfCanceled(t);let c=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&c.push("--debug"),n=o.execObservable(c,{cwd:s?e:process.cwd(),env:a}),gn.throwIfCanceled(t)}else{let i=this.launchKernelSpec.argv[0];H(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${i}`);let[o,s]=await Promise.all([this.processExecutionFactory.create(this.resource,t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,t)]);gn.throwIfCanceled(t);let a=this.launchKernelSpec.argv.slice(1);n=o.execObservable(i,a,{env:s,cwd:e})}if(!n.proc)throw new Error("KernelProcess failed to launch");return this._process=n.proc,this._pid=n.proc.pid,n}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};g([pr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],wy.prototype,"launch",1),g([d(1,Hu())],wy.prototype,"launchAsObservable",1);function fH(r){let e=Ke(r,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")).join(Ey.EOL):r}var RH="kernelLauncherPortStart_{0}.tmp",Eo=class{constructor(e,t,n,i,o,s,a,c,l,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=n;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=c;this.pythonKernelInterruptDaemon=l;this.platformService=u}static async cleanupStartPort(){try{let e=await Eo.startPortPromise;E(`Cleaning up port start file : ${e}`);let t=We(dF.tmpdir(),qa(RH,e.toString()));await K_.remove(t)}catch(e){j("Kernel port mutex failed to cleanup: ",e)}}static async computeStartPort(){if(Dr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let n=We(dF.tmpdir(),qa(RH,e.toString()));await K_.open(n,"wx"),t=e}catch{e+=1e3}return E(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,n,i,o){let s=new Be,a=(async()=>(this.logIPyKernelPath(n,e,o).catch(f),await this.launchProcess(e,n,i,t,o)))();return a.then(()=>A("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:$i(n)})).catch(f),a}async logIPyKernelPath(e,t,n){let i=t.interpreter;if(!dt(t)||!Kt(t)||!i)return;let s=await(await this.pythonExecFactory.createActivatedEnvironment({interpreter:i,resource:e})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:n});if(n.isCancellationRequested)return;let a=V(i.uri);if(s.stdout){let c=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(l=>l.trim()).filter(l=>l.length>0);c.length===2?E(`ipykernel version & path ${c[0]}, ${P6(c[1])} for ${a}`):E(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let c=Ke(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((l,u)=>u===0?l:`    ${l}`).join(`
`);j(`Stderr output when getting ipykernel version & path ${c} for ${a}`)}}async launchProcess(e,t,n,i,o){let s=await ar(o,this.getKernelConnection(e)),a=t?De(t.fsPath):"",c=this.configService.getSettings(t),l=c.logKernelOutputSeparately||c.development?F_.window.createOutputChannel(y.kernelConsoleOutputChannel(a),"log"):void 0;l?.clear();let u=new wy(this.processExecutionFactory,s,e,this.fs,t,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,l,c,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);u.exited(()=>l?.dispose(),this,this.disposables);try{await ar(o,u.launch(n,i,o))}catch(m){throw await u.dispose(),gn.throwIfCanceled(o),m}let p=u.exited(({exitCode:m,reason:h})=>{Tt(t,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",m?{exitCode:m}:void 0,{exitReason:Rh(h)}),So.delete(s.control_port),So.delete(s.hb_port),So.delete(s.iopub_port),So.delete(s.shell_port),So.delete(s.stdin_port),p.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await u.dispose(),new F_.CancellationError;return u}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let n=await(0,AH.promisify)((await Promise.resolve().then(()=>k(TH()))).getPorts)(5,{host:"127.0.0.1",port:e});if(n.some(i=>So.has(i))){let i=Math.max(...So,...n);return Eo.findNextFreePort(i)}return n.forEach(i=>So.add(i)),n}async getConnectionPorts(){let e=await Eo.startPortPromise;return Eo.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,NH.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Eo.startPortPromise=Eo.computeStartPort(),g([Nr("Failed to capture IPyKernel version and path")],Eo.prototype,"logIPyKernelPath",1),Eo=g([(0,rs.injectable)(),d(0,(0,rs.inject)(_i)),d(1,(0,rs.inject)(hr)),d(2,(0,rs.inject)(ze)),d(3,(0,rs.inject)(xa)),d(4,(0,rs.inject)(K)),d(5,(0,rs.inject)(Or)),d(6,(0,rs.inject)(ae)),d(7,(0,rs.inject)(Kr)),d(8,(0,rs.inject)(pu)),d(9,(0,rs.inject)(Cr))],Eo);var JH=k(require("vscode")),pC=k(M());var L_=class extends cy{constructor(t,n,i){super("localRaw",t);this.resource=n;this.kernelConnectionMetadata=i;this.initializeKernelSocket()}get atleastOneCellExecutedSuccessfully(){return this.session.atleastOneCellExecutedSuccessfully}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(re(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.disposeAsync().catch(f)}async disposeAsync(){await this.shutdown().catch(f).finally(()=>this.session.dispose()).finally(()=>super.dispose())}async waitForIdle(t,n){try{await ay(this.kernelConnectionMetadata,this.resource,this.session,t,n)}catch(i){throw re("Error waiting for idle",i),await this.shutdown().catch(f),i}}async shutdown(){if(this._isDisposed)return;this._isDisposed=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;E(`Shutdown session ${t} - start called from ${new Error("").stack}`),sy(this.session.kernel),await _r(1e3,this.session.shutdown().catch(f)),this.didShutdown.fire(),super.dispose(),E(`Shutdown session ${t} - shutdown complete`)}};var _a=k(GD()),qH=k(Io());var q_=k(Io());var B_=k(FH()),BH=k(Io());var du=k(Fl());var j_=k(require("os"));var LH=k(Fl()),fF=k(require("os"));var Mge=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Oge=new RegExp(/^[0-9 .]*$/);async function UH(){let r={id:"",version_id:""};if(fF.platform()==="darwin"||fF.platform()==="win32")return r;try{let e=await LH.readFile("/etc/os-release","utf-8");Ke(e).forEach(t=>{let n=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(n||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(n)r.id=Mge.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";r.version_id=Oge.test(o)?o:s.toString()}}})}catch(e){x("Failed to read distro info",e)}return r}var Kge="zeromq";function W_(){try{let r=require(Kge);return r.context.blocky=!1,hF(!1).catch(f),r}catch(r){try{let e=require(We(qo,"dist","node_modules","zeromqold"));return H("ZMQ loaded via fallback mechanism."),hF(!1,!0,r.message||r.toString()).catch(f),e}catch(e){throw hF(!0,!0,r.message||r.toString(),e.message||e.toString()).catch(f),j("Exception while attempting zmq :",r.message||r),j("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Fge(){try{let r=We(qo,"dist","node_modules","zeromq","prebuilds");if(!await du.pathExists(We(qo,"dist","node_modules")))return;let e=await du.readdir(r).then(n=>n.map(async i=>{let o=We(r,i);return(await du.stat(o)).isDirectory()?du.readdir(o).then(a=>a.map(c=>We(o,c))):[]}));return(await Promise.all(e.flat())).flat().map(n=>n.substring(n.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(r){return j("Failed to determine local zmq binaries.",r),["Failed to determine local zmq binaries."]}}var jH=!1;async function hF(r,e=!1,t="",n=""){if(jH)return;jH=!0;let[i,o]=await Promise.all([UH().catch(()=>({id:"",version_id:""})),Fge()]),s=Lge();A("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),A("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:r,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:n})}function WH(r){return r==="linux"&&du.existsSync("/etc/alpine-release")}function Lge(){try{let r=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||j_.arch(),n=process.env.npm_config_platform||j_.platform(),i=WH(n),o=process.env.LIBC||(WH(n)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":r.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(r){return j("Failed to determine platform information used to load zeromq binary.",r),{}}}function Uge(r,e){let t=r.transport==="tcp"?":":"-",n=r[`${e}_port`];if(!n)throw new Error(`Port not found for channel "${e}"`);return`${r.transport}://${r.ip}${t}${n}`}var V_=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=f;this.onerror=f;this.onclose=f;this.onmessage=f;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(n){x("Error during socket shutdown",n)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,n){let i=n();return i.connect(Uge(e,t)),this.processSocketMessages(t,i).catch(x.bind(`Failed to read messages from channel ${t}`)),i}async processSocketMessages(e,t){for await(let n of t){if(this.closed)break;this.onIncomingMessage(e,n)}}generateChannels(e){let t=W_(),n=(0,BH.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:n,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let n=this.closed?{}:B_.decode(t,this.connection.key,this.connection.signature_scheme);n.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(n);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(n,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(n,e))}fireOnMessage(e,t){if(!this.closed)try{Wge(e,t),this.onmessage({data:e,type:"message",target:this})}catch(n){x(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,n)}}sendMessage(e,t){let n=B_.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,f)))).then(async()=>{try{await this.postToSocket(e.channel,n)}catch(o){x(`Failed to write data to the kernel channel ${e.channel}`,n,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,n)});this.sendChain.catch(f)}postToSocket(e,t){let n=this.channels[e];n?n.send(t).catch(i=>{x("Error communicating with the kernel",i)}):x(`Attempting to send message on invalid channel: ${e}`)}},jge=["username","version","session","msg_id","msg_type"],VH={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function Wge(r,e){let t=r.header;jge.forEach(n=>{typeof t[n]!="string"&&(t[n]="")}),typeof r.channel!="string"&&(r.channel=e),r.content||(r.content={}),r.metadata||(r.metadata={}),r.channel==="iopub"&&Vge(r)}function Vge(r){if(r.channel!=="iopub")return;let e=r.header.msg_type;if(e in VH){let t=VH[e];if(t===void 0)return;let n=Object.keys(t),i=r.content;for(let o=0;o<n.length;o++){let s=t[n[o]];Array.isArray(s)||(s=[s]);let a=n[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var od=k(GD()),sd=require("vscode");var gF,J_=class{constructor(e,t,n,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=n;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new od.Signal(this);this.connectionStatusChanged=new od.Signal(this);this.iopubMessage=new od.Signal(this);this.unhandledMessage=new od.Signal(this);this.anyMessage=new od.Signal(this);this.disposed=new od.Signal(this);this.id=(0,q_.default)();this.clientId=(0,q_.default)();this.username=(0,q_.default)();this.infoDeferred=ce();this.name=eg(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new sd.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],n=mP(e);t.push(n);try{let i=this.kernelProcess;this.kernelProcess=void 0,i?.dispose()?.catch(f),An(()=>this.socket?.dispose()),An(()=>this.realKernel?.dispose());let o=this.kernelProcess=await ft.wrapAndReportProgress(this.resource,y.connectingToKernel(pt(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new sd.CancellationError;this.hookupKernelProcessExitHandler(o);let s=qge(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=s.kernelProcess,this.realKernel=s.realKernel,this.socket=s.socket,s.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c));let a=setTimeout(()=>n.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(a)}),await ft.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>Bge(n.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,s.realKernel)),e.isCancellationRequested)throw new sd.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(i){throw await Promise.all([this.kernelProcess?.dispose().catch(f),this.realKernel?.shutdown().catch(o=>j(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,o))]),dr(i)&&n.token.isCancellationRequested&&!e.isCancellationRequested?new Wm(this.kernelConnectionMetadata):(dr(i)||e.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${i}`),i)}finally{Q(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(n=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(x(`Disposing session as kernel process died ExitCode: ${n.exitCode}, Reason: ${n.reason}`),Tt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",n.exitCode?{exitCode:n.exitCode}:void 0,{exitReason:Rh(n.reason)}),this.shutdown().catch(f))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),od.Signal.disconnectAll(this)}).catch(f))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),sy(this.realKernel),await this.kernelProcess?.dispose().catch(f),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}clone(e){return this}get spec(){if(tg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return x("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,n){return this.realKernel.sendShellMessage(e,t,n)}sendControlMessage(e,t,n){return this.realKernel.sendControlMessage(e,t,n)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){H("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(n=>x("Failed to interrupt via a message",n))}else x("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,n){return this.realKernel.requestExecute(e,t,n)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e){return this.realKernel.sendInputReply(e)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function Bge(r,e,t,n,i){try{E("Waiting for Raw Session to be ready in postStartRawSession"),await ar(r,Jge(i,n,e)),E("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw x("Failed waiting for Raw Session to be ready",u),dr(u)||r.isCancellationRequested?new sd.CancellationError:u}E(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=ce(),s=ce(),a=()=>o.resolve(!0);i.iopubMessage.connect(a);let c=()=>{let p=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(p,!0,!0).done.then(()=>s.resolve(!0)).catch(f)},l=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(f)};try{let u=new Be,p=0;for(;u.elapsedTime<e*1e3;){p+=1;try{E("Sending request for kernelInfo"),c(),l(),await ar(r,Promise.all([o.promise,s.promise]),ji(Math.min(e,500)).then(f))}catch(m){throw x("Failed to request kernel info",m),m}if(o.completed&&s.completed){E("Got response for requestKernelInfo");break}else{E("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?E(`Successfully completed postStartRawSession after ${p} attempt(s) in ${u.elapsedTime}ms`):j(`Didn't get response for requestKernelInfo after ${p} attempt(s) in ${u.elapsedTime}ms.`),Tt(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:p},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function qge(r,e,t,n){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends V_{constructor(){super(r.connection,o.serialize),s=this}}let c=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW"});gF||(gF=require("@jupyterlab/services/lib/kernel/nonSerializingKernel"));let l=new gF.KernelConnection({serverSettings:c,clientId:e,handleComms:!0,username:t,model:n});return sd.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&l.anyMessage.connect((u,p)=>{E(`[AnyMessage Event] [${p.direction}] [${r.pid}] ${JSON.stringify(p.msg)}`)}),Zi.set(l.id,s),s.emit("open"),{realKernel:l,socket:s,kernelProcess:r}}async function Jge(r,e,t){E(`Waiting for Raw session to be ready, status: ${r.connectionStatus}`);let n=ce(),i=(s,a)=>{a=="connected"?(E("Raw session connected"),n.resolve(a)):E(`Raw session not connected, status: ${a}`)};r.connectionStatusChanged.connect(i),r.connectionStatus==="connected"&&(E("Raw session connected"),n.resolve(r.connectionStatus)),E("Waiting for Raw session to be ready");let o=await _r(t,n.promise);if(r.connectionStatusChanged.disconnect(i),E(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new Wm(e)}var $_=class{constructor(e,t,n,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new _a.Signal(this);this.kernelChanged=new _a.Signal(this);this.terminated=new _a.Signal(this);this.iopubMessage=new _a.Signal(this);this.unhandledMessage=new _a.Signal(this);this.anyMessage=new _a.Signal(this);this.disposed=new _a.Signal(this);this.connectionStatusChanged=new _a.Signal(this);this.propertyChanged=new _a.Signal(this);this._didShutDownOnce=!1;this.id=(0,qH.default)(),this.name=eg(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new J_(e,t,n,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this)}get atleastOneCellExecutedSuccessfully(){return this.cellExecutedSuccessfully===!0}get jupyterLabServices(){return this._jupyterLabServices||(this._jupyterLabServices=require("@jupyterlab/services")),this._jupyterLabServices}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await Xi(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;Tt(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(f).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),_a.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>j(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){re(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){!this.cellExecutedSuccessfully&&t.header.msg_type==="execute_result"&&t.content&&(this.jupyterLabServices.KernelMessage.isExecuteResultMsg(t)||this.jupyterLabServices.KernelMessage.isExecuteInputMsg(t))&&t.content.execution_count&&(this.cellExecutedSuccessfully=!0),this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var _y=class{constructor(e,t){this.configService=e;this.kernelLauncher=t}async create(e){E(`Creating raw notebook for resource '${V(e.resource)}'`);let t,[n]=await Promise.all([ar(e.token,Fx(e.resource).then(o=>JH.Uri.file(o))),ar(e.token,Xi(e.resource,{kernelConnection:e.kernelConnection}))]),i=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new $_(e.resource,this.kernelLauncher,n,e.kernelConnection,i,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await ar(e.token,t.startKernel(e))}catch(o){throw dr(o)||e.token.isCancellationRequested?E("Starting of raw session cancelled by user"):x(`Failed to connect raw kernel session: ${o}`),t?.shutdown().catch(s=>x(`Failed to dispose of raw session on launch error: ${s} `)).finally(()=>t?.dispose()).catch(f),o}return new L_(t,e.resource,e.kernelConnection)}};_y=g([(0,pC.injectable)(),d(0,(0,pC.inject)(ae)),d(1,(0,pC.inject)(mD))],_y);var H_=k(M());var Ty=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{W_(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};Ty=g([(0,H_.injectable)(),d(0,(0,H_.inject)(ae))],Ty);var mu=k(M()),$H=require("vscode");var Rn=Symbol("IJupyterVariables"),G_=Symbol("IKernelVariableRequester");var lf=class{constructor(e,t,n){this.kernelVariables=t;this.debuggerVariables=n;this.refreshEventEmitter=new $H.EventEmitter;e.push(n.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,n,i){return this.variableHandler.getAllVariableDiscriptions(e,t,n,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,n){return this.variableHandler.getMatchingVariable(e,t,n)}async getDataFrameInfo(e,t,n,i){return this.variableHandler.getDataFrameInfo(e,t,n,i)}async getDataFrameRows(e,t,n,i,o){return this.variableHandler.getDataFrameRows(e,t,n,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};g([pr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],lf.prototype,"getVariables",1),lf=g([(0,mu.injectable)(),d(0,(0,mu.inject)(K)),d(1,(0,mu.inject)(Rn)),d(1,(0,mu.named)(Ge.KERNEL_VARIABLES)),d(2,(0,mu.inject)(Rn)),d(2,(0,mu.named)(Ge.DEBUGGER_VARIABLES))],lf);var fu=k(M()),z_=require("vscode");var $ge=/Type:\s*(\w+)/,Hge=/Value:\s*(.*)/,Gge=/String form:\s*([\s\S]+?)\n/,zge=/Docstring:\s*(.*)/,Qge=/Length:\s+(.*)/,Yge=/^\s+\[(\d+) rows x (\d+) columns\]/m,Xge=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),Ry=class{constructor(e,t,n,i){this.configService=e;this.disposables=n;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new z_.EventEmitter;this.variableRequesters.set(xe,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,n,i){let o=Di(e.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,n,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,n){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,n)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,n);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,size:0,count:0,shape:"",truncated:!0},t,n)}}}async getDataFrameInfo(e,t,n,i){if(!t)return e;let o=Di(t?.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return n&&(a=`${e.name}${n}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,n,i,o){let s=Di(i?.kernelConnectionMetadata)||xe,a=this.variableRequesters.get(s);if(a){let c=e.name;return o&&(c=`${e.name}${o}`),a.getDataFrameRows(t,n,i,c)}return{data:[]}}async getFullVariable(e,t,n){let i=Di(t?.kernelConnectionMetadata)||xe,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,n):e}async getVariablesBasedOnKernel(e,t){let n=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!n||!i&&(n.currentExecutionCount!==t.executionCount||n.currentExecutionCount!==o.executionCount))&&(n={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(c=>({name:c.name,value:void 0,supportsDataExplorer:!1,type:c.type,size:0,shape:"",count:0,truncated:!0}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(n){let c=t.sortColumn,l=(m,h)=>{let v=m[c]?m[c]:"",b=h[c]?h[c]:"";return t.sortAscending?v.localeCompare(b,void 0,{sensitivity:"base"}):b.localeCompare(v,void 0,{sensitivity:"base"})};n.variables.sort(l);let u=t.startIndex?t.startIndex:0,p=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let m=u;m<u+p&&m<n.variables.length;){if(s&&s.indexOf(n.variables[m].type)>=0){n.variables.splice(m,1);continue}let h=typeof n.variables[m].value=="string"?n.variables[m]:await this.getVariableValueFromKernel(n.variables[m],e);n.variables[m]=h,a.pageResponse.push(h),m+=1}this.cachedVariables.set(e.uri.toString(),n),a.totalCount=n.variables.length}return a}async getVariableProperties(e,t,n){let i=await this.getMatchingVariable(e,t,n),o=Di(t.kernelConnectionMetadata)||xe,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,n,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let n=Di(e.kernelConnectionMetadata)||xe,i=this.variableRequesters.get(n);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,n=0,i){let o=ce();try{e.requestInspect({code:t,cursor_pos:n,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new z_.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,n){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,n);if(o&&o.hasOwnProperty("text/plain")){let s=Yc(o["text/plain"].toString()),a=$ge.exec(s),c=Qge.exec(s),l=Yge.exec(s);a&&(i.type=a[1]),i.value=[Hge,Gge,zge].reduce((u,p)=>u||p.exec(s)?.[1]||"",""),c&&(i.count=parseInt(c[1],10)),l&&(i.shape=`(${l[1]}, ${l[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),Xge.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&Kt(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};Ry=g([(0,fu.injectable)(),d(0,(0,fu.inject)(ae)),d(1,(0,fu.inject)(G_)),d(1,(0,fu.named)(Ge.PYTHON_VARIABLES_REQUESTER)),d(2,(0,fu.inject)(K)),d(3,(0,fu.inject)(Fe))],Ry);var el=k(M());var Ay=class{constructor(e,t,n,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=n;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(f))),this.preWarmInterpreterVariables().catch(f),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(f),this.condaService.getCondaVersion().catch(f))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(f)}};Ay=g([(0,el.injectable)(),d(0,(0,el.inject)(ks)),d(1,(0,el.inject)(li)),d(2,(0,el.inject)(K)),d(3,(0,el.inject)(ze)),d(4,(0,el.inject)(zt)),d(5,(0,el.inject)(ui)),d(6,(0,el.inject)(As))],Ay);var mC=k(M());var Ny=class extends Xe{constructor(){super("unknown",y.jupyterDataRateExceeded)}};function vF(r){let e=r.index,t=r.columns;return{data:r.data.map((o,s)=>{let a={index:e[s]};return t.forEach((c,l)=>{a[c]=o[l]}),a})}}async function dC(r,{code:e,initializeCode:t,cleanupCode:n},i){if(r.disposed||r.disposing||!r.session?.kernel||!r.session.kernel||r.session.isDisposed)return[];try{return t&&await hn(r.session.kernel,t,i),await hn(r.session.kernel,e,i)}catch(o){if(o instanceof fn)return[];throw o}finally{n&&await hn(r.session.kernel,n,i)}}var My=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:n}),a=await dC(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),c=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:c}}async getDataFrameRows(e,t,n,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),c=await dC(n,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return c.length===0?{data:[]}:vF(this.deserializeJupyterResult(c))}async getVariableProperties(e,t,n){let i={};return n&&n.value&&(i[`${e}`]=n.value),i}async getAllVariableDiscriptions(e,t,n,i){if(!e.session)return[];let{code:o,cleanupCode:s,initializeCode:a}=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions({isDebugging:!1,parent:t,startIndex:n}),c=await dC(e,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request when retrieving variables",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return e.disposed||e.disposing||i?.isCancellationRequested?[]:this.deserializeJupyterResult(c)}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:n,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await dC(e,{code:n,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),c=[];for(let[l,u]of Object.entries(a)){let p={name:l,value:void 0,supportsDataExplorer:!1,type:u||"",size:0,shape:"",count:0,truncated:!0};c.push(p)}return c}return[]}async getFullVariable(e,t,n){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await dC(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let n=t.text;if(n.includes("iopub_data_rate_limit"))throw new Ny;{let i=y.jupyterGetVariablesExecutionError(n);throw x(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let n=t.data;if(n&&n.hasOwnProperty("text/plain"))return n["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(Yc).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw x(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};My=g([(0,mC.injectable)(),d(0,(0,mC.inject)(Lh)),d(1,(0,mC.inject)(Uh))],My);var uf=k(M());var GH=require("vscode");var HH=1e3*60*60*24*2,Ta=class extends er{constructor(t,n,i,o){super();this.serverStorage=n;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=GH.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,n){if(t.isUntitled||!Ut(n.kernelConnectionMetadata)||!n.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,n){if(!Ut(n.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,c)=>{if(c.direction==="send"){let l=c.msg;if(l.header.msg_type==="execute_request"&&l.metadata&&typeof l.metadata=="object"&&l.metadata&&"cellId"in l.metadata&&typeof l.metadata.cellId=="string"&&l.metadata.cellId===t.document.uri.toString()){let u=l.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:n.session?.kernel?.id||"",cellIndex:t.index})}}else if(c.direction==="recv"){let l=c.msg,u=this.executedCells.get(t);if(u?.msg_id&&au(l)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(l.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in l.content&&typeof l.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==l.content.execution_count&&(u.executionCount=l.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,n,u),Q(i))}}},s=()=>{let a=n.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>An(()=>a.anyMessage?.disconnect(o))}))};n.onStarted(()=>s(),i),n.session&&s()}deleteTrackedCellExecution(t,n){t.notebook.isUntitled||!Ut(n.kernelConnectionMetadata)||!n.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,n,i){if(!i.executionCount||!i.msg_id||!i.startTime||!Ut(n.kernelConnectionMetadata)||!n.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:n.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Wt(n.kernelConnectionMetadata.serverProviderHandle),sessionId:n.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let c=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(c.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let n={};try{let s=await this.fs.readFile(this.storageFile);n=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Wt(s)));Object.keys(n).forEach(s=>{let a=n[s];(o.has(a.serverId)||Date.now()-a.startTime>HH)&&(delete n[s],i=!0)}),i&&(this.removeOldItems(n),this.staleState=n,await this.fs.writeFile(this.storageFile,JSON.stringify(n)))}))}removeOldItems(t){Object.keys(t).forEach(n=>{let i=t[n];i&&Date.now()-i.startTime>HH&&delete t[n]})}};Ta=g([(0,uf.injectable)(),d(0,(0,uf.inject)(K)),d(1,(0,uf.inject)(Zt)),d(2,(0,uf.inject)(ct)),d(3,(0,uf.inject)(st))],Ta);var Ky=k(M());var fC=require("vscode");var Oy=class{constructor(e,t,n){this.serverUriStorage=e;this.registrations=t;this.disposables=n}activate(){this.disposables.push(fC.commands.registerCommand(J.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(f),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===Pt).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new fC.CancellationTokenSource,n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((n||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(f)))})).catch(f),await fC.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(f,f)},this))}};Oy=g([(0,Ky.injectable)(),d(0,(0,Ky.inject)(Zt)),d(1,(0,Ky.inject)(Gt)),d(2,(0,Ky.inject)(K))],Oy);var hu=require("vscode");var zH=k(M());var Fy=class{activate(){let e=_e.instance.get(K),t=new Ko;e.push(t),e.push(hu.commands.registerCommand("jupyter.manageAccessToKernels",()=>Zge(t)))}};Fy=g([(0,zH.injectable)()],Fy);async function Zge(r){let e=await MV(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=hu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let n=[];r.add({dispose:()=>{n=Q(n)}});let i=hu.window.createQuickPick();i.title=hu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=hu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;n.push(i),i.show(),await Promise.race([sN(i.onDidAccept,void 0,n).then(()=>o=!0),sN(i.onDidHide,void 0,n)]),o&&(await OV(i.selectedItems.map(s=>s.extensionId)),n=Q(n))}function QH(r,e){r.addSingleton(Ie,Av),r.addSingleton(Ie,Ov),r.addSingleton(Ie,Sy),r.addSingleton(ui,Ty),r.addSingleton(Go,Go),r.addSingleton(fD,_y),r.addSingleton(mD,Eo),r.addSingleton(xa,xa),r.addSingleton(Tr,my),r.addSingleton(Ie,sf),r.addSingleton(Ie,Nv),r.addSingleton(Kr,Kr),r.addSingleton(nd,Xc),r.addSingleton(es,es),r.addBinding(es,Ie),r.addSingleton(lu,lu),r.addSingleton(Ie,Iy),r.addSingleton(Ie,Ay),r.addSingleton(Rn,lf,Ge.ALL_VARIABLES),r.addSingleton(Rn,Ry,Ge.KERNEL_VARIABLES),r.addSingleton(G_,My,Ge.PYTHON_VARIABLES_REQUESTER),r.addSingleton(Ps,Zp),r.addSingleton(Ie,rf),r.addSingleton(Ie,vy),r.addSingleton(Ie,py),r.addSingleton(Ie,dy),r.addSingleton(Ie,by),r.addSingleton(Fe,hy),r.addSingleton(hm,gy),r.addSingleton(Ie,Oy),r.addSingleton(Ta,Ta),r.addBinding(Ta,Ie),r.addSingleton(Ie,Fy),e5(r,e),Nh("isInsiderExtension",Ou());let t=r.get(ze);Nh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let n=r.get(ui);Nh("rawKernelSupported",n.isSupported?"true":"false"),r.addSingleton(Ie,Xr),r.addSingleton(da,yy),r.addSingleton(pu,pu)}var ad=k(M()),ns=require("vscode");var Ly=class{constructor(e,t,n,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=n;this.pythonApi=i;this.errorHandler=o;this.executingCells=new WeakSet}activate(){this.disposables.push(ns.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this)),this.disposables.push(ns.commands.registerCommand(J.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(ns.commands.registerCommand(J.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}onDidChangeNotebookCellExecutionState(e){e.cell.notebook.notebookType===It&&(e.state===ns.NotebookCellExecutionState.Pending||e.state===ns.NotebookCellExecutionState.Executing?this.executingCells.add(e.cell):e.state===ns.NotebookCellExecutionState.Idle&&this.executingCells.delete(e.cell))}async installPythonViaKernelPicker(){A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[ge.install,ge.reload]:[ge.install],t=await ns.window.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===ge.install?(this.installedOnceBefore=!0,A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await ns.commands.executeCommand("python.installPython")):t===ge.reload?(A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await ns.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):A("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){A("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",n=await _r(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&n===t)return E("Python Extension installed via Kernel Picker command"),A("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;x("Failed to install Python Extension via Kernel Picker command"),A("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(f,f)}finally{e.dispose()}}}};Ly=g([(0,ad.injectable)(),d(0,(0,ad.inject)(K)),d(1,(0,ad.inject)(ze)),d(2,(0,ad.inject)($o)),d(3,(0,ad.inject)(zt)),d(4,(0,ad.inject)(Yr))],Ly);var Uy=k(M()),df=require("vscode");var pf=class{constructor(e,t,n){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=n}activate(){df.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),df.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!_t(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e.uri);if(!t)return;let n=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(f),!0):!1};if(n())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&n()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){E(`Using notebook.selectKernel to force remote kernel for ${V(e.uri)} to ${t.id}`),await df.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:Pt}),await yw(async()=>{if(df.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(f),!0}return!1},2e3,100)?E(`Successfully switched remote kernel for ${V(e.uri)} to ${t.id}`):j(`Failed to switch remote kernel for ${V(e.uri)} to ${t.id}`)}};g([Nr()],pf.prototype,"onDidOpenNotebook",1),pf=g([(0,Uy.injectable)(),d(0,(0,Uy.inject)(K)),d(1,(0,Uy.inject)(St)),d(2,(0,Uy.inject)(Go))],pf);var Wy=k(M()),ld=require("vscode");var ko=require("vscode");var gC=k(M()),r4=require("vscode");var yF=k(Io()),ZH=require("vscode");function YH(r){if(!r||!Array.isArray(r)||r.length===0)return;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=Array.apply(null,new Uint8Array(n.buffer));e.push({...n,byteLength:n.byteLength,byteOffset:n.byteOffset,buffer:i})}else e.push([...new Uint8Array(n)])}return e}function XH(r){if(!Array.isArray(r)||r.length===0)return r;let e=[];for(let t=0;t<r.length;t+=1){let n=r[t];if("buffer"in n&&"byteOffset"in n){let i=new Uint8Array(n.buffer).buffer,o=new DataView(i,n.byteOffset,n.byteLength);e.push(o)}else{let i=new Uint8Array(n).buffer;e.push(i)}}return e}var hC=new WeakMap;function e4(r,e){let t=hC.get(r);t&&(t.targets.add(e),t.registerCommTarget(e))}function t4(r,e){hC.get(r)?.targets?.delete?.(e)}var Q_=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new ZH.EventEmitter;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.totalWaitTime=0;this.totalWaitedMessages=0;this.hookCount=0;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let n=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=n.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.sendOverheadTelemetry(),this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?x(`Widget Error: ${t.message}`):E(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(XH(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e)),E("IPyWidgetMessageDispatcher.initialize")}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let n=t?Zi.get(t):void 0;if(n?.removeReceiveHook(this.onKernelSocketMessage),n?.removeSendHook(this.mirrorSend),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(s=>s.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(s=>s.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!Zi.get(e.session?.kernel?.id))return;hC.has(e.session.kernel)||hC.set(e.session.kernel,{targets:new Set,registerCommTarget:s=>{this.raisePostMessage("IPyWidgets_registerCommTarget",s)}}),this.kernelWasConnectedAtLeastOnce=!0;let i=e.session.kernel?.id,o=i?Zi.get(i):void 0;o?.addReceiveHook(this.onKernelSocketMessage),o?.addSendHook(this.mirrorSend),this.sendKernelOptions(),this.registerCommTargets(e),this.sendPendingMessages()}sendKernelOptions(){this.kernel?.session?.kernel&&this.raisePostMessage("IPyWidgets_kernelOptions",{id:this.kernel?.session?.kernel?.id||"",clientId:this.kernel?.session?.kernel?.clientId||"",userName:this.kernel?.session?.kernel?.username||"",model:this.kernel?.session?.kernel?.model||{id:"",name:""}})}async mirrorSend(e,t){if(typeof e=="string"&&e.includes("shell")&&e.includes("execute_request")){let n=Date.now(),i=this.deserialize(e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!c_(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o,this.totalWaitTime=Date.now()-n,this.totalWaitedMessages+=1}}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=ce();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e){let t=(0,yF.default)(),n=ce();if(this.waitingMessageIds.set(t,{startTime:Date.now(),resultPromise:n}),typeof e=="string"?c_(e)&&this.raisePostMessage("IPyWidgets_msg",{id:t,data:e}):this.raisePostMessage("IPyWidgets_binary_msg",{id:t,data:YH([e])}),typeof e!="string"||e.includes(Ui)||e.includes(Ge.DefaultCommTarget)||e.includes("comm_open")||e.includes("comm_close")||e.includes("comm_msg")){let o=this.deserialize(e);if(!c_(o))return;o&&o.content&&o.content.data&&(o.content.data[Ui]||o.content.target_name===Ge.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let s=o.header?.msg_type==="comm_open"&&o.content?.data?.state?._model_module==="@jupyter-widgets/output"&&o.content?.data?.state?._model_name==="OutputModel",a=o.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(o.content?.comm_id);s?this.outputWidgetIds.add(o.content.comm_id):a?this.outputWidgetIds.delete(o.content.comm_id):this.messageNeedsFullHandle(o)&&(this.fullHandleMessage={id:o.header.msg_id,promise:ce()},await n.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),this.totalWaitTime+=Date.now()-t.startTime,this.totalWaitedMessages+=1,t.resultPromise.resolve())}sendPendingMessages(){if(this.kernel?.session?.kernel)for(;this.pendingMessages.length;)try{let e=this.pendingMessages[0],t=typeof e=="string"?JSON.parse(e):this.deserialize(e);t.buffers?.length&&(t.buffers=t.buffers.map(n=>n instanceof DataView?n.buffer:n)),t.channel==="control"?this.kernel.session.kernel.sendControlMessage(t):this.kernel.session.kernel.sendShellMessage(t),this.pendingMessages.shift()}catch(e){x("Failed to send message to Kernel",e);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let n=Array.from([...this.pendingTargetNames.values()]).shift();if(n){if(this.commTargetsRegistered.has(n))return;E(`Registering commtarget ${n}`),this.commTargetsRegistered.add(n),this.pendingTargetNames.delete(n),e.session?.kernel&&n!==Ge.DefaultCommTarget&&!hC.get(e.session.kernel)?.targets?.has(n)&&e.session.kernel.registerCommTarget(n,f)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){this.hookCount+=1;let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=ce(),n=(0,yF.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(n,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:n,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}sendOverheadTelemetry(){A("DS_INTERNAL.IPYWIDGET_OVERHEAD",{totalOverheadInMs:this.totalWaitTime,numberOfMessagesWaitedOn:this.totalWaitedMessages,averageWaitTime:this.totalWaitTime/this.totalWaitedMessages,numberOfRegisteredHooks:this.hookCount})}};var bF=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new r4.EventEmitter;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},gu=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new Q_(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let n=[];e&&this.messagesPerNotebook.get(e)&&(n=this.messagesPerNotebook.get(e)||[]);let i=new bF(t,n);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,n=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),n?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};gu=g([(0,gC.injectable)(),d(0,(0,gC.inject)(K)),d(1,(0,gC.inject)(Fe))],gu);var i4=require("vscode");var n4=require("vscode");var jy=class jy extends er{constructor(t,n,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=n;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(c=>this._register(c)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(n=>n.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async n=>{n.getWidgetScriptSources&&t.push(...await n.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,n){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let c=await a.getWidgetScriptSource(t,n,i);if(c.scriptUri){s=c;break}else j(`Widget Script Source not found for ${t}@${n} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,n,"",s.source).catch(f),s.scriptUri?E(`Script source for Widget ${t}@${n} was found from source ${s.source} and ${s.scriptUri}`):x(`Script source for Widget ${t}@${n} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,n,i,o){let s=`${t}.${t}@${n}`;if(jy.trackedWidgetModuleNames.has(s))return;jy.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),c=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),l=c?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=c?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;A("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await ht(t),moduleName:l,modelName:u,source:o,moduleVersion:c?n:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new n4.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,n){if(n.direction==="recv"&&n.msg.header.msg_type==="comm_open"){let o=n.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(f)}}};g([Nr()],jy.prototype,"sendTelemetryForWidgetModule",1),g([Nr()],jy.prototype,"onAnyMessage",1);var X_=jy;var Z_=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var eT=class{constructor(e,t,n,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new i4.EventEmitter;this.disposables=[];this.isWebViewOnline=ce();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new lo;this.uriConverter=new Z_(Br(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,ce()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(f),n.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let n=t;n&&this.uriTranslationRequests.has(n.request)&&this.uriTranslationRequests.get(n.request).resolve(n.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(f);else if(e==="IPyWidgets_IsOnline"){let n=t.isOnline;this.isWebViewOnline.resolve(n)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(f)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new X_(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),E("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>x("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){j("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:n,requestId:i}=e;if(H(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,n,i).catch(o=>x("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,n,i).catch(x.bind(void 0,"Failed to send widget sources upon ready"))}}async sendWidgetSource(e,t="*",n){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:n});return}let i={moduleName:e,requestId:n};try{H(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){x("Failed to get widget source due to an error",o),A("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{H(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:n,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,n,i).catch(x.bind(`Failed to send WidgetScript for ${t}`))}}}};var rT=Symbol("IWidgetScriptSourceProviderFactory"),nT=Symbol("INbExtensionsPathProvider"),iT=Symbol("IIPyWidgetScriptManagerFactory"),Cot=Symbol("IIPyWidgetScriptManager");var mf=k(M()),Po=require("vscode");var a4="https://unpkg.com/",SF="https://cdn.jsdelivr.net/npm/",oT="IPYWidgetCDNConfigured",o4="IPYWidgetNotFoundOnCDN",s4="IPYWidgetNoNetWorkAccess";function eve(r,e,t){let n=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),n=e.substr(0,o)),r===SF&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${r}${n}@${t}/dist/${i}`}function tve(r){switch(r){case"unpkg.com":return a4;case"jsdelivr.com":return SF;default:break}}var Ra=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let n=(async()=>{let i=new Gl,o=ds(i.exists(`${a4}${e}`)),s=ds(i.exists(`${SF}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return n.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(f,f),this.isOnCDNCache.set(t,n),n}async getWidgetScriptSource(e,t,n){if(n===!1)return re(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(f),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(oT,!1))return re("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,n){let i=tve(n);if(i)return eve(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(H(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(H(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(x(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(f),{moduleName:e})}async getValidUri(e,t,n){try{let i=await this.generateDownloadUri(e,t,n),o=new Gl;if(i&&await o.exists(i))return i}catch{E(`Failed downloading ${e}:${t} from ${n}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(s4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Po.window.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),ge.ok,ge.doNotShowAgain,ge.moreInfo)){case ge.doNotShowAgain:return this.globalMemento.update(s4,!0);case ge.moreInfo:return Po.env.openExternal(Po.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(oT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=ce(),A("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await Po.window.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},ge.ok,ge.doNotShowAgain,ge.moreInfo),t="dismissed";switch(e){case ge.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(oT,!0)]);break}case ge.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(oT,!0)]);break}case ge.moreInfo:{Po.env.openExternal(Po.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===ge.cancel?"cancel":"dismissed";break}A("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){let t="widgetScriptSources";await this.configurationSettings.updateSetting(t,e,void 0,Po.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(o4,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Po.window.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),ge.ok,ge.doNotShowAgain,ge.reportThisIssue)){case ge.doNotShowAgain:return this.globalMemento.update(o4,!0);case ge.reportThisIssue:return Po.env.openExternal(Po.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Ra=g([(0,mf.injectable)(),d(0,(0,mf.inject)($e)),d(0,(0,mf.named)(yt)),d(1,(0,mf.inject)(ae))],Ra);var vC=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new ko.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(K),this.jupyterOutput=this.serviceContainer.get(Mo,Ku),this.configService=this.serviceContainer.get(ae),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(re(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(f,f)}},this,this.disposables);let t=ce(),n=async()=>{let i=new Be;if(!t.completed){E("Attempting to determine version of IPyWidgets");let s=[],a=this.serviceContainer.get(Fe),c=ce();a.get(this.document)?c.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&c.resolve(u)},this,s);let l=await c.promise;l&&(Kt(l.kernelConnectionMetadata)?l.ipywidgetsVersion?t.completed||t.resolve(l.ipywidgetsVersion):(E("Waiting for IPyWidgets version"),l.onIPyWidgetVersionResolved(()=>{l.ipywidgetsVersion&&(t.completed||t.resolve(l.ipywidgetsVersion),Q(s))},this,s)):t.completed||t.resolve(uS)),s.length&&this.disposables.push(...s),E("Waiting for IPyWidgets version promise")}let o=await t.promise;E(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(f,f)};e.onDidReceiveMessage(async i=>{re(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await n(),i.type==="IPyWidgets_Window_Alert"&&ko.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&ko.env.openExternal(ko.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(E("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(f,f),n().catch(f)}onMessage(e,t,n){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(n).catch(f):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,n).catch(f):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(n).catch(f):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(n):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(n),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:n}),this.getIPyWidgetScriptSource().onMessage(t,n)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(f,f)}initialize(){E("initialize CommonMessageCoordinator"),this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{A("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await ht(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let n=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)n=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),ko.window.showErrorMessage(n).then(f,f);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=ge.moreInfo,c=y.enableCDNForWidgetsButton;n=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),ko.window.showErrorMessage(n,{modal:!0},c,a).then(l=>{switch(l){case a:ko.env.openExternal(ko.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case c:this.enableCDNForWidgets(e).catch(f);break;default:break}},f)}x(`Widget load failure ${n}`,i,t),A("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await ht(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await ko.commands.executeCommand(J.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{A("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await ht(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{x("Error rendering a widget: ",e),A("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(Yc)}H(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),A("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(gu).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new eT(this.document,this.serviceContainer.get(Fe),this.serviceContainer.get(K),this.serviceContainer.get(ae),this.serviceContainer.get(rT),this.serviceContainer.get(Ra)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){re("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};g([Nr()],vC.prototype,"enableCDNForWidgets",1);var xF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new ld.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){Q(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},cd=class{constructor(e,t,n){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=n;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){ld.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),ld.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),ld.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>{let i=this.notebookCommunications.get(n);this.notebookCommunications.delete(n),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(n),i&&i.dispose())}),t?.dispose()),ld.window.visibleNotebookEditors.filter(n=>n.notebook===e.notebook).forEach(n=>this.initializeNotebookCommunication(n,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!_t(e.notebook))return;let n=e.notebook;if(!t){E(`No controller, hence notebook communications cannot be initialized for editor ${V(e.notebook.uri)}`);return}if(this.notebookCommunications.has(e)){E(`notebook communications already initialized for editor ${V(e.notebook.uri)}`);return}E(`Initialize notebook communications for editor ${V(e.notebook.uri)}`);let i=new xF(e,t);this.addNotebookDisposables(n,[i]),this.notebookCommunications.set(e,i),E(`Resolving notebook UI Comms (resolve) for ${V(n.uri)}`);let o=this.messageCoordinators.get(n);o||(o=new vC(n,this.serviceContainer),this.messageCoordinators.set(n,o)),o.attach(i)}addNotebookDisposables(e,t){let n=this.notebookDisposables.get(e)||[];n.push(...t),this.notebookDisposables.set(e,n)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let n=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,n)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];Q(this.notebookDisposables.get(e)||[]),t.forEach(n=>this.notebookCommunications.get(n)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};cd=g([(0,Wy.injectable)(),d(0,(0,Wy.inject)(lt)),d(1,(0,Wy.inject)(K)),d(2,(0,Wy.inject)(St))],cd);var ud=k(M());var Vy=class{constructor(e,t,n,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=n;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:n}){t.isClosed||(n.connection.kind==="connectToLiveRemoteKernel"&&n.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,n.connection.serverProviderHandle,n.connection.kernelModel.id)),dt(n.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(f))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let n=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(E(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(f),this.liveKernelTracker.trackKernelIdAsUsed(t,n,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};Vy=g([(0,ud.injectable)(),d(0,(0,ud.inject)(K)),d(1,(0,ud.inject)(Fe)),d(2,(0,ud.inject)(St)),d(3,(0,ud.inject)(nm)),d(4,(0,ud.inject)(Go))],Vy);var hf=k(M());var c4=require("vscode");var ff=class{constructor(e,t,n,i){this.disposables=e;this.uriStorage=t;this.controllers=n;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(n=>this.checkExpiredServersInJupyterCollection(n)),t.forEach(n=>this.removeControllersBelongingToDisposedProvider(n.extensionId,n.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(f),this,this.disposables));let t=new c4.CancellationTokenSource;this.disposables.push(t);try{let n=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(n||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,n){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{n.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;dt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||n.includes(s.serverProviderHandle.handle)||(j(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(n=>{let i=n.connection;dt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(j(`Deleting controller ${n.id} as it is associated with a Provider Id that has been removed`),n.dispose())})}};g([Nr("Failed to check what servers were shutdown in Controller Watcher")],ff.prototype,"checkExpiredServersInJupyterCollection",1),ff=g([(0,hf.injectable)(),d(0,(0,hf.inject)(K)),d(1,(0,hf.inject)(Zt)),d(2,(0,hf.inject)(St)),d(3,(0,hf.inject)(Gt))],ff);var gf=k(M());var l4=require("vscode");var sT=class{constructor(e,t,n,i,o,s){this.label=e;this._description=t;this.detail=n;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new l4.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function u4(r){switch(r.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return aT(r)}}function aT(r){switch(r.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Mn(r.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(r.interpreter.envType){case"Conda":return r.interpreter.isCondaEnvWithoutPython?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var By=class{constructor(e,t,n,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=n;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=pt(e),o=rN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=tN(e));let s=aT(e),a=e.kind==="connectToLiveRemoteKernel"?()=>tN(e):void 0,c=new sT(i,o,"",s,void 0,a);if(this.disposables.push(c),this.details.set(e.id,c),e.kind==="startUsingPythonInterpreter"&&e.interpreter.isCondaEnvWithoutPython){let l=u=>{let p=u.find(h=>h.id===e.interpreter?.id),m=this.interpreters.resolvedEnvironments.find(h=>h.id===p?.id);if(e.kind==="startUsingPythonInterpreter"&&m){e.updateInterpreter(m);let h=pt(e),v=rN(e,this.platform),b=aT(e),w=!1;h!==c.label&&(c.label=h,w=!0),v!==c.description&&(c.description=v,w=!0),b!==c.category&&(c.category=b,w=!0),w&&c.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?l([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=Fv(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let n=u4(e);return t.category!==n&&(t.category=n,t.triggerChange()),t}};By=g([(0,gf.injectable)(),d(0,(0,gf.inject)(Cr)),d(1,(0,gf.inject)(Gt)),d(2,(0,gf.inject)(K)),d(3,(0,gf.inject)(Qe))],By);var vu=k(M()),yu=require("vscode");var pd=k(M()),m4=require("vscode");var p4=require("vscode");function cT(r){try{return rP(co(r))||r.getCells().find(t=>t.kind===p4.NotebookCellKind.Code)?.document.languageId}catch(e){j("Failed to determine language of first cell",e)}}var d4="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",is=class{constructor(e,t,n){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=n}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,n=this.pythonExtensionChecker.isPythonExtensionInstalled?xe:"plaintext";return xs(t||n)}activate(){m4.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(Kt(e))return QU;{let t=xs(Di(e)||"");return t&&lS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(d4)}async onDidSaveNotebookDocument(e){if(!_t(e))return;let t=cT(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(d4,t)}};g([Nr("Saving last saved cell language")],is.prototype,"onDidSaveNotebookDocument",1),is=g([(0,pd.injectable)(),d(0,(0,pd.inject)(K)),d(1,(0,pd.inject)($e)),d(1,(0,pd.named)(yt)),d(2,(0,pd.inject)(ze))],is);function f4(r){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};r.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),A("DS_INTERNAL.KERNEL_COUNT",{...e})}var At=require("vscode");var tl=require("vscode");var fi=Symbol("INotebookEditorProvider");var h4=require("vscode");async function g4(r,e){let t=e?.findNotebookEditor(r);return t?h4.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(x("Unable to select kernel as the Notebook document could not be identified"),!1)}var v4=require("vscode");var lT=class extends pc{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(pt(e),e.kernelSpec.specFile?V(v4.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Vs=class r{static async switchController(e,t){let i=t.get(fi).findNotebookEditor(e),o=t.get(St),s,a=ce(),c=o.onControllerSelected(u=>a.resolve(u.controller));return await g4(e,t.get(fi))&&i&&(s=await a.promise),c.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await tl.window.showErrorMessage(y.cannotRunCellKernelIsDead(pt(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),n=!1;switch(t){case y.restartKernel:{await e.restart(),n=!0;break}case y.showJupyterLogs:tl.commands.executeCommand(J.ViewJupyterOutput).then(f,f)}return n}static async handleKernelError(e,t,n,i,o,s,a,c){let l=e.get($e,yt),u=e.get(Yr);a.interpreter&&n==="start"&&oJ(l,19,a.interpreter.uri).catch(f);let p=await u.handleKernelError(t,n,a,i,c),m=dt(a);switch(e.tryGet(ui)?.isSupported&&m&&n==="start"&&Tt(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:p}),o.dispose().catch(f),p){case 1:case 2:throw t;case 3:{let b=await r.switchController(i,e);if(!b)throw t;s=b.controller,a=b.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return n=>n.start(t);case"interrupt":return n=>n.interrupt();case"restart":return n=>n.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,n,i,o,s,a){let{kernel:c,deadKernelAction:l}=await i;if(l_(c)){if(this.deleteKernelInfo(t,i),l==="deadKernelWasNoRestarted")throw new $p(c.kernelConnectionMetadata);return l==="deadKernelWasRestarted"?c:r.wrapKernelMethod(c.kernelConnectionMetadata,"start",o,e,t,n,a,s)}return c}static async wrapKernelMethod(e,t,n,i,o,s,a,c=()=>void 0){let l=this.getKernelInfo(o);if(!s.disableUI&&l?.options.disableUI&&(l.options.disableUI=!1),!s.disableUI&&l?.kernel.resolved&&(l?.kernel.value?.kernel?.disposed||l?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),l=void 0),l&&t!=="restart"&&t!=="interrupt")return r.verifyKernelState(i,o,s,l.kernel.promise,n,c,a);E(`${t} the kernel, options.disableUI=${s.disableUI} for ${V("notebook"in o?o.notebook.uri:o.resource)}`);let u=r.wrapKernelMethodImpl(e,t,i,o,s,n,c),p=ds(u);return p.promise.catch(f),u.then(m=>{m.kernel.onDisposed(()=>{this.deleteKernelInfo(o,p.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,p.promise)}),this.setKernelInfo(o,p,s),r.verifyKernelState(i,o,s,p.promise,n,c,a)}static getKernelInfo(e){return"notebook"in e?r.connectionsByNotebook.get(e.notebook):r.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,n){"notebook"in e?r.connectionsByNotebook.set(e.notebook,{kernel:t,options:n}):r.connectionsByUri.set(e.resource.toString(),{kernel:t,options:n})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?r.connectionsByNotebook.delete(e.notebook):r.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&r.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?r.connectionsByNotebook.delete(e.notebook):e.resource&&r.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&r.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!dt(e)||!e.kernelSpec.specFile)return;if(!t.get(nd).isTrusted(tl.Uri.file(e.kernelSpec.specFile)))throw new lT(e)}static async wrapKernelMethodImpl(e,t,n,i,o,s,a){let c=n.get(Fe),l=n.get(hm),u,p=r.convertContextToFunction(t,o),m=t,h="controller"in i?i.controller:void 0;for(t==="start"&&r.verifyWeCanStartKernel(e,n);u===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new tl.CancellationError;u="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:h||i.controller,resourceUri:i.resource}):l.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});try{if(t!=="restart"&&l_(u)&&!o.disableUI){let v=await r.notifyAndRestartDeadKernel(u);return{kernel:u,deadKernelAction:v?"deadKernelWasRestarted":"deadKernelWasNoRestarted"}}else{if(a(m,u),await p(u),"notebook"in i&&i.notebook.isClosed)throw new tl.CancellationError;l_(u)&&!o.disableUI&&m!=="interrupt"&&await r.notifyAndRestartDeadKernel(u)}}catch(v){if(dr(v)||j(`Error occurred while trying to ${m} the kernel, options.disableUI=${o.disableUI}`,v),o.disableUI)throw v;if("notebook"in i&&i.notebook.isClosed)throw new tl.CancellationError;let b=await r.handleKernelError(n,v,m,i.resource,u,h,e,s);if(h=b.controller,e=b.metadata,p=w=>w.start(o),m="start",s==="3rdPartyExtension")throw v;u=void 0}}return{kernel:u}}static async connectToNotebookKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}static async connectToKernel(e,t,n,i,o,s="jupyterExtension",a=()=>void 0){return r.wrapKernelMethod(e,"start",s,t,n,i,o,a)}};var vf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var pT=require("vscode");var uT=class extends er{constructor(t,n,i){super();this.kernel=t;this.controller=n;this.notebook=i}initialize(){let t=this.kernel,n=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!n.createNotebookExecution)return;this._register(pT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(n.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=n.createNotebookExecution(i);o.start(),this._register(new pT.Disposable(()=>o.end()))}};var y4=require("vscode");var dT=class{constructor(){this.cache=new Map;this.executionCount=0}getCacheKey(e,t,n){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${n}`),`${e}:${i}`}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,n){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,n)}};var mT=class{constructor(e,t){this.variables=e;this.kernelProvider=t;this.variableResultCache=new dT;this._onDidChangeVariables=new y4.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event}async*provideVariables(e,t,n,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s)return;let a=this.kernelProvider.getKernelExecution(s).executionCount,c=this.variableResultCache.getCacheKey(e.uri.toString(),t,i),l=this.variableResultCache.getResults(a,c);if(t){let u=t;if(!l&&u.getChildren)l=(await u.getChildren(i,o)).map(m=>this.createVariableResult(m,s)),this.variableResultCache.setResults(a,c,l);else if(!l)return;for(let p of l)yield p;if(n===2&&u.count&&l.length>0&&u.count>i+l.length)for await(let p of this.provideVariables(e,t,n,i+l.length,o))yield p}else{l||(l=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(p=>this.createVariableResult(p,s)),this.variableResultCache.setResults(a,c,l));for(let u of l)yield u}}createVariableResult(e,t){let n=!!e.properties,i=e.count??0,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),...e};return{variable:o,hasNamedChildren:n,indexedChildrenCount:i}}async getChildren(e,t,n,i){let o=e;return await this.variables.getAllVariableDiscriptions(n,o,t,i)}};var fT=class r{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.kernelConnection=e;this._viewType=n;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=c;this.extensionChecker=l;this.serviceContainer=u;this.displayDataProvider=p;this._onNotebookControllerSelectionChanged=new At.EventEmitter;this._onConnecting=new At.EventEmitter;this.pendingCellAdditions=new Map;this._onDidDispose=new At.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new Map;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;s.push(this),this._onNotebookControllerSelected=new At.EventEmitter,this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=At.notebooks.createNotebookController(t,n,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.variableProvider=new mT(m,this.kernelProvider),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),At.workspace.onDidCloseNotebookDocument(h=>{this.associatedDocuments.delete(h)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelected(){return this._onNotebookControllerSelected.event}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,n,i,o,s,a,c,l,u,p,m){return new r(e,t,n,i,o,s,a,c,l,u,p,m)}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Yt(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new uT(t,this.controller,e);this.disposables.push(u),u.initialize()}let n=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Ta).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||n.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==At.NotebookCellKind.Code)return;let s=!1,a=[],c,l=(u,p)=>{if(!(p.direction==="send"||s)&&au(p.msg)===o.msg_id){if("msg_type"in p.msg&&p.msg.msg_type==="status"&&"execution_state"in p.msg.content&&p.msg.content.execution_state==="idle")return;s=!0,n.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(f),Q(a)}};t.session.kernel.anyMessage.connect(l),c=new At.Disposable(()=>{An(()=>t.session?.kernel?.anyMessage.disconnect(l))}),a.push(c),this.disposables.push(c)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=pt(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let n=e&&"message"in e?e.message:"";return re(`\x1B[32mPosting message to Notebook UI ${n}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==Et)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=At.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());E(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),re(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelected.dispose(),this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),Q(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){e.length<1||(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(n=>n.index<0?(j(`Attempting to run a cell with index ${n.index}, kind ${n.kind}, text = ${n.document.getText()}`),!1):!0),At.workspace.isTrusted&&(H(`Handle Execution of Cells ${e.map(n=>n.index)} for ${V(t.uri)}`),await Qo(t.uri,this.connection),await Promise.all(e.map(n=>this.executeCell(t,n)))))}warnWhenUsingOutdatedPython(){let e=this.kernelConnection.interpreter?.version;!e||e.major>=4||this.kernelConnection.kind!=="startUsingLocalKernelSpec"&&this.kernelConnection.kind!=="startUsingPythonInterpreter"||(e.major<3||e.major===3&&e.minor<=5)&&At.window.showWarningMessage(y.warnWhenSelectingKernelWithUnSupportedPythonVersion,ge.learnMore).then(t=>{if(t===ge.learnMore)return Cp("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},f)}async onDidChangeSelectedNotebooks(e){if(re(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let n=this.kernelProvider.get(e.notebook);n?.kernelConnectionMetadata.id===this.kernelConnection.id&&(H(`Disposing kernel ${this.kernelConnection.id} for notebook ${V(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),n.dispose().catch(f)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire(e);return}if(!_t(e.notebook)&&e.notebook.notebookType!==Et||!At.workspace.isTrusted)return;this.warnWhenUsingOutdatedPython();let t=ce();re(`Controller ${this.connection.kind}:${this.id} associated with nb ${V(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelected.fire({notebook:e.notebook,controller:this}),this._onNotebookControllerSelectionChanged.fire(e),E("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=Kt(this.kernelConnection)?xe:t[0];await Promise.all(e.getCells().filter(o=>o.kind===At.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await At.languages.setTextDocumentLanguage(o.document,i).then(f,f)}))}getRendererScripts(){return this.context.extensionMode===At.ExtensionMode.Development||this.context.extensionMode===At.ExtensionMode.Test?[new At.NotebookRendererScript(At.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){E(`VS Code interrupted kernel for ${V(e.uri)}`),e.getCells().forEach(t=>gt(t,"Cell cancellation requested")),At.commands.executeCommand(J.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(f,t=>x("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let n=this.runningCellExecutions.get(e.notebook);if(!n||n.cell===e){n?.end(void 0,void 0),n=Hi.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,n);let i=n.end.bind(n);n.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return n}async executeCell(e,t,n){let i=new Ko,o=i.add(new At.CancellationTokenSource);i.add(At.workspace.onDidCloseNotebookDocument(m=>m===e?o.cancel():void 0));let s=this.createCellExecutionIfNecessary(t,new vf(this.controller)),a="start",c,l=new vf(this.controller),u=!1,p=this.serviceContainer.get(Ta);try{if(c=await this.connectToKernel(e,new Yt(!1)),c.disposing)throw new At.CancellationError;u=!0,c&&c.controller.id!==l.id&&(l=c.controller,s=this.createCellExecutionIfNecessary(t,c.controller)),a="execution",c.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(c,e),p.trackCellExecution(t,c);let h=this.kernelProvider.getKernelExecution(c).executeCell(t,n);return h.then(()=>{if(c&&!oS.isExiting)return p.deleteTrackedCellExecution(t,c)}).catch(f),await h}catch(m){if(m instanceof rd)return;dr(m)||x("Error in execution",m),u||(s.start(),s.clearOutput(t).then(f,f));let h=this.serviceContainer.get(Yr);m=sn.unwrap(m);let v=dr(m)||m instanceof $p;await sp(t,l,await h.getErrorMessageForDisplayInCell(m,a,e.uri),v)}finally{i.dispose()}}async connectToKernel(e,t){return this._onConnecting.fire(),Vs.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables)}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let n=[];At.workspace.onDidCloseNotebookDocument(s=>{s===t&&Q(n)},this,n);let i=e.onDisposed(()=>Q(n)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await b4(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&Q(n))});n.push({dispose:()=>o.dispose()}),n.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,n=this.kernelProvider.get(e);if(n&&IV(n.kernelConnectionMetadata,t)){H("Switch kernel did not change kernel.");return}if(Tt(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),n&&At.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await b4(e,t),e.notebookType===Et)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(E(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),Kt(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(nd);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&dt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(At.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Yt(!0)).catch(f)}};async function b4(r,e,t){let n=co(r)||{},{changed:i}=await YE(n,e,t);if(i){let o=new At.WorkspaceEdit,s=JSON.parse(JSON.stringify(r.metadata||{custom:{}}));s.custom=s.custom||{},s.custom.metadata=n,o.set(r.uri,[At.NotebookEdit.updateNotebookMetadata({...r.metadata||{},custom:s.custom})]),await At.workspace.applyEdit(o)}}var qy=class{constructor(e,t,n,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=n;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new yu.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new yu.EventEmitter;this.selectionChangedEmitter=new yu.EventEmitter;this.selectedControllers=new Map;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.onDidChange(({added:e})=>{e.forEach(t=>{t.onNotebookControllerSelectionChanged(n=>{!n.selected&&this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(j(`Removing controller ${t.id} for ${t.connection.kind} from kernel list`),t.dispose())},this,this.disposables)})},this,this.disposables),yu.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),yu.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebookDocument(e).catch(f)),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),f4(this.registered.map(e=>e.connection)),re(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async onDidOpenNotebookDocument(e){e.notebookType!==It&&e.notebookType!==Et||yu.workspace.isTrusted}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(n=>{let i=e.some(o=>o.id===n.connection.id)||Zn&&this._activeInterpreterControllerIds.has(n.id);return!i&&n.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(n)?(i||E(`Controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}' is no longer a valid`),!i):!1}).forEach(n=>{j(`Disposing old controller ${n.connection.kind}:'${n.id}' for view = '${n.viewType}'`),n.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[It,Et])}catch(t){if(!dr(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:n})=>{let i=new Set((n||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{j(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(n=>{n.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(n=>{Ut(n.connection)&&n.connection.serverProviderHandle.id===t.id&&n.connection.serverProviderHandle.handle===t.handle&&(j(`Deleting controller ${n.id} as it is associated with a connection that has been removed`),n.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.filter(t=>!this.isFiltered(t)).forEach(t=>this.addOrUpdate(t,[It,Et])),this.registered.forEach(t=>{this.isFiltered(t.connection)&&this.canControllerBeDisposed(t)&&(j(`Deleting controller ${t.id} as it is associated with a connection that has been hidden`),t.dispose())})}batchAdd(e,t){let n=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);n.push(...o)}),n.length&&this.changeEmitter.fire({added:n,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e.uri.toString())}addOrUpdate(e,t){let{added:n,existing:i}=this.addImpl(e,t,!0);return n.concat(i)}addImpl(e,t,n){let i=[],o=[];re(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),re(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):this.isFiltered(e)?(re(`Existing controller '${s}' will be excluded as it is filtered`),!1):(re(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let c=fT.create(e,s,a,this.serviceContainer.get(Fe),this.serviceContainer.get(ct),this.disposables,this.serviceContainer.get(is),this.serviceContainer.get(ae),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(lp),this.serviceContainer.get(Rn,Ge.KERNEL_VARIABLES)),l=[];c.onDidDispose(()=>{re(`Deleting controller '${c.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(c.id),l.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(c),this.registeredControllers.set(c.id,c),i.push(c),c.onNotebookControllerSelected(u=>{re(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook.uri.toString(),u.controller),this.selectedEmitter.fire(u)},this,l),c.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:c}),this,l)}),n&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(dr(s,!0))return{added:i,existing:o};x(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let n=this.getControllerId(e,t);return this.registeredControllers.get(n)}isFiltered(e){return!1}getControllerId(e,t){return t===It?e.id:`${e.id}${DV}`}isControllerAttachedToADocument(e){return yu.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};qy=g([(0,vu.injectable)(),d(0,(0,vu.inject)(K)),d(1,(0,vu.inject)(ai)),d(2,(0,vu.inject)(ze)),d(3,(0,vu.inject)(lt)),d(4,(0,vu.inject)(Zt)),d(5,(0,vu.inject)(Tr))],qy);var dd=k(M());var hT=class{constructor(e,t,n){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=n;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var I4=require("vscode"),gT=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return I4.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let n=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!n&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return n||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async n=>({moduleName:n,scriptUri:e[n].toString(),source:"remote"}))):[]}};var Jy=class{constructor(e,t,n){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=n}getProviders(e,t){let n=[];switch(n.push(new Ra(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":n.push(new gT(e,this.widgetScriptManagerFactory));break;default:n.push(new hT(e,t,this.widgetScriptManagerFactory))}return n}};Jy=g([(0,dd.injectable)(),d(0,(0,dd.inject)(ae)),d(1,(0,dd.inject)(iT)),d(2,(0,dd.inject)($e)),d(2,(0,dd.named)(yt))],Jy);var S4=k(M()),vT=require("vscode");var $y=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return vT.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":return vT.Uri.joinPath(vT.Uri.file(e.kernelConnectionMetadata.interpreter.sysPrefix),"share","jupyter");default:return}}};$y=g([(0,S4.injectable)()],$y);var fd=k(M());var yf=require("vscode");var EF=require("vscode");var M4=k(A4());var N4=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function ove(r,e,t){let n=[...N4],i=await ht(e),o=0,s;for(;o<=0&&n.length&&(s=n.pop(),!!s);)o=t.indexOf(s);if(o<0){let m=[...N4].map(h=>h.substring(0,h.length-2));for(;o<=0&&m.length&&(s=m.pop(),!!s);)o=t.indexOf(s)}if(o<0){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let c=t.indexOf("{",o),l=t.substring(c,a);l=(0,M4.default)(l,{language:"javascript"}),l=Ke(l,{trim:!0,removeEmptyEntries:!0}).join("");let u=l.split("{")[l.split("{").length-1].split("}")[0].split(",").map(m=>m.trim()).filter(m=>m.length&&m.includes(":")),p={};if(u.forEach(m=>{let h=m.split(":"),v=Yd(h[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),b=Yd(m.substring(m.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();p[v]=b.startsWith("http")?EF.Uri.parse(b):EF.Uri.joinPath(r,b)}),!p||!Object.keys(p).length){A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return A("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(p).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),p}var Hy=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){Q(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,n){let i=await this.getWidgetScriptSource(t);try{let o=await ove(e,n,i);if(!o){let s=`Failed to extract require.config from widget for ${n} from ${V(t)}`;Zn&&(s+=`with contents ${i}`),j(s)}return o}catch(o){x(`Failed to extract require.config entry for ${n} from ${V(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Be,[t,n]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!n)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(n,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),A("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:dt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var ST=class extends Hy{constructor(t,n,i){super(t);this.context=n;this.fs=i;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(f)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return yf.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(yf.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!Kt(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return re("No Kernel session to get list of widget entry points"),[];let n=[];n.push(hn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!Zn&&this.context.extensionMode===yf.ExtensionMode.Production&&n.push(ji(1e4).then(()=>[])),n.forEach(s=>s.catch(f));let i=await Promise.race(n);if(i.length===0)return re("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return re("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return E(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>Yd(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:yf.Uri.joinPath(yf.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:ut(a)}))}catch(s){return x(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let n=t.toString(!0),o=await new Gl().downloadFile(n);if(o.status===200)return o.text();throw x(`Error downloading from ${n}: ${o.statusText}`),new Error(`Error downloading from ${n}: ${o.statusText}`)}};var Gy=require("vscode");var xT=class r extends Hy{constructor(t,n,i,o,s){super(t);this.fs=n;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!r.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let n=new Be;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){j(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await ht(this.kernel.kernelConnectionMetadata.id),o=Gy.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=Gy.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),c=a.map(l=>Gy.Uri.joinPath(l,"nbextensions"));c.reverse();for(let l of c)await this.fs.exists(l)&&await this.fs.copy(l,s,{overwrite:t});return this.overwriteExistingFiles=!1,r.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),A("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:n.elapsedTime}),o}catch(n){throw A("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,n),n}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let n=Gy.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("*/extension.js",n.fsPath,!0)).map(o=>({uri:Gy.Uri.joinPath(n,o),widgetFolderName:ut(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var zy=class{constructor(e,t,n,i,o){this.nbExtensionsPathProvider=e;this.fs=t;this.context=n;this.jupyterPaths=i;this.disposables=o;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new ST(e,this.context,this.fs);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new xT(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};zy=g([(0,fd.injectable)(),d(0,(0,fd.inject)(nT)),d(1,(0,fd.inject)(hr)),d(2,(0,fd.inject)(ct)),d(3,(0,fd.inject)(Kr)),d(4,(0,fd.inject)(K))],zy);var CT=k(M()),Aa=require("vscode");var Bs=class{constructor(e){this.disposables=[];e.push(this)}dispose(){Q(this.disposables)}activate(){Aa.workspace.onDidChangeNotebookDocument(this.onDidChangeNotebookDocument,this,this.disposables)}onDidChangeNotebookDocument(e){_t(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(n=>n.items&&n.items.some(i=>i.mime===Ui)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!Aa.workspace.isTrusted)return;let e=Aa.extensions.getExtension(ch);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let n=t.split("."),i=parseInt(n[0],10),o=parseInt(n[1],10),s=parseInt(n[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){Bs.messageDisplayed||(Bs.messageDisplayed=!0,Aa.window.showInformationMessage(y.rendererExtensionRequired,{modal:!0},ge.bannerLabelYes).then(e=>{e===ge.bannerLabelYes&&Aa.commands.executeCommand("extension.open",ch).then(f,f)}).then(f,f))}displayUpdateMessage(){Bs.messageDisplayed||(Bs.messageDisplayed=!0,Aa.window.showInformationMessage(y.rendererExtension1015Required,{modal:!0},ge.bannerLabelYes).then(e=>{e===ge.bannerLabelYes&&Aa.commands.executeCommand("extension.open",ch).then(f,f)}).then(f,f))}};Bs.messageDisplayed=!1,Bs=g([(0,CT.injectable)(),d(0,(0,CT.inject)(K))],Bs);function O4(r,e){r.addSingleton(gu,gu),r.addSingleton(rT,Jy),r.addSingleton(iT,zy),r.addSingleton(nT,$y),r.addSingleton(Ra,Ra),r.addSingleton(Ie,Bs)}var hd=k(M()),Fr=require("vscode");var Qy=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=n;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){Q(this.localDisposables)}activate(){if(!Br()){this.localDisposables.push(Fr.notebooks.registerKernelSourceActionProvider(It,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Fr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Fr.notebooks.registerKernelSourceActionProvider(Et,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Fr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],n=new Fr.EventEmitter;this.localDisposables.push(Fr.notebooks.registerKernelSourceActionProvider(It,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Fr.notebooks.registerKernelSourceActionProvider(Et,{onDidChangeNotebookKernelSourceActions:n.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>tg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:Fr.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],n.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Fr.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Fr.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Fr.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),_e.instance.get(Gt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=_e.instance.get(Gt),t=new Set;e.jupyterCollections.map(n=>{let i=`${n.extensionId}:${n.id}`;if(n.id===fw||(t.add(i),this.providerMappings.has(i)))return;let o=Fr.notebooks.registerKernelSourceActionProvider(It,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]}),s=Fr.notebooks.registerKernelSourceActionProvider(Et,{provideNotebookKernelSourceActions:()=>[{get label(){return n.label},get documentation(){return n.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[n.extensionId,n.id],title:n.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:n})}),this.providerMappings.forEach(({disposables:n},i)=>{t.has(i)||(Q(n),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Fr.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await _e.instance.get(fm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await _e.instance.get(aP).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,n){if(n=n||Fr.window.activeNotebookEditor?.notebook,!n&&Fr.window.activeTextEditor&&(n=this.notebookEditorProvider.findNotebookEditor(Fr.window.activeTextEditor.document.uri)?.notebook),!n)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await _e.instance.get(sP).selectRemoteKernel(n,o);return this.getSelectedController(n,a)}async getSelectedController(e,t){if(!t)return;let n=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(n)||n.length===0){j(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}Qo(e.uri,t).finally(()=>Tt(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(f),n.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Fr.NotebookControllerAffinity.Preferred);let i=n[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(dt(t.connection)&&Kt(t.connection)&&t.connection.interpreter?.isCondaEnvWithoutPython&&!Br()){let n=[];try{let i=new Fr.CancellationTokenSource;n.push(i);let o=new Yt(!1);n.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){x(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{Q(n)}}}};Qy=g([(0,hd.injectable)(),d(0,(0,hd.inject)(St)),d(1,(0,hd.inject)(Tr)),d(2,(0,hd.inject)(fi)),d(3,(0,hd.inject)(Ps)),d(4,(0,hd.inject)(K))],Qy);var bf=k(M()),kT=require("vscode");var rl=require("vscode");var wT=require("vscode");var gd=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){Q(this.disposables)}async findPreferredRemoteKernelConnection(e,t,n){return this.findPreferredRemoteKernelConnectionImpl(e,t,n,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,n,i){let o=await _e.instance.get(Go).getPreferredRemoteKernelId(e.uri),s=async()=>{let c=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(c)return c;if(t.status==="idle")return;let l=await new Promise(u=>t.onDidChangeKernels(()=>{let p=t.kernels.find(m=>m.kind==="connectToLiveRemoteKernel"&&m.id===o);p&&u(p),(t.status==="idle"||n.isCancellationRequested)&&u(void 0)},this,this.disposables));if(l)return l};if(o){let c=await s();if(c||i)return c}let a=t.kernels.find(c=>Ut(c))?.serverProviderHandle;if(a){let c=await this.jupyterConnection.createConnectionInfo(a),l=(e.uri,void 0),u=l&&t.kernels.find(p=>Ut(p)&&p.kind==="connectToLiveRemoteKernel"&&p.kernelModel.model&&p.kernelModel.model.path===l.path&&p.kernelModel.model.name===l.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,n,i)}async findPreferredLocalKernelSpecConnection(e,t,n){return this.findPreferredKernelSpecConnection(e,t,n,!1)}async findPreferredKernelSpecConnection(e,t,n,i){let s=co(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.name===s):[];if(u.length||i)return u;let p=cT(e);if(p)return t.kernels.filter(m=>(m.kind==="startUsingLocalKernelSpec"||m.kind==="startUsingRemoteKernelSpec")&&m.kernelSpec.language&&(m.kernelSpec.language===p||xs(m.kernelSpec.language)===xs(p)))},c=a();if(Array.isArray(c)&&c.length)return i&&c.length>1?void 0:c[0];if(t.status==="idle")return;let l=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(n.isCancellationRequested)return u(void 0);let p=a();if(Array.isArray(p)&&p.length)return i&&p.length>1?u(void 0):u(p[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>Q(l))}async findPreferredPythonKernelConnection(e,t,n){return this.findPreferredPythonKernelConnectionImpl(e,t,n)}async findPreferredPythonKernelConnectionImpl(e,t,n){t=t||_e.instance.get(Tr).registered.find(l=>l.kind==="localPythonEnvironment");let i=_e.instance.get(Qe),o=PF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!n.isCancellationRequested)return t.kernels.filter(l=>l.kind==="startUsingPythonInterpreter").map(l=>l).find(l=>l.interpreter.id===s.id)},c=a();if(c)return c;if(t.status==="discovering")return await new Promise(l=>{t.onDidChangeStatus(()=>t.status==="idle"&&l(),this,this.disposables),t.onDidChangeKernels(()=>(PF(e,t)||a())&&l(),this,this.disposables)}),PF(e,t)||a()}};function PF(r,e){let t=wT.workspace.getWorkspaceFolder(r.uri)?.uri||(wT.workspace.workspaceFolders?.length===1?wT.workspace.workspaceFolders[0].uri:void 0),n=K4(Si(r.uri),e);if(n)return n;if(t)return K4(t,e)}function K4(r,e){let n=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>Og(a.interpreter.envPath?.fsPath||a.interpreter.uri.fsPath,r.fsPath)),i=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(i)return i;let o=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");if(o)return o;let s=n.find(a=>a.interpreter.envType==="Venv"&&a.interpreter.envName?.toLowerCase()===".venv");return s||(n.length?n[0]:void 0)}var ET=class{constructor(e,t,n,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new rl.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new rl.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new rl.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new rl.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new rl.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),Qd(n)?n.then(s=>this.setupFinder(s)).catch(s=>x(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(n)}dispose(){Q(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>x(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new rl.CancellationTokenSource;this.disposables.push(new rl.Disposable(()=>t.cancel())),this.disposables.push(t);let n=new gd(this.connection);this.disposables.push(n),e.kind==="remote"?this.computePreferredRemoteKernel(e,n,t.token):this.computePreferredLocalKernel(e,n,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(n=>n.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(n.interpreter)):e}computePreferredRemoteKernel(e,t,n){t.findPreferredRemoteKernelConnection(this.notebook,e,n).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>x(`Preferred connection failure ${V(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,n){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,n).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>x(`Preferred connection failure ${V(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var vd=require("vscode");function nl(r){return"connection"in r}function sve(r){return"command"in r}function ave(r,e,t){let n=t?[t]:r.activeItems.length?[r.activeItems[0]]:[];if(n.length&&!e.includes(n[0])){let i=n[0],o=nl(i)&&e.find(s=>nl(s)&&s.connection.id===i.connection.id);o?n[0]=o:n.length=0}r.items=e,r.activeItems=n}var kF=class extends Error{},PT=class extends er{constructor(t,n){super();this.provider=t;this.token=n;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=_e.instance.get(lp)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,n){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:vd.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,n)}async selectKernelImplInternal(t,n){let i={iconPath:new vd.ThemeIcon("refresh"),tooltip:ge.refresh},o={iconPath:new vd.ThemeIcon("loading~spin"),tooltip:ge.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let p=s.buttons;s.buttons=p.filter(m=>m!==i).concat(o),await this.provider.refresh().catch(f),s.buttons=p}}});n.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let c;this._register(this.provider.onDidChangeStatus(()=>{switch(c&&clearTimeout(c),this.provider.status){case"discovering":s.busy=!0;break;case"idle":c=setTimeout(()=>s.busy=!1,500),this._register(new vd.Disposable(()=>c&&clearTimeout(c)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let l=await a;if(!this.token.isCancellationRequested){if(sve(l))try{let u=await l.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof kF)return{selection:"userPerformedSomeOtherAction"};if(u===Ae.back)return this.selectKernelImplInternal(t,n);throw u}if(l&&"connection"in l)return{selection:"controller",connection:l.connection};if(l&&"error"in l)throw Ae.back}}updateQuickPickItems(t){t.title=this.provider.title;let n=new Set(t.items.filter(u=>nl(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!n.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,p)=>u.label.localeCompare(p.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),c=s.size;i.forEach(u=>{let p=a.get(u.connection.id);p&&s.delete(p),s.add(u)});let l=Array.from(s);l.sort((u,p)=>u.label.localeCompare(p.label)),this.quickPickItems.splice(o+1,c,...l),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let n=this.recommendedItems.find(a=>nl(a)),i=new Set(this.recommendedItems.filter(nl).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!nl(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;n&&nl(n)&&s&&(nl(s)?s.connection.id!==n.connection.id&&(n=void 0):n=void 0),ave(t,this.recommendedItems.concat(o),n)}removeMissingKernels(t){let n=t.items.filter(s=>nl(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=n.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:vd.QuickPickItemKind.Separator});let n=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=n:this.recommendedItems.push(n),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let n=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!nl(i)||!n.has(i.connection.id))return;let o=n.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,n=!1){let i=n?"$(star-full) ":"",o=(c,l,u)=>{c.label=`${i}${l.label}`,c.detail=l.detail,c.description=l.description,this.quickPickItems.forEach(p=>{"connection"in p&&p.connection.id===u.id&&(p.label=l.label,p.detail=l.detail,p.description=l.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:n,connection:t};return o(a,s,t),this._register(s.onDidChange(c=>o(a,c,t),this)),a}};var Yy=class{constructor(e,t,n,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=n;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==It&&e.notebookType!==Et)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new kT.CancellationTokenSource;let t=this.multiStepFactory.create(),n={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,n),n)===Ae.cancel||n.selection?.type==="userPerformedSomeOtherAction")throw new kT.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){Q(n.disposables);return}if(n.selection?.type==="connection")return n.selection.connection}finally{Q(n.disposables)}}selectKernelFromKernelFinder(e,t,n,i){let o=new ET(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,n,i)}async selectKernel(e,t,n,i){if(t.isCancellationRequested)return;let o=new PT(e,t);i.disposables.push(o);let s=c=>{let{quickPick:l,selection:u}=n.showLazyLoadQuickPick({...c,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:l,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};Yy=g([(0,bf.injectable)(),d(0,(0,bf.inject)(Tr)),d(1,(0,bf.inject)(_g)),d(2,(0,bf.inject)(ai)),d(3,(0,bf.inject)(In))],Yy);var bu=k(M()),Sf=require("vscode");var If=require("vscode");var Xy=require("vscode");var DT=class{constructor(e,t){this.notebook=e;this.disposables=[];_e.instance.get(St).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=mP(t)}dispose(){this.cancelTokeSource.dispose(),Q(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,E(`Python Environment created ${e.id}`);let n=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!n)return A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),E(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};E(`Python Environment ${e.id} found as a kernel ${n.kind}:${n.id}`);let o=await _e.instance.get(Ps).installMissingDependencies({resource:this.notebook.uri,kernelConnection:n,ui:new Yt(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,j(`Dependencies not installed for new Python Env ${V(e.uri)} for notebook ${V(this.notebook.uri)}`)),A("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:t.interpreter.envType}),{kernelConnection:n}}async waitForPythonKernel(e){let n=_e.instance.get(Tr).registered.find(i=>i.kind==="localPythonEnvironment");if(n)return this.waitForPythonKernelFromFinder(e,n)}async waitForPythonKernelFromFinder(e,t){let n=t.kernels.find(i=>i.interpreter.id===e.id);return n||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return Q(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{Q(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||j(`New Python Environment ${V(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=_e.instance.get(Qe),t=new Xy.CancellationTokenSource;e.pauseInterpreterDetection(t.token);try{let n=await Xy.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0});if(n?.action==="Cancel")return{action:"Cancel"};if(n?.action==="Back")return{action:"Back"};let i=n?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return j("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,E(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||j(`No interpreter details for New Python Environment ${V(Xy.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var _T=require("vscode");function L4(r,e){let t=cve(r,e.environments.known);return t||(()=>{let i=e.environments.getActiveEnvironmentPath(r.uri);return i&&e.environments.known.find(o=>o.id===i.id)})()}function cve(r,e){let t=_T.workspace.getWorkspaceFolder(r.uri)?.uri||(_T.workspace.workspaceFolders?.length===1?_T.workspace.workspaceFolders[0].uri:void 0),n=F4(Si(r.uri),e);if(n)return n;if(t)return F4(t,e)}function F4(r,e){let t=e.filter(n=>Og(n.environment?.folderUri?.fsPath||n.executable.uri?.fsPath||n.path,r.fsPath));return t.find(n=>Jr(n)==="Venv"&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>Jr(n)==="Conda"&&n.environment?.name?.toLowerCase()===".conda")||t.find(n=>["VirtualEnv","VirtualEnvWrapper"].includes(Jr(n))&&n.environment?.name?.toLowerCase()===".venv")||t.find(n=>n.environment?.name?.toLowerCase()===".venv"||n.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}var TT=class extends er{constructor(t,n){super();this.notebook=t;this.token=n;let i=_e.instance.get(ai),o=_e.instance.get(ze),s=_e.instance.get(zt);this.provider=_e.instance.get(Ms).withFilter(h=>!i.isPythonEnvironmentExcluded(h)),this.pythonEnvPicker=this._register(new Vp(Promise.resolve(this.provider),aD,cD,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let a=!1,c=()=>{a||(a=!0,this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this)))};this.provider.items.length&&c();let l={dispose:f},u=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),l.dispose(),u.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(l=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>If.commands.executeCommand(J.InstallPythonViaKernelPicker).then(f,f)),new If.CancellationError}))}).catch(f);let p=()=>{!this.pythonApi||n.isCancellationRequested||(this.pythonEnvPicker.recommended=L4(this.notebook,this.pythonApi))},m=h=>{h&&(this.pythonApi=h,p(),this._register(h.environments.onDidChangeActiveEnvironmentPath(p)),this._register(h.environments.onDidChangeEnvironments(p)))};o.isPythonExtensionInstalled?s.getNewApi().then(m).catch(f):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(m),this)),p()}async selectKernel(){let t=ce();If.extensions.getExtension(ei)||If.commands.executeCommand(J.InstallPythonExtensionViaKernelPicker).then(c=>{c===!0?this.provider.refresh().catch(f):t.resolve()},c=>{x("Failed to install the Python extension",c),t.resolve()});let n=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!n||n instanceof Ae)return n||Ae.cancel;let i=_e.instance.get(Qe),o=_e.instance.get(Kr),s=await i.getInterpreterDetails(n.path);if(!s)return Ae.cancel;let a=await ws(s,await o.getKernelSpecTempRegistrationFolder());return Fo.create({kernelSpec:a,interpreter:s,id:ki(a,s)})}async createNewEnvironment(){let t=_e.instance.get(zt);if(!_e.instance.get(ze).isPythonExtensionInstalled)return;let o=await this._register(new DT(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?Ae.back:Ae.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):Ae.cancel}};var Zy=class extends er{constructor(t,n,i,o,s,a){super();this.pythonApi=n;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new Sf.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Sf.EventEmitter);this._status="idle";this.promiseMonitor=new ao;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(f),this.hookupPythonApi().catch(f))},this))}async selectLocalKernel(t){let n=new Sf.CancellationTokenSource,i=[n];try{let o=new TT(t,n.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof Ae&&s===Ae.back)return;throw new Sf.CancellationError}return this.addUpdateKernel(s),s}finally{Q(i)}}async getKernelConnection(t){let n=_e.instance.get(Qe),i=_e.instance.get(Kr),o=await n.getInterpreterDetails(t.path);if(!o){j(`Python Env ${V(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){j(`Python Env hidden via filter: ${V(o.id)}`);return}let s=await ws(o,await i.getKernelSpecTempRegistrationFolder()),a=Fo.create({kernelSpec:s,interpreter:o,id:ki(s,o)}),c=this._kernels.get(a.id);return c||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let n=this._kernels.get(t.id);n?(n.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(n,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),Q(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(f)),t.environments.known.forEach(n=>this.buildDummyEnvironment(n).catch(f)))}).catch(f)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||this.jupyterPaths.getKernelSpecTempRegistrationFolder()}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();t&&(t.environments.known.map(n=>this.buildDummyEnvironment(n).catch(f)),this._register(t.environments.onDidChangeEnvironments(n=>{if(n.type==="remove"){let i=this._kernels.get(n.env.id);i&&(this._kernels.delete(n.env.id),this._onDidChangeKernels.fire({removed:[i]}))}else this.buildDummyEnvironment(n.env).catch(f)},this)))}async buildDummyEnvironment(t){let n=this.pythonApi.pythonExtensionVersion&&this.pythonApi.pythonExtensionVersion.compare("2023.3.10341119")>=0,i=VE(t,n===!0);if(!i||this.filter.isPythonEnvironmentExcluded(i))return;let o=await ws(i,await this.getKernelSpecsDir()),s=Fo.create({kernelSpec:o,interpreter:i,id:ki(o,i)});this._kernels.get(t.id)||(this._kernels.set(t.id,s),this._onDidChangeKernels.fire({}))}};Zy=g([(0,bu.injectable)(),d(0,(0,bu.inject)(K)),d(1,(0,bu.inject)(zt)),d(2,(0,bu.inject)(ai)),d(3,(0,bu.inject)(Kr)),d(4,(0,bu.inject)(ze)),d(5,(0,bu.inject)(Tr))],Zy);var il=k(M()),Ln=require("vscode");function RT(r){return r===Pt||r===sh}var eb=class{constructor(e,t,n,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=n;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==It&&e.notebookType!==Et)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Ln.CancellationTokenSource;let n=new lx,i={disposables:[],notebook:e};try{if(await n.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===Ae.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Ln.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){Q(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{Q(i.disposables)}}async getRemoteServersFromProvider(e,t,n,i){let o=this.kernelFinder.registered.filter(T=>T.kind==="remote"),s=[],a=[],c=[],l=this.jupyterServerRegistry.jupyterCollections.find(T=>T.extensionId===e.extensionId&&T.id===e.id)?.serverProvider,u=l?.provideJupyterServers?Promise.resolve(l.provideJupyterServers.bind(l)(t)).then(T=>T||[]):Promise.resolve([]),p=new Set,m=await u;if(o.filter(T=>T.serverProviderHandle.id===e.id).map(T=>{let F=this.serverUriStorage.all.find(ee=>Wt(ee.provider)===Wt(T.serverProviderHandle));p.add(Wt(T.serverProviderHandle)),c.push({server:T,time:F?.time})}),c.sort((T,F)=>!T.time&&!F.time?T.server.displayName.localeCompare(F.server.displayName):!T.time&&F.time?1:T.time&&!F.time||(T.time||0)>(F.time||0)?-1:1),c.filter(({time:T})=>(T||0)>0).forEach(({server:T,time:F})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,description:F?y.jupyterServerLastConnectionForQuickPickDescription(new Date(F)):void 0,buttons:l?.removeJupyterServer&&RT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),c.filter(({time:T})=>!T).forEach(({server:T})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,buttons:l?.removeJupyterServer&&RT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),m.sort((T,F)=>T.label.localeCompare(F.label)).forEach(T=>{let F=Wt({extensionId:e.extensionId,id:e.id,handle:T.id});p.has(F)||s.push({type:"jupyterServer",label:T.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:T.id},server:T,buttons:l?.removeJupyterServer&&RT(e.extensionId)?[{iconPath:new Ln.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let T=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map(F=>({...F,provider:e,type:"uriProviderQuickPick",command:F}));s.length>0&&T.length&&a.push({label:"",kind:Ln.QuickPickItemKind.Separator}),a.push(...T)}let h=s.concat(a),v=new Ln.EventEmitter,b=h.length===1&&"command"in h[0]&&h[0].command.canBeAutoSelected?h[0]:void 0;if(l){let T=h.filter(F=>"type"in F);T.length===1&&T.every(F=>F.type!=="uriProviderQuickPick")?b=T[0]:T.every(F=>F.type==="uriProviderQuickPick")&&T.filter(F=>F.picked).length===1&&(b=h.filter(F=>F.picked)[0])}let w,D;if(b)D=b;else{let{quickPick:T,selection:F}=n.showLazyLoadQuickPick({items:h,placeholder:e.extensionId===Pt||e.extensionId===sh?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async ee=>{if("type"in ee.item&&(ee.item.type==="finder"||ee.item.type==="jupyterServer")){let de=ee.item.idAndHandle.handle,Z=m.find(ye=>ye.id===de);l?.removeJupyterServer&&Z&&RT(e.extensionId)&&(T.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:de}).catch(f),await l.removeJupyterServer(Z),T.busy=!1,h.splice(h.indexOf(ee.item),1),v.fire(h.concat([])))}},onDidChangeItems:v.event});T.onDidChangeValue(async ee=>{if(!e.commandProvider?.provideCommands)return;let de=[];s.length>0&&de.push({label:"",kind:Ln.QuickPickItemKind.Separator});let ye=(await Promise.resolve(e.commandProvider.provideCommands(ee,t))||[]).map(ue=>({...ue,provider:e,type:"uriProviderQuickPick",command:ue}));T.items=s.concat(de).concat(ye)},this),w=T,D=await F}if(!t.isCancellationRequested&&D&&"type"in D)switch(D.type){case"finder":{let T=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(D.kernelFinderInfo),t).catch(F=>x("Failed to select a kernel",F));if(T&&T===Ae.back){if(D===b)throw Ae.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!T||T instanceof Ae)throw new Ln.CancellationError;i.selection={type:"connection",connection:T};return}case"jupyterServer":{let T=(async()=>{let ee={id:e.id,handle:D.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===Va.toLowerCase()&&await ar(t,this.serverSelector.addJupyterServer(ee)),this.kernelFinderController.getOrCreateRemoteKernelFinder(ee,D.server.label)})(),F=await this.selectRemoteKernelFromPicker(i.notebook,T,t).catch(ee=>x("Failed to select a kernel",ee));if(F&&F===Ae.back){if(D===b)throw Ae.back;return this.getRemoteServersFromProvider(e,t,n,i)}if(!F||F instanceof Ae)throw new Ln.CancellationError;i.selection={type:"connection",connection:F};return}case"uriProviderQuickPick":{let T=Ln.notebooks.createNotebookControllerDetectionTask(It);try{w&&(w.busy=!0);let F=await this.selectRemoteServerFromRemoteKernelFinder(D,i,t);return w&&(w.busy=!1),F}catch(F){if(F===Ae.back&&!b)return this.getRemoteServersFromProvider(e,t,n,i);throw F}finally{T.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,n){if(!e.provider.commandProvider?.handleCommand||n.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,n));if(!i)throw Ae.back;if(n.isCancellationRequested)throw new Ln.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===Va.toLowerCase()&&await ar(n,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,n).catch(a=>x("Failed to select a kernel",a));if(s&&s===Ae.back)throw Ae.back;if(!s||s instanceof Ae)throw new Ln.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,n){let i,o=u=>{let p=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${p.label}`,description:p.description,detail:p.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),c=new Vp(t,o,s,{supportsBack:!0},a),l=new gd(this.jupyterConnection);return t.then(u=>l.findPreferredRemoteKernelConnection(e,u,n)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(c.recommended=u),c.selected=u}).catch(u=>x("Failed to determine preferred remote kernel",u)),c.selectItem(n)}};eb=g([(0,il.injectable)(),d(0,(0,il.inject)(Tr)),d(1,(0,il.inject)(Zt)),d(2,(0,il.inject)(pa)),d(3,(0,il.inject)(In)),d(4,(0,il.inject)(lp)),d(5,(0,il.inject)(Zx)),d(6,(0,il.inject)(Gt))],eb);function U4(r,e){r.addSingleton(St,qy),r.addBinding(St,Ie),r.addSingleton(lp,By),r.addSingleton(sP,eb),r.addSingleton(aP,Yy),r.addSingleton(fm,Zy),r.addBinding(fm,Ie),r.addSingleton(Ie,Qy),O4(r,e)}var bC=k(M()),xf=require("vscode");var Na=Symbol("IJupyterDebugService"),yd=Symbol("INotebookDebuggingManager");var AT=Symbol("IDebugLocationTrackerFactory"),NT=Symbol("IDebugLocationTracker");var tb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(xf.commands.registerCommand(J.RunByLine,this.runByLine,this)),this.disposables.push(xf.commands.registerCommand(J.RunByLineNext,this.runByLineNext,this)),this.disposables.push(xf.commands.registerCommand(J.RunByLineStop,this.runByLineStop,this)),this.disposables.push(xf.commands.registerCommand(J.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){A("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){A("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=xf.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};tb=g([(0,bC.injectable)(),d(0,(0,bC.inject)(yd)),d(1,(0,bC.inject)(K))],tb);var Iu=k(M());var rb=class{constructor(e,t,n){this.debugService=e;this.disposables=t;this.debugVariables=n}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(xe,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(_S,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(TS,this))}createDebugAdapterTracker(e){return this.debugVariables}};rb=g([(0,Iu.injectable)(),d(0,(0,Iu.inject)(Na)),d(0,(0,Iu.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Iu.inject)(K)),d(2,(0,Iu.inject)(Rn)),d(2,(0,Iu.named)(Ge.DEBUGGER_VARIABLES))],rb);var Ma=k(M());var IC=require("vscode");var DF=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function OT(r){return{name:r.evaluateName??r.name,type:r.type,count:0,shape:"",size:0,supportsDataExplorer:DF.has(r.type||""),value:r.value,truncated:!0,frameId:r.variablesReference}}var _F=require("vscode"),nb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new _F.EventEmitter;this.sessionEndedEmitter=new _F.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var lve=new Set(["In","Out","exit","quit"]),KT=100,ib=class extends nb{constructor(t,n,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=n;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new IC.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,n){n&&this.watchKernel(n);let i=n&&this.kernelProvider.getKernelExecution(n),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,p)=>{let m=u[s]?u[s]:"",h=p[s]?p[s]:"";return t.sortAscending?m.localeCompare(h,void 0,{sensitivity:"base"}):h.localeCompare(m,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let c=t.startIndex?t.startIndex:0,l=t.pageSize?t.pageSize:KT;o.pageStartIndex=c;for(let u=c;u<c+l&&u<this.lastKnownVariables.length;u+=1){let p=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=p,o.pageResponse.push(p)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,n){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&n?.resourceUri&&$u(n?.resourceUri).toLowerCase()===".ipynb"&&A("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getDataFrameInfo(t,n,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),n&&this.watchKernel(n);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:c,code:l}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:l,cleanupCode:a,initializeCode:c,frameId:t.frameId}),p=n?.notebook,m=p?De(p.uri.path):"";return!m&&this.debugLocation?.fileName&&(m=De(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:KT,fileName:m}:t}async getDataFrameRows(t,n,i,o,s){if(i-n>KT)throw new Error(`Debugger cannot provide more than ${KT} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:c,initializeCode:l,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:n,endIndex:i}),p=await this.evaluate({code:u,cleanupCode:c,initializeCode:l,frameId:t.frameId});return vF(JSON.parse(p.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(f);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let n=this.debugService.activeDebugSession?.id;n&&this.importedGetVariableInfoScriptsIntoKernel.delete(n)}}watchKernel(t){let n=t.notebook?.uri.toString();if(n&&!this.watchedNotebooks.has(n)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,n))),i.push(t.onDisposed(()=>{this.resetImport(n),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(n)})),this.watchedNotebooks.set(n,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:n,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};E(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;x(`Cannot evaluate ${t}`);return}finally{n&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:n})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:n,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:n,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(n=>{n.type&&DF.has(n.type)&&(n.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,n){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=n.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||lve.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>OT(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=IC.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let n=IC.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(n){let o=this.debuggingManager.getDebugSession(n);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],c=this.debuggingManager.getDebugMode(n),l;if(c===0){let u=this.debuggingManager.getDebugCell(n);a.source&&u&&a.source.path===u.document.uri.toString()&&(l=await o.customRequest("scopes",{frameId:a.id}))}else{let u=De(n.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(l=await o.customRequest("scopes",{frameId:a.id}))}l&&(l.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(f,f)}),this.refreshEventEmitter.fire())}}}}};ib=g([(0,Ma.injectable)(),d(0,(0,Ma.inject)(Na)),d(0,(0,Ma.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(1,(0,Ma.inject)(yd)),d(2,(0,Ma.inject)(ae)),d(3,(0,Ma.inject)(Lh)),d(4,(0,Ma.inject)(Uh)),d(5,(0,Ma.inject)(Fe))],ib);var Su=k(M()),bd=require("vscode");var j4=require("vscode"),ir=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await j4.commands.executeCommand("setContext",this.name,this.lastValue))}};var $4=require("vscode");var SC=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(SC||{});async function W4(r){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,n=await r.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of n){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let c=a[1];return Number(c)>=6?1:2}}return 0}function xC(r){let e=r;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function V4(r){if(xC(r),r.__mode!==2)throw new Error("Invalid launch configuration")}function FT(r,e){switch(r.type){case"event":let t=r;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let n=r;switch(n.command){case"setBreakpoints":let o=n.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(l=>{e(l,{...o.source})});let c={source:o.source,line:a};e(c),o.source=c.source}break;case"breakpointLocations":e(n.arguments);break;case"source":e(n.arguments);break;case"gotoTargets":e(n.arguments);break;default:break}break;case"response":let i=r;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function B4(r){return/~\d+\\/.test(r)}function q4(r,e){return new RegExp(r.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function Cf(r,e){let t=`import debugpy
debugpy.debug_this_thread()`;await r.executeHidden(t),await e.dumpAllCells()}function J4(r){return!!r.header&&r.header.msg_type==="debug_event"}function CC(r){return r.includes("Frame skipped from debugging during step-in")}function TF(r){return r.event==="debugpyAttach"}var LT=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return TF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&CC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await Cf(this.execution,this.debugAdapter),$4.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f))}};var wC=class{constructor(e,t,n,i){this.mode=e;this.debugAdapter=t;this.debugCell=n;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(yd)}trace(e,t){E(`[Debug-Restart] ${e}: ${t}`)}error(e,t){x(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var EC=require("vscode");var UT=class{constructor(e,t,n,i){this.debugAdapter=e;this.debugCell=t;this.execution=n;this.settings=i;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){E("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(f,f)}stop(){re("RunbylineController::stop()"),this.execution.executeHidden("pass").then(f,f),this.debugAdapter.disconnect().then(f,f)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&CC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){re(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(f,f),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let n=t.stackFrames[0],i=new EC.Position(n.line,n.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!n.source&&n.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){E(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await Cf(this.execution,this.debugAdapter);let e=Ke(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(pm(e,()=>void 0,(n,i)=>{n.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let n={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:De(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[n],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&EC.commands.executeCommand(J.OpenVariableView).then(f,f)}EC.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(f,f)}};var ob=class{constructor(e,t,n){this.document=e;this.config=t;this.session=n}};var Un=require("vscode");var sb=class{constructor(e,t,n){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=n;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new Un.EventEmitter}activate(){this.disposables.push(Un.debug.onDidTerminateDebugSession(this.endSession.bind(this)),Un.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await Un.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){re(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await Un.debug.startDebugging(void 0,e,t)}catch(n){x(`Can't start debugging (${n})`),Un.window.showErrorMessage(y.cantStartDebugging).then(f,f)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){H(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,n]of this.notebookToDebugger.entries())if(n&&e.id===n.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,n]of this.notebookToDebugger.entries())if(e===t)return n}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),n=this.kernelProvider.get(e);return t&&(!n||n&&n.status==="unknown")&&(n=await Vs.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Yt(!1),this.disposables,"jupyterExtension")),n}findEditorForCell(e){let t=e.notebook.uri.toString();return Un.window.visibleNotebookEditors.find(n=>n.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let n=this.findEditorForCell(e);if(!n)return Un.window.showErrorMessage(y.noNotebookToDebug).then(f,f),0;let i=await this.checkForIpykernel6(n.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(f,f);break}case 4:if(t)return await Un.commands.executeCommand("notebook.selectKernel",{notebookEditor:n}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let o=this.controllerRegistration.getSelected(e);if(!o)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:o.connection,controller:o?.controller,resourceUri:e.uri})}let n=this.kernelProvider.getKernelExecution(t),i=await W4(n);return A("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:i===1?"installed":"notInstalled"}),i}catch(t){x("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await Un.window.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(A("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),Un.env.openExternal(Un.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):A("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var eo=require("vscode");var jT=class{constructor(e){this.debugAdapter=e}trace(e,t){E(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(n=>this.debugAdapter.continueDirect(n)))}};var ab=class{constructor(e,t,n,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=n;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new eo.EventEmitter;this.endSession=new eo.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;re("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;xC(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new jT(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new eo.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(eo.debug.stopDebugging(this.session).then(f,f),this.disconnect().catch(f),A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(eo.notebooks.onDidChangeNotebookCellExecutionState(c=>{this.configuration.__cellIndex===c.cell.index&&c.state===eo.NotebookCellExecutionState.Idle&&!this.disconnected&&(A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(f))},this,this.disposables)),this.disposables.push(eo.workspace.onDidChangeNotebookDocument(c=>{c.contentChanges.forEach(l=>{l.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(f)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(c=>{c===this.session&&this.disconnect().catch(f)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){E(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(re(`Debug IO Pub message: ${JSON.stringify(t)}`),J4(t)){this.trace("event",JSON.stringify(t));for(let n of this.delegates??[])if(await n?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(f)}async handleClientMessageAsync(e){try{if(re(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let n=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);n&&await this.dumpCell(n.index)}}if(e.type==="request")for(let t of this.delegates??[]){let n=await t?.willSendRequest?.(e);if(n){this.trace("response",JSON.stringify(n)),this.sendMessage.fire(n);return}}await this.sendMessageToJupyterSession(e)}catch(t){x(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new fn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session)try{await Promise.all([this.deleteDumpedFiles().catch(e=>j("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){x("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===eo.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=bn(e);for(let[t,n]of this.fileToCell.entries())if(B4(t)&&q4(t,e))return n}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){H(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){FT(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else x(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(FT(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new fn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;FT(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let n=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);n&&(t.name=De(n.path),t.path=n.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let n=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await hn(this.jupyterSession.kernel,n,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var WT=class extends ab{constructor(){super(...arguments);this.cellToFile=new Map}async dumpCell(t){let n=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:n.document.getText().replace(/\r\n/g,`
`)}),o=bn(i.sourcePath);this.fileToCell.set(o,n.document.uri),this.cellToFile.set(n.document.uri.toString(),o)}catch(i){x(i)}}translateRealLocationToDebuggerLocation(t){let n=t.source;if(n&&n.path){let i=this.cellToFile.get(n.path);i&&(n.path=i)}}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};var cb=class extends sb{constructor(t,n,i,o,s,a){super(t,n,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new ir(yr.RunByLineCells),this.runByLineDocuments=new ir(yr.RunByLineDocuments),this.debugDocuments=new ir(yr.DebugDocuments)}activate(){super.activate(),this.disposables.push(bd.debug.registerDebugAdapterDescriptorFactory(_S,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],n=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),n.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(f),this.runByLineDocuments.set(n).catch(f)}updateDebugContextKey(){let t=new kc;this.notebookToDebugAdapter.forEach((n,i)=>t.add(i.uri)),this.notebookInProgress.forEach(n=>t.add(n.uri)),this.debugDocuments.set(Array.from(t.values())).catch(f)}async tryToStartDebugging(t,n,i=!1){if(H(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(n);if(o!==1){H(`Ipykernel check failed: ${SC[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,n)}runByLineNext(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&n.debugCell.document.uri.toString()===t.document.uri.toString()&&n.continue()}runByLineStop(t){let n=this.notebookToRunByLineController.get(t.notebook);n&&(A("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),n.stop())}async startDebuggingCell(t,n){let i=n.notebook,o=this.configurationService.getSettings(i.uri),s={type:_S,name:De(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:n.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let n=t.configuration;xC(n);let i=n.__notebookUri,o=bd.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){H(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){H("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){H("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new ob(o,n,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(n,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,n,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new WT(n,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new UT(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([c,new wC(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,c),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),c=new LT(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([c,new wC(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new bd.DebugAdapterInlineImplementation(s)}else bd.window.showInformationMessage(y.kernelWasNotStarted).then(f,f)}};cb=g([(0,Su.injectable)(),d(0,(0,Su.inject)(Fe)),d(1,(0,Su.inject)(St)),d(2,(0,Su.inject)(ae)),d(3,(0,Su.inject)(Cr)),d(4,(0,Su.inject)(Ti)),d(5,(0,Su.inject)(lt))],cb);var PC=k(M()),H4=require("vscode");var lb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.updatedEmitter=new H4.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new nb(e.id);return this.activeTrackers.set(e,t),t.sessionEnded(()=>this.activeTrackers.delete(e),this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};lb=g([(0,PC.injectable)(),d(0,(0,PC.inject)(Ti)),d(1,(0,PC.inject)(K))],lb);var BT=k(M()),Q4=k(require("net"));var Y4=k(Io()),wf=require("vscode");var z4=require("events"),G4=`\r
\r
`,VT=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new z4.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let n=t;typeof n.event=="string"&&this.events.emit(`${t.type}_${n.event}`,n);break}case"request":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}case"response":{let n=t;typeof n.command=="string"&&this.events.emit(`${t.type}_${n.command}`,n);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(G4);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+G4.length);continue}}break}}};var RF=class{constructor(e,t,n){this._id=e;this._configuration=t;this.customRequestHandler=n;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},ub=class{constructor(e){this.sequence=1;this.breakpointEmitter=new wf.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new wf.EventEmitter;this.sessionStartedEvent=new wf.EventEmitter;this.sessionTerminatedEvent=new wf.EventEmitter;this.sessionCustomEvent=new wf.EventEmitter;this.breakpointsChangedEvent=new wf.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new VT}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(n=>n!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,n){let i=t;return i.port?(this.session=new RF((0,Y4.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=Q4.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=ce();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let n=t,i=n.body.stackFrames?n.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=ce(),t=0;return this.protocolParser.once("response_scopes",n=>{this.sendToTrackers(n);let i=n;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(f)}),this.protocolParser.once("response_variables",n=>{this.sendToTrackers(n),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){H("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(H("Sending breakpoints"),await this.sendBreakpoints()),H("Sending debugger attach...");let n=this.sendAttach(e,t);return H("Sending configuration done"),await this.sendConfigurationDone(),H("Session started."),n.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(n=>n),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:De(t),path:t},lines:e.map(n=>n.location.range.start.line),breakpoints:e.map(n=>({line:n.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:qo,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let n=ce(),i=this.sessionTerminatedEvent.event(()=>{n.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),H(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),n.resolve(s.body))}),this.socket?.on("error",s=>n.reject(s)),this.emitMessage(e,t).catch(s=>{x(`Exception attempting to emit ${e} to debugger: `,s)}),n.promise}emitMessage(e,t){return new Promise((n,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);H(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,c=>{this.sendToTrackers(o),n()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),H(JSON.stringify(e))}onError(e){this.sendToTrackers(e),H(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(f),this.socket.destroy(),this.socket=void 0)}};ub=g([(0,BT.injectable)(),d(0,(0,BT.inject)(K))],ub);var ol=k(M()),Ef=require("vscode");var pb=class{constructor(e,t,n){this.vscodeDebugService=t;this.jupyterDebugService=n;this.sessionChangedEvent=new Ef.EventEmitter;this.sessionStartedEvent=new Ef.EventEmitter;this.sessionTerminatedEvent=new Ef.EventEmitter;this.sessionCustomEvent=new Ef.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),n&&(e.push(n.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(n.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(n.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(n.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let n=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(n,i)}return n}registerDebugAdapterTrackerFactory(e,t){let n=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(n,i)}return n}startDebugging(e,t,n){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,n)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():Ef.commands.executeCommand("workbench.action.debug.stop").then(f,f)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};pb=g([(0,ol.injectable)(),d(0,(0,ol.inject)(K)),d(1,(0,ol.inject)(Ti)),d(2,(0,ol.optional)()),d(2,(0,ol.inject)(Na)),d(2,(0,ol.named)(Ge.RUN_BY_LINE_DEBUGSERVICE))],pb);var Cu=k(M());var HT=require("vscode");var db=Symbol("IFileConverter"),Id=Symbol("IExportBase"),Pyt=Symbol("IExport"),Sd=Symbol("IExportUtil");var $T=k(M()),X4=k(require("os"));var Z4=k(Io());var mb=require("vscode");var kC=require("vscode");var uve={PDF:["pdf"]},pve={HTML:["html","htm"]},dve={Python:["py"]},Oa=class{async showDialog(e,t,n){let i={},o;switch(e){case"python":i=dve,o=".py";break;case"pdf":o=".pdf",i=uve;break;case"html":o=".html",i=pve;break;case"ipynb":o=".ipynb";let c=y.exportDialogFilter;i[c]=["ipynb"];break;default:return}let s=n||!t?n||"":`${De(t.path,Wi(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return kC.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&Br())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=_e.instance.get(IP);return kC.Uri.file(We(await i.computeWorkingDirectory(e),t))}let n=We(ut(e.path),t);return kC.Uri.parse(`${e.scheme}://${n}`).with({authority:e.authority})}};var qT=class{async getContent(e){let t=mb.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new mb.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new mb.NotebookData(i);return o.metadata=e.metadata,t.exports.exportNotebook(o)}async getTargetFile(e,t,n){return await new Oa().showDialog(e,t,n)}};var JT=require("vscode");var fb=class extends qT{constructor(t){super();this.fs=t}async getTargetFile(t,n,i){let o;return t!=="python"?o=await new Oa().showDialog(t,n,i):o=JT.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};fb=g([(0,$T.injectable)(),d(0,(0,$T.inject)(hr))],fb);var DC=class{async generateTempDir(){let e=JT.Uri.file(We(X4.tmpdir(),(0,Z4.default)())),t=_e.instance.get(hr);return await t.createDirectory(e),{path:Ee(e),dispose:async()=>{let n=0;for(;n<10;)try{await t.delete(e),n=10}catch{await ji(3e3),n+=1}}}}async makeFileInDirectory(e,t,n){let i=We(n,t);return await _e.instance.get(hr).writeFile(JT.Uri.file(i),e),i}};async function eG(r){let e=JSON.parse(r);for(let t of e.cells){let n="outputs"in t?t.outputs:void 0;n&&Array.isArray(n)&&mve(n)}return JSON.stringify(e,void 0,4)}function mve(r){let e="image/svg+xml",t="image/png";for(let n of r)if("data"in n){let i=n.data;if(!(e in i))continue;t in i&&delete i[e]}}var hb=k(M());var xu=class{constructor(e,t,n){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=n}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};xu=g([(0,hb.injectable)(),d(0,(0,hb.inject)(Yu)),d(1,(0,hb.inject)(Eh)),d(2,(0,hb.inject)(li))],xu);var Pf=class{constructor(e,t,n,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=n;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,n,i){}async executeCommand(e,t,n,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),n==="python"){let h=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,h);return}let s=await this.exportUtil.getContent(e);n==="pdf"&&(s=await eG(s));let a=await new DC().generateTempDir(),c=await this.makeSourceFile(t,s,a),l=await this.getExecutionService(c,i);if(!l||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(Wi(t.fsPath)),p=[c.fsPath,"--to",n,"--output",De(u.filePath),"--output-dir",ut(u.filePath),"--debug"],m=await l.execModule("jupyter",["nbconvert"].concat(p),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(HT.Uri.file(u.filePath))).size>1)await this.fs.copy(HT.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(m.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,n){let i=De(e.fsPath,Wi(e.fsPath)),o=await new DC().makeFileInDirectory(t,`${i}.ipynb`,n.path);return HT.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};g([dv("PerformingExport")],Pf.prototype,"executeCommand",1),Pf=g([(0,Cu.injectable)(),d(0,(0,Cu.inject)(Or)),d(1,(0,Cu.inject)(Wp)),d(2,(0,Cu.inject)(hr)),d(3,(0,Cu.inject)(Sd)),d(4,(0,Cu.inject)(pE)),d(5,(0,Cu.inject)(xu))],Pf);var kf=k(M());var wu=require("vscode");var gb=class{constructor(){this.fs=_e.instance.get(st)}async openFile(e,t,n=!1){if(e==="python")await this.openPythonFile(t,n),A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,n);A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let n;if(t)n=await wu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await wu.workspace.openTextDocument({language:xe,content:i});n=await wu.window.showTextDocument(o)}await n.edit(i=>{i.insert(new wu.Position(n.document.lineCount,0),`
`)})}async askOpenFile(e,t){let n=y.openExportFileYes,i=y.openExportFileNo,o=[n,i];return await wu.window.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===n?(t?wu.window.showTextDocument(e).then(f,f):Cp(e.toString()),!0):!1}};var XT=k(M()),ZT=require("vscode");var GT=class{async export(e,t,n,i){await _e.instance.get(Id).executeCommand(e,t,"python",n,i)}};var zT=class{async export(e,t,n,i){await _e.instance.get(Id).executeCommand(e,t,"pdf",n,i)}};var QT=class{async export(e,t,n,i){await _e.instance.get(Id).executeCommand(e,t,"html",n,i)}};var AF=require("vscode");var YT=class{constructor(){this.fs=_e.instance.get(st),this.configuration=_e.instance.get(ae),this.platform=_e.instance.get(Cr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,n){if(n.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata.custom?.metadata?.isInteractiveWindowMessageCell).reduce((t,n)=>t+this.exportCell(n),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),n=this.getEOL();switch(e.kind){case AF.NotebookCellKind.Code:return`${t}${n}${this.exportCodeCell(e)}${n}${n}`;case AF.NotebookCellKind.Markup:return`${t} [markdown]${n}${this.exportMarkdownCell(e)}${n}${n}`}}return""}exportCodeCell(e){let t=Ke(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),n=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return Ic(t,this.getEOL(),n?fve:void 0).join("")}exportMarkdownCell(e){let t=Ke(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return Ic(t,this.getEOL(),hve).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function fve(r){return/^\s*!/.test(r)||/^\s*%/.test(r)?`# ${r}`:r}function hve(r){return`# ${r}`}var vb=class{constructor(e,t,n){this.exportUtil=e;this.progressReporter=t;this.configuration=n}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let n=await ZT.workspace.openNotebookDocument(e);await this.exportImpl("python",n,void 0,t.token)}finally{t.dispose()}}async export(e,t,n,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,n,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){A("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,n,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,n);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){x("Export failed",s),A("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&x(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,n,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,n,i):await this.performNbConvertExport(t,e,n,o,i),n&&this.openExportedFile(e,n).catch(f)}async openExportedFile(e,t){await new gb().openFile(e,t,!0).catch(f)}async performPlainExport(e,t,n,i){if(n)switch(e){case"python":await new YT().export(t,n,i);break}return n}async performNbConvertExport(e,t,n,i,o){try{return await this.exportToFormat(e,n,t,i,o)}finally{}}async exportToFormat(e,t,n,i,o){switch(n){case"python":return new GT().export(e,t,i,o);case"pdf":return new zT().export(e,t,i,o);case"html":return new QT().export(e,t,i,o);default:break}}showExportFailed(e){ZT.window.showErrorMessage(`${y.failedExportMessage} ${e}`)}};vb=g([d(0,(0,XT.inject)(Sd)),d(1,(0,XT.inject)($o)),d(2,(0,XT.inject)(ae))],vb);var yb=class extends vb{constructor(t,n,i,o){super(t,i,o);this.exportUtil=t;this.fs=n}async openExportedFile(t,n){await new gb().openFile(t,n).catch(f)}};yb=g([(0,kf.injectable)(),d(0,(0,kf.inject)(Sd)),d(1,(0,kf.inject)(hr)),d(2,(0,kf.inject)($o)),d(3,(0,kf.inject)(ae))],yb);var Ib=k(M());var Df=require("vscode");var bb=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,It)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Ke(qa(Ba.UpdateCWDAndPath,Ee(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!dt(e.kernelConnectionMetadata)&&!nP(e.kernelConnectionMetadata)||!Kt(e.kernelConnectionMetadata))return;let t=await this.calculateWorkingDirectory(e.resourceUri);if(t&&await this.fs.exists(t))return t;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(t=Df.Uri.file(Oh(Ee(t),e.resourceUri,this.configService.getSettings(e.resourceUri))),t&&await this.fs.exists(t)))return t}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=hk(n.notebookFileRoot);if(i&&Df.workspace.workspaceFolders?.length){let o=Df.Uri.file(i),s=Df.workspace.workspaceFolders[0].uri;if(dh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Df.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};bb=g([(0,Ib.injectable)(),d(0,(0,Ib.inject)(ae)),d(1,(0,Ib.inject)(st)),d(2,(0,Ib.inject)(da))],bb);var TC=k(M()),_f=require("vscode");var _C=require("vscode");var NF=new WeakMap;async function qs(r,e){let t=r;if(r.isClosed)return!0;let n=NF.has(t)?NF.get(t):Promise.resolve(),i=ce(),o=n.finally(async()=>{let s=new _C.WorkspaceEdit,a=e(s);Qd(a)&&await a,await _C.workspace.applyEdit(s).then(c=>i.resolve(c),c=>i.reject(c))}).catch(f);return NF.set(t,o),i.promise}var Sb=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,n=e.controller.connection;if(!_t(t))return;let i=_f.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===_f.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===_f.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,c=n.kind;switch(n.kind){case"connectToLiveRemoteKernel":{a=n.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=n.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=xe;break}default:{x(`Unsupported kernel kind encountered ${c}`);return}}if(!a)return;let l=xs(a);qs(i.notebook,async()=>{await o.map(async u=>{if(l.toLowerCase()!==u.document.languageId)return _f.languages.setTextDocumentLanguage(u.document,l).then(f,f)})}).then(f,f)}};Sb=g([(0,TC.injectable)(),d(0,(0,TC.inject)(K)),d(1,(0,TC.inject)(St))],Sb);var Ka=k(M()),Jt=require("vscode");var xb=class{constructor(e,t,n,i,o,s,a,c){this.disposableRegistry=e;this.languageService=t;this.configurationService=n;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=c;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push(Jt.commands.registerCommand(J.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(Jt.commands.registerCommand(J.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(Jt.commands.registerCommand(J.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(Jt.commands.registerCommand(J.NotebookEditorCollapseAllCells,()=>this.collapseAll())),this.disposableRegistry.push(Jt.commands.registerCommand(J.NotebookEditorExpandAllCells,()=>this.expandAll())),this.disposableRegistry.push(Jt.commands.registerCommand(J.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(Jt.commands.registerCommand(J.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(f):this.restartKernel(e).catch(f))),this.disposableRegistry.push(Jt.commands.registerCommand(J.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(Jt.commands.registerCommand(J.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(f):this.restartKernelAndRunAllCells(e).catch(f)}))}runAllCells(){Jt.window.activeNotebookEditor&&Jt.commands.executeCommand("notebook.execute").then(f,f)}addCellBelow(){Jt.window.activeNotebookEditor&&Jt.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(f,f)}removeAllCells(){let e=Jt.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(co(e));qs(e,n=>{let i=Jt.NotebookEdit.replaceCells(new Jt.NotebookRange(0,e.cellCount),[new Jt.NotebookCellData(Jt.NotebookCellKind.Code,"",t)]);n.set(e.uri,[i])}).then(f,f)}collapseAll(){let e=Jt.window.activeNotebookEditor?.notebook;e&&qs(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!0,outputCollapsed:!0};t.set(e.uri,[Jt.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}expandAll(){let e=Jt.window.activeNotebookEditor?.notebook;e&&qs(e,t=>{e.getCells().forEach((n,i)=>{let o={...n.metadata||{},inputCollapsed:!1,outputCollapsed:!0};t.set(e.uri,[Jt.NotebookEdit.updateCellMetadata(i,o)])})}).then(f,f)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=Jt.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;E(`Command interrupted kernel for ${V(n.uri)}`);let i=this.kernelProvider.get(n);if(!i){H("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),Jt.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(f,f))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,n=Jt.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(n===void 0)return;let i=this.kernelProvider.get(n);if(i)if(E(`Restart kernel command handler for ${V(n.uri)}`),await this.shouldAskForRestart(n.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,c=await Jt.window.showInformationMessage(o,{modal:!0},s,a);c===a?(await this.disableAskForRestart(n.uri),this.wrapKernelMethod("restart",i).catch(f)):c===s&&this.wrapKernelMethod("restart",i).catch(f)}else this.wrapKernelMethod("restart",i).catch(f)}async wrapKernelMethod(e,t){let n=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(n);try{if(!a)throw new Error("No kernel associated with the notebook");await Vs.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:n,controller:a.controller},new Yt(!1),this.disposableRegistry)}catch(c){s?await sp(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCell(c,e,t.resourceUri),!1):Jt.window.showErrorMessage(c.toString()).then(f,f)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(f),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,Jt.ConfigurationTarget.Global).catch(f)}};xb=g([(0,Ka.injectable)(),d(0,(0,Ka.inject)(K)),d(1,(0,Ka.inject)(is)),d(2,(0,Ka.inject)(ae)),d(3,(0,Ka.inject)(Fe)),d(4,(0,Ka.inject)(St)),d(5,(0,Ka.inject)(Yr)),d(6,(0,Ka.inject)(fi)),d(7,(0,Ka.inject)(lt))],xb);var rG=k(M()),xd=require("vscode");var Cb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?dn(e,!0):"false",n=$i(e)==="notebook"?xd.workspace.notebookDocuments.find(o=>dn(o.uri,!0)===t):void 0,i=n&&xd.window.activeNotebookEditor?.notebook===n?xd.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(xd.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(xd.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=qr()==="Windows",n=xd.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(n)return n;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Cb=g([(0,rG.injectable)()],Cb);var e0=k(M()),Cd=require("vscode");var wb=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}get isTelemetryDisabled(){return wE()}activate(){Cd.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Cd.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Cd.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Cd.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}dispose(){Q(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!_t(e.cell.notebook)||this.isTelemetryDisabled||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!_t(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Cd.NotebookCellKind.Markup||e.document.languageId==="raw")return;let n=e.notebook.notebookType===It?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,n))}sendTelemetry(e,t,n){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),A("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:n}))}};wb=g([(0,e0.injectable)(),d(0,(0,e0.inject)(K))],wb);var t0=k(M());var gve=/(;32m[ ->]*?)(\d+)(.*)/g,Eb=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==It?t:t.map(n=>this.modifyTracebackFrameIPython(e,n))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,c,l)=>(l=l.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${c}${l}
`)),re(`Trace frame to match: ${t}`);let n=(s,a)=>{let c=s.replace(gve,(u,p,m,h)=>{let v=parseInt(m,10);return`${p}<a href='${e.document.uri.toString()}?line=${v-1}'>${v}</a>${h}`}),l=y.cellAtFormat(Ee(e.document.uri),e.index+1);return c.replace(/.*?\n/,`\x1B[1;32m${l}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return n(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?n(t,o[2]):t}};Eb=g([(0,t0.injectable)(),d(0,(0,t0.inject)(ae))],Eb);var Js=k(M()),nG=require("vscode");var Pb=class{constructor(e,t,n,i,o,s,a){this.packages=e;this.installer=t;this.pythonExtensionChecker=n;this.disposables=i;this.interpreterService=o;this.apiProvider=s;this.notebookControllerManager=a}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),Br()||this.interpreterService.onDidChangeInterpreter(this.trackPackagesOfActiveInterpreter,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables),nG.extensions.onDidChange(this.trackUponActivation,this,this.disposables),this.trackUponActivation().catch(f),this.apiProvider.onDidActivatePythonExtension(this.trackUponActivation,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await Xi(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async trackUponActivation(){this.activeInterpreterTrackedUponActivation||this.pythonExtensionChecker.isPythonExtensionActive&&(this.activeInterpreterTrackedUponActivation=!0,await this.trackPackagesOfActiveInterpreter())}async trackPackagesOfActiveInterpreter(){if(!this.pythonExtensionChecker.isPythonExtensionActive)return;let e=await this.interpreterService.getActiveInterpreter(void 0);e&&await this.packages.trackPackages(e)}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(Lu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Pb=g([(0,Js.injectable)(),d(0,(0,Js.inject)(Mp)),d(1,(0,Js.inject)(Mi)),d(1,(0,Js.optional)()),d(2,(0,Js.inject)(ze)),d(3,(0,Js.inject)(K)),d(4,(0,Js.inject)(Qe)),d(5,(0,Js.inject)(zt)),d(6,(0,Js.inject)(St))],Pb);function iG(r,e){U4(r,e),r.addSingleton(Ie,pf),r.addSingleton(Fh,xb),r.addSingleton(fi,Cb),r.addSingleton(Ie,ff),r.addSingleton(ng,Eb),r.addSingleton(Na,ub,Ge.RUN_BY_LINE_DEBUGSERVICE),r.addSingleton(cd,cd),r.addBinding(cd,Ie),r.addSingleton(Ie,Vy),r.addSingleton(Ie,Pb),r.addSingleton(Ie,Ly),r.addSingleton(is,is),r.addBinding(is,Ie),r.addSingleton(Ie,Sb),r.addSingleton(yd,cb,void 0,[Ie]),r.addSingleton(Ie,rb),r.addSingleton(Rn,ib,Ge.DEBUGGER_VARIABLES),r.addSingleton(Na,pb,Ge.MULTIPLEXING_DEBUGSERVICE),r.addSingleton(NT,lb,void 0,[AT]),r.addSingleton(Ie,tb),r.addSingleton(Ie,wb),r.addSingleton(Ie,bb),r.addSingleton(db,yb),r.addSingleton(xu,xu),r.addSingleton(Id,Pf),r.addSingleton(Sd,fb)}var Sn=k(M()),qe=require("vscode");var wd=Symbol("IDataScienceCodeLensProvider"),r0=Symbol("ICodeWatcher"),n0=Symbol("ICodeLensFactory"),Lxt=Symbol("IGeneratedCodeStore"),$s=Symbol("IGeneratedCodeStorageFactory"),kb=Symbol("ICodeGeneratorFactory");var i0=Symbol("IInteractiveWindowDebugger"),Ki=Symbol("IInteractiveWindowProvider"),o0=Symbol("IInteractiveControllerHelper"),s0=Symbol("IInteractiveWindowDebuggingManager");var a0=require("vscode");async function c0(r){let e=await a0.workspace.openNotebookDocument(r);await a0.window.showNotebookDocument(e)}var AC=require("vscode");var hi=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,Gd.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,Gd.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Ke(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Ke(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var os=require("vscode");function oG(r,e){let t=pt(r);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function sG(r,e){let t=pt(r);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function RC(r){return r.kind===os.NotebookCellKind.Markup&&r.metadata.custom?.metadata&&r.metadata.custom.metadata.isInteractiveWindowMessageCell}var l0=class{constructor(e,t){this.notebookDocument=e;this.isDeleted=!1;if(e.cellCount){let n=e.cellAt(e.cellCount);RC(n)&&(this.sysInfoCellPromise=Promise.resolve(n),this.sysInfoCellPromise=this.updateMessage(t))}this.sysInfoCellPromise===void 0&&(this.sysInfoCellPromise=this.createCell(t))}async createCell(e){let t;return await qs(this.notebookDocument,n=>{let i=new os.NotebookCellData(os.NotebookCellKind.Markup,e,sS);i.metadata={custom:{metadata:{isInteractiveWindowMessageCell:!0}}},t=this.notebookDocument.cellCount;let o=os.NotebookEdit.insertCells(t,[i]);n.set(this.notebookDocument.uri,[o])}),t=t??this.notebookDocument.cellCount-1,this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await qs(this.notebookDocument,n=>{if(t.index>=0&&!this.isDeleted&&RC(t)){n.replace(t.document.uri,new os.Range(0,0,t.document.lineCount,0),e),n.set(this.notebookDocument.uri,[os.NotebookEdit.updateCellMetadata(t.index,{custom:{metadata:{isInteractiveWindowMessageCell:!0}}})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await qs(this.notebookDocument,t=>{if(e.index>=0&&RC(e)){let n=os.NotebookEdit.deleteCells(new os.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[n]);return}})}};function yve(r,e){let t=typeof e=="boolean"?e:!1,n=typeof e=="boolean"?[]:e||[];r=r||"";let i=Array.isArray(r)?Ic(r,`
`,t?Db:void 0):r;return{cell_type:"code",execution_count:null,metadata:{},outputs:n,source:i}}function bve(r,e=!1){return r=Array.isArray(r)?r:[r],{cell_type:"markdown",metadata:{},source:e?r:JE(r)}}function Db(r){return/^#\s*!/.test(r)?/^#\s*!\s*%%?/.test(r)?r.replace(/^#\s*!\s*/,""):r.replace(/^#\s*/,""):r}function aG(r,e,t){return{data:yve(r,t),uri:e}}function cG(r,e,t=!1){return{uri:e,data:bve(r,t)}}function Ive(r,e,t,n){let i=Ke(e,{trim:!1}),o=i[0],s=new hi(r),{magicCommandsAsComments:a=!1}=r||{};if(s.isMarkdown(o)){let c=-1;return pm(i,(l,u)=>void 0,(l,u)=>{l&&l.length>0&&c===-1&&(c=n?u:-1)}),c>=0?[cG(i.slice(0,c),t),aG(i.slice(c),t,a)]:[cG(i,t)]}else return[aG(i,t,a)]}function lG(r,e){let t=new hi(e);for(let n=0;n<r.lineCount;n+=1){let i=r.lineAt(n);if(t.isCell(i.text))return!0}return!1}function NC(r,e){let t=new hi(e),n=[];for(let i=0;i<r.lineCount;i+=1){let o=r.lineAt(i);if(t.isCell(o.text)){if(n.length>0){let s=n[n.length-1];s.range=new AC.Range(s.range.start,r.lineAt(i-1).range.end)}n.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(n.length>=1){let i=r.lineAt(r.lineCount-1),o=n[n.length-1];o.range=new AC.Range(o.range.start,i.range.end)}return n}function MF(r,e){let t=NC(r,e);return Array.prototype.concat(...t.map(n=>{let i=r.getText(n.range);return Ive(e,i,r.uri,!1)}))}function uG(r,e){return r.getCells().filter(t=>!RC(t)).map(t=>{let n=Ke(t.document.getText(),{trim:!1,removeEmptyEntries:!1});t.metadata.interactiveWindowCellMarker!==void 0&&n.unshift(t.metadata.interactiveWindowCellMarker+`
`);let i=GE(t);return i.source=t.kind===AC.NotebookCellKind.Code?Ic(n,`
`,e?Db:void 0):Ic(n),{data:i,file:""}})}var MC=require("vscode");var OF=class{constructor(e,t,n){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=ce(),this.disposeCallback=t,n&&(this.timeout=setTimeout(this.dispose,n))}},u0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,n){this.incrementCount();let i=new OF(e,()=>this.decrementCount(),t),o={location:n?MC.ProgressLocation.Notification:MC.ProgressLocation.Window,title:e,cancellable:n!==void 0};return MC.window.withProgress(o,(s,a)=>(a&&n&&a.onCancellationRequested(()=>{n(),i.reject()}),i.promise())).then(f,f),i}async waitWithStatus(e,t,n,i){let o=this.set(t,n,i),s;try{s=await e()}finally{o.dispose()}return s}};var Do=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m,h){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=n;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=c;this.interactiveWindowProvider=l;this.kernelProvider=u;this.dataScienceErrorHandler=p;this.ipynbProvider=m;this.fileConverter=h;this.statusProvider=new u0,qe.workspace.isTrusted||qe.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(J.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(J.InsertCellBelow,this.insertCellBelow),this.registerCommand(J.InsertCellAbove,this.insertCellAbove),this.registerCommand(J.DeleteCells,this.deleteCells),this.registerCommand(J.SelectCell,this.selectCell),this.registerCommand(J.SelectCellContents,this.selectCellContents),this.registerCommand(J.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(J.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(J.MoveCellsUp,this.moveCellsUp),this.registerCommand(J.MoveCellsDown,this.moveCellsDown),this.registerCommand(J.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(J.ChangeCellToCode,this.changeCellToCode),this.registerCommand(J.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(J.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(J.AddCellBelow,this.addCellBelow),this.registerCommand(J.CreateNewNotebook,this.createNewNotebook),this.registerCommand(J.LatestExtension,this.openPythonExtensionPage),this.registerCommand(J.EnableDebugLogging,this.enableDebugLogging),this.registerCommand(J.ResetLoggingLevel,this.resetLoggingLevel),this.registerCommand(J.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(J.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(J.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand(J.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),qe.commands.registerCommand(J.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let n=qe.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFile(n.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let n=qe.window.activeTextEditor;if(n&&n.document.languageId===xe)return this.exportFileAndOutput(n.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand(J.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(J.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(J.InteractiveGoToCode,this.goToCodeInInteractiveWindow),qe.commands.registerCommand(J.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){qe.workspace.isTrusted&&(this.registerCommand(J.RunAllCells,this.runAllCells),this.registerCommand(J.RunCell,this.runCell),this.registerCommand(J.RunCurrentCell,this.runCurrentCell),this.registerCommand(J.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(J.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(f)}),this.registerCommand(J.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(J.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(J.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(J.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(J.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(J.DebugCell,this.debugCell),this.registerCommand(J.DebugStepOver,this.debugStepOver),this.registerCommand(J.DebugContinue,this.debugContinue),this.registerCommand(J.DebugStop,this.debugStop),this.registerCommand(J.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(J.OpenVariableView,this.openVariableView),this.registerCommand(J.OpenOutlineView,this.openOutlineView),this.registerCommand(J.RunToLine,this.runToLine),this.registerCommand(J.RunFromLine,this.runFromLine),this.registerCommand(J.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(J.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let n=qe.commands.registerCommand(e,t,this);this.disposables.push(n)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=qe.workspace.textDocuments.filter(n=>Ii(n.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(Ee(e)))}}async enableDebugLogging(){this.configService.getSettings().logging.level!=="debug"&&(await this.configService.updateSetting("logging.level","debug",void 0,qe.ConfigurationTarget.Global),qe.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(f,f))}async resetLoggingLevel(){this.configService.getSettings().logging.level!=="error"&&(await this.configService.updateSetting("logging.level","error",void 0,qe.ConfigurationTarget.Global),qe.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired).then(f,f))}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,qe.ConfigurationTarget.Global).catch(f)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,n,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new qe.Range(t,n,i,o))}async runAllCellsAbove(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,n)}}async runCellAndAllBelow(e,t,n){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,n)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=qe.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=qe.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(qe.window.activeTextEditor,Vn(e)?void 0:e)}async debugCell(e,t,n,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new qe.Range(t,n,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&qe.commands.executeCommand("workbench.action.debug.stepOver").then(f,f)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let n=this.kernelProvider.get(t.notebookDocument);n&&(E(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await n.interrupt())}qe.commands.executeCommand("workbench.action.debug.stop").then(f,f)}}async debugContinue(){this.debugService?.activeDebugSession&&qe.commands.executeCommand("workbench.action.debug.continue").then(f,f)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){qe.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(f,f),await qe.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=qe.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(n=>n.range.end.line>=e.selection.anchor.line&&n.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=qe.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){qe.env.openExternal(qe.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(f,f)}async openVariableView(){return qe.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return qe.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(n){x("listenForErrors",n),this.dataScienceErrorHandler.handleError(n).then(f,f)}return t}async exportFile(e){let t=Ee(e);if(t&&t.length>0&&this.jupyterExporter){let n=qe.window.activeTextEditor;if(n&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=MF(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Oa().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,V(e)),o&&t){let s=y.exportOpenQuestion1;await qe.window.showInformationMessage(y.exportDialogComplete(V(e)),s)===s&&await c0(o)}}}}}async exportFileAndOutput(e){let t=Ee(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let n=qe.window.activeTextEditor;if(n&&n.document&&this.fileSystem.arePathsSame(n.document.uri,e)){let i=MF(n.document,this.configuration.getSettings(n.document.uri));if(i){let o=await new Oa().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.translateToNotebook(i);await this.fileSystem.writeFile(o,JSON.stringify(s,void 0,1))}},y.exportingFormat,V(e)),await qe.workspace.openNotebookDocument(o).then(s=>qe.window.showNotebookDocument(s)),await qe.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new Yi(y.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);H(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);H(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,n,i){let o=t(n||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let n=await qe.window.showOpenDialog({openLabel:y.importDialogTitle,filters:t});n&&n.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(n[0])},y.importingFormat,V(n[0]))}async importNotebookOnFile(e){let t=Ee(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,V(e))}async scrollToCell(e,t){if(t&&e){let n=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<n.length;i+=1)if(await n[i].hasCell(t)){n[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let n=qe.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!n)return;let i=new qe.WorkspaceEdit,o=qe.NotebookEdit.deleteCells(new qe.NotebookRange(0,n.cellCount));i.set(n.uri,[o]),await qe.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=qe.Uri.parse(e.metadata.interactive.uristring),n=e.metadata.interactive.lineIndex,i=await qe.window.showTextDocument(t,{viewColumn:qe.ViewColumn.One});i&&(i.revealRange(new qe.Range(n,0,n,0)),i.selection=new qe.Selection(new qe.Position(n,0),new qe.Position(n,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),n=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await qe.env.clipboard.writeText(n)}}};g([Qr("DATASCIENCE.DEBUG_STEP_OVER")],Do.prototype,"debugStepOver",1),g([Qr("DATASCIENCE.DEBUG_STOP")],Do.prototype,"debugStop",1),g([Qr("DATASCIENCE.DEBUG_CONTINUE")],Do.prototype,"debugContinue",1),g([pr("DATASCIENCE.ADD_CELL_BELOW")],Do.prototype,"addCellBelow",1),g([Qr("DATASCIENCE.EXPORT_PYTHON_FILE")],Do.prototype,"exportFile",1),g([Qr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],Do.prototype,"exportFileAndOutput",1),g([Qr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],Do.prototype,"importNotebook",1),g([Qr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],Do.prototype,"importNotebookOnFile",1),Do=g([(0,Sn.injectable)(),d(0,(0,Sn.inject)(K)),d(1,(0,Sn.inject)(wh)),d(1,(0,Sn.optional)()),d(2,(0,Sn.inject)(Qu)),d(2,(0,Sn.optional)()),d(3,(0,Sn.inject)(st)),d(4,(0,Sn.inject)(ae)),d(5,(0,Sn.inject)(wd)),d(5,(0,Sn.optional)()),d(6,(0,Sn.inject)(Ti)),d(6,(0,Sn.optional)()),d(7,(0,Sn.inject)(ae)),d(8,(0,Sn.inject)(Ki)),d(9,(0,Sn.inject)(Fe)),d(10,(0,Sn.inject)(Yr)),d(11,(0,Sn.inject)(fi)),d(12,(0,Sn.inject)(db))],Do);var Tb=k(M());var Hs=require("vscode");var p0=class{constructor(e,t,n,i){this.configService=e;this.storage=t;this.notebook=n;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),Hs.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),Hs.notebooks.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,n,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,n,i)}extractExecutableLines(e){let t=e.interactive.originalSource,n=this.configService.getSettings(this.notebook.uri),i=new hi(n),o=bc(t);if(n.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=Db(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0)}async generateCodeImpl(e,t,n,i){let{lineIndex:o,uristring:s}=e.interactive,a=Hs.workspace.textDocuments.find(le=>le.uri.toString()===s);if(!a)return;let{stripped:c,trueStartLine:l}=this.extractStrippedLines(e),u=a.lineAt(l),p=a.lineAt(Math.min(l+c.length-1,a.lineCount-1)),m=0;for(;m<c.length&&c[m].trim().length===0;)m+=1;let h=m+l,v=a.offsetAt(new Hs.Position(o,0)),b=a.offsetAt(p.rangeIncludingLineBreak.end),w=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:D,debuggerStartLine:T}=this.addHiddenLines(n,c,l,h,w,i),F=c.join(""),ee=a.getText(new Hs.Range(new Hs.Position(o,0),p.rangeIncludingLineBreak.end)),de=(await ca(F,"SHA-1")).substring(0,12),Z=this.getRuntimeFile(de,t),ye=n?-1:0,ue={line:u?u.lineNumber+1:1,endLine:p?p.lineNumber+1:1,firstNonBlankLineIndex:h,debuggerStartLine:T,executionCount:t,startOffset:v,endOffset:b,deleted:!1,code:F,trimmedRightCode:c.map(le=>le.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:ee,runtimeLine:D,runtimeFile:Z,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:ye,hasCellMarker:w};return H(`Generated code for ${t} = ${Z} with ${c.length} lines`),this.storage.store(Hs.Uri.parse(e.interactive.uristring),ue),ue}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let n=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(n,i,t)})}}extractStrippedLines(e){let t=bc(e.interactive.originalSource),{lines:n}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let c=0;c<n.length;c+=1)if(n[c]!==t[c]){i+=c+1;break}}let o=0;for(;o<n.length&&n[o].trim().length===0;)o+=1;let s=n.length-1,a=n.length-2;for(;a>0;){let c=n[s],l=n[a];if((c.length===0||c===`
`)&&(l.length===0||l===`
`))n.splice(s,1),s-=1,a-=1;else break}!n[s].endsWith(`
`)&&n[s].length>0&&(n[s]=`${n[s]}
`);for(let c=0;c<n.length;c++)n[c]=n[c].replace(/\r\n/g,`
`);return{stripped:n,trueStartLine:i}}handleContentChange(e,t,n){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;n.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,n,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:n+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:n}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var pG=require("vscode");var _b=class{constructor(e,t,n){this.configService=e;this.storageFactory=t;this.disposables=n;this.codeGenerators=new WeakMap}activate(){pG.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let n=new p0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,n),n}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};_b=g([(0,Tb.injectable)(),d(0,(0,Tb.inject)(ae)),d(1,(0,Tb.inject)($s)),d(2,(0,Tb.inject)(K))],_b);var Rf=k(M()),al=require("vscode");function ss(r){if(r.metadata.interactive!==void 0)return r.metadata}function dG(r,e,t){let n=Ke(r,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(n),o=cV(i);return Ic(o,`
`,e.magicCommandsAsComments?Db:void 0).join("")}function Tf(r){let e=r;return e&&e.input&&Vn(e.input.uri)&&Vn(e.input.inputBoxUri)}var fG=require("vscode");var Sve=y.runCurrentCellAndAddBelow,xve=y.addCellBelowCommandTitle,Cve=y.debugCellCommandTitle,wve=y.debugCellCommandTitle,Eve=y.debugStepOverCommandTitle,Pve=y.debugContinueCommandTitle,kve=y.debugStopCommandTitle,Dve=y.runCellLensCommandTitle,_ve=y.runAllCellsLensCommandTitle,Tve=y.runAllCellsAboveLensCommandTitle,mG=y.runCellAndAllBelowLensCommandTitle,Rve=y.scrollToCellTitleFormatMessage,Rb=class{constructor(e,t,n,i){this.configService=e;this.generatedCodeStorageFactory=n;this.updateEvent=new al.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;al.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),al.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),fG.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(o=>{this.notebookData.delete(o.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Be,n=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=NC(e,this.configService.getSettings(e.uri)),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(c=>!o?.cachedExecutionCounts.has(c)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){n=!0;let c=this.enumerateCommands(e.uri);E(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${c.join(", ")}`);let l=!0;o.cellRanges.forEach(u=>{c.forEach(p=>{let m=this.createCodeLens(e,u,p,l);m&&o.documentLenses.push(m)}),l=!1})}else re(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let c=this.generatedCodeStorageFactory.get({fileUri:e.uri}),l=c?c.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;l&&l.length&&o.cellRanges.forEach(u=>{let p=this.createExecutionLens(e,u.range,l);p&&o?.gotoCellLens.push(p)})}return n&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(e.cell.notebook.notebookType!==Et||e.state!==al.NotebookCellExecutionState.Idle||!e.cell.executionSummary?.executionOrder)return;let t=ss(e.cell),n=this.notebookData.get(e.cell.notebook.uri.toString());n||(n={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),n)),n!==void 0&&t!==void 0&&(n.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),n.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,n=this.configService.getSettings(e).codeLenses;n?t=n.split(",").map(s=>s.trim()):t=Fu.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(Fu.DefaultDebuggingLenses);let o=[];return al.workspace.isTrusted||(o=[...Fu.DebuggerCommands,...Fu.DebuggerCommands,J.RunAllCells,J.RunAllCellsAbove,J.RunAllCellsAbovePalette,J.RunCellAndAllBelowPalette,J.RunCurrentCell,J.RunCurrentCellAdvance,J.RunCurrentCellAndAddBelow,J.RunFileInInteractiveWindows,J.InterruptKernel,J.RunToLine,J.RunCell,J.DebugCell,J.DebugContinue,J.DebugStepOver,J.DebugStop,J.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,n,i){let{range:o,cell_type:s}=t;switch(n){case J.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,J.RunCurrentCellAndAddBelow,Sve);case J.AddCellBelow:return this.generateCodeLens(o,J.AddCellBelow,xve,[e.uri,o.start.line]);case J.DebugCurrentCellPalette:return this.generateCodeLens(o,J.DebugCurrentCellPalette,Cve);case J.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,J.DebugCell,wve,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStepOver,Eve,[e.uri]);case J.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,J.DebugContinue,Pve,[e.uri]);case J.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStop,kve,[e.uri]);case J.RunCurrentCell:case J.RunCell:return this.generateCodeLens(o,J.RunCell,Dve,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.RunAllCells:return this.generateCodeLens(o,J.RunAllCells,_ve,[e.uri,o.start.line,o.start.character]);case J.RunAllCellsAbovePalette:case J.RunAllCellsAbove:return i?this.generateCodeLens(o,J.RunCellAndAllBelow,mG,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,J.RunAllCellsAbove,Tve,[e.uri,o.start.line,o.start.character]);case J.RunCellAndAllBelowPalette:case J.RunCellAndAllBelow:return this.generateCodeLens(o,J.RunCellAndAllBelow,mG,[e.uri,o.start.line,o.start.character]);default:j(`Invalid command for code lens ${n}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(n=>n.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,n){if(n){let i=n.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,J.ScrollToCell,Rve(s),[e.uri,o.id])}}}generateCodeLens(e,t,n,i){return new al.CodeLens(e,Ave(t,n,i))}};Rb=g([(0,Rf.injectable)(),d(0,(0,Rf.inject)(ae)),d(1,(0,Rf.inject)(K)),d(2,(0,Rf.inject)($s)),d(3,(0,Rf.inject)(Fe))],Rb);function Ave(r,e,t){return{arguments:t,title:e,command:r}}var cl=k(M()),Fa=k(require("vscode"));var Ab=class{constructor(e,t,n,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=n;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new Fa.EventEmitter;i.push(this),i.push(Fa.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=Q(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(Fa.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&A("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),Q(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[wl,gw].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(n=>n.uri&&n.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Be,n=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,new ir(yr.HasCodeCells).set(n&&n.length>0).catch(f),this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,n):[]}adjustDebuggingLenses(e,t){let n=Fu.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?Fa.Uri.parse(i.fileName):void 0}catch{}if(i&&(Ii(Fa.Uri.file(i.fileName),e.uri,!0)||o&&Ii(o,e.uri,!0)))return t.filter(a=>{let c=new Fa.Position(i.lineNumber-1,i.column-1);return a.range.contains(c)}).filter(a=>a.command?n.includes(a.command.command):!1);re(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!n.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(E(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let n=Fa.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(n&&n.length>0)return E(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(n[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(r0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};Ab=g([(0,cl.injectable)(),d(0,(0,cl.inject)(lt)),d(1,(0,cl.inject)(NT)),d(1,(0,cl.optional)()),d(2,(0,cl.inject)(ae)),d(3,(0,cl.inject)(K)),d(4,(0,cl.inject)(Ti))],Ab);var Ed=k(M()),Se=require("vscode");var Af=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function Nve(r,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return r<0&&(r+=e),r<0?0:r>=e?e-1:r}var tr=class{constructor(e,t,n,i,o){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=n;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new Se.EventEmitter}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.updateRequiredDisposable=this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this)),this.closeDocumentDisposable=Se.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&A("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),this.codeLensUpdatedEvent.dispose(),this.closeDocumentDisposable?.dispose(),this.updateRequiredDisposable?.dispose()}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),n=this.codeLenses.filter(s=>s.command&&s.command.command===J.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=n.length,o=Promise.resolve(!0);for(let s of n){let a=new Se.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===n.length&&(a=new Se.Range(new Se.Position(0,0),a.end));let c=this.document.getText(a);i-=1,o=this.addCode(t,c,this.document.uri,a.start.line,e)}}if(await o,n.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===J.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let c of i)if(o>0&&this.document){let l=new Se.Range(c.range.start,c.range.end);o===s&&(l=new Se.Range(new Se.Position(0,0),l.end)),o-=1;let u=this.document.getText(l);a=this.addCode(n,u,this.document.uri,c.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let n=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(c=>c.command&&c.command.command===J.RunCell),o=i.findIndex(c=>c.range.start.line>=e&&c.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let c=o;c>=0&&c<i.length;c+=1)if(s>0&&this.document){let l=i[c];s-=1;let u=this.document.getText(l.range);a=this.addCode(n,u,this.document.uri,l.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&Ii(e.document.uri,this.document.uri)){let n=await this.getActiveInteractiveWindow(),i;if(t===void 0||Vn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;let s=this.configService.getSettings(e.document.uri).normalizeSelectionForInteractiveWindow??!0?await this.executionHelper.normalizeLines(i):i;if(!s||s.trim().length===0)return;await this.addCode(n,s,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(e-1),i=this.document.getText(new Se.Range(0,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),n=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new Se.Range(e,0,n.range.end.line,n.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let t=e.contains(Se.window.activeTextEditor.selection.start)&&this.configService.getSettings(Se.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document))return this.runMatchingCell(Se.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=Se.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!Se.window.activeTextEditor||!Se.window.activeTextEditor.document)return;let e=Se.window.activeTextEditor,t=new hi(this.configService.getSettings(e.document.uri)),n=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let c=e.selection.end.line+1;c<e.document.lineCount;c+=1)if(t.isCell(e.document.lineAt(c).text)){a=!1,n=c,s.insert(new Se.Position(c,0),`${i}

`);break}a&&(n=e.document.lineCount,s.insert(new Se.Position(e.document.lineCount,0),`
${i}
`))}).then(f,f);let o=new Se.Position(n+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new Se.Range(o,o)))}insertCellBelowPosition(){let e=Se.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let n=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,c=0;n.range.start.line>0&&(o=n.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,c=i.range.end.character);let l=new Se.Range(new Se.Position(o,s),new Se.Position(a,c));e.edit(u=>{u.replace(l,""),this.codeLensUpdatedEvent.fire()}).then(f,f)}selectCell(){let e=Se.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let n=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new Se.Selection(n.range.start,i.range.end):e.selection=new Se.Selection(i.range.end,n.range.start)}}}selectCellContents(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let n=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let c=n;c<=i;c+=1){let l=s[c],u=l.range.start.line+1,p=0,m=l.range.end.line,h=l.range.end.character;l.range.start.line===l.range.end.line&&(u=l.range.start.line,p=e.document.lineAt(u).range.end.character,m=u,h=p),o?a.push(new Se.Selection(u,p,m,h)):a.push(new Se.Selection(m,h,u,p))}e.selections=a}extendSelectionByCellAbove(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?s<a?u=new Se.Selection(c.range.start,o[a-1].range.end):u=new Se.Selection(c.range.end,c.range.start):u=new Se.Selection(l.range.end,c.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new Se.Selection(c.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getStartEndCellIndex(e.selection);if(!n)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=n[0],a=n[1],c=o[s],l=o[a];if(!c.range.start.isEqual(t.start)||!l.range.end.isEqual(t.end)){let u;i?u=new Se.Selection(c.range.start,l.range.end):s<a?u=new Se.Selection(o[s+1].range.start,l.range.end):u=new Se.Selection(l.range.start,l.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new Se.Selection(c.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new Se.Selection(l.range.end,u.range.start)),u&&e.revealRange(u.range,Se.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,n)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);n&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=Se.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,n=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);n&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=Se.window.activeTextEditor,n=this.getStartEndCellIndex(t?.selection);if(!t||!n)return;let i=this.cells,o=n[0],s=n[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,n){if(n==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===n)return;let i=new hi(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),c=n==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!c)return;let l=c[c.length-1],u=n==="markdown"?`${a} [markdown]${l}`:`${a}${l}`;e.edit(async p=>{p.replace(o.range,u),t.cell_type=n,t.range.start.line<t.range.end.line&&(e.selection=new Se.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),Se.commands.executeCommand("editor.action.removeCommentLine").then(f,f),n==="markdown"&&Se.commands.executeCommand("editor.action.addCommentLine").then(f,f))}).then(f,f)}async moveCellsDirection(e){let t=Se.window.activeTextEditor;if(!t||!t.selection)return!1;let n=this.getStartEndCellIndex(t.selection);if(!n)return!1;let i=n[0],o=n[1],s=this.cells,a=s[i],c=s[o];if(!a||!c)return!1;let l=new Se.Range(a.range.start,c.range.end),u=new Se.Range(t.selection.start.line-l.start.line,t.selection.start.character,t.selection.end.line-l.start.line,t.selection.end.character),p=t.selection.active.isBefore(t.selection.anchor),m;if(e){if(i===0)return!1;{let h=s[i-1];m=this.exchangeTextLines(t,h.range,l).then(b=>(b&&(t.selection=new Se.Selection(h.range.start.line+u.start.line,u.start.character,h.range.start.line+u.end.line,u.end.character)),b))}}else{if(o===s.length-1)return!1;{let h=s[o+1],v=this.exchangeTextLines(t,l,h.range),b=h.range.end.line-h.range.start.line,w=l.end.line-l.start.line,D=b-w;m=v.then(T=>(T&&(t.selection=new Se.Selection(h.range.start.line+D+u.start.line,u.start.character,h.range.start.line+D+u.end.line,u.end.character)),T))}}return m.then(h=>(h&&p&&(t.selection=new Se.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,n){let i=t.start.line,o=t.end.line,s=n.start.line,a=n.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let c=new Se.Range(i,0,o,e.document.lineAt(o).range.end.character),l=e.document.getText(c),u=new Se.Range(s,0,a,e.document.lineAt(a).range.end.character),p=e.document.getText(u),m="";if(o+1<s){let b=o+1,w=s-1,D=new Se.Range(b,0,w,e.document.lineAt(w).range.end.character);m=`${e.document.getText(D)}
`}let h=`${p}
${m}${l}`,v=new Se.Range(c.start,u.end);return e.edit(b=>{b.replace(v,h),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let n=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[n,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),n=t;if(e.start.line!==e.end.line&&(n=this.getCellIndex(e.end)),t===-1){if(n===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&n>=0)return[t,n]}insertCell(e,t){let n=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${n}
`:`${n}

`,o=new Se.Position(t,0),s=new Se.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(f,f),e.selection=new Se.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Ge.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&Ii(e.uri,this.document.uri)&&(this.codeLensUpdatedEvent.dispose(),this.closeDocumentDisposable?.dispose(),this.updateRequiredDisposable?.dispose())}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,n,i,o){let s=!1;try{o?s=await e.debugCode(t,n,i):s=await e.addCode(t,n,i)}catch(a){a instanceof Af||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,n){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=this.document.getText(i.range);if(t){let c=Se.window.activeTextEditor,{newCellOnRunLast:l}=this.configService.getSettings(this.document.uri),u=new hi(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):l&&c&&!u.isEmptyCell(s)&&this.insertCell(c,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,n)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,n=Nve(e,t.length);return t[n]}getCellFromPosition(e){if(!e){let t=Se.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===J.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===J.RunCell);if(t>=0)return this.codeLenses.find((n,i)=>n.command!==void 0&&n.command.command===J.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(n=>n.range.contains(e)&&n.command!==void 0&&n.command.command===J.RunCell);if(t>=1)return this.codeLenses.find((n,i)=>n.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),n=this.document.getText();await this.addCode(t,n,this.document.uri,0,e)}}advanceToRange(e){let t=Se.window.activeTextEditor,n=new Se.Selection(e.start,e.start);t&&(t.selection=n,t.revealRange(e,Se.TextEditorRevealType.Default))}};g([Qr("DATASCIENCE.DEBUG_CURRENT_CELL")],tr.prototype,"debugCurrentCell",1),g([Qr("DATASCIENCE.RUN_ALL_CELLS")],tr.prototype,"runAllCells",1),g([Qr("DATASCIENCE.RUN_FILE_INTERACTIVE")],tr.prototype,"runFileInteractive",1),g([Qr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],tr.prototype,"debugFileInteractive",1),g([Qr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],tr.prototype,"runAllCellsAbove",1),g([Qr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],tr.prototype,"runCellAndAllBelow",1),g([Qr("DATASCIENCE.RUN_SELECTION_OR_LINE")],tr.prototype,"runSelectionOrLine",1),g([Qr("DATASCIENCE.RUN_TO_LINE")],tr.prototype,"runToLine",1),g([Qr("DATASCIENCE.RUN_FROM_LINE")],tr.prototype,"runFromLine",1),g([ti("CodeWatcher::runCell",4)],tr.prototype,"runCell",1),g([Qr("DATASCIENCE.DEBUG_CURRENT_CELL")],tr.prototype,"debugCell",1),g([Qr("DATASCIENCE.RUN_CURRENT_CELL")],tr.prototype,"runCurrentCell",1),g([Qr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],tr.prototype,"runCurrentCellAndAdvance",1),g([pr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],tr.prototype,"runCurrentCellAndAddBelow",1),g([pr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],tr.prototype,"insertCellBelowPosition",1),g([pr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],tr.prototype,"insertCellBelow",1),g([pr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],tr.prototype,"insertCellAbove",1),g([pr("DATASCIENCE.RUN_DELETE_CELLS")],tr.prototype,"deleteCells",1),g([pr("DATASCIENCE.RUN_SELECT_CELL")],tr.prototype,"selectCell",1),g([pr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],tr.prototype,"selectCellContents",1),g([pr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],tr.prototype,"extendSelectionByCellAbove",1),g([pr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],tr.prototype,"extendSelectionByCellBelow",1),g([pr("DATASCIENCE.RUN_MOVE_CELLS_UP")],tr.prototype,"moveCellsUp",1),g([pr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],tr.prototype,"moveCellsDown",1),g([pr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],tr.prototype,"changeCellToMarkdown",1),g([pr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],tr.prototype,"changeCellToCode",1),g([pr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],tr.prototype,"gotoNextCell",1),g([pr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],tr.prototype,"gotoPreviousCell",1),tr=g([(0,Ed.injectable)(),d(0,(0,Ed.inject)(Ki)),d(1,(0,Ed.inject)(ae)),d(2,(0,Ed.inject)(Dk)),d(3,(0,Ed.inject)(Yr)),d(4,(0,Ed.inject)(n0))],tr);var Mb=k(M()),Yn=k(require("vscode"));var Pd=require("vscode");var Nb=class{constructor(e,t,n){this.configuration=t;this.extensionChecker=n;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(Yn.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(Yn.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(Yn.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){Yn.window.activeTextEditor&&this.triggerUpdate(Yn.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){Yn.window.activeTextEditor&&e.document===Yn.window.activeTextEditor.document&&this.triggerUpdate(Pd.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=Pd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=Pd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=Pd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=Pd.window.createTextEditorDecorationType({borderColor:new Yn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?Pd.window.visibleTextEditors:[e];for(let n of t)if(n&&n.document&&n.document.languageId===xe&&!Qh(n.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(n.document.uri);if(this.cellDecorationEnabled(i)){let o=NC(n.document,i),s=o.map(u=>u.range).filter(u=>u.contains(n.selection.anchor)),a=s.length>0?[new Yn.Range(s[0].start,s[0].start)]:[],c=i.decorateCells!=="allCells"&&s.length>0?[new Yn.Range(s[0].end,s[0].end)]:[],l=[];i.decorateCells==="allCells"&&o.forEach(u=>{let p=u.range.start;p!==s[0].start&&l.push(new Yn.Range(p,p))}),Pd.window.activeTextEditor===n?(n.setDecorations(this.currentCellTop,a),n.setDecorations(this.currentCellBottom,c),n.setDecorations(this.currentCellTopUnfocused,l),n.setDecorations(this.currentCellBottomUnfocused,[])):(n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[...l,...a]),n.setDecorations(this.currentCellBottomUnfocused,c))}else n.setDecorations(this.currentCellTop,[]),n.setDecorations(this.currentCellBottom,[]),n.setDecorations(this.currentCellTopUnfocused,[]),n.setDecorations(this.currentCellBottomUnfocused,[])}}};Nb=g([(0,Mb.injectable)(),d(0,(0,Mb.inject)(K)),d(1,(0,Mb.inject)(ae)),d(2,(0,Mb.inject)(ze))],Nb);var hG=k(M()),gG=require("vscode");var d0=class{constructor(){this.codeGeneratorsByFile=new lo}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let n=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<n.length&&!i;o+=1){let s=n[o];t.line>=s.line&&t.line<=s.endLine?(n.splice(o,1,t),i=!0):s.line>t.line&&(n.splice(o,0,t),i=!0)}i||n.push(t),this.codeGeneratorsByFile.set(e,n)}};var Ob=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new d0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=gG.workspace.notebookDocuments.find(n=>this.storages.get(n)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};Ob=g([(0,hG.injectable)()],Ob);var Eu=k(M()),kd=k(require("vscode"));var Kb=class{constructor(e,t,n,i){this.variableProvider=e;this.interactiveProvider=t;this.disposables=n;this.kernelProvider=i;this.runFiles=new Set;this.stopWatch=new Be}activate(){kd.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(e.cell.notebook.notebookType!==Et)return;let t=this.runFiles.size,n=ss(e.cell);n!==void 0&&this.runFiles.add(n.interactive.uristring),t!==this.runFiles.size&&await this.initializeHoverProvider()}catch(t){x(t)}}async provideHover(e,t,n){this.stopWatch.reset();let i=await _r(300,this.getVariableHover(e,t,n));return A("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}async initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=kd.languages.registerHoverProvider(GU,this))}async getVariableHover(e,t,n){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await mr(n,{},...s.map(l=>this.variableProvider.getVariableProperties(o,l,n))),c=Object.entries(a||{});if(c.length>0){let l=c.reduce((p,m)=>p+`${m[0]}: ${m[1]}
`,"```\n")+"```";return{contents:[new kd.MarkdownString(l)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let n=new Set;return kd.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&n.add(o)}),Array.from(n)}};Kb=g([(0,Eu.injectable)(),d(0,(0,Eu.inject)(Rn)),d(0,(0,Eu.named)(Ge.KERNEL_VARIABLES)),d(1,(0,Eu.inject)(Ki)),d(2,(0,Eu.inject)(K)),d(3,(0,Eu.inject)(Fe))],Kb);var _o=k(M()),Hr=require("vscode");var Ft=require("vscode");var vG=k(Io());var Nf=class{constructor(e,t,n,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=n;this.inputUri=o;this._onDidChangeViewState=new Ft.EventEmitter;this.closedEvent=new Ft.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(st),this.configuration=this.serviceContainer.get(ae),this.jupyterExporter=this.serviceContainer.get(wh),this.interactiveWindowDebugger=this.serviceContainer.tryGet(i0),this.errorHandler=this.serviceContainer.get(Yr),this.codeGeneratorFactory=this.serviceContainer.get(kb),this.storageFactory=this.serviceContainer.get($s),this.kernelProvider=this.serviceContainer.get(Fe),this.debuggingManager=this.serviceContainer.get(s0),this.notebookUri=Tf(i)?i.input.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Ft.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Ft.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Ft.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new hi(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Ft.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=Ft.workspace.onDidOpenNotebookDocument(t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(t),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(e){let t=this.controllerFactory.create(e,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(t.listenForControllerSelection()),t}async ensureInitialized(){if(!this.notebookDocument&&(E("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController(this.notebookDocument)),this.controller.controller?this.controller.startKernel().catch(f):(H("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;Ft.window.tabGroups.all.find(i=>{i.tabs.find(o=>{Tf(o)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Ft.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e?.group.viewColumn})}async openNotebookDocument(){return E(`Opening notebook document ${this.notebookUri}`),await Ft.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let n=this.controller?.controller,i=Ah(e);if(n&&i&&t){let o=Hi.getOrCreate(t,new vf(n));try{await o.appendOutput(i)}catch(s){j(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else H(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,n){return this.submitCode(e,t,n,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!dt(this.controller.metadata))}async debugCode(e,t,n){let i=!0,o=Ft.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Ft.workspace.textDocuments];if(i=await o.save(),i){let c=Ft.workspace.textDocuments.filter(l=>a.indexOf(l)===-1);c&&c.length>0&&(t=(c.find(u=>u.languageId==="python")||c.find(u=>!u.fileName.endsWith(".interactive"))||c[0]).uri,await Ft.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,n,!0):s}async submitCode(e,t,n,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Ke(e,{trim:!1}),s=new hi(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&pm(o,(u,p)=>void 0,(u,p)=>{u&&u.length>0&&a===-1&&(a=p)});let l=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let p=ce();this.controller.setPendingCellAdd(p.promise);let m=this.addNotebookCell(u,t,n),h=this.createExecutionPromise(m,i);return h.catch(v=>{v instanceof Af?m.then(b=>{v.cell!==b&&this.showErrorForCell(y.cellStopOnErrorMessage,b).then(f,f)}).catch(f):m.then(b=>this.errorHandler.getErrorMessageForDisplayInCell(v,"execution",this.owningResource).then(w=>this.showErrorForCell(w,b))).catch(f)}).finally(()=>{p?.resolve()}),h});return l[l.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;re("InteractiveWindow.ts.createExecutionPromise.start");let n=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await n;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&dt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),re("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let c=ss(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,c?.generatedCode?.code).then(()=>!0,()=>!1),re("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),re("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Af(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Ft.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Ft.NotebookCellKind.Code&&await Ft.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),n=t.notebook.getCells().find(i=>ss(i)?.id===e);if(n){let i=new Ft.NotebookRange(n.index,n.index+1);t.revealRange(i,Ft.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(n=>ss(n)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=Is();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,n){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===sS,a=s?JE(Ke(e)).join(""):dG(e,o,this.cellMatcher),c=this.cellMatcher.getFirstMarker(e),l=Ft.workspace.textDocuments.find(v=>v.uri.toString()===this.owner?.toString())?.languageId??xe,u=new Ft.NotebookCellData(s?Ft.NotebookCellKind.Markup:Ft.NotebookCellKind.Code,a,s?sS:l),p={uristring:t.toString(),lineIndex:n,originalSource:e},m={interactiveWindowCellMarker:c,interactive:p,id:(0,vG.default)()};u.metadata=m,await qs(i,v=>{let b=Ft.NotebookEdit.insertCells(i.cellCount,[u]);v.set(i.uri,[b])});let h=i.cellCount-1;return i.cellAt(h)}async generateCodeAndAddMetadata(e,t,n){let i=ss(e);if(!i)return;let o=!dt(n.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},c=new Ft.WorkspaceEdit,l=Ft.NotebookEdit.updateCellMetadata(e.index,a);c.set(e.notebook.uri,[l]),await Ft.workspace.applyEdit(c)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let{magicCommandsAsComments:e}=this.configuration.getSettings(this.owningResource),t=uG(this.notebookDocument,e);if(t){let n=await new Oa().showDialog("ipynb",this.owningResource);n&&await this.jupyterExporter?.exportToFile(t,Ee(n))}}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value;e&&await YE({},e.kernelConnectionMetadata);let n;if(this.submitters&&this.submitters.length){let i=this.submitters[this.submitters.length-1];n=De(i.path,Wi(i.path))}Br()?Ft.commands.executeCommand(J.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(f,f):Ft.commands.executeCommand(J.Export,this.notebookDocument,n,e?.kernelConnectionMetadata.interpreter).then(f,f)}};g([kR()],Nf.prototype,"showErrorForCell",1),g([kR()],Nf.prototype,"createExecutionPromise",1);function yG(r){return y.interactiveWindowTitleFormat(De(r.path))}var KF=class{constructor(e,t,n,i,o,s,a){this.controllerService=e;this.mode=t;this.notebook=n;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.notebook&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{E("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{x("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=ce();e.promise.catch(f),this.kernel=e;try{let{kernel:t,actualController:n}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.notebook,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=n,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){re("Unable to run initialization for IW");return}let n=Ee(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(E(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${n.replace(/\\/g,"\\\\")}'`)):E(`Not Initializing __file__ in setFileInKernel with ${n} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.notebook&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.notebook,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.notebook||e.notebook.uri.toString()!==this.notebook?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(f):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(f)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>j(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new l0(this.notebook,e)}setInfoMessage(e,t){let n=oG(e,t);this.setInfoMessageCell(n)}finishSysInfoMessage(e,t){let n=sG(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(n).catch(i=>j(`System info message was not updated: "${n}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(n=>j(`System info message was not updated: "${t}" because of error: ${n}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(f,f),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},OC=class{constructor(e,t,n){this.controllerService=e;this.mode=t;this.initialController=n}create(e,t,n,i){let o=this.initialController,s=this.controllerService.getSelectedController(e);return s&&(o=s),new KF(this.controllerService,this.mode,e,t,n,i,o)}};var bG="ds_asked_per_file_interactive",IG="ds_interactive_window_cache",Fb=class{constructor(e,t,n,i,o,s,a,c){this.serviceContainer=e;this.disposables=t;this.fs=n;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=c;this._onDidChangeActiveInteractiveWindow=new Hr.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Hr.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Hr.window.tabGroups.all.forEach(t=>{t.tabs.forEach(n=>{Tf(n)&&n.input.uri&&e.set(n.input.uri.toString(),n)})}),this.workspaceMemento.get(IG,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let n=e.get(t.uriString);if(!n)return;let i=this.configService.getSettings(n.input.uri).interactiveWindowMode,o=new Nf(this.serviceContainer,Hr.Uri.parse(t.owner),new OC(this.controllerHelper,i),n,Hr.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset(),this._windows.push(o),A("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Hr.workspace.isTrusted)throw new Error("Workspace not trusted");let n=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(f);let i=this.getExisting(e,n,t);return i||(i=await this.create(e,n,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,n){let i=ce();this.pendingCreations=i.promise;try{let o=await this.controllerHelper.getInitialController(e,n);H(`Starting interactive window for resource '${V(e)}' with controller '${o?.id}'`);let[s,a]=await this.createEditor(o,e,t);o&&o.controller.updateNotebookAffinity(a.notebook,Hr.NotebookControllerAffinity.Preferred),E(`Interactive Window Editor Created: ${a.notebook.uri.toString()} with input box: ${s.toString()}`);let c=new Nf(this.serviceContainer,e,new OC(this.controllerHelper,t,o),a,s);this._windows.push(c),A("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!o,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=c;let l=c.closed(this.onInteractiveWindowClosed.bind(this,c));return this.disposables.push(c),this.disposables.push(l),this.disposables.push(c.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),c}finally{i.resolve()}}async createEditor(e,t,n){let i=e?`${Pt}/${e.id}`:void 0,o=t!==void 0,s=this.getInteractiveViewColumn(t),{inputUri:a,notebookEditor:c}=await Hr.commands.executeCommand("interactive.open",{viewColumn:s,preserveFocus:o},void 0,i,t&&n==="perFile"?yG(t):void 0);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[a,c]}getInteractiveViewColumn(e){if(e)return Hr.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Hr.ViewColumn.One:t==="active"?Hr.ViewColumn.Active:Hr.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(bG)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(bG,!0).then(f,f);let n=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await Hr.window.showInformationMessage(y.interactiveWindowModeBannerTitle,...n)===n[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Hr.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(IG,e).then(f,f)}getExisting(e,t,n){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!n?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!n||i.kernelConnectionMetadata?.id===n.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){E(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Hr.window.activeTextEditor===void 0)return;let e=Hr.window.activeTextEditor.document.uri;if(e.scheme!==wl)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let n=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,n)?.notebookDocument}return t?Hr.window.visibleNotebookEditors.find(n=>n.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(n=>n.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(n=>this.fs.arePathsSame(e,n)))}};Fb=g([(0,_o.injectable)(),d(0,(0,_o.inject)(lt)),d(1,(0,_o.inject)(K)),d(2,(0,_o.inject)(st)),d(3,(0,_o.inject)(ae)),d(4,(0,_o.inject)($e)),d(4,(0,_o.named)(yt)),d(5,(0,_o.inject)($e)),d(5,(0,_o.named)(ri)),d(6,(0,_o.inject)(fi)),d(7,(0,_o.inject)(o0))],Fb);var Dd=k(M());var Lb=class{constructor(e,t,n,i,o){this.kernelProvider=e;this.codeGeneratorFactory=n;this.storageFactory=i;this.controllers=o;this.disposables=[];t.push(this)}dispose(){Q(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||t.notebookType!==Et||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};Lb=g([(0,Dd.injectable)(),d(0,(0,Dd.inject)(Fe)),d(1,(0,Dd.inject)(K)),d(2,(0,Dd.inject)(kb)),d(3,(0,Dd.inject)($s)),d(4,(0,Dd.inject)(St))],Lb);var jb=k(M()),rz=require("vscode");var tz=ez(),f0=/(;32m[ ->]*?)(\d+)(.*)/g,Ub=class{constructor(e,t,n){this.storageFactory=e;this.platformService=t;this.configurationService=n}format(e,t){if(e.notebook.notebookType!==Et)return t;let n=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!n)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,n?.all,s):s?this.modifyTracebackFrameIPython7(a,n.all):a)}modifyTracebackFrameIPython8(e,t,n){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,p,m,h)=>(h=h.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${p}${m}${h}
`)),re(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,c=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),l=s.exec(e);if(c&&c.groups?.executionCount&&c.groups?.lineNumber?(i=parseInt(c.groups.executionCount),o=c.groups?.lineNumber):l&&l.groups?.executionCount&&l.groups?.lineNumber&&(i=parseInt(l.groups.executionCount),o=l.groups.lineNumber),t&&i){let u,p;for(let m of t)if(p=m.generatedCodes.find(h=>h.executionCount===i),p){u=m.uri;break}if(p&&u){let m=e;return n&&(m=m.replace(f0,(h,v,b,w)=>{let D=parseInt(b,10),ee=(p.hasCellMarker?p.line-1:p.line)-1+p.lineOffsetRelativeToIndexOfFirstLineInCell+D;return`${v}<a href='${u?.toString()}?line=${ee-1}'>${ee}</a>${w}`})),m.replace(/.*?\n/,`File \x1B[1;32m${Ee(u)}:${o}\x1B[0m
`)}}if(n){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let p=mh(u[1],Ee(this.platformService.homeDir)),m=rz.Uri.file(p);return e.replace(f0,(h,v,b,w)=>{let D=parseInt(b,10);return`${v}<a href='${m?.toString()}?line=${D-1}'>${D}</a>${w}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Ee(i),s=V(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${tz(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${tz(s)}`).test(e)){let c="",l=/(;32m[ ->]*?)(\d+)(.*)/g;for(let p=l.exec(e);p&&p.length>3;p=l.exec(e)){let m=Yc(p[3]).substr(1);c=`${c}${m}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),c);u!==void 0&&(e=e.replace(f0,(p,m,h,v)=>{let b=parseInt(h,10),w=u+b-1;return`${m}<a href='${i.toString()}?line=${w}'>${w+1}</a>${v}`}))}if(e.includes(o)){let c=this.findCellOffset(a.getFileGeneratedCode(i),e);if(c)return e.replace(f0,(l,u,p,m)=>{let h=parseInt(p,10),v=c+h-1;return`${u}<a href='${i.toString()}?line=${v}'>${v+1}</a>${m}`})}}}),e}findCellOffset(e,t){if(e){for(let n of e)if(n.trimmedRightCode.indexOf(t)>=0)return n.firstNonBlankLineIndex}}};Ub=g([(0,jb.injectable)(),d(0,(0,jb.inject)($s)),d(1,(0,jb.inject)(Cr)),d(2,(0,jb.inject)(ae))],Ub);var Pu=k(M());var FC=class extends Pn{constructor(e,t,n){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,n)}};function h0(r){let e={source:{path:Ee(r.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=r.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var Wb=class{constructor(e,t,n,i){this.apiProvider=e;this.configService=t;this.debugService=n;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),n=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:n})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(H("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(re("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",h0(t))})))}enable(e){e.session?.kernel&&hn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}disable(e){e.session?.kernel&&hn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(f)}async startDebugSession(e,t,n){if(H("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,n);if(i&&(H("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await hn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?j(`${this.debuggerPackage} not found in path.`):H(`import startup: ${u_(o)}`),await this.disable(t)}}async connect(e,t){let n=e.notebook,i=n,o=this.configs.get(i);if(o)return{...o,...t};H("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(n,o);let c=[],l=()=>{this.configs.delete(i),c.forEach(u=>u.dispose())};c.push(e.onDisposed(l)),c.push(e.onRestarted(l))}return o}async calculateDebuggerPathList(e){let t=[],n=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(n&&(this.platform.isWindows&&(n=n.replace(/\\/g,"\\\\")),t.push(n)),dt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let n=e.session?.kernel?await hn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];H(`Appending paths: ${u_(n)}`)}}async connectToLocal(e){let t=e.session?.kernel?await hn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0){let n=u_(t);if(n){n=Yd(n);let o=/\('(.*?)', ([0-9]*)\)/.exec(n);if(o)return{port:parseInt(o[2],10),host:o[1]}}}if(t.length>0&&t[0].output_type==="error"){let n=t[0];throw new FC(this.debuggerPackage,n.ename,e.kernelConnectionMetadata)}throw new FC(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};Wb=g([(0,Pu.injectable)(),d(0,(0,Pu.inject)(zt)),d(1,(0,Pu.inject)(ae)),d(2,(0,Pu.inject)(Na)),d(2,(0,Pu.named)(Ge.MULTIPLEXING_DEBUGSERVICE)),d(3,(0,Pu.inject)(Cr))],Wb);var ll=k(M()),_d=require("vscode");var g0=class{constructor(e,t,n){this.debugAdapter=e;this.debugCell=t;this.execution=n;this._ready=ce();this.ready=this._ready.promise;A("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){E(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return TF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&CC(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=ss(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=Cf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=Cf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var v0=class extends ob{constructor(){super(...arguments);this._ready=ce();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var FF=require("vscode");var y0=class extends ab{constructor(t,n,i,o,s,a,c){super(t,n,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];c&&(this.debugLocationTracker=c.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(l=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(l)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return re(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let n=this.notebookDocument.cellAt(t),i=ss(n);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||n.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=bn(s.sourcePath);this.fileToCell.set(a,FF.Uri.parse(i.interactive.uristring));let c=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(c=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:FF.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:c+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((l,u)=>u.metadata.interactive.lineIndex-l.metadata.interactive.lineIndex)}catch(o){x(`Failed to dump cell for ${n.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,n){if(n=t?.source??n,!n||!n.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===n.path);i&&(n.name=De(i.interactiveWindow.path),n.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,n){let i=t.line;if(n=t?.source??n,!n||!n.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==n.path||(n.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let n=t.arguments;if(delete n.lines,n.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let p=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(m=>u.line>=m.metadata.generatedCode.line&&u.line<=m.metadata.generatedCode.endLine);if(p&&p.metadata.interactive.lineIndex!==i)a(),i=p.metadata.interactive.lineIndex,o=[u];else if(p)o.push(u);else{let m={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[m]}}))}}a();let c=await Promise.all(s),l=JSON.parse(JSON.stringify(c[0]));return c.slice(1).forEach(u=>{l.body.breakpoints=l.body.breakpoints.concat(u.body.breakpoints??[])}),l.command="setBreakpoints",l.type="response",l.success=!0,l.request_seq=t.seq,l}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var nz=require("vscode");var b0=class{constructor(e){this.debugCell=e}trace(e,t){E(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),nz.window.showWarningMessage(y.restartNotSupported,{modal:!0}).then(f,f),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var Vb=class extends sb{constructor(t,n,i,o,s,a,c){super(t,n,c);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(_d.debug.registerDebugAdapterDescriptorFactory(TS,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,n){re("Starting debugging IW"),await this.checkIpykernelAndPrompt(n)===1&&await this.startDebuggingCell(t,n)}async startDebuggingCell(t,n){let i=this.configService.getSettings(t.uri),o={type:TS,name:De(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:n.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){x("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let n=t.configuration;V4(n);let i=_d.workspace.notebookDocuments.find(s=>s.uri.toString()===n.__notebookUri);if(!i||typeof n.__cellIndex!="number"){x("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){H("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){H("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new v0(i,n,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(n,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,n,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){_d.window.showInformationMessage(y.kernelWasNotStarted).then(f,f);return}let a=new y0(n,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let c=i.cellAt(t.__cellIndex),l=new g0(a,c,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([l,new b0(c)]),l.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new _d.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,n){let i=this.getDebugSession(t.notebook);i&&(re("Sending debug request for source map"),await Promise.all(n.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",h0(o))})))}};Vb=g([(0,ll.injectable)(),d(0,(0,ll.inject)(Fe)),d(1,(0,ll.inject)(St)),d(2,(0,ll.inject)(Cr)),d(3,(0,ll.inject)(AT)),d(4,(0,ll.inject)(ae)),d(5,(0,ll.inject)(Ti)),d(6,(0,ll.inject)(lt))],Vb);var LC=k(M()),UC=require("vscode");var iz="InteractiveShiftEnterBanner";var Td=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=wA.bannerMessage;this.bannerLabels=[ge.bannerLabelYes,ge.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(A("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await UC.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,UC.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,UC.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};g([Qr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],Td.prototype,"disableInteractiveShiftEnter",1),g([Qr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],Td.prototype,"enableInteractiveShiftEnter",1),Td=g([(0,LC.injectable)(),d(0,(0,LC.inject)(dc)),d(1,(0,LC.inject)(ae))],Td);var Mf=k(M()),oz=require("vscode");var Bb=class{constructor(e,t,n,i){this.configService=e;this.fs=t;this.context=n;this.registry=i;this.priority=5}activate(){this.registry.register(this,Et)}async getCode(e){if(!Kt(e.kernelConnectionMetadata))return[];if(!Br()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!dt(e.kernelConnectionMetadata))return[]}if(e.notebook?.notebookType===Et){if(!dt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(oz.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Ke(t,{trim:!1})}return[]}};Bb=g([(0,Mf.injectable)(),d(0,(0,Mf.inject)(ae)),d(1,(0,Mf.inject)(st)),d(2,(0,Mf.inject)(ct)),d(3,(0,Mf.inject)(da))],Bb);var Jb=k(M()),$b=require("vscode");var qb=class{constructor(e,t,n){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=n}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push($b.languages.registerFoldingRangeProvider([hw],this))}provideFoldingRanges(e,t,n){if([wl,gw].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return n.isCancellationRequested||o.length==0?void 0:o.map(s=>new $b.FoldingRange(s.range.start.line,s.range.end.line,$b.FoldingRangeKind.Region))}}};qb=g([(0,Jb.injectable)(),d(0,(0,Jb.inject)(wd)),d(1,(0,Jb.inject)(ct)),d(2,(0,Jb.inject)(ae))],qb);var jC=k(M());var sz=require("vscode");var Hb=class{constructor(e,t){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(sz.languages.registerCodeLensProvider([hw],this.dataScienceCodeLensProvider))}};Hb=g([(0,jC.injectable)(),d(0,(0,jC.inject)(wd)),d(1,(0,jC.inject)(ct))],Hb);var Gs=k(M());var LF="LastInteractiveKernelSelected",Gb=class{constructor(e,t,n,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=n;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t){if(t){let n=this.controllerRegistration.get(t,Et);if(n)return n}if(this.workspaceMemento.get(LF)){let n=this.workspaceMemento.get(LF),i=n?this.controllerRegistration.get(n,Et):void 0;if(i)return i}if(this.interpreterService)return await mye(Et,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,n,i,o){await Qo(n,e);let s=(u,p)=>{u!=="start"&&u!=="restart"||re(`(onStart) Looking for controller ${p.controller.id} in ${this.controllerRegistration.all.map(m=>`${m.kind}:${m.id}`).join(", ")}`)},a=await Vs.connectToNotebookKernel(e,this.serviceContainer,{resource:n||i.uri,notebook:i,controller:t},new Yt(!1),o,"jupyterExtension",s),c=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!c)throw Error(`Controller ${a.controller.id} not found or not yet created`);let l=c.controller;return this.interpreterService&&fye(a.kernelConnectionMetadata,n,this.interpreterService).then(async u=>{await this.workspaceMemento.update(LF,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{j("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:l}}};Gb=g([(0,Gs.injectable)(),d(0,(0,Gs.inject)(St)),d(1,(0,Gs.inject)(Qe)),d(1,(0,Gs.optional)()),d(2,(0,Gs.inject)(K)),d(3,(0,Gs.inject)($e)),d(3,(0,Gs.named)(ri)),d(4,(0,Gs.inject)(lt))],Gb);async function mye(r,e,t,n){let i=await t.getActiveInterpreter(e);if(i){let o=await ws(i),s=Fo.create({kernelSpec:o,interpreter:i,id:ki(o,i)}),a=n.addOrUpdate(s,[r]),c=a[0];return n.trackActiveInterpreterControllers(a),re(`Active Interpreter Controller ${c.connection.kind}:${c.id} created for View ${r} with resource ${V(e)}`),c}}async function fye(r,e,t){return(await t.getActiveInterpreter(e))?.id===r.interpreter?.id}var Qb=k(M());var Rd=require("vscode");var zb=class{constructor(e,t,n){this.configService=e;this.fs=t;this.registry=n;this.priority=0}activate(){this.registry.register(this,Et)}async getCode(e){let t=await this.getWorkingDirectory(e);return t?Ke(qa(Ba.UpdateCWDAndPath,Ee(t)),{trim:!1}):[]}async getWorkingDirectory(e){if(!dt(e.kernelConnectionMetadata)&&!nP(e.kernelConnectionMetadata)||!Kt(e.kernelConnectionMetadata))return;let t=Is(),n=e.resourceUri?.path.endsWith(".interactive")&&t?Rd.Uri.joinPath(t,e.resourceUri.path):e.resourceUri,i=await this.calculateWorkingDirectory(e.resourceUri);if(i&&await this.fs.exists(i))return i;if(e.resourceUri&&e.resourceUri.scheme!=="untitled"&&await this.fs.exists(e.resourceUri)&&(i=Rd.Uri.file(Oh(Ee(i),n,this.configService.getSettings(n))),i&&await this.fs.exists(i)))return i}async calculateWorkingDirectory(e){let t,n=this.configService.getSettings(e),i=hk(n.notebookFileRoot);if(i&&Rd.workspace.workspaceFolders?.length){let o=Rd.Uri.file(i),s=Rd.workspace.workspaceFolders[0].uri;if(dh(i))await this.fs.exists(o)?t=o:t=s;else if(i.includes("${"))t=o;else{let a=Rd.Uri.joinPath(s,i);await this.fs.exists(a)?t=a:t=s}}return t}};zb=g([(0,Qb.injectable)(),d(0,(0,Qb.inject)(ae)),d(1,(0,Qb.inject)(st)),d(2,(0,Qb.inject)(da))],zb);function az(r){r.addSingleton(Ki,Fb),r.addSingleton(o0,Gb),r.addSingleton(Ie,Do),r.addSingleton(Ie,Kb),r.add(r0,tr),r.addSingleton(n0,Rb),r.addSingleton(wd,Ab),r.addSingleton(Ie,Hb),r.addSingleton(Ie,qb),r.addSingleton(Ie,Nb),r.addSingleton(Ie,Lb),r.addSingleton(Ie,zb),r.addSingleton(Ie,Bb),r.addSingleton(kb,_b,void 0,[Ie]),r.addSingleton($s,Ob),r.addSingleton(ng,Ub),r.addSingleton(i0,Wb),r.addSingleton(s0,Vb,void 0,[Ie]),r.addSingleton(S2,Td,iz)}var ku=k(M()),Xb=require("vscode");var Yb=class{constructor(e,t,n,i){this.jupyterServerHelper=e;this.configService=t;this.fileSystem=n;this.errorHandler=i;this.pruneCells=(e,t)=>e.map(i=>this.pruneCell(i,t));this.pruneCell=(e,t)=>{let n=oV({...e.data});return n.source=this.pruneSource(e.data.source,t),n};this.pruneSource=(e,t)=>{if(Array.isArray(e)&&e.length>0){if(t.isCell(e[0]))return e.slice(1)}else{let n=e.toString().split(`
`).map(i=>`${i}
`);if(n.length>0&&t.isCell(n[0]))return n.slice(1)}return e};this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython();return e&&e.version?e.version.major:3}}dispose(){}async exportToFile(e,t,n=!0){let i=await this.translateToNotebook(e);try{let o=JSON.stringify(i,void 0,1);if(await this.fileSystem.writeFile(Xb.Uri.file(t),o),!n)return;let s=y.exportOpenQuestion1;Xb.window.showInformationMessage(y.exportDialogComplete(t),s).then(async a=>{try{a===s&&await c0(Xb.Uri.file(t))}catch(c){await this.errorHandler.handleError(c)}},f)}catch(o){x("Error in exporting notebook file"),Xb.window.showInformationMessage(y.exportDialogFailed(o)).then(f,f)}}async translateToNotebook(e,t){let n=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:n},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${n}`,version:n},kernelspec:t},o=new hi(this.configService.getSettings());return{cells:this.pruneCells(e,o),nbformat:CR.major,nbformat_minor:CR.minor,metadata:i}}};Yb=g([(0,ku.injectable)(),d(0,(0,ku.inject)(Qu)),d(0,(0,ku.optional)()),d(1,(0,ku.inject)(ae)),d(2,(0,ku.inject)(st)),d(3,(0,ku.inject)(Yr))],Yb);var Ad=k(M()),cz=require("vscode");var Zb=class{constructor(e,t,n,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=n;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>qa(Ba.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let n=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(n){let i;n.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Ge.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(cz.Uri.file(t.filePath),qa(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};Zb=g([(0,Ad.injectable)(),d(0,(0,Ad.inject)(hr)),d(1,(0,Ad.inject)(K)),d(2,(0,Ad.inject)(ae)),d(3,(0,Ad.inject)(Eh)),d(4,(0,Ad.inject)(dE))],Zb);var zs=k(M());var as=require("vscode");var I0=class{constructor(e,t,n,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=n;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand(J.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(J.ExportToHTML,(e,t,n)=>this.export(e,"html",t,n)),this.registerCommand(J.ExportToPDF,(e,t,n)=>this.export(e,"pdf",t,n)),this.registerCommand(J.Export,(e,t,n)=>this.export(e,void 0,t,n)),this.registerCommand(J.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let n=as.commands.registerCommand(e,t,this);this.disposables.push(n)}async nativeNotebookExport(e){let t=Vn(e)?e:e?.notebookEditor?.notebookUri,n=t?as.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):as.window.activeNotebookEditor?.notebook;if(n){let i,o=this.kernelFinder.registered.find(c=>c.kind==="localPythonEnvironment"),s=new as.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(n,o,s.token).then(c=>c?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(n)?.connection.interpreter||i;return this.export(n,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,n,i){if(!e){if(e=as.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){H("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&A("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,n,i);else{let o=await this.showExportQuickPickMenu(e,n,i).then(s=>s);o!==void 0?o.handler():A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,n){let i=[];return(n||e.metadata&&ZE(co(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),as.commands.executeCommand(J.ExportAsPythonScript,e,n).then(f,f)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),as.commands.executeCommand(J.ExportToHTML,e,t,n).then(f,f)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{A("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),as.commands.executeCommand(J.ExportToPDF,e,t,n).then(f,f)}}),i}async showExportQuickPickMenu(e,t,n){let i=this.getExportQuickPickItems(e,t,n),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return as.window.showQuickPick(i,o)}};var S0=require("vscode");var eI=class{constructor(e,t,n,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=n;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new I0(this.fileConverter,this.fs,this.interactiveProvider,o,new gd(a),s),S0.workspace.isTrusted||S0.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){S0.workspace.isTrusted&&this.exportCommand?.register()}};eI=g([(0,zs.injectable)(),d(0,(0,zs.inject)(K)),d(1,(0,zs.inject)(db)),d(2,(0,zs.inject)(st)),d(3,(0,zs.inject)(Ki)),d(3,(0,zs.optional)()),d(4,(0,zs.inject)(St)),d(5,(0,zs.inject)(Tr)),d(6,(0,zs.inject)(In))],eI);var Nd=k(M()),rI=require("vscode");var lz=require("vscode");var UF="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",hye=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),gye=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),tI=class{constructor(e,t,n){this.controllerManager=e;this.globalMemento=n;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){Q(this.disposables)}activate(){rI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!_t(e))return;let t=rP(co(e));t&&this.recommendExtensionForLanguage(t).catch(f)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||Kt(e.connection))return;let t=Di(e.connection);t&&this.recommendExtensionForLanguage(t).catch(f)}async recommendExtensionForLanguage(e){let t=gye.get(e.toLowerCase());if(!t||lz.extensions.getExtension(t))return;let n=hye.get(t);if(!n||this.globalMemento.get(UF,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${n.displayName}](${n.extensionLink})`,e);switch(A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await rI.window.showInformationMessage(i,ge.bannerLabelYes,ge.bannerLabelNo,ge.doNotShowAgain)){case ge.bannerLabelYes:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),rI.commands.executeCommand("extension.open",t).then(f,f);break}case ge.bannerLabelNo:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case ge.doNotShowAgain:{A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(UF,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(UF,s));break}default:A("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};tI=g([(0,Nd.injectable)(),d(0,(0,Nd.inject)(St)),d(1,(0,Nd.inject)(K)),d(2,(0,Nd.inject)($e)),d(2,(0,Nd.named)(yt))],tI);var ul=k(M()),Fi=require("vscode");var nI=class{constructor(e,t,n,i,o){this.interactiveProvider=e;this.kernelProvider=n;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;t.push(this),this.nativeContext=new ir(yr.IsNativeActive),this.canRestartNotebookKernelContext=new ir(yr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new ir(yr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new ir(yr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new ir(yr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new ir(yr.IsInteractiveActive),this.interactiveOrNativeContext=new ir(yr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new ir(yr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new ir(yr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new ir(yr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new ir(yr.HaveNativeCells),this.isPythonNotebook=new ir(yr.IsPythonNotebook),this.isJupyterKernelSelected=new ir(yr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new ir(yr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new ir(yr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){Fi.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),Fi.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(Fi.window.activeNotebookEditor),Fi.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),Fi.window.activeTextEditor?.document.languageId===xe&&this.onDidChangeActiveTextEditor(Fi.window.activeTextEditor),Fi.window.onDidChangeNotebookEditorSelection(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Fi.workspace.onDidOpenNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),Fi.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(Fi.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(f)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(f),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===It:!1;this.nativeContext.set(t).catch(f),this.isPythonNotebook.set(e&&t?ZE(co(e.notebook)):!1).catch(f),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookInteractiveWindowOpenContext(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(){this.hasNativeNotebookOrInteractiveWindowOpen.set(Fi.workspace.notebookDocuments.some(e=>e.notebookType===It||e.notebookType===Et)).catch(f)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===It?this.kernelProvider.get(e.notebook):void 0;if(t){let n=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||n.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(f);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(f)}else this.canRestartNotebookKernelContext.set(!1).catch(f),this.canInterruptNotebookKernelContext.set(!1).catch(f);this.updateKernelSourceContext(t).catch(f),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!Ut(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(f);return}let t=e.kernelConnectionMetadata,n=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!n){this.kernelSourceContext.set("").catch(f);return}this.kernelSourceContext.set(n.id).catch(f)}updateSelectedKernelContext(){let e=Fi.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&_t(e)&&this.controllers.getSelected(e)?this.isJupyterKernelSelected.set(!0).catch(f):this.isJupyterKernelSelected.set(!1).catch(f)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let n=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!n).catch(f);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(f)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(f),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(f);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===Et?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===It&&t===Fi.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(Fi.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===xe&&!rj(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(f),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(f),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(f)}};nI=g([(0,ul.injectable)(),d(0,(0,ul.inject)(Ki)),d(0,(0,ul.optional)()),d(1,(0,ul.inject)(K)),d(2,(0,ul.inject)(Fe)),d(3,(0,ul.inject)(St)),d(4,(0,ul.inject)(Gt))],nI);var x0=k(M()),La=require("vscode");var vye=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,yye=1e3,bye=Dr(),uz=Symbol("IImportTracker"),Of=class{constructor(e){this.pendingChecks=new lo;this.disposables=[];this.sentMatches=new Set;e.push(this),La.workspace.onDidOpenNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),La.workspace.onDidCloseNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),La.workspace.onDidSaveNotebookDocument(t=>this.onOpenedOrClosedNotebookDocument(t,"onOpenCloseOrSave"),this.disposables),La.notebooks.onDidChangeNotebookCellExecutionState(t=>{t.state==La.NotebookCellExecutionState.Pending&&!this.isTelemetryDisabled&&this.checkNotebookCell(t.cell,"onExecution").catch(f)},this,e)}get isTelemetryDisabled(){return wE()}dispose(){Q(this.disposables),this.pendingChecks.clear()}activate(){La.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let n=0;n<Math.min(yye,e.lineCount);n++){let i=e.lineAt(n);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!_t(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let n=this.pendingChecks.get(e);n&&(clearTimeout(n),this.pendingChecks.delete(e)),bye?t():this.pendingChecks.set(e,setTimeout(t,5e3))}async checkNotebookDocument(e,t){!_t(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async n=>this.checkNotebookCell(n,t)))}async checkNotebookCell(e,t){if(!(!_t(e.notebook)||e.kind!==La.NotebookCellKind.Code||e.document.languageId!==xe))try{let n=e.notebook.notebookType===It?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),n,t)}catch(n){if(!Zn)throw n}}lookForImports(e){let t=[];try{for(let n of e){if(!n.includes("import")&&!n.includes("from"))continue;let i=n?vye.exec(n):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,n){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${n}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await ht(i);A("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:n})}))}};Of=g([(0,x0.injectable)(),d(0,(0,x0.inject)(K))],Of);var pl=k(M());var jF=require("vscode");var iI=class{constructor(e,t,n,i){this.disposableRegistry=e;this.configuration=t;this.rawSupported=n;this.commandListeners=i;this.isDisposed=!1;this.startTime=Date.now();this.onSettingsChanged=()=>{let t=this.configuration.getSettings(void 0).sendSelectionToInteractiveWindow;new ir(yr.OwnsSelection).set(t).catch(f)}}get activationStartTime(){return this.startTime}activate(){this.onSettingsChanged(),this.changeHandler=this.configuration.getSettings(void 0).onDidChange(this.onSettingsChanged.bind(this)),this.disposableRegistry.push(this),this.disposableRegistry.push(jF.window.onDidChangeActiveTextEditor(()=>this.onChangedActiveTextEditor())),this.onChangedActiveTextEditor(),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new ir(yr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(f,f)}onChangedActiveTextEditor(){let e=new ir(yr.HasCodeCells),t=jF.window.activeTextEditor;t&&t.document.languageId===xe?e.set(lG(t.document,this.configuration.getSettings())).catch(f):e.set(!1).catch(f)}};iI=g([(0,pl.injectable)(),d(0,(0,pl.inject)(K)),d(1,(0,pl.inject)(ae)),d(2,(0,pl.inject)(ui)),d(2,(0,pl.optional)()),d(3,(0,pl.multiInject)(Fh))],iI);var gi=k(M()),C0=require("vscode");var Ff=k(M()),Kf=require("vscode");var dz=require("vscode");var WF="JUPYTER_API_ACCESS_INFORMATION",pz=new Set([Pt.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),VF=new Set(["rchiodo","nuant"]),Du=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new lh}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===pS?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===Kf.ExtensionMode.Test||!t||mo()==="insiders"){if(!pz.has(t)&&!VF.has(t)){j(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=dz.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;Kf.window.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(f,f)}if(!VF.has(t)||!t||this.context.extensionMode===Kf.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(pz.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!VF.has(t))return Kf.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(f,f),x(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(WF)?.find(s=>s.extensionId===e.extensionId);if(i)return A("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,ge.bannerLabelYes),c=await Kf.window.showInformationMessage(s,{modal:!0},ge.bannerLabelYes,ge.bannerLabelNo)===ge.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let l=[...this.globalState.get(WF,[])];return l=l.filter(u=>u.extensionId!==e.extensionId),l.push({allowed:c?"yes":"no",extensionId:e.extensionId}),this.globalState.update(WF,l)}).then(f,f),A("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:c?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:c}})();return this.extensionAccess.set(e.extensionId,o),o}};Du=g([(0,Ff.injectable)(),d(0,(0,Ff.inject)($e)),d(0,(0,Ff.named)(yt)),d(1,(0,Ff.inject)(ct))],Du);var mz=new WeakMap;function BF(r){let e=mz.get(r);return e||(e=Iye(r),mz.set(r,e)),e}function Iye(r){return new Proxy(r,{get(e,t){return t==="kernel"?e.kernel?Sye(e.kernel):void 0:Reflect.get(e,t)}})}var fz=new WeakMap;function Sye(r){let e=fz.get(r);return e||(e=xye(r),fz.set(r,e)),e}function xye(r){return new Proxy(r,{get(e,t){return t==="registerCommTarget"?(n,i)=>(e4(r,n),Reflect.get(e,t).apply(e,[n,i])):t==="removeCommTarget"?(n,i)=>(t4(r,n),Reflect.get(e,t).apply(e,[n,i])):Reflect.get(e,t)}})}var oI=class{constructor(e,t,n,i,o,s,a,c){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=n;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=c;this.chainedApiAccess=new lh;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let n=new WC(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,n),n}};oI=g([(0,gi.injectable)(),d(0,(0,gi.inject)(Fe)),d(1,(0,gi.inject)(Tr)),d(2,(0,gi.inject)(hm)),d(3,(0,gi.inject)(K)),d(4,(0,gi.inject)(St)),d(5,(0,gi.inject)(Du)),d(6,(0,gi.inject)(sm)),d(7,(0,gi.inject)(lt))],oI);var WC=class{constructor(e,t,n,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=n;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new C0.EventEmitter;this._onDidChangeKernels=new C0.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new C0.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(c=>{re(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(c=>{re(`Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(c=>{re(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(c=>{re(`Third party Kernel ${c.kernelConnectionMetadata.id}, ${c.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),E(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.kernelProvider.get(n.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.thirdPartyKernelProvider.kernels.filter(n=>n.startedAtLeastOnce||n.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(n=>{let i=this.thirdPartyKernelProvider.get(n.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(n.kernelConnectionMetadata),uri:n.uri,id:n.id})}),this.controllerRegistration.registered.forEach(n=>{n.controller.notebookType===It&&n.connection.kind==="connectToLiveRemoteKernel"&&(!n.connection.kernelModel.id||t.has(n.connection.kernelModel.id)||e.push({metadata:n.connection,uri:void 0,id:n.id}))}),e}getKernel(e){A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:BF(t.session)}}async startKernel(e,t){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return A("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let n=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!n)throw new Error("Not found");let i=await Vs.connectToKernel(n,this.serviceContainer,{resource:t},new Yt(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return BF(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Es.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};WC=g([d(1,(0,gi.inject)(Fe)),d(2,(0,gi.inject)(Tr)),d(3,(0,gi.inject)(hm)),d(4,(0,gi.inject)(K)),d(5,(0,gi.inject)(St)),d(6,(0,gi.inject)(lt))],WC);var w0=k(M()),dl=require("vscode");var hz=require("vscode");var Lf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(f)}getActiveResource(){let e=hz.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(dl.workspace.workspaceFolders)&&dl.workspace.workspaceFolders.length>0?dl.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await N6(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==xe)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(dl.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let n=dl.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(n?n.uri:void 0).catch(f)}addHandlers(){this.disposables.push(dl.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=dl.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(dl.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),n=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(n.length>0)for(let i of n)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(dl.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return bs(e,"")}};g([gh("Failed to activate a workspace")],Lf.prototype,"activateWorkspace",1),Lf=g([(0,w0.injectable)(),d(0,(0,w0.inject)(st))],Lf);var aI=k(M());var sI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){x(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};sI=g([(0,aI.injectable)(),d(0,(0,aI.optional)()),d(0,(0,aI.multiInject)(Ie))],sI);var VC=k(M()),fl=require("vscode");var qF=Symbol("ISurveyBanner");var ml=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[vE.bannerLabelYes,vE.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner"),setTimeout(()=>{ml.surveyDelay=!0},10*60*1e3)}isEnabled(e){switch(e){case 0:if(mo()==="insiders")return this.isEnabledInternal(e);break;case 1:if(mo()==="stable")return this.isEnabledInternal(e);break;default:return x("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return fl.env.uiKind!==fl.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){fl.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){if(!this.shouldShowBanner(e))return;switch(this.disabledInCurrentSession=!0,await fl.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return $d()||!this.isEnabled(e)||this.disabledInCurrentSession||!ml.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Cp(this.getSurveyLink(e))}async disable(e,t){let n=e===0?6:4;n&&await this.showBannerState.get(t).updateValue({expiry:n*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return x("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){_t(e.cell.notebook)&&e.state===fl.NotebookCellExecutionState.Executing&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(f),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(f))}async updateStateAndShowBanner(e,t){let n=this.persistentState.createGlobalPersistentState(e,0);await n.updateValue(n.value+1),this.showBanner(t).catch(f)}getBannerMessage(e){switch(e){case 0:case 1:return EA.bannerMessage;default:return x("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return x("Invalid Banner type"),""}}};ml.surveyDelay=!1,ml=g([(0,VC.injectable)(),d(0,(0,VC.inject)(dc)),d(1,(0,VC.inject)(K))],ml);var Ua=require("vscode");function gz(r,e){e&&Ua.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let n of r.globalState.keys())t.push(r.globalState.update(n,void 0).then(f,f));for(let n of r.workspaceState.keys())t.push(r.workspaceState.update(n,void 0).then(f,f));t.push(Ua.commands.executeCommand(J.ClearSavedJupyterUris).then(f,f)),await Promise.all(t).catch(f),await Promise.all([Ua.workspace.fs.delete(Ua.Uri.joinPath(r.globalStorageUri,"lastExecutedRemoteCell.json")).then(f,f),Ua.workspace.fs.delete(Ua.Uri.joinPath(r.globalStorageUri,"remoteServersMRUList.json")).then(f,f),Ua.workspace.fs.delete(Ua.Uri.joinPath(r.globalStorageUri,iy)).then(f,f)]),H("Cache cleared")})}function vz(r,e){gz(r,e)}var k0=k(M()),$t=require("vscode");var E0=y.percentPipCondaInstallInsteadOfBang("pip"),JF=y.percentPipCondaInstallInsteadOfBang("conda"),yz=y.matplotlibWidgetInsteadOfOther,P0="Jupyter",cI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=$t.languages.createDiagnosticCollection(P0),this.disposables.push(this.problems),e.push(this)}dispose(){Q(this.disposables),this.problems.dispose()}activate(){this.disposables.push($t.languages.registerCodeActionsProvider(xe,this)),this.disposables.push($t.languages.registerHoverProvider(xe,this)),$t.workspace.onDidChangeTextDocument(e=>{let t=Qh(e.document);if(!t)return;let n=t.getCells().find(i=>i.document===e.document);n&&this.analyzeNotebookCell(n)},this,this.disposables),$t.workspace.onDidCloseNotebookDocument(e=>{this.problems.delete(e.uri);let t=this.notebooksProcessed.get(e);this.notebooksProcessed.delete(e),t&&t.forEach((n,i)=>this.problems.delete($t.Uri.parse(i)))},this,this.disposables),$t.workspace.onDidOpenNotebookDocument(e=>this.analyzeNotebook(e),this,this.disposables),$t.workspace.onDidChangeNotebookDocument(e=>{let t=this.notebooksProcessed.get(e.notebook);e.contentChanges.forEach(n=>{n.removedCells.forEach(i=>{t?.delete(i.document.uri.toString())}),n.addedCells.forEach(i=>this.queueCellForProcessing(i))}),e.cellChanges.forEach(n=>this.queueCellForProcessing(n.cell))},this,this.disposables),$t.workspace.notebookDocuments.map(e=>this.analyzeNotebook(e))}provideHover(e,t,n){if(Qh(e)?.notebookType!==It)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(c=>c.message===E0||c.message===JF);if(!s||!s.range.contains(t))return;let a=s.message===E0?"pip":"conda";return new $t.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,n,i){if(!Qh(e))return[];let o=[];return n.diagnostics.forEach(s=>{switch(s.message){case E0:o.push(this.createReplaceCodeAction(e,"pip",s));break;case JF:o.push(this.createReplaceCodeAction(e,"conda",s));break;case yz:o.push(this.createGotoWikiAction(e,$t.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,n){let i=new $t.CodeAction(y.replacePipCondaInstallCodeAction(t),$t.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[n];let o=new $t.WorkspaceEdit;return o.replace(e.uri,new $t.Range(n.range.start,new $t.Position(n.range.start.line,n.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,n){let i=new $t.CodeAction(y.matplotlibWidgetCodeActionTitle,$t.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[n],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===It&&e.getCells().forEach((t,n)=>n<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;this.cellsToProcess.delete(e),this.analyzeNotebookCell(e),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==$t.NotebookCellKind.Code||e.document.languageId!==xe||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let n=0;n<Math.min(e.document.lineCount,50);n++){let i=e.document.lineAt(n),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:E0,range:c,severity:$t.DiagnosticSeverity.Error,source:P0}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),c=new $t.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:JF,range:c,severity:$t.DiagnosticSeverity.Error,source:P0}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,c=new $t.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:yz,range:c,severity:$t.DiagnosticSeverity.Warning,source:P0}])}}}};cI=g([(0,k0.injectable)(),d(0,(0,k0.inject)(K))],cI);var _0=k(M()),Lr=require("vscode");var bz=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function D0(r){if(r>=300)return"ZZZZZZZ";if(r<=25)return`A${String.fromCharCode(65+r)}`;let e=String.fromCharCode(65+Math.ceil(r/25)),t=String.fromCharCode(65+r%25);return`${e}${t}`}var $F=class{constructor(e,t,n,i){this.kernelId=e;this.kernel=t;this.monacoLanguage=n;this.toDispose=i;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,n,i){if(!this.kernel.session?.kernel)return[];if(this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===e.version)return[];this.pendingCompletionRequest.set(e,{position:t,version:e.version});try{let o=ds(mr(n,Promise.resolve(Lr.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(u=>u?.items||[]))),s=new Be;if(await ji(100),n.isCancellationRequested)return[];let a=await this.provideCompletionItemsFromKernel(e,t,n,i);if(n.isCancellationRequested)return[];let c=await _r(0,o.promise);Kt(this.kernel.kernelConnectionMetadata)&&!o.completed&&s.elapsedTime<300&&(c=await _r(200,o.promise));let l=new Set((c||[]).map(u=>typeof u.label=="string"?u.label:u.label.label));return a.filter(u=>!l.has(typeof u.label=="string"?u.label:u.label.label))}finally{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===e.version&&this.pendingCompletionRequest.delete(e)}}async provideCompletionItemsFromKernel(e,t,n,i){if(n.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Be,s={duration:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:R0(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(this.kernel.status!=="idle")return A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",s,a),[];let c=e.getText(),l=e.offsetAt(t);a.requestSent=!0;let u=await mr(n,this.kernel.session.kernel.requestComplete({code:c,cursor_pos:l}));if(E(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=n.isCancellationRequested,a.completed=!n.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=n.isCancellationRequested?0:o.elapsedTime,n.isCancellationRequested||u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",s,a),[];let p={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},m=p.metadata?p.metadata._jupyter_types_experimental:[];s.completionItems=p.matches.length,A("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",s,a);let h={code:c,cursor:p.cursor,documentRef:new WeakRef(e),position:e.positionAt(p.cursor.start)},v=new Lr.Range(e.positionAt(p.cursor.start),e.positionAt(p.cursor.end)),b=[];return Array.isArray(m)&&m.length>=p.matches.length&&m.every(w=>w&&typeof w.text=="string")?b=u.content.matches.map((w,D)=>{let T=m[D],F=T.type?bz.get(T.type):Lr.CompletionItemKind.Field,ee=new Lr.CompletionItem(w,F);return typeof T.start=="number"&&typeof T.end=="number"?ee.range=new Lr.Range(e.positionAt(T.start),e.positionAt(T.end)):ee.range=v,ee.insertText=T.text,ee.sortText=D0(D),Kt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(ee.sortText=`ZZZ${ee.sortText}`),this.previousCompletionItems.set(ee,{...h,originalCompletionItem:JSON.parse(JSON.stringify(ee))}),ee}):b=p.matches.map((w,D)=>{let T=new Lr.CompletionItem(w);return T.range=v,T.sortText=D0(D),Kt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(T.sortText=`ZZZ${T.sortText}`),this.previousCompletionItems.set(T,{...h,originalCompletionItem:T}),T}),Kt(this.kernel.kernelConnectionMetadata)?kye(i.triggerCharacter,this.allowStringFilterForPython,b,e,t):b}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let n=this.previousCompletionItems.get(e);if(!n)return e;let{documentRef:i,position:o,originalCompletionItem:s}=n,a=i.deref();return a?f5(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o,this.toDispose):e}},HF=class extends er{constructor(t,n){super();this.kernel=t;this.notebookEditorProvider=n;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=T0(this.kernel);this.toDispose=this._register(new Ko);this.registerCompletionProvider(),this._register(Lr.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(Iz(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||(this.completionProvider?.dispose(),this.completionProvider=void 0,this.registerCompletionProvider())}))}registerCompletionProvider(){if(!Iz(this.kernel.notebook.uri))return;let t=wye(this.kernel);if(t.length===0){Eye(this.kernel);return}H(`Registering Kernel Completion Provider from kernel ${pt(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider=Lr.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,n,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await ht(this.kernel.kernelConnectionMetadata.id);s=new $F(a,this.kernel,this.monacoLanguage,this.toDispose),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,n,i,o).then(a=>(a.forEach(c=>this.completionItemsSent.set(c,s)),a))}async resolveCompletionItem(t,n){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,n):t}},Md=class extends er{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=_e.instance.get(Fe);this._register(t.onDidStartKernel(async n=>{n.session?.kernel&&Kt(n.kernelConnectionMetadata)&&n.session.kernel.requestComplete({code:"__file__.",cursor_pos:9});let i=_e.instance.get(mc),o=T0(n);if(!o||!i.inExperiment("KernelCompletions")&&o.toLowerCase()!==xe.toLowerCase()||this.kernelCompletionProviders.has(n))return;let s=_e.instance.get(fi),a=this._register(new HF(n,s));this.kernelCompletionProviders.set(n,a)})),this._register(t.onDidDisposeKernel(n=>{this.kernelCompletionProviders.get(n)?.dispose()}))}};Md=g([(0,_0.injectable)(),d(0,(0,_0.inject)(K))],Md);function T0(r){return xs(R0(r))}function R0(r){let e="";switch(r.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=r.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=r.kernelConnectionMetadata.kernelSpec.language;break;default:e=r.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function Iz(r){return Lr.workspace.getConfiguration("jupyter",r).get("enableKernelCompletions",!1)}function wye(r){let e=Lr.workspace.getConfiguration("jupyter",r.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=R0(r),n=T0(r);return t in e?Array.isArray(e[t])?e[t]:[]:n in e?Array.isArray(e[n])?e[n]:[]:[]}function Eye(r){let e=R0(r),t=T0(r);e.toLowerCase()===t.toLowerCase()?j(Lr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,pt(r.kernelConnectionMetadata),`{${e}`)):j(Lr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,pt(r.kernelConnectionMetadata),`{${e}`,`{${t}`))}function Pye(r,e){let t=r.indexOf('"'),n=r.indexOf("'"),i=r.lastIndexOf('"'),o=r.lastIndexOf("'"),s=t>=0?t:n,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function kye(r,e,t,n,i){let o=t,s=i.character===0?void 0:new Lr.Range(i.line,i.character-1,i.line,i.character),c=(s?n.getText(s):void 0)===".",l=n.getWordRangeAtPosition(c||r==="."?new Lr.Position(i.line,i.character-1):i),u=l&&s?l.union(s):void 0,p=n.lineAt(i.line).text,m=u?n.getText(u):p,h=m.endsWith(".")||c,v=e&&(r=="'"||r=='"'||Pye(p,i));return re(`Jupyter completions filtering applied: ${v} on ${p}`),o=o.map((b,w)=>{let D=typeof b.label=="string"?b.label:b.label.label,T=typeof b.label=="string"?b.label:b.label.label;if(T.startsWith("%")||T.startsWith("!"))return{...b,sortText:`ZZZ${b.sortText}`};if(v)return b;let F=m?T.indexOf(m):-1,ee,de,Z;if(m&&h&&T.includes(m)){ee=T.substring(T.indexOf(m)+(h?m.length:0)),de=T.substring(T.indexOf(m)+m.length);let ye=(typeof b.label=="string"?b.label.length:b.label.label.length)-de.length;Z=b.range&&"start"in b.range?new Lr.Range(new Lr.Position(b.range.start.line,b.range.start.character+ye),b.range.end):b.range}if(!de&&F>0){ee=T.substring(T.indexOf(m)+(h?m.length:0)),de=T.substring(T.indexOf(m)+m.length);let ye=(typeof b.label=="string"?b.label.length:b.label.label.length)-de.length;Z=b.range&&"start"in b.range?new Lr.Range(new Lr.Position(b.range.start.line,b.range.start.character+ye),b.range.end):b.range}return ee&&de&&Z&&(b.label=ee,D=de,b.insertText=de,b.filterText=h?`.${de}`:de,b.range=Z,b.sortText=D0(w)),D.endsWith("/")?{...b,command:{command:"editor.action.triggerSuggest",title:""}}:(D.includes(" ")&&(D=D.replace(/\\ /g," "),typeof b.label=="string"?b.label=b.label.replace(/\\ /g," "):b.label.label=b.label.label.replace(/\\ /g," ")),v||!D.includes(".")&&!D.endsWith("/")?b:void 0)}).filter(b=>b!==void 0),re(`Jupyter completions for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${t.map(b=>b.label).join(",")}`),re(`Jupyter results for ${m} at pos ${i.line}:${i.character} with trigger: ${r}
   ${o.map(b=>b.label).join(",")}`),o}var Uf=k(M()),Kd=require("vscode");var Od=class{constructor(e,t,n,i){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=n;this.controllerRegistration=i;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=Kd.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t)),e.registerGetNotebookUriForTextDocumentUriFunction!==void 0&&e.registerGetNotebookUriForTextDocumentUriFunction(t=>this._getNotebookUriForTextDocumentUri(t))}).catch(f)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return Kd.extensions.getExtension(Hd)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){if(this._isEnabled===void 0){let t=Kd.workspace.getConfiguration("python")?.get("languageServer");this._isEnabled=!1,t!=="Pylance"&&t!=="Default"?H("Not using Pylance"):(this._isEnabled=!0,H("Using Pylance"))}return this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let n=this.controllerRegistration.getSelected(t);if(n&&Ut(n.connection))return"";let i=n?.connection?.interpreter;return i?Ee(i.uri):(H(`No interpreter for Pylance for Notebook URI "${V(t.uri)}"`),"")}_getNotebookUriForTextDocumentUri(e){let t=Dye(e);if(!t)return;let n;return Kd.window.tabGroups.all.find(i=>{i.tabs.find(o=>{if(Tf(o)){let s=o.input.uri.toString();o.input.uri.toString().endsWith(t.path)&&(n=s)}})}),n}};Od=g([(0,Uf.injectable)(),d(0,(0,Uf.inject)(zt)),d(1,(0,Uf.inject)(ze)),d(2,(0,Uf.inject)(fi)),d(3,(0,Uf.inject)(St))],Od);function Dye(r){if(r.scheme!=="vscode-interactive-input")return;let e=`${r.path.replace("InteractiveInput-","Interactive-")}.interactive`;return Kd.workspace.notebookDocuments.find(t=>t.uri.path===e)?.uri}function Sz(r){r.addSingleton(Ie,cI),r.addSingleton(Md,Md),r.addBinding(Md,Ie),r.addSingleton(Od,Od),r.addBinding(Od,Ie)}var uI=k(M());var xz=require("vscode");var lI=class{constructor(e,t,n){this.extensionChecker=e;this.disposables=t;this.kernelProvider=n}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&xz.window.showInformationMessage(y.pythonExtensionInstalled,ge.ok).then(f,f)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};lI=g([(0,uI.injectable)(),d(0,(0,uI.inject)(ze)),d(1,(0,uI.inject)(K)),d(2,(0,uI.inject)(Fe))],lI);var Ur=k(M()),Ez=k(Io()),xt=require("vscode");var hl=require("vscode");var A0=class{constructor(e,t,n,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=n;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=BC(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:n,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(j(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&Q(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,n,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=hl.window.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[hl.QuickInputButtons.Back],o=await new Promise((c,l)=>{a.onDidTriggerButton(u=>{u===hl.QuickInputButtons.Back&&l(Ae.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>c(a.value),this,e.disposables),a.onDidHide(()=>l(Ae.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new hl.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");n=a.sessionCookieName,i=a.sessionCookieValue}else n="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${n}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&n&&(i||e.isTokenEmpty)?(A("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${n}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(A("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getXSRFToken(e,t){let n,i,o=new URL("login?",BC(e)).toString();t!=""?(o=new URL("tree",BC(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(n=a.get("_xsrf")?.split(";")[0])}return n}async needPassword(e){return(await this.makeRequest(new URL("tree?",BC(e)).toString(),{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}})).status!==200}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await hl.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,hl.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,n){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",n);let a=await this.makeRequest(new URL("login?",BC(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let c=this.getCookies(a);c.size>0&&(i=c.entries().next().value[0],o=c.entries().next().value[1])}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function BC(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var M0=require("vscode");var N0=class{constructor(e,t,n,i,o,s,a){this.multiStepFactory=e;this.asyncDisposableRegistry=t;this.configService=n;this.agentCreator=i;this.requestCreator=o;this.serverUriStorage=s;this.disposables=a;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}async getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");if(!await this.isJupyterHub(e.url))throw new Error("Not a Jupyter Hub Url");let t=Cz(e.url),n=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterHubConnectionInfo(t,e.validationErrorMessage).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(j(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&Q(n)}).catch(f),this.savedConnectInfo.set(e.handle,o)),o}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",Cz(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let n=await t.json();return E(`JupyterHub version is ${n&&n.version} for url ${e}`),n&&n.version}catch{}return!1}catch(t){return E(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}async getJupyterHubConnectionInfo(e,t){try{let n=await this.getUserNameAndPassword(t);if(n.username||n.password){let i=await this.getJupyterHubConnectionInfoFromLogin(e,n.username,n.password);if(i){let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromLogin":"gotResponseFromLogin";A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}else{A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"emptyResponseFromLogin"}),i=await this.getJupyterHubConnectionInfoFromApi(e,n.username,n.password);let o=Object.keys(i||{}).length===0,s=o?"emptyResponseFromApi":"gotResponseFromApi";A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:o,info:s})}return i}return A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!1,info:"passwordNotRequired"}),{requiresPassword:!1}}catch(n){throw A("DS_INTERNAL.JUPYTER_HUB_PASSWORD",void 0,{failed:!0,info:"failure"}),n}}async getJupyterHubConnectionInfoFromLogin(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=new URLSearchParams;s.append("username",t||""),s.append("password",n||"");let a=await this.makeRequest(`${o}/hub/login?next=`,{method:"POST",headers:{Connection:"keep-alive",Referer:`${o}/hub/login`,"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a&&a.status===302){let l=[...this.getCookies(a).entries()].reduce((u,p)=>`${u};${p[0]}=${p[1]}`,"");if(a=await this.makeRequest(`${o}/hub/api/users/${t}/tokens`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),a.ok&&a.status===200){let u=await a.json();if(u&&u.token&&u.id)return await this.makeRequest(`${o}/hub/api/users/${t}/server`,{method:"POST",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}),this.asyncDisposableRegistry.push({dispose:async()=>{this.makeRequest(`${o}/hub/api/users/${t}/tokens/${u.id}`,{method:"DELETE",headers:{Connection:"keep-alive",Cookie:l,Referer:`${o}/hub/login`}}).catch(f)}}),{requestHeaders:{},remappedBaseUrl:`${o}/user/${t}`,remappedToken:u.token,requiresPassword:!0}}}}async getJupyterHubConnectionInfoFromApi(e,t,n){let i=new URL(e),o=`${i.protocol}//${i.host}`,s=await this.makeRequest(`${o}/hub/api/authorizations/token`,{method:"POST",headers:{Connection:"keep-alive","content-type":"application/json;charset=UTF-8"},body:`{ "username": "${t||""}", "password": "${n||""}"  }`,redirect:"manual"});if(s.ok&&s.status===200){let a=await s.json();if(a&&a.user&&a.user.server&&a.token)return{requestHeaders:{},remappedBaseUrl:`${o}${a.user.server}`,remappedToken:a.token,requiresPassword:!0}}return{requiresPassword:!1}}addAllowUnauthorized(e,t,n){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...n,agent:i}}return n}async getUserNameAndPassword(e){let t=this.multiStepFactory.create(),n={username:"",password:"",validationMessage:e};return await t.run(this.getUserNameMultiStep.bind(this),n),n}async getUserNameMultiStep(e,t){if(t.username=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectUserPrompt,validate:this.validateUserNameOrPassword,validationMessage:t.validationMessage,value:""}),t.username)return this.getPasswordMultiStep.bind(this)}async validateUserNameOrPassword(e){}async getPasswordMultiStep(e,t){t.password=await e.showInputBox({title:y.jupyterSelectUserAndPasswordTitle,prompt:y.jupyterSelectPasswordPrompt,validate:this.validateUserNameOrPassword,value:"",password:!0})}async makeRequest(e,t){let n=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!n,t))}catch(i){if(i.message.indexOf("reason: self signed certificate")>=0){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await M0.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return A("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,M0.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&A("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function Cz(r){let e=r;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var O0="user-jupyter-server-uri-list-version2";var _ye="DataScienceAllowInsecureConnections",pI=class extends er{constructor(t,n,i,o,s,a,c,l,u,p,m,h,v,b=SR){super();this.jupyterConnection=n;this.context=m;this.fs=h;this.jupyterServerProviderRegistry=v;this.id=b;this.extensionId=Pt;this.documentation=xt.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new xt.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new xt.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new $C(i),this.secureConnectionValidator=new JC(s),this.jupyterServerUriInput=new qC(p),this.jupyterServerUriDisplayName=new GF,this.jupyterPasswordConnect=new A0(t,u,p,o,a),this.jupyterHubPasswordConnect=new N0(c,l,t,u,p,o,a)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(Pt,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(xt.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(f),this.fs.delete(xt.Uri.joinPath(this.context.globalStorageUri,iy)).catch(f)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(f)}async resolveJupyterServer(t,n){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:xt.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?xt.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,n){let i=new xt.CancellationTokenSource;this._register(new xt.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===Ae.cancel)throw new xt.CancellationError;if(s&&s instanceof Ae)return;let c=(await this.provideJupyterServers(i.token)).find(l=>l.id===s);if(!c)throw new Error(`Server ${s} not found`);return c}catch(o){if(o instanceof xt.CancellationError)throw o;x("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,n){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=ce();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(f),t.resolve()})().then(()=>t.resolve(),n=>t.reject(n)).catch(f),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){if(!xt.workspace.getConfiguration("jupyter").get("bypassJupyterHubExtensionCheck"))throw xt.extensions.getExtension(sh)?xt.window.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{xt.commands.executeCommand("notebook.selectKernel",{notebookEditor:xt.window.activeNotebookEditor}).then(f,f)},f):xt.window.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},ge.install,ge.moreInfo).then(t=>{t===ge.install?xt.commands.executeCommand("workbench.extensions.installExtension",sh,{context:{skipWalkthrough:!0}}).then(f,f):t===ge.moreInfo&&xt.env.openExternal(xt.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(f,f)},f),new xt.CancellationError}async captureRemoteJupyterUrl(t,n=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,c=!1,l,u="Get Url",p="Get Url",m=n,h=!1;if(n){let v=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(n);typeof v.validationError=="string"?(s=v.validationError,u="Get Url"):(h=!0,o=v.jupyterServerUri,u="Check Passwords")}try{let v=!1,b=!1;for(;;)try{if(l=(0,Ez.default)(),u==="Get Url"){h=!1,u="Check Passwords",p=void 0;let D=s;s="";let T=await this.jupyterServerUriInput.getUrlFromUser(m||n,D,i);o=T.jupyterServerUri,m=T.url}if(t.isCancellationRequested)return Ae.cancel;let w=[];if(u==="Check Passwords"){u="Check Insecure Connections",p=h&&n?void 0:"Get Url";try{let D=s;s="",v=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),v&&this.recommendInstallingJupyterHubExtension();let T=v?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:l,displayName:o.displayName,validationErrorMessage:D,disposables:w}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:l,validationErrorMessage:D,disposables:w});a=T.requiresPassword,o.authorizationHeader=T.requestHeaders,b=!1}catch(D){if(b=!1,D instanceof xt.CancellationError||D==Ae.back||D==Ae.cancel)throw D;if(!No.isSelfCertsError(D)){if(!uc.isSelfCertsExpiredError(D)){jf(l,o.baseUrl,v,"ConnectionFailure");let T=/(https?:\/\/[^\s]+)/g,F=(D.message||D.toString()).replace(T,ee=>`[${ee}](${ee})`);if(s=(Br()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(F),o.token.length>0&&(D.message||"").toLowerCase()==="Failed to fetch".toLowerCase())b=!0;else{u="Get Url";continue}}}}finally{w.forEach(D=>this._register(D))}}if(t.isCancellationRequested)return Ae.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",p=a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(c=!0,Q(w),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return jf(l,o.baseUrl,v,"InsecureHTTP"),Ae.cancel;if(t.isCancellationRequested)return Ae.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:l,extensionId:Pt},o,!0)}catch(D){if(j("Uri verification error",D),b&&s){u="Get Url";continue}if(D instanceof xt.CancellationError||D==Ae.back||D==Ae.cancel)throw D;if(No.isSelfCertsError(D)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",jf(l,o.baseUrl,v,"SelfCert");continue}else if(uc.isSelfCertsExpiredError(D)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",jf(l,o.baseUrl,v,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",jf(l,o.baseUrl,v,"AuthFailure");continue}else{jf(l,o.baseUrl,v,"ConnectionFailure");let T=/(https?:\/\/[^\s]+)/g,F=(D.message||D.toString()).replace(T,ee=>`[${ee}](${ee})`);s=(Br()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(F),u="Get Url";continue}}finally{Q(w)}if(t.isCancellationRequested)return Ae.cancel;if(u==="Get Display Name"){Q(w),p=c?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",p==="Get Url"&&(p=h&&n?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(l,o.displayName||new URL(o.baseUrl).hostname);break}}catch(w){if(w instanceof xt.CancellationError||w===Ae.cancel)return Ae.cancel;if(w===Ae.back){if(!p)return Ae.back;u=p;continue}throw w}return t.isCancellationRequested?Ae.cancel:(await this.addNewServer({handle:l,uri:m,serverInfo:o}),yD({extensionId:this.extensionId,id:this.id,handle:l},o.displayName),jf(l,o.baseUrl,v),l)}catch(v){if(v instanceof xt.CancellationError)return Ae.cancel;throw v}finally{Q(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl),c=Object.assign({},o);try{let l=a?await this.jupyterHubPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,handle:t,displayName:o.displayName}):await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});c=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader}),a&&l.remappedBaseUrl&&(c.baseUrl=l.remappedBaseUrl),a&&l.remappedToken&&(c.token=l.remappedToken)}catch(l){x("Failed to validate Password info",l)}return c}};pI=g([(0,Ur.injectable)(),d(0,(0,Ur.inject)(ae)),d(1,(0,Ur.inject)(In)),d(2,(0,Ur.inject)(YS)),d(3,(0,Ur.inject)(Zt)),d(4,(0,Ur.inject)($e)),d(4,(0,Ur.named)(yt)),d(5,(0,Ur.inject)(K)),d(6,(0,Ur.inject)(_g)),d(7,(0,Ur.inject)(ni)),d(8,(0,Ur.inject)(Xu)),d(8,(0,Ur.optional)()),d(9,(0,Ur.inject)(_l)),d(10,(0,Ur.inject)(ct)),d(11,(0,Ur.inject)(st)),d(12,(0,Ur.inject)(Gt)),d(13,(0,Ur.optional)()),d(13,(0,Ur.inject)(Date.now().toString()))],pI);var qC=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",n){if(!e&&!Pw)try{let s=await xt.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:xt.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=xt.window.createInputBox();n.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[xt.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=ce();return i.onDidChangeValue(()=>i.validationMessage="",this,n),i.onDidHide(()=>o.reject(Ae.cancel),this,n),i.onDidTriggerButton(s=>{s===xt.QuickInputButtons.Back&&o.reject(Ae.back)},this,n),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),n=zF(t,"");return n?(n.baseUrl=await Tye(t,this.requestCreator)||n.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:n,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};qC=g([d(0,(0,Ur.inject)(_l))],qC);async function Tye(r,e){try{if(r=zF(r,"")?.baseUrl||r,new URL(r).pathname==="/")return r;let t=r.indexOf("token=")>0?r.substring(0,r.indexOf("token=")):r,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){E("Unable to identify the baseUrl of the Jupyter Server",t)}}function jf(r,e,t,n){e=e.trim().toLowerCase();let i=Wt({handle:r,extensionId:Pt,id:SR});Promise.all([ht(e.toLowerCase()),ht(i.toLowerCase())]).then(([o,s])=>{A("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!n,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:n})}).catch(o=>x(`Failed to hash remote url ${e}`,o))}var GF=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let n=[];try{let i=xt.window.createInputBox();n.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[xt.QuickInputButtons.Back],i.show();let o=ce();return n.push(i.onDidHide(()=>o.reject(Ae.cancel))),i.onDidTriggerButton(s=>{s===xt.QuickInputButtons.Back&&o.reject(Ae.back)},this,n),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,n),await o.promise}finally{Q(n)}}},JC=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(_ye,!1))return!0;let e=[],t=ce();try{let n=xt.window.createQuickPick();e.push(n),n.canSelectMany=!1,n.ignoreFocusOut=!0,n.title=y.insecureSessionMessage,n.buttons=[xt.QuickInputButtons.Back],n.items=[{label:ge.bannerLabelYes},{label:ge.bannerLabelNo}],n.show(),e.push(n.onDidHide(()=>t.reject(Ae.cancel))),n.onDidTriggerButton(i=>{i===xt.QuickInputButtons.Back&&t.reject(Ae.back)},this,e),n.onDidAccept(()=>t.resolve(n.selectedItems.some(i=>i.label===ge.bannerLabelYes)),this,e)}finally{Q(e)}return t.promise}};JC=g([d(0,(0,Ur.inject)($e)),d(0,(0,Ur.named)(yt))],JC);function zF(r,e){if(!r.startsWith(Ge.REMOTE_URI))try{let t=new URL(r);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){x(`Failed to parse URI ${r}`,t);return}}function wz(r){return r.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function Rye(r){let e=[];return r.forEach(t=>{let n=zF(t.uri,t.displayName);n&&e.push({handle:t.handle,uri:t.uri,serverInfo:n})}),e}var $C=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(ps.JupyterServerRemoteLaunchService,O0);if(!t||t==="[]")return[];try{return this.servers=Rye(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(ps.JupyterServerRemoteLaunchService,O0,JSON.stringify(wz(t)))}).catch(f))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(n=>n.handle!==e);return this.servers=t,this.encryptedStorage.store(ps.JupyterServerRemoteLaunchService,O0,JSON.stringify(wz(t)))}).catch(f))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(ps.JupyterServerRemoteLaunchService,O0,void 0)}).catch(f))}};$C=g([d(0,(0,Ur.inject)(YS))],$C);var HC=k(M()),mI=require("vscode");var dI=class extends er{constructor(t,n){super();this.uriProviderRegistration=t;this.serverUriStorage=n;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new mI.EventEmitter);this.extensionId=Pt;this.id=fw;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(n=>n.server)}async resolveJupyterServer(t,n){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(Pt,this.id,this.displayName,this)),this._register(mI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){H(`Setting Jupyter Server URI to remote: ${t}`);let n=t.toString(!0),i=new URL(n),o=mI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await ca(t.toString(!0),"SHA-1"),c={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:c}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:Pt}),this._onDidChangeHandles.fire()}};dI=g([(0,HC.injectable)(),d(0,(0,HC.inject)(Gt)),d(1,(0,HC.inject)(Zt))],dI);var K0=k(M());var GC=require("vscode");var fI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){GC.workspace.isTrusted&&this.registerCommand(J.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let n=GC.commands.registerCommand(e,t,this);this.disposables.push(n)}async continueEditSessionInCodespace(){await GC.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};fI=g([(0,K0.injectable)(),d(0,(0,K0.inject)(K))],fI);var Pz=k(M());var kz=require("vscode");var hI=class{activate(){this.eagerlyActivateOtherExtensions().catch(f)}async eagerlyActivateOtherExtensions(){await Promise.all(kz.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(f,f)))}};hI=g([(0,Pz.injectable)()],hI);var F0=k(M()),Dz=require("vscode");var gI=class{constructor(e){this.uriStorage=e}activate(){Dz.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(n=>{n.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(n.provider)}),e})}};gI=g([(0,F0.injectable)(),d(0,(0,F0.inject)(Zt))],gI);function _z(r,e,t){e.addSingleton(Ie,iI),e.addSingleton(Ie,Lf),e.addSingleton(Ie,tI),e.addSingleton(Ie,nI),e.addSingleton(uz,Of),e.addSingleton(Ie,Of),e.addSingleton(Ie,hI),e.addSingleton(Ie,dI),e.add(wh,Yb),e.add(pE,Zb),e.addSingleton(Ie,eI),e.addSingleton(Ie,fI),e.addSingleton(qF,ml),e.addBinding(qF,Ie),e.add(fP,sI),e.addSingleton(dN,oI),e.addSingleton(Du,Du),e.addSingleton(Ie,lI),Sz(e),vz(r,t),e.addSingleton(Ie,pI),e.addSingleton(Ie,gI)}var gl=k(M()),Ys=require("vscode");var L0=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var Tz=1e3,Aye;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(Aye||={});var Qs;(p=>(p.Started="started",p.UpdateSettings="update_settings",p.InitializeData="init",p.GetAllRowsRequest="get_all_rows_request",p.GetAllRowsResponse="get_all_rows_response",p.GetRowsRequest="get_rows_request",p.GetRowsResponse="get_rows_response",p.CompletedData="complete",p.GetSliceRequest="get_slice_request",p.RefreshDataViewer="refresh_data_viewer",p.SliceEnablementStateChanged="slice_enablement_state_changed"))(Qs||={});var vI=Symbol("IDataViewerFactory"),U0=Symbol("IDataViewer"),j0=Symbol("IJupyterVariableDataProvider"),W0=Symbol("IJupyterVariableDataProviderFactory"),yI=Symbol("IDataViewerDependencyService");var YF;function XF(r,e){return YF&&YF.hasOwnProperty(r)?YF[r]:e}function ZF(r,...e){return r.replace(/{(\d+)}/g,(t,n)=>e[n]===void 0?t:e[n])}var Nye=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function eL(r){let e=r.length-2;return"["+r.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function Mye(r,e){if(r.startsWith("[")&&r.endsWith("]")){let t,n=r.substring(1,r.length-1).split(",").map((i,o)=>{let s=Nye.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),c=e[o];return(a>=0&&a>=c||a<0&&a<-c)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=XF("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return ZF(s,o.toString(),i.toString(),e[i].toString())}else if(n&&n.length!==e.length){let i=XF("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return ZF(i,e.length.toString(),n.length.toString())}}return""}function Rz(r,e){return Mye(r,e)===""}var Tu=require("vscode");var _u=class{constructor(e,t,n){this.configService=e;this.rootPath=t;this.scripts=n;this.disposed=!1;this.themeIsDarkPromise=ce();this.webviewInit=ce();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new Tu.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(f)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let n=JSON.stringify(t);this.postMessageInternal("update_settings",n).catch(f)}}};this._disposables.push(Tu.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=ce(),this.postMessageInternal("get_html_by_id_request",e).catch(f);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(n=>{n(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||ce(),this.webview===void 0){let n=await this.generateDataScienceExtraSettings(),i=Tu.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,n,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(f),this.sendLocStrings().catch(f)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=Tu.workspace.getConfiguration("editor"),n=Tu.workspace.getConfiguration("workbench"),i=n?n.get("colorTheme",xR):xR,o=Tu.extensions.getExtension(ei);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:qr()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Bt.collapseSingle,expandSingle:Bt.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Bt.noRowsInDataViewer,sliceIndexError:Bt.sliceIndexError,sliceMismatchedAxesError:Bt.sliceMismatchedAxesError,filterRowsTooltip:Bt.sliceMismatchedAxesError,fetchingDataViewer:Bt.fetchingDataViewer,dataViewerHideFilters:Bt.dataViewerHideFilters,dataViewerShowFilters:Bt.dataViewerShowFilters,refreshDataViewer:Bt.refreshDataViewer,clearFilters:Bt.refreshDataViewer,sliceSummaryTitle:Bt.sliceSummaryTitle,sliceData:Bt.sliceData,sliceSubmitButton:Bt.sliceSubmitButton,sliceDropdownAxisLabel:Bt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Bt.sliceDropdownIndexLabel,variableExplorerNameColumn:Bt.variableExplorerNameColumn,variableExplorerTypeColumn:Bt.variableExplorerTypeColumn,variableExplorerCountColumn:Bt.variableExplorerCountColumn,variableExplorerValueColumn:Bt.variableExplorerValueColumn,collapseVariableExplorerLabel:Bt.collapseVariableExplorerLabel,variableLoadingValue:Bt.variableLoadingValue,showDataExplorerTooltip:Bt.showDataExplorerTooltip,noRowsInVariableExplorer:Bt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Bt.loadingRowsInVariableExplorer,previousPlot:Bt.previousPlot,nextPlot:Bt.nextPlot,panPlot:Bt.panPlot,zoomInPlot:Bt.zoomInPlot,zoomOutPlot:Bt.zoomOutPlot,exportPlot:Bt.exportPlot,deletePlot:Bt.deletePlot,selectedImageListLabel:Bt.selectedImageListLabel,selectedImageLabel:Bt.selectedImageLabel};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(f)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(f),this.onDataScienceSettingsChanged().catch(f)}getValue(e,t,n){return e?e.get(t,n):n}};g([uh()],_u.prototype,"getHTMLById",1),g([uh()],_u.prototype,"addMessageListener",1),g([uh()],_u.prototype,"removeMessageListener",1);var bI=class extends _u{constructor(t,n,i,o,s,a,c){super(t,o,s);this.configService=t;this.provider=n;this._title=a;this.viewColumn=c;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let n=t.isVisible(),i=t.isActive(),o={visible:n,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=n,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,n,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:n,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var Az="JupyterDataViewerPreferredViewColumn",Wf=class extends bI{constructor(t,n,i,o,s){let a=sr(s.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new L0(c,l,u),a,[sr(a,"dataExplorer.js")],y.dataExplorerTitle,i.get(Az)??Ys.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new Ys.EventEmitter;this._onDidChangeDataViewerViewState=new Ys.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,n){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(Ys.Uri.file(process.cwd())).catch(x),super.setTitle(n),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=eL(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(Qs.InitializeData,i).catch(f)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let n=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&n.shape!==void 0)if(Rz(t,n.shape))n=await this.getDataFrameInfo(t);else{let i=eL(n.shape);n=await this.getDataFrameInfo(i)}H(`Refreshing data viewer for variable ${n.name}`),this.postMessage(Qs.InitializeData,n).catch(f)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(Az,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,n){switch(t){case Qs.GetAllRowsRequest:this.getAllRows(n).catch(f);break;case Qs.GetRowsRequest:this.getRowChunk(n).catch(f);break;case Qs.GetSliceRequest:this.getSlice(n).catch(f);break;case Qs.RefreshDataViewer:this.refreshData().catch(f),A("DATASCIENCE.REFRESH_DATA_VIEWER");break;case Qs.SliceEnablementStateChanged:A("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:n.newState?"checked":"unchecked"});break;default:break}super.onMessage(t,n)}getDataFrameInfo(t,n){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,n):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Be;let t=await this.getDataFrameInfo();try{A("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(Qs.GetAllRowsResponse,n)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.slice);return n.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(n.shape.length),A("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(Qs.InitializeData,n)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let n=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,n.rowCount?n.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(Qs.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(n){if(n instanceof Ny){x(n.message);let i=y.pythonInteractiveHelpLink;Ys.window.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&Ys.env.openExternal(Ys.Uri.parse(aS.JupyterDataRateHelpLink))},f),this.dispose()}x(n),this.errorHandler.handleError(n).then(f,f)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&A("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(A("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};g([pr("DATAVIEWER.WEBVIEW_LOADED")],Wf.prototype,"showData",1),Wf=g([(0,gl.injectable)(),d(0,(0,gl.inject)(fp)),d(1,(0,gl.inject)(ae)),d(2,(0,gl.inject)($e)),d(2,(0,gl.named)(yt)),d(3,(0,gl.inject)(Yr)),d(4,(0,gl.inject)(ct))],Wf);var Zr=k(M()),Xs=require("vscode");var B0=require("vscode");var V0=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>Tz&&await this.shouldAskForLargeData(t)){let n=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await B0.window.showWarningMessage(n,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,B0.ConfigurationTarget.Global).catch(f))}};var II=class{constructor(e,t,n,i,o,s,a,c,l,u,p,m){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=c;this.interpreterService=l;this.platformService=u;this.kernelProvider=p;this.interactiveWindowProvider=m;this.dataViewerChecker=new V0(n),Xs.workspace.isTrusted||Xs.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){Xs.workspace.isTrusted&&this.registerCommand(J.ShowDataViewer,this.onVariablePanelShowDataViewerRequest)}registerCommand(e,t){let n=Xs.commands.registerCommand(e,t,this);this.disposables.push(n)}async onVariablePanelShowDataViewerRequest(e){let t="variable"in e?e.variable:e;if(A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX"),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let c=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);c&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(c)}let n=OT(t),i=await this.variableProvider.getFullVariable(n),o=await this.jupyterVariableDataProviderFactory.create(i),a=(await o.getDataFrameInfo())?.columns?.length;if(a&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(a)){let c=`${y.dataExplorerTitle} - ${i.name}`,l=await this.dataViewerFactory.create(o,c);return A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),l}}catch(n){A("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,n),x(n),this.errorHandler.handleError(n).then(f,f)}else try{let n=this.getActiveKernel();if(n&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let i=await this.jupyterVariableDataProviderFactory.create(t,n),o=`${y.dataExplorerTitle} - ${t.name}`;return await this.dataViewerFactory.create(i,o)}}catch(n){x(n),A("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),Xs.window.showErrorMessage(y.showDataViewerFail).then(f,f)}}getActiveKernel(){let e=Xs.window.activeNotebookEditor?.notebook,t=e?.notebookType==It?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Xs.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){H("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(H("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(H("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let n=t;return n.startsWith("~")&&this.platformService.homeDir&&(n=mh(n,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(Xs.Uri.file(n))}else return this.interpreterService.getActiveInterpreter()}};II=g([(0,Zr.injectable)(),d(0,(0,Zr.inject)(K)),d(1,(0,Zr.inject)(Ti)),d(1,(0,Zr.optional)()),d(2,(0,Zr.inject)(ae)),d(3,(0,Zr.inject)(W0)),d(3,(0,Zr.optional)()),d(4,(0,Zr.inject)(vI)),d(4,(0,Zr.optional)()),d(5,(0,Zr.inject)(Rn)),d(5,(0,Zr.optional)()),d(5,(0,Zr.named)(Ge.DEBUGGER_VARIABLES)),d(6,(0,Zr.inject)(Yr)),d(7,(0,Zr.inject)(yI)),d(7,(0,Zr.optional)()),d(8,(0,Zr.inject)(Qe)),d(8,(0,Zr.optional)()),d(9,(0,Zr.inject)(Cr)),d(10,(0,Zr.inject)(Fe)),d(11,(0,Zr.inject)(Ki))],II);var xI=k(M());var q0="0.20.0";var J0=require("vscode");var Vf=class{async getVersion(e,t){try{let n=await this._getVersion(e,t);return typeof n=="string"?$E(n):n}catch(n){j(y.failedToGetVersionOfPandas,n.message);return}}async promptInstall(e,t,n){let i=n?y.pandasTooOldForViewingFormat(n,q0):y.pandasRequiredForViewing(q0);if(($d()?ge.install:await J0.window.showErrorMessage(i,{modal:!0},ge.install))===ge.install)await this._doInstall(e,t);else throw A("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new J0.CancellationTokenSource;try{let n=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){A("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(n){if(n.compare(q0)>0){A("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}A("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${n.major}.${n.minor}.${n.build}`;await this.promptInstall(e,t,i)}A("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};g([pr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:fr.get(23)})],Vf.prototype,"promptInstall",1);var tL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",Oye=`import pandas;print(pandas.__version__);print("${tL}")`,$0=class extends Vf{constructor(t,n,i){super();this.installer=t;this.pythonFactory=n;this.interpreterService=i}async _getVersion(t,n){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",Oye],{throwOnStdErr:!0,token:n})).stdout;if(!s?.includes(tL))return j(y.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Ke(s.trim()),c=a.indexOf(tL);return c>=0?a[c-1]:""}async _doInstall(t,n){let i=t||await this.interpreterService.getActiveInterpreter();if(n.token.isCancellationRequested)return;await mr(n.token,2,this.installer.install(23,i,n))===0&&A("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){A("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var rL="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",Kye=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${rL}"); del _VSCODE_pandas`;function Fye(r){return r.kernelConnectionMetadata.interpreter?.envType==="Conda"?"%conda":"%pip"}var H0=class extends Vf{async execute(e,t){if(!t.session?.kernel)throw new fn;let n=await hn(t.session.kernel,e),i=n.find(o=>o.output_type==="error");return i&&j(y.failedToGetVersionOfPandas,i.message),n.map(o=>o.text?.toString())}async _getVersion(e){let n=(await this.execute(Kye,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!n?.includes(rL))return j(y.failedToGetVersionOfPandas,`Output is ${n}`),"";let i=Ke(n.trim()),o=i.indexOf(rL);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${Fye(e)} install pandas`;try{await this.execute(t,e),A("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(n){throw A("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,n),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(A("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw A("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};function Lye(r){return"sysPrefix"in r&&typeof r.sysPrefix=="string"}var SI=class{constructor(e,t,n){this.withKernel=new H0,this.withInterpreter=new $0(e,t,n)}async checkAndInstallMissingDependencies(e){return Lye(e)?this.withInterpreter.checkAndInstallMissingDependencies(e):this.withKernel.checkAndInstallMissingDependencies(e)}};SI=g([(0,xI.injectable)(),d(0,(0,xI.inject)(Mi)),d(1,(0,xI.inject)(Or)),d(2,(0,xI.inject)(Qe))],SI);var CI=k(M());var Nz=require("vscode");var Fd=class{constructor(e,t,n){this.serviceContainer=e;this.disposables=n;this.knownViewers=new Set;t.push(this),this.viewContext=new ir(yr.IsDataViewerActive),this.disposables.push(Nz.commands.registerCommand(J.RefreshDataViewer,this.refreshDataViewer,this))}async dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let n,i=this.serviceContainer.get(U0);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),n=i}finally{n||i.dispose()}return n}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(f,f)}};g([pr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Fd.prototype,"create",1),g([hv(1e3)],Fd.prototype,"refreshDataViewer",1),Fd=g([(0,CI.injectable)(),d(0,(0,CI.inject)(lt)),d(1,(0,CI.inject)(ni)),d(2,(0,CI.inject)(K))],Fd);var Au=k(M());var Ru=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let n;switch(t.type){case"bool":n="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":n="number";break;default:n="string"}return{key:t.key,type:n}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{x(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let n={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),n={columns:i.columns?Ru.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Ru.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Ee(i.fileName)}),t&&(this.variable=i),n}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,n){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,n)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Uu()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Ru=g([(0,Au.injectable)(),d(0,(0,Au.inject)(Rn)),d(0,(0,Au.named)(Ge.ALL_VARIABLES)),d(1,(0,Au.inject)(yI)),d(1,(0,Au.optional)())],Ru);var G0=k(M());var wI=class{constructor(e){this.serviceContainer=e}async create(e,t){let n=this.serviceContainer.get(j0);return n.setDependencies(e,t),n}};wI=g([(0,G0.injectable)(),d(0,(0,G0.inject)(lt))],wI);var zC=k(M()),z0=require("vscode");var EI=class{constructor(e,t){this.kernelProvider=e;this.controllers=t;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){Q(this.disposables)}activate(){let e=z0.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,n=e.session?.kernel?.iopubMessage;if(!n)return;let i=require("@jupyterlab/services"),o=(s,a)=>{s===t&&(i.KernelMessage.isDisplayDataMsg(a)||i.KernelMessage.isUpdateDisplayDataMsg(a)||i.KernelMessage.isExecuteReplyMsg(a)||i.KernelMessage.isExecuteResultMsg(a))&&this.trackModelId(e.notebook,a)};n.connect(o),this.disposables.push(new z0.Disposable(()=>n.disconnect(o)))}trackModelId(e,t){let n=t.content;if(n.data&&typeof n.data=="object"&&Ui in n.data){let i=n.data[Ui];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:n}){n&&typeof n=="object"&&n.command==="query-widget-state"&&this.queryWidgetState(e,t,n),n&&typeof n=="object"&&n.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,n){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(n.model_id);e.postMessage({command:"query-widget-state",model_id:n.model_id,hasWidgetState:s,kernelSelected:o},t).then(f,f)}sendWidgetVersionAndState(e,t){let n=this.kernelProvider.get(t.notebook),i=n?.ipywidgetsVersion;n?.ipywidgetsVersion&&E(`IPyWidget version in Kernel is ${n?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(f,f)}};EI=g([(0,zC.injectable)(),d(0,(0,zC.inject)(Fe)),d(1,(0,zC.inject)(St))],EI);var qf=k(M());var nL=require("vscode");var Bf=k(M());var vl=require("vscode");var Q0=class{constructor(e,t,n){this.disposedCallback=n,this.callback=e,this.viewChanged=t}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var Zs;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(Zs||={});var Mz=class{static{Zs.Started,Zs.UpdateSettings,Zs.SendPlot,Zs.CopyPlot,Zs.ExportPlot,Zs.RemovePlot}},Y0=Symbol("IPlotViewerProvider"),X0=Symbol("IPlotViewer");var PI=class extends bI{constructor(t,n,i,o){let s=new Be,a=sr(o.extensionUri,"dist","webviews","webview-side","viewers");super(n,t,(c,l,u)=>new Q0(c,l,u),a,[sr(a,"plotViewer.js")],y.plotViewerTitle,vl.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new vl.EventEmitter;this.removedEvent=new vl.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(Zs.SendPlot,t).catch(f))};super.loadWebview(vl.Uri.file(process.cwd())).catch(x).finally(()=>{A("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,n){switch(t){case Zs.CopyPlot:this.copyPlot(n.toString()).catch(f);break;case Zs.ExportPlot:this.exportPlot(n).catch(f);break;case Zs.RemovePlot:this.removePlot(n);break;default:break}super.onMessage(t,n)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){H("exporting plot...");let n={};n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await vl.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Wi(i.path).toLowerCase()){case".png":let s=Buffer.from(t.png.replace("data:image/png;base64",""),"base64");await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),vl.window.showErrorMessage(y.exportImageFailed(o.toString())).then(f,f)}}};PI=g([(0,Bf.injectable)(),d(0,(0,Bf.inject)(fp)),d(1,(0,Bf.inject)(ae)),d(2,(0,Bf.inject)(st)),d(3,(0,Bf.inject)(ct))],PI);var kI=class extends PI{constructor(t,n,i,o){super(t,n,i,o);this.fsNode=i}async exportPlot(t){H("exporting plot...");let n={};n[y.pdfFilter]=["pdf"],n[y.pngFilter]=["png"],n[y.svgFilter]=["svg"];let i=await nL.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:n});try{if(i)switch(Wi(i.fsPath).toLowerCase()){case".pdf":await iL(t.svg,this.fsNode,i);break;case".png":let s=Buffer.from(t.png.replace("data:image/png;base64",""),"base64");await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){x(o),nL.window.showErrorMessage(y.exportImageFailed(o)).then(f,f)}}};kI=g([(0,qf.injectable)(),d(0,(0,qf.inject)(fp)),d(1,(0,qf.inject)(ae)),d(2,(0,qf.inject)(hr)),d(3,(0,qf.inject)(ct))],kI);async function iL(r,e,t){H("Attempting pdf write...");let n=(await import("svg-to-pdfkit")).default,i=ce(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);H(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),n(s,r,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),H(`Finishing pdf to ${t.fsPath}`),await i.promise,H(`Completed pdf to ${t.fsPath}`)}var QC=k(M());var DI=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}async dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,n=await this.getOrCreate();await Promise.all(t.map(n.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(X0),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),A("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};DI=g([(0,QC.injectable)(),d(0,(0,QC.inject)(lt)),d(1,(0,QC.inject)(ni))],DI);var r1=k(M());var e1=k(M()),Ld=require("vscode");var t1="image/svg+xml",Z0={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[t1]:"svg"},_I=class{constructor(e){this.fs=e}async savePlot(e,t,n){if(e.isClosed)return;let i=Uye(e,t,n);if(!i)return x(`No plot to save ${V(e.uri)}, id: ${t} for ${n}`);if(!(n.toLowerCase()in Z0))return x(`Unsupported MimeType ${V(e.uri)}, id: ${t} for ${n}`);let o=await this.getSaveTarget(i,n);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let n=Z0[t.toLowerCase()],i={};e.items.find(c=>c.mime.toLowerCase()===t1)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),n==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[n]);let o=(Ld.workspace.workspaceFolders?.length||0)>0?Ld.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Ld.Uri.joinPath(o,s):Ld.Uri.file(s);return Ld.window.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let n=Wi(t.path).substring(1),i=Object.keys(Z0).find(s=>Z0[s]===n),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,Buffer.from(o.data))}async saveAsPdf(e,t){return x("Save as PDF is not yet supported on the web.")}};_I=g([(0,e1.injectable)(),d(0,(0,e1.inject)(st))],_I);function Uye(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var TI=class extends _I{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,n){let i=Buffer.from(t.items.find(o=>o.mime===t1).data).toString();await iL(i,this.fsNode,n)}};TI=g([(0,r1.injectable)(),d(0,(0,r1.inject)(hr))],TI);var n1=k(M());var jye="image/svg+xml",Wye="image/png",Nu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let n=Oz(e,t,jye),i;if(n)i=new TextDecoder().decode(n.data);else{let o=Oz(e,t,Wye);if(!o)return x(`No SVG or PNG Plot to open ${V(e.uri)}, id: ${t}`);i=Vye(o)}i&&await this.plotViewProvider.showPlot(i)}};Nu=g([(0,n1.injectable)(),d(0,(0,n1.inject)(Y0))],Nu);function Oz(r,e,t){for(let n of r.getCells())for(let i of n.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function Vye(r){let e=Buffer.from(r.data),t=e.toString("base64"),n=Bye(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${n.height}" width="${n.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function Bye(r){if(!qye(r))throw new Error("The buffer is not a valid png");return{width:r.readUInt32BE(16),height:r.readUInt32BE(20)}}function qye(r){return r[0]===137&&r[1]===80&&r[2]===78&&r[3]===71&&r[4]===13&&r[5]===10&&r[6]===26&&r[7]===10&&r.length>8+21}var YC=k(M()),o1=require("vscode");var i1=Symbol("IPlotSaveHandler");var RI=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){Q(this.disposables)}activate(){this.activateImpl().catch(f)}async activateImpl(){let e=o1.extensions.getExtension(ch);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(({editor:n,message:i})=>{let o=n.notebook||o1.window.activeNotebookEditor?.notebook;o&&(i.type==="saveImageAs"?this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType).catch(f):i.type==="openImageInPlotViewer"&&this.plotViewHandler.openPlot(o,i.outputId).catch(f))},this,this.disposables)}};RI=g([(0,YC.injectable)(),d(0,(0,YC.inject)(i1)),d(1,(0,YC.inject)(Nu))],RI);var Jf=k(M()),To=require("vscode");var AI=class{constructor(e,t,n,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=n;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new To.EventEmitter;this._onDidChangeActiveNotebook=new To.EventEmitter;this._onDidRestartActiveNotebook=new To.EventEmitter;this._executionCountTracker=new WeakMap;To.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),To.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),To.notebooks.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=To.window.activeNotebookEditor?.notebook,t=e?.notebookType==It?this.kernelProvider.get(e):void 0;if(t)return t;let n=this.getActiveInteractiveWindowDocument(),i=n?this.kernelProvider.get(n):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return To.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){_t(e.cell.notebook)&&e.state===To.NotebookCellExecutionState.Idle&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&_t(e.notebook)){let n=this._executionCountTracker.get(e.notebook);n&&(t.executionCount=n)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};AI=g([(0,Jf.injectable)(),d(0,(0,Jf.inject)(Ki)),d(1,(0,Jf.inject)(Fe)),d(2,(0,Jf.inject)(vI)),d(3,(0,Jf.inject)(K))],AI);var Kz=class{static{"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","finish_cell","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel"}},s1=Symbol("INotebookWatcher"),a1=Symbol("IVariableViewProvider");var XC=k(M()),Fz=require("vscode");var NI=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(Fz.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};NI=g([(0,XC.injectable)(),d(0,(0,XC.inject)(ct)),d(1,(0,XC.inject)(a1))],NI);var ta=k(M());var ea=require("vscode");var c1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}async dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var l1=class extends _u{constructor(t,n,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=n(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,n,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:n,webviewHost:o})}};var Lz=require("vscode");var $f=class extends l1{constructor(t,n,i,o,s,a,c){let l=sr(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,p)=>new c1(u,p),n,l,[sr(l,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.experiments=c;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),ea.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(ea.Uri.file(process.cwd()),t).catch(x),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,n){switch(t){case"get_variables_request":this.handleMessage(t,n,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,n,this.showDataViewer);break;default:break}super.onMessage(t,n)}handleMessage(t,n,i){let o=n;i.bind(this)(o)}handleVisibilityChanged(){let t=new ir("jupyter.variableViewVisible"),n=!1;this.webviewView&&(n=this.webviewView.visible),t.set(n).catch(f),n&&(A("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(f):this.postMessage("force_variable_refresh").catch(f))}async showDataViewer(t){try{if(this.experiments.inExperiment("DataViewerContribution")){let n=this.getMatchingVariableViewers(t.variable);if(n.length===0){await ea.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers");return}else if(n.length===1){let i=n[0].jupyterVariableViewers.command;return ea.commands.executeCommand(i,t.variable)}else{let i=n.filter(s=>s.extension.id!==Pt);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return ea.commands.executeCommand(s,t.variable)}let o=ea.window.createQuickPick();o.title="Select DataFrame Viewer",o.items=n.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(()=>{let s=o.selectedItems[0];s&&(o.hide(),ea.commands.executeCommand(s.command,t.variable).then(f,f))}),o.show()}}else return ea.commands.executeCommand(J.ShowDataViewer,t.variable)}catch(n){x(n),A("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),ea.window.showErrorMessage(y.showDataViewerFail).then(f,f)}}getMatchingVariableViewers(t){return this.getVariableViewers().filter(i=>i.jupyterVariableViewers.dataTypes.includes(t.type))}getVariableViewers(){return Lz.extensions.all.filter(n=>n.packageJSON?.contributes?.jupyterVariableViewers&&n.packageJSON?.contributes?.jupyterVariableViewers.length).map(n=>{let i=n.packageJSON?.contributes;return i?.jupyterVariableViewers?i.jupyterVariableViewers.map(o=>({extension:n,jupyterVariableViewers:o})):[]}).flat()}postProcessSupportsDataExplorer(t){let n=this.getVariableViewers();return t.pageResponse.forEach(i=>{this.experiments.inExperiment("DataViewerContribution")&&(i.supportsDataExplorer=n.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type)))}),t}async requestVariables(t){let n=this.notebookWatcher.activeKernel;if(n){let i=await this.variables.getVariables(t,n);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(f),A("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(f)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(f):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(f),this.postMessage("force_variable_refresh").catch(f)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(f)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(f)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(f)}};g([pr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],$f.prototype,"load",1),g([Nr()],$f.prototype,"showDataViewer",1),g([Nr()],$f.prototype,"requestVariables",1);var MI=class{constructor(e,t,n,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=n;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.experiments=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!Dr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=ce(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,n){e.webview.options={enableScripts:!0},this.variableView=new $f(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.experiments),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};MI=g([(0,ta.injectable)(),d(0,(0,ta.inject)(ae)),d(1,(0,ta.inject)(SP)),d(2,(0,ta.inject)(ct)),d(3,(0,ta.inject)(Rn)),d(3,(0,ta.named)(Ge.ALL_VARIABLES)),d(4,(0,ta.inject)(K)),d(5,(0,ta.inject)(s1)),d(6,(0,ta.inject)(mc))],MI);function Uz(r){r.addSingleton(Ie,RI),r.add(U0,Wf),r.addSingleton(vI,Fd),r.addSingleton(yI,SI),r.addSingleton(Ie,II),r.add(X0,kI),r.addSingleton(Y0,DI),r.addSingleton(i1,TI),r.addSingleton(Nu,Nu),r.addSingleton(s1,AI),r.addSingleton(Ie,NI),r.addSingleton(Ie,EI),r.addSingleton(a1,MI),r.add(j0,Ru),r.addSingleton(W0,wI)}var Wz=require("vscode");function Vz(r){let e=Wz.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");r.push(e);let t={get(n,i){let o=n[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),jz(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),jz(...s)}}return o}};return new Proxy(e,t)}function jz(...r){r.length===1?E(Ke(r[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):E(...r)}var Yz=k(mA());var Bz=k(M());var Hf=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,n,i){n?this.container.bind(e).to(t).whenTargetNamed(n):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,n,i){n?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,n){n?this.container.bind(e).toConstantValue(t).whenTargetNamed(n):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,n){n?this.container.rebind(e).to(t).whenTargetNamed(n):this.container.rebind(e).to(t)}rebindSingleton(e,t,n){n?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(n):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,n){n?this.container.rebind(e).toConstantValue(t).whenTargetNamed(n):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};g([uh()],Hf.prototype,"getContainer",1),Hf=g([(0,Bz.injectable)()],Hf);var Jz=oL(),u1=class{constructor(e,t,n){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=n}format(e,t,...n){let i=e?`${Iw()} [${e}] ${Jz(t,...n)}`:Jz(t,...n);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}traceLog(e,...t){this.channel.appendLine(this.format("",e,...t))}traceError(e,...t){this.channel.appendLine(this.format("error",e,...t))}traceWarn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}traceInfo(e,...t){this.channel.appendLine(this.format("info",e,...t))}traceVerbose(e,...t){this.channel.appendLine(this.format("debug",e,...t))}};var sL=oL();function p1(r,e,...t){let i=[...t].length===0?sL(e):sL(e,...t);return r?`${r} ${Iw()}: ${i}`:i}var d1=class{constructor(e){this.prefix=e}traceLog(e,...t){console.log(sL(`${this.prefix||""} ${e}`,...t))}traceError(e,...t){console.error(p1("error",`${this.prefix||""} ${e}`,...t))}traceWarn(e,...t){console.warn(p1("warn",`${this.prefix||""} ${e}`,...t))}traceInfo(e,...t){console.info(p1("info",`${this.prefix||""} ${e}`,...t))}traceVerbose(e,...t){console.log(p1("verbose",`${this.prefix||""} ${e}`,...t))}};var Ud=require("os");var yl=k(require("vscode"));var Hz=k(require("vscode"));var Gf=k(require("vscode"));function OI(r){r.sort((t,n)=>t-n);let e=r.shift();return e===void 0?[]:r.reduce(function(t,n){return n<=t[0][1]?t[0][1]=n+1:t.unshift([n,n+1]),t},[[e,e+1]]).reverse().map(t=>new Gf.NotebookRange(t[0],t[1]))}function Jye(r){return Gf.workspace.notebookDocuments.find(e=>e.uri.authority===r.uri.authority&&e.uri.path===r.uri.path)}function ZC(r){let e=Gf.workspace.textDocuments.find(o=>o.uri.toString()===r?.document.uri.toString())??Gf.window.activeTextEditor?.document;if(!e)return;let t=Jye(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function aL(r,e){return r.start.line===e.start.line&&r.start.character===e.start.character&&r.end.line===e.end.line&&r.end.character===e.end.character}function vi(){}var $z="ms-python.vscode-pylance";async function $ye(r){return await r.activate()}var cL;async function Gz(){let r=Hz.extensions.getExtension($z);if(r)return cL||new Promise((e,t)=>{$ye(r).then(async n=>{if(!n){console.error("Could not start Pylance"),t();return}n.client&&await n.client.start(),cL=n.notebook,e(n.notebook)}).then(vi,vi)})}var Pr=k(require("vscode"));var Hye=Pr.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),Gye=Pr.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),KI=class{constructor(e,t,n){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=n}_getVirtualCellList(e){return this._cellExecution.findIndex(n=>n.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(n=>n.cell)}getPredecessorCells(e,t=!1){let n=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=n.length-1;i>=0&&n[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=n.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let c=new Map;for(let[p,m]of this._cellRefs.entries()){let h=m.filter(v=>v.kind==="write").map(v=>v.uri.fragment);m.forEach(v=>{let b=v.uri.fragment;c.has(b)?c.get(b)?.push(p):c.set(b,[p])}),m.forEach(v=>{let b=v.uri.fragment;c.has(b)?c.get(b)?.push(...h):c.set(b,h)})}let l=e.document.uri.fragment;this._resolveDependencies(c,a,l,s);let u=[];for(let p=0;p<a.length;p++)a[p]&&u.push(s[p]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),n=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(n===-1)return[];let i=new Array(t.length).fill(!1);i[n]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(c=>{if(c.kind==="write"){let l=c.uri.fragment,u=o.get(l)??[];u.push(...a.filter(p=>p!==c)),o.set(l,u)}})});for(let a=n;a<t.length;a++)if(i[a]){let c=this._cellRefs.get(t[a].document.uri.fragment)||[],l=o.get(t[a].document.uri.fragment)||[];[...c,...l].forEach(p=>{let m=t.findIndex(h=>h.document.uri.fragment===p.uri.fragment);m!==-1&&m>=a&&(i[m]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,n,i){if(e.has(n))for(let o of e.get(n)){let s=i.findIndex(a=>a.document.uri.fragment===o);if(s===-1)throw new Error(`Dependency ${o} is not in the execution list.`);t[s]||(t[s]=!0,this._resolveDependencies(e,t,o,i))}}};var m1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(n=>{this._requestCellSymbols(n,!1).then(vi,vi)}),this._disposables.push(Pr.workspace.onDidChangeNotebookDocument(n=>{n.notebook===this._notebookEditor.notebook&&(n.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(vi,vi)})}),n.cellChanges.forEach(i=>{this._requestCellSymbols(i.cell,!1).then(vi,vi),this._updateCellStatus(i.cell,0)}))})),this._disposables.push(Pr.notebooks.onDidChangeNotebookCellExecutionState(n=>{n.state===Pr.NotebookCellExecutionState.Executing&&n.cell.document.languageId==="python"&&this._updateCellStatus(n.cell,1),n.state===Pr.NotebookCellExecutionState.Idle&&n.cell.document.languageId==="python"&&(this._cellExecution.push({cell:n.cell,executionCount:n.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(n.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let n=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);n&&await this._requestCellSymbols(n,!0)}}async selectPrecedentCells(e){await this.requestCellSymbolsSync();let t=new KI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs);try{let n=t.getPredecessorCells(e);this._notebookEditor.selections=OI(n.map(i=>i.index));return}catch{}try{let n=t.getPredecessorCells(e,!0);this._notebookEditor.selections=OI(n.map(i=>i.index));return}catch{}}async selectSuccessorCells(e){await this.requestCellSymbolsSync();let n=new KI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=OI(n.map(o=>o.index));this._notebookEditor.selections=i}async runPrecedentCells(e){await this.requestCellSymbolsSync();let t=new KI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),n=[];try{n=t.getPredecessorCells(e)}catch{try{n=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=n.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0),o=OI((i===-1?n:n.slice(i)).map(s=>s.index));await Pr.commands.executeCommand("notebook.cell.execute",{ranges:o.map(s=>({start:s.start,end:s.end})),document:this._notebookEditor.notebook.uri}).then(vi,vi)}async runSuccessorCells(e){await this.requestCellSymbolsSync();let n=new KI(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e),i=OI(n.map(o=>o.index));await Pr.commands.executeCommand("notebook.cell.execute",{ranges:i.map(o=>({start:o.start,end:o.end})),document:this._notebookEditor.notebook.uri}).then(vi,vi)}async debugSymbols(){let e=[];await this.requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let n of Pr.window.visibleTextEditors){let i=n.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(n=>{let i=n.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(n)}),t.forEach((n,i)=>{let o=Pr.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];n.reduce((l,u)=>l.find(m=>aL(m.range,u.range))?l:l.concat([u]),[]).forEach(l=>{let u=new Pr.Position(l.range.end.line,l.range.end.character),p=new Pr.Range(u,u);l.kind==="write"?s.push(p):l.kind==="read"&&a.push(p)}),o.setDecorations(Hye,s),o.setDecorations(Gye,a)}})}async _requestCellSymbols(e,t){let n=this._pendingRequests.get(e.document.uri.fragment);if(n&&n.cancel(),t){let o=new Pr.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new Pr.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(vi,vi))},500)}async _getDocumentSymbols(e){return Pr.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let n=await this._getDocumentSymbols(e);if(!n)return;let i=[];for(let o of n){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:Pr.Uri.parse(o.uri),kind:aL(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},f1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;Pr.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new m1(t,this._client))}),this._disposables.push(Pr.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(n=>{this._notebookDocumentSymbolTrackers.has(n.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(n.notebook.uri.toString(),new m1(n,this._client))}),this._notebookDocumentSymbolTrackers.forEach((n,i)=>{Pr.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(n.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runSuccessorCells(t)}async runPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.runPrecedentCells(t)}async selectSuccessorCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let n=this._notebookDocumentSymbolTrackers.get(e.uri.toString());n&&await n.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}};async function zz(r){if(!yl.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await Gz();if(!t)return;let n=new f1(t);r.subscriptions.push(n),r.subscriptions.push(yl.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=ZC(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectSuccessorCells(s,a)})),r.subscriptions.push(yl.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=ZC(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runPrecedentCells(s,a)})),r.subscriptions.push(yl.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=ZC(i);if(!o)return;let{notebook:s,cell:a}=o;await n.runSuccessorCells(s,a)})),r.subscriptions.push(yl.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=ZC(i);if(!o)return;let{notebook:s,cell:a}=o;await n.selectPrecedentCells(s,a)})),r.subscriptions.push(yl.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=yl.window.activeNotebookEditor;i&&await n.debugSymbols(i.notebook)}))}function Qz(){}var h1={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0},lL=new Be;h1.codeLoadingTime=lL.elapsedTime;var uL;async function zye(r){PV(r.subscriptions),JU(lr.env.uiKind==lr.UIKind.Web),HU(!1),r.subscriptions.push({dispose:()=>oS.isExiting=!0});try{let e,t;return[e,t]=await Yye(r,lL,h1),qV(t,h1,lL).catch(f),await t,e}catch(e){return await Zye(e,h1),x("Failed to active the Jupyter Extension",e),{ready:Promise.resolve(),registerPythonApi:f,registerRemoteServerProvider:()=>({dispose:f}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0)}}}}function Qye(){if(oS.isExiting=!0,uL){let r=uL.get(ni);if(r)return r.dispose()}return Qz(),Promise.resolve()}async function Yye(r,e,t){let n=ce();try{Xye(n.promise),t.startActivateTime=e.elapsedTime;let[i,o]=abe(r);uL=o,u7(c=>o.get(Mp).getPackageVersions(c));let s=tbe(r,i,o);return t.endActivateTime=e.elapsedTime,n.resolve(),zz(r).then(f,f),[WV(s,i,o,r),s,o]}finally{n.completed||n.reject()}}function Xye(r){let e={location:lr.ProgressLocation.Window,title:ge.loadingExtension};lr.window.withProgress(e,()=>r).then(f,f)}async function Zye(r,e){ebe(ge.handleExtensionActivationError),console.error("extension activation failed",r),x("extension activation failed",r),await JV(r,e)}function ebe(r){try{lr.window.showErrorMessage(r).then(f,f)}catch(e){x("failed to notify user",e)}}async function tbe(r,e,t){return sbe(r,e,t)}function rbe(){if(process.env.VSC_JUPYTER_FORCE_LOGGING){let r;Zn||(r="Jupyter Extension:"),UR(new d1(r))}}function Xz(r){return r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function nbe(){try{let r=Xz((0,Ud.userInfo)().username);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get username info with ${r}
 username will not be obfuscated in local logs`)}}function ibe(){try{let r=Xz(Fg().fsPath);return new RegExp(r,"ig")}catch(r){console.info(`jupyter extension failed to get home directory path with ${r}
 home Path will not be obfuscated in local logs`)}}function obe(r,e){let t=lr.window.createOutputChannel(xA.jupyter,"log");UR(new u1(t,ibe(),nbe())),e.addSingletonInstance(Mo,t,Ku),e.addSingletonInstance(Mo,Vz(r.subscriptions),ah),t.appendLine(`${lr.env.appName} (${lr.version}, ${lr.env.remoteName}, ${lr.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${r.extension.packageJSON.version}.`);let n=lr.extensions.getExtension(ei);n?t.appendLine(`Python Extension Version: ${n.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=lr.extensions.getExtension(Hd);i?t.appendLine(`Pylance Extension Version: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),t.appendLine(`Platform: ${(0,Ud.platform)()} (${(0,Ud.arch)()}).`),!lr.workspace.workspaceFolders||lr.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):lr.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${V(lr.workspace.workspaceFolders[0].uri)}, Home = ${vk.fsPath}`):t.appendLine(`Multiple Workspace folders opened ${lr.workspace.workspaceFolders.map(o=>V(o.uri)).join(", ")}`)}async function sbe(r,e,t){let n=!Dr()&&(r.extensionMode===lr.ExtensionMode.Development||lr.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(b2,n),n&&lr.commands.executeCommand("setContext","jupyter.development",!0).then(f,f),lr.commands.executeCommand("setContext","jupyter.webExtension",!1).then(f,f),kj((0,Ud.homedir)()),rbe(),obe(r,e),e7(e),QH(e,n),iG(e,n),az(e),_z(r,e,n),Uz(e);let i=t.get(mc),o=new Be;await i.activate();let s=o.elapsedTime;A("DS_INTERNAL.EXPERIMENT_LOAD",{duration:s});let c=e.get(ae).getSettings();jR(c.logging.level),c.onDidChange(()=>{jR(c.logging.level)}),lr.commands.executeCommand("setContext","jupyter.vscode.channel",mo()).then(f,f),t.get(fP).activate();let l=t.get(kE);l.initialize(),r.subscriptions.push(l)}function abe(r){let e=new Yz.Container({skipBaseClassChecks:!0}),t=new Hf(e),n=new _e(e);return t.addSingletonInstance(lt,n),t.addSingletonInstance(VV,t),t.addSingletonInstance(K,r.subscriptions),t.addSingletonInstance($e,r.globalState,yt),t.addSingletonInstance($e,r.workspaceState,ri),t.addSingletonInstance(ct,r),[t,n]}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

mime-db/index.js:
  (*!
   * mime-db
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015-2022 Douglas Christopher Wilson
   * MIT Licensed
   *)

mime-types/index.js:
  (*!
   * mime-types
   * Copyright(c) 2014 Jonathan Ong
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
