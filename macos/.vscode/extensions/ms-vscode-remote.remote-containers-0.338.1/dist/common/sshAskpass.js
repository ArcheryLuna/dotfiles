/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

var O=Object.create;var w=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty;var j=(e,t,s,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of H(t))!L.call(e,r)&&r!==s&&w(e,r,{get:()=>t[r],enumerable:!(o=_(t,r))||o.enumerable});return e};var p=(e,t,s)=>(s=e!=null?O(I(e)):{},j(t||!e||!e.__esModule?w(s,"default",{value:e,enumerable:!0}):s,e));var P=p(require("net")),b=p(require("child_process")),y=p(require("fs")),A=p(require("path"));var i=p(require("path")),g=p(require("fs"));async function m(e,t=process.cwd(),s=process.env){if(process.platform!=="win32")return e;if(i.isAbsolute(e))return await d(e)||e;if(/[/\\]/.test(e)){let n=i.join(t,e);return await d(n)||n}let o,r;if(s){for(let n of Object.keys(s))if(n.toLowerCase()==="path"){let a=s[n];typeof a=="string"&&(o=a,r=a.split(i.delimiter).filter(Boolean),r.push(i.join(s.ProgramW6432||"C:\\Program Files","Docker\\Docker\\resources\\bin")));break}}if(r===void 0||r.length===0){let n=new Error(`No PATH to look up executable '${e}'.`);throw n.code="ENOENT",n}for(let n of r){let a;i.isAbsolute(n)?a=i.join(n,e):a=i.join(t,n,e);let f=await d(a);if(f)return f}let l=new Error(`Exectuable '${e}' not found on PATH '${o}'.`);throw l.code="ENOENT",l}var S=process.env.PATHEXT,x=S?S.toLowerCase().split(";"):[".com",".exe",".bat",".cmd"];async function d(e){if(x.indexOf(i.extname(e))!==-1)return await E(e)?e:void 0;for(let t of x){let s=e+t;if(await E(s))return s}}function E(e){return new Promise(t=>g.stat(e,(s,o)=>t(!s&&o.isFile())))}var v=process.env.VSCODE_SSH_ASKPASS_HANDLE;v||(console.error("VSCODE_SSH_ASKPASS_HANDLE not set."),process.exit(1));(async()=>{let e=process.argv.slice(2),t=process.env.VSCODE_SSH_ASKPASS_COUNTER;if(process.platform==="win32"){let o=process.env.WINDIR,r=o?A.join(o,"System32","wbem","en-US","csv.xsl"):void 0,l=r&&y.existsSync(r)?r:"csv",n=await m("wmic"),f=b.execSync(`"${n}" process where (commandline like "%ssh-askpass.bat%") get processid,parentprocessid /format:"${l}"`).toString().split(/\r?\n/).map(c=>c.trim()).filter(c=>!!c).map(c=>c.split(",")),N=f.shift(),u=f.map(c=>c.reduce((h,k,D)=>(h[N[D]]=k,h),{})).find(c=>c.ProcessId===String(process.ppid));u&&(t=u.ParentProcessId)}else t=e.shift();let s=P.connect(v,()=>{s.write(JSON.stringify({prompt:e.join(" "),counter:t})+`
`,o=>{o&&(console.error(o),process.exit(1))})});s.setEncoding("utf8"),s.on("data",o=>{process.stdout.write(o)}),s.on("error",o=>{console.error(o),process.exit(1)}),s.on("end",()=>{process.exit(0)})})().catch(console.error);
//# sourceMappingURL=sshAskpass.js.map
